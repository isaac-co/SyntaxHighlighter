<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""KDDCUP 99 dataset.

A classic dataset for anomaly detection.

The dataset page is available from UCI Machine Learning Repository

https://archive.ics.uci.edu/ml/machine-learning-databases/kddcup99-mld/kddcup.data.gz

"""</span>

<span class="keyword">import</span> <span class="identifier">errno</span>
<span class="keyword">from</span> <span class="identifier">gzip</span> <span class="keyword">import</span> <span class="identifier">GzipFile</span>
<span class="keyword">import</span> <span class="identifier">logging</span>
<span class="keyword">import</span> <span class="identifier">os</span>
<span class="keyword">from</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="keyword">import</span> <span class="identifier">dirname</span><span class="punctuation">,</span> <span class="identifier">exists</span><span class="punctuation">,</span> <span class="identifier">join</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">joblib</span>

<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">_base</span> <span class="keyword">import</span> <span class="identifier">_fetch_remote</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">_base</span> <span class="keyword">import</span> <span class="identifier">_convert_data_dataframe</span>
<span class="keyword">from</span> <span class="punctuation">.</span> <span class="keyword">import</span> <span class="identifier">get_data_home</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">_base</span> <span class="keyword">import</span> <span class="identifier">RemoteFileMetadata</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">Bunch</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">check_random_state</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">shuffle</span> <span class="keyword">as</span> <span class="identifier">shuffle_method</span>


<span class="comment"># The original data can be found at:</span>
<span class="comment"># https://archive.ics.uci.edu/ml/machine-learning-databases/kddcup99-mld/kddcup.data.gz</span>
<span class="identifier">ARCHIVE</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RemoteFileMetadata</span><span class="grouping">(</span>
    <span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="string-literal">'kddcup99_data'</span><span class="punctuation">,</span>
    <span class="identifier">url</span><span class="arithmetic-assignment">=</span><span class="string-literal">'https://ndownloader.figshare.com/files/5976045'</span><span class="punctuation">,</span>
    <span class="identifier">checksum</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="string-literal">'3b6c942aa0356c0ca35b7b595a26c89d'</span>
              <span class="string-literal">'343652c9db428893e7494f837b274292'</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># The original data can be found at:</span>
<span class="comment"># https://archive.ics.uci.edu/ml/machine-learning-databases/kddcup99-mld/kddcup.data_10_percent.gz</span>
<span class="identifier">ARCHIVE_10_PERCENT</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RemoteFileMetadata</span><span class="grouping">(</span>
    <span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="string-literal">'kddcup99_10_data'</span><span class="punctuation">,</span>
    <span class="identifier">url</span><span class="arithmetic-assignment">=</span><span class="string-literal">'https://ndownloader.figshare.com/files/5976042'</span><span class="punctuation">,</span>
    <span class="identifier">checksum</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="string-literal">'8045aca0d84e70e622d1148d7df78249'</span>
              <span class="string-literal">'6f6333bf6eb979a1b0837c42a9fd9561'</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="identifier">logger</span> <span class="arithmetic-assignment">=</span> <span class="identifier">logging</span><span class="punctuation">.</span><span class="identifier">getLogger</span><span class="grouping">(</span><span class="identifier">__name__</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">fetch_kddcup99</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="punctuation">,</span> <span class="identifier">subset</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">data_home</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">shuffle</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                   <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
                   <span class="identifier">percent10</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">download_if_missing</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">X</span><span class="invalid">_</span><span class="invalid">y</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                   <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Load the kddcup99 dataset (classification).

    Download it if necessary.

    =================   ====================================
    Classes                                               23
    Samples total                                    4898431
    Dimensionality                                        41
    Features            discrete (int) or continuous (float)
    =================   ====================================

    Read more in the :ref:`User Guide &lt;kddcup99_dataset&gt;`.

    .. versionadded:: 0.18

    Parameters
    ----------
    subset : {'SA', 'SF', 'http', 'smtp'}, default=None
        To return the corresponding classical subsets of kddcup 99.
        If None, return the entire kddcup 99 dataset.

    data_home : str, default=None
        Specify another download and cache folder for the datasets. By default
        all scikit-learn data is stored in '~/scikit_learn_data' subfolders.
        .. versionadded:: 0.19

    shuffle : bool, default=False
        Whether to shuffle dataset.

    random_state : int, RandomState instance or None, default=None
        Determines random number generation for dataset shuffling and for
        selection of abnormal samples if `subset='SA'`. Pass an int for
        reproducible output across multiple function calls.
        See :term:`Glossary &lt;random_state&gt;`.

    percent10 : bool, default=True
        Whether to load only 10 percent of the data.

    download_if_missing : bool, default=True
        If False, raise a IOError if the data is not locally available
        instead of trying to download the data from the source site.

    return_X_y : bool, default=False
        If True, returns ``(data, target)`` instead of a Bunch object. See
        below for more information about the `data` and `target` object.

        .. versionadded:: 0.20

    as_frame : bool, default=False
        If `True`, returns a pandas Dataframe for the ``data`` and ``target``
        objects in the `Bunch` returned object; `Bunch` return object will also
        have a ``frame`` member.

        .. versionadded:: 0.24

    Returns
    -------
    data : :class:`~sklearn.utils.Bunch`
        Dictionary-like object, with the following attributes.

        data : {ndarray, dataframe} of shape (494021, 41)
            The data matrix to learn. If `as_frame=True`, `data` will be a
            pandas DataFrame.
        target : {ndarray, series} of shape (494021,)
            The regression target for each sample. If `as_frame=True`, `target`
            will be a pandas Series.
        frame : dataframe of shape (494021, 42)
            Only present when `as_frame=True`. Contains `data` and `target`.
        DESCR : str
            The full description of the dataset.
        feature_names : list
            The names of the dataset columns
        target_names: list
            The names of the target columns

    (data, target) : tuple if ``return_X_y`` is True

        .. versionadded:: 0.20
    """</span>
    <span class="identifier">data_home</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_data_home</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="arithmetic-assignment">=</span><span class="identifier">data_home</span><span class="grouping">)</span>
    <span class="identifier">kddcup99</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_fetch_brute_kddcup99</span><span class="grouping">(</span>
        <span class="identifier">data_home</span><span class="arithmetic-assignment">=</span><span class="identifier">data_home</span><span class="punctuation">,</span>
        <span class="identifier">percent10</span><span class="arithmetic-assignment">=</span><span class="identifier">percent10</span><span class="punctuation">,</span>
        <span class="identifier">download_if_missing</span><span class="arithmetic-assignment">=</span><span class="identifier">download_if_missing</span>
    <span class="grouping">)</span>

    <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">kddcup99</span><span class="punctuation">.</span><span class="identifier">data</span>
    <span class="identifier">target</span> <span class="arithmetic-assignment">=</span> <span class="identifier">kddcup99</span><span class="punctuation">.</span><span class="identifier">target</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">kddcup99</span><span class="punctuation">.</span><span class="identifier">feature_names</span>
    <span class="identifier">target_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">kddcup99</span><span class="punctuation">.</span><span class="identifier">target_names</span>

    <span class="keyword">if</span> <span class="identifier">subset</span> <span class="relational-operator">==</span> <span class="string-literal">'SA'</span><span class="punctuation">:</span>
        <span class="identifier">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">target</span> <span class="relational-operator">==</span> <span class="identifier">b</span><span class="string-literal">'normal.'</span>
        <span class="identifier">t</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">logical_not</span><span class="grouping">(</span><span class="identifier">s</span><span class="grouping">)</span>
        <span class="identifier">normal_samples</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="grouping">[</span><span class="identifier">s</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">normal_targets</span> <span class="arithmetic-assignment">=</span> <span class="identifier">target</span><span class="grouping">[</span><span class="identifier">s</span><span class="grouping">]</span>
        <span class="identifier">abnormal_samples</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="grouping">[</span><span class="identifier">t</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">abnormal_targets</span> <span class="arithmetic-assignment">=</span> <span class="identifier">target</span><span class="grouping">[</span><span class="identifier">t</span><span class="grouping">]</span>

        <span class="identifier">n_samples_abnormal</span> <span class="arithmetic-assignment">=</span> <span class="identifier">abnormal_samples</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="comment"># selected abnormal samples:</span>
        <span class="identifier">random_state</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_random_state</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="grouping">)</span>
        <span class="identifier">r</span> <span class="arithmetic-assignment">=</span> <span class="identifier">random_state</span><span class="punctuation">.</span><span class="identifier">randint</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">n_samples_abnormal</span><span class="punctuation">,</span> <span class="int-literal">3377</span><span class="grouping">)</span>
        <span class="identifier">abnormal_samples</span> <span class="arithmetic-assignment">=</span> <span class="identifier">abnormal_samples</span><span class="grouping">[</span><span class="identifier">r</span><span class="grouping">]</span>
        <span class="identifier">abnormal_targets</span> <span class="arithmetic-assignment">=</span> <span class="identifier">abnormal_targets</span><span class="grouping">[</span><span class="identifier">r</span><span class="grouping">]</span>

        <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">r_</span><span class="grouping">[</span><span class="identifier">normal_samples</span><span class="punctuation">,</span> <span class="identifier">abnormal_samples</span><span class="grouping">]</span>
        <span class="identifier">target</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">r_</span><span class="grouping">[</span><span class="identifier">normal_targets</span><span class="punctuation">,</span> <span class="identifier">abnormal_targets</span><span class="grouping">]</span>

    <span class="keyword">if</span> <span class="identifier">subset</span> <span class="relational-operator">==</span> <span class="string-literal">'SF' or subset == 'http' or subset == 'smtp'</span><span class="punctuation">:</span>
        <span class="comment"># select all samples with positive logged_in attribute:</span>
        <span class="identifier">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">11</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>
        <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">c_</span><span class="grouping">[</span><span class="identifier">data</span><span class="grouping">[</span><span class="identifier">s</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="int-literal">11</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">[</span><span class="identifier">s</span><span class="punctuation">,</span> <span class="int-literal">12</span><span class="punctuation">:</span><span class="grouping">]</span><span class="grouping">]</span>
        <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">feature_names</span><span class="grouping">[</span><span class="punctuation">:</span><span class="int-literal">11</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">12</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">target</span> <span class="arithmetic-assignment">=</span> <span class="identifier">target</span><span class="grouping">[</span><span class="identifier">s</span><span class="grouping">]</span>

        <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.1</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">float</span><span class="punctuation">,</span> <span class="identifier">copy</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.1</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">float</span><span class="punctuation">,</span> <span class="identifier">copy</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.1</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">float</span><span class="punctuation">,</span> <span class="identifier">copy</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">subset</span> <span class="relational-operator">==</span> <span class="string-literal">'http'</span><span class="punctuation">:</span>
            <span class="identifier">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="identifier">b</span><span class="string-literal">'http'</span>
            <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="grouping">[</span><span class="identifier">s</span><span class="grouping">]</span>
            <span class="identifier">target</span> <span class="arithmetic-assignment">=</span> <span class="identifier">target</span><span class="grouping">[</span><span class="identifier">s</span><span class="grouping">]</span>
            <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">c_</span><span class="grouping">[</span><span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">]</span>
            <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span>
                             <span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">]</span>

        <span class="keyword">if</span> <span class="identifier">subset</span> <span class="relational-operator">==</span> <span class="string-literal">'smtp'</span><span class="punctuation">:</span>
            <span class="identifier">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="identifier">b</span><span class="string-literal">'smtp'</span>
            <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="grouping">[</span><span class="identifier">s</span><span class="grouping">]</span>
            <span class="identifier">target</span> <span class="arithmetic-assignment">=</span> <span class="identifier">target</span><span class="grouping">[</span><span class="identifier">s</span><span class="grouping">]</span>
            <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">c_</span><span class="grouping">[</span><span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">]</span>
            <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span>
                             <span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">]</span>

        <span class="keyword">if</span> <span class="identifier">subset</span> <span class="relational-operator">==</span> <span class="string-literal">'SF'</span><span class="punctuation">:</span>
            <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">c_</span><span class="grouping">[</span><span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">]</span>
            <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span>
                             <span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">]</span>

    <span class="keyword">if</span> <span class="identifier">shuffle</span><span class="punctuation">:</span>
        <span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">target</span> <span class="arithmetic-assignment">=</span> <span class="identifier">shuffle_method</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">target</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="grouping">)</span>

    <span class="identifier">module_path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">__file__</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">open</span><span class="grouping">(</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">module_path</span><span class="punctuation">,</span> <span class="string-literal">'descr', 'kddcup99.rst'</span><span class="grouping">)</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">rst_file</span><span class="punctuation">:</span>
        <span class="identifier">fdescr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rst_file</span><span class="punctuation">.</span><span class="identifier">read</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="identifier">frame</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
    <span class="keyword">if</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="punctuation">:</span>
        <span class="identifier">frame</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">target</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_convert_data_dataframe</span><span class="grouping">(</span>
            <span class="string-literal">"fetch_kddcup99"</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">target</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="punctuation">,</span> <span class="identifier">target_names</span>
        <span class="grouping">)</span>

    <span class="keyword">if</span> <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">X</span><span class="invalid">_</span><span class="invalid">y</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">target</span>

    <span class="keyword">return</span> <span class="identifier">Bunch</span><span class="grouping">(</span>
        <span class="identifier">data</span><span class="arithmetic-assignment">=</span><span class="identifier">data</span><span class="punctuation">,</span>
        <span class="identifier">target</span><span class="arithmetic-assignment">=</span><span class="identifier">target</span><span class="punctuation">,</span>
        <span class="identifier">frame</span><span class="arithmetic-assignment">=</span><span class="identifier">frame</span><span class="punctuation">,</span>
        <span class="identifier">target_names</span><span class="arithmetic-assignment">=</span><span class="identifier">target_names</span><span class="punctuation">,</span>
        <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
        <span class="identifier">DESCR</span><span class="arithmetic-assignment">=</span><span class="identifier">fdescr</span><span class="punctuation">,</span>
    <span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_fetch_brute_kddcup99</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
                          <span class="identifier">download_if_missing</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">percent10</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">:</span>

    <span class="comment">"""Load the kddcup99 dataset, downloading it if necessary.

    Parameters
    ----------
    data_home : str, default=None
        Specify another download and cache folder for the datasets. By default
        all scikit-learn data is stored in '~/scikit_learn_data' subfolders.

    download_if_missing : bool, default=True
        If False, raise a IOError if the data is not locally available
        instead of trying to download the data from the source site.

    percent10 : bool, default=True
        Whether to load only 10 percent of the data.

    Returns
    -------
    dataset : :class:`~sklearn.utils.Bunch`
        Dictionary-like object, with the following attributes.

        data : ndarray of shape (494021, 41)
            Each row corresponds to the 41 features in the dataset.
        target : ndarray of shape (494021,)
            Each value corresponds to one of the 21 attack types or to the
            label 'normal.'.
        feature_names : list
            The names of the dataset columns
        target_names: list
            The names of the target columns
        DESCR : str
            Description of the kddcup99 dataset.

    """</span>

    <span class="identifier">data_home</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_data_home</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="arithmetic-assignment">=</span><span class="identifier">data_home</span><span class="grouping">)</span>
    <span class="identifier">dir_suffix</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"-py3"</span>

    <span class="keyword">if</span> <span class="identifier">percent10</span><span class="punctuation">:</span>
        <span class="identifier">kddcup_dir</span> <span class="arithmetic-assignment">=</span> <span class="identifier">join</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="punctuation">,</span> <span class="string-literal">"kddcup99_10"</span> <span class="arithmetic-operator">+</span> <span class="identifier">dir_suffix</span><span class="grouping">)</span>
        <span class="identifier">archive</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ARCHIVE_10_PERCENT</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">kddcup_dir</span> <span class="arithmetic-assignment">=</span> <span class="identifier">join</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="punctuation">,</span> <span class="string-literal">"kddcup99"</span> <span class="arithmetic-operator">+</span> <span class="identifier">dir_suffix</span><span class="grouping">)</span>
        <span class="identifier">archive</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ARCHIVE</span>

    <span class="identifier">samples_path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">join</span><span class="grouping">(</span><span class="identifier">kddcup_dir</span><span class="punctuation">,</span> <span class="string-literal">"samples"</span><span class="grouping">)</span>
    <span class="identifier">targets_path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">join</span><span class="grouping">(</span><span class="identifier">kddcup_dir</span><span class="punctuation">,</span> <span class="string-literal">"targets"</span><span class="grouping">)</span>
    <span class="identifier">available</span> <span class="arithmetic-assignment">=</span> <span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">samples_path</span><span class="grouping">)</span>

    <span class="identifier">dt</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">(</span><span class="string-literal">'duration'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'protocol_type', 'S4'</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'service', 'S11'</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'flag', 'S6'</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'src_bytes'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_bytes'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'land'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'wrong_fragment'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'urgent'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'hot'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'num_failed_logins'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'logged_in'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'num_compromised'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'root_shell'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'su_attempted'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'num_root'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'num_file_creations'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'num_shells'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'num_access_files'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'num_outbound_cmds'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'is_host_login'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'is_guest_login'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'count'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'srv_count'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'serror_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'srv_serror_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'rerror_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'srv_rerror_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'same_srv_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'diff_srv_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'srv_diff_host_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_count'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_srv_count'</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_same_srv_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_diff_srv_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_same_src_port_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_srv_diff_host_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_serror_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_srv_serror_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_rerror_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'dst_host_srv_rerror_rate'</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="grouping">(</span><span class="string-literal">'labels', 'S16'</span><span class="grouping">)</span><span class="grouping">]</span>

    <span class="identifier">column_names</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">c</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">c</span> <span class="relational-operator">in</span> <span class="identifier">dt</span><span class="grouping">]</span>
    <span class="identifier">target_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">column_names</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">column_names</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>

    <span class="keyword">if</span> <span class="identifier">available</span><span class="punctuation">:</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">joblib</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">samples_path</span><span class="grouping">)</span>
            <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">joblib</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">targets_path</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="invalid">E</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span> <span class="keyword">as</span> <span class="identifier">e</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">IOError</span><span class="grouping">(</span>
                <span class="string-literal">"The cache for fetch_kddcup99 is invalid, please delete "</span>
                <span class="identifier">f</span><span class="string-literal">"{str(kddcup_dir)} and run the fetch_kddcup99 again"</span><span class="grouping">)</span> <span class="keyword">from</span> <span class="identifier">e</span>

    <span class="keyword">elif</span> <span class="identifier">download_if_missing</span><span class="punctuation">:</span>
        <span class="identifier">_mkdirp</span><span class="grouping">(</span><span class="identifier">kddcup_dir</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"Downloading %s"</span> <span class="arithmetic-operator">%</span> <span class="identifier">archive</span><span class="punctuation">.</span><span class="identifier">url</span><span class="grouping">)</span>
        <span class="identifier">_fetch_remote</span><span class="grouping">(</span><span class="identifier">archive</span><span class="punctuation">,</span> <span class="identifier">dirname</span><span class="arithmetic-assignment">=</span><span class="identifier">kddcup_dir</span><span class="grouping">)</span>
        <span class="identifier">DT</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dtype</span><span class="grouping">(</span><span class="identifier">dt</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"extracting archive"</span><span class="grouping">)</span>
        <span class="identifier">archive_path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">join</span><span class="grouping">(</span><span class="identifier">kddcup_dir</span><span class="punctuation">,</span> <span class="identifier">archive</span><span class="punctuation">.</span><span class="identifier">filename</span><span class="grouping">)</span>
        <span class="identifier">file_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">GzipFile</span><span class="grouping">(</span><span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="identifier">archive_path</span><span class="punctuation">,</span> <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="string-literal">'r'</span><span class="grouping">)</span>
        <span class="identifier">Xy</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="keyword">for</span> <span class="identifier">line</span> <span class="relational-operator">in</span> <span class="identifier">file_</span><span class="punctuation">.</span><span class="identifier">readlines</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">line</span> <span class="arithmetic-assignment">=</span> <span class="identifier">line</span><span class="punctuation">.</span><span class="identifier">decode</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">Xy</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">line</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">'\n', '').split(','</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">file_</span><span class="punctuation">.</span><span class="identifier">close</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">'extraction done'</span><span class="grouping">)</span>
        <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">remove</span><span class="grouping">(</span><span class="identifier">archive_path</span><span class="grouping">)</span>

        <span class="identifier">Xy</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">Xy</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">object</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">j</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="int-literal">42</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">Xy</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">j</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Xy</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">j</span><span class="grouping">]</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">DT</span><span class="grouping">[</span><span class="identifier">j</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Xy</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Xy</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>
        <span class="comment"># XXX bug when compress!=0:</span>
        <span class="comment"># (error: 'Incorrect data length while decompressing[...] the file</span>
        <span class="comment">#  could be corrupted.')</span>

        <span class="identifier">joblib</span><span class="punctuation">.</span><span class="identifier">dump</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">samples_path</span><span class="punctuation">,</span> <span class="identifier">compress</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
        <span class="identifier">joblib</span><span class="punctuation">.</span><span class="identifier">dump</span><span class="grouping">(</span><span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">targets_path</span><span class="punctuation">,</span> <span class="identifier">compress</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">IOError</span><span class="grouping">(</span><span class="string-literal">"Data not found and `download_if_missing` is False"</span><span class="grouping">)</span>

    <span class="keyword">return</span> <span class="identifier">Bunch</span><span class="grouping">(</span>
        <span class="identifier">data</span><span class="arithmetic-assignment">=</span><span class="identifier">X</span><span class="punctuation">,</span>
        <span class="identifier">target</span><span class="arithmetic-assignment">=</span><span class="identifier">y</span><span class="punctuation">,</span>
        <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
        <span class="identifier">target_names</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="identifier">target_names</span><span class="grouping">]</span><span class="punctuation">,</span>
    <span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_mkdirp</span><span class="grouping">(</span><span class="identifier">d</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Ensure directory d exists (like mkdir -p on Unix)
    No guarantee that the directory is writable.
    """</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">makedirs</span><span class="grouping">(</span><span class="identifier">d</span><span class="grouping">)</span>
    <span class="keyword">except</span> <span class="identifier">OSError</span> <span class="keyword">as</span> <span class="identifier">e</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">e</span><span class="punctuation">.</span><span class="identifier">errno</span> <span class="relational-operator">!=</span> <span class="identifier">errno</span><span class="punctuation">.</span><span class="identifier">EEXIST</span><span class="punctuation">:</span>
            <span class="keyword">raise</span>

    </pre>
  </body>
</html>