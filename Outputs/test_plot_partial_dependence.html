<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">from</span> <span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">stats</span><span class="punctuation">.</span><span class="identifier">mstats</span> <span class="keyword">import</span> <span class="identifier">mquantiles</span>

<span class="keyword">import</span> <span class="identifier">pytest</span>
<span class="keyword">from</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_diabetes</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_iris</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">make_classification</span><span class="punctuation">,</span> <span class="identifier">make_regression</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">GradientBoostingRegressor</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">GradientBoostingClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">LinearRegression</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="identifier">_convert_container</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">inspection</span> <span class="keyword">import</span> <span class="identifier">plot_partial_dependence</span>


<span class="comment"># TODO: Remove when https://github.com/numpy/numpy/issues/14397 is resolved</span>
<span class="identifier">pytestmark</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span>
    <span class="string-literal">"ignore:In future, it will be an error for 'np.bool_':DeprecationWarning:"</span>
    <span class="string-literal">"matplotlib.*"</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">fixture</span><span class="grouping">(</span><span class="identifier">scope</span><span class="arithmetic-assignment">=</span><span class="string-literal">"module"</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">diabetes</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">return</span> <span class="identifier">load_diabetes</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">fixture</span><span class="grouping">(</span><span class="identifier">scope</span><span class="arithmetic-assignment">=</span><span class="string-literal">"module"</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">clf_diabetes</span><span class="grouping">(</span><span class="identifier">diabetes</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">GradientBoostingRegressor</span><span class="grouping">(</span><span class="identifier">n_estimators</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">target</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">clf</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">"grid_resolution"</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">20</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span> <span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span>
                                 <span class="identifier">diabetes</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Test partial dependence plot function.</span>
    <span class="comment"># Use columns 0 & 2 as 1 is not quantitative (sex)</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span>
    <span class="identifier">disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
                                   <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="grouping">]</span><span class="punctuation">,</span>
                                   <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
                                   <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
                                   <span class="identifier">contour_kw</span><span class="arithmetic-assignment">=</span><span class="grouping">{</span><span class="string-literal">"cmap": "jet"</span><span class="grouping">}</span><span class="grouping">)</span>
    <span class="identifier">fig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pyplot</span><span class="punctuation">.</span><span class="identifier">gcf</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">axs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">get_axes</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">figure_</span> <span class="relational-operator">is</span> <span class="identifier">fig</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">axs</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">4</span>

    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">bounding_ax_</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_vlines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_hlines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>

    <span class="comment"># deciles lines: always show on xaxis, only show on yaxis if 2-way PDP</span>
    <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="int-literal">3</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_vlines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">i</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_hlines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_hlines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_hlines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>

    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">features</span> <span class="relational-operator">==</span> <span class="grouping">[</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="grouping">]</span>
    <span class="keyword">assert</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">feature_names</span> <span class="relational-operator">==</span> <span class="identifier">feature_names</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span>
    <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="identifier">mquantiles</span><span class="grouping">(</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">i</span><span class="grouping">]</span><span class="punctuation">,</span>
                                   <span class="identifier">prob</span><span class="arithmetic-assignment">=</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="float-literal">1.0</span><span class="punctuation">,</span> <span class="float-literal">0.1</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="identifier">single_feature_positions</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">]</span>
    <span class="identifier">expected_ylabels</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"Partial dependence", ""</span><span class="grouping">]</span>

    <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">feat_col</span><span class="punctuation">,</span> <span class="identifier">pos</span><span class="grouping">)</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">single_feature_positions</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="identifier">pos</span><span class="grouping">]</span>
        <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_ylabels</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span>
        <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xlabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="identifier">feat_col</span><span class="grouping">]</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_ylim</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">pdp_lim</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="identifier">line</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="grouping">[</span><span class="identifier">pos</span><span class="grouping">]</span>

        <span class="identifier">avg_preds</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">pd_results</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span>
        <span class="keyword">assert</span> <span class="identifier">avg_preds</span><span class="punctuation">.</span><span class="identifier">average</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">grid_resolution</span><span class="grouping">)</span>
        <span class="identifier">target_idx</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">target_idx</span>

        <span class="identifier">line_data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">line</span><span class="punctuation">.</span><span class="identifier">get_data</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">line_data</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">avg_preds</span><span class="grouping">[</span><span class="string-literal">"values"</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">line_data</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">avg_preds</span><span class="punctuation">.</span><span class="identifier">average</span><span class="grouping">[</span><span class="identifier">target_idx</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># two feature position</span>
    <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span>
    <span class="identifier">coutour</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span>
    <span class="identifier">expected_levels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">linspace</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">pdp_lim</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">num</span><span class="arithmetic-assignment">=</span><span class="int-literal">8</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">coutour</span><span class="punctuation">.</span><span class="identifier">levels</span><span class="punctuation">,</span> <span class="identifier">expected_levels</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">coutour</span><span class="punctuation">.</span><span class="identifier">get_cmap</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="relational-operator">==</span> <span class="string-literal">"jet"</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xlabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">"kind, subsample, shape"</span><span class="punctuation">,</span> <span class="grouping">[</span>
    <span class="grouping">(</span><span class="string-literal">'average'</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'individual'</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">442</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'both'</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">443</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'individual'</span><span class="punctuation">,</span> <span class="int-literal">50</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">50</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'both'</span><span class="punctuation">,</span> <span class="int-literal">50</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">51</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'individual'</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">221</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'both'</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">222</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_kind</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">kind</span><span class="punctuation">,</span> <span class="identifier">subsample</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="punctuation">,</span>
                                      <span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span>
                                   <span class="identifier">kind</span><span class="arithmetic-assignment">=</span><span class="identifier">kind</span><span class="punctuation">,</span> <span class="identifier">subsample</span><span class="arithmetic-assignment">=</span><span class="identifier">subsample</span><span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="identifier">shape</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="string-literal">"input_type, feature_names_type"</span><span class="punctuation">,</span>
    <span class="grouping">[</span><span class="grouping">(</span><span class="string-literal">'dataframe'</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="string-literal">'dataframe', 'list'), ('list', 'list'), ('array', 'list'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="string-literal">'dataframe', 'array'), ('list', 'array'), ('array', 'array'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="string-literal">'dataframe', 'series'), ('list', 'series'), ('array', 'series'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="string-literal">'dataframe', 'index'), ('list', 'index'), ('array', 'index'</span><span class="grouping">)</span><span class="grouping">]</span>
<span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_str_features</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">,</span>
                                              <span class="identifier">input_type</span><span class="punctuation">,</span> <span class="identifier">feature_names_type</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">if</span> <span class="identifier">input_type</span> <span class="relational-operator">==</span> <span class="string-literal">'dataframe'</span><span class="punctuation">:</span>
        <span class="identifier">pd</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">i</span><span class="invalid">p</span><span class="grouping">(</span><span class="string-literal">"pandas"</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pd</span><span class="punctuation">.</span><span class="identifier">DataFrame</span><span class="grouping">(</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">columns</span><span class="arithmetic-assignment">=</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">input_type</span> <span class="relational-operator">==</span> <span class="string-literal">'list'</span><span class="punctuation">:</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">tolist</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span>

    <span class="keyword">if</span> <span class="identifier">feature_names_type</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_convert_container</span><span class="grouping">(</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
                                           <span class="identifier">feature_names_type</span><span class="grouping">)</span>

    <span class="identifier">grid_resolution</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">25</span>
    <span class="comment"># check with str features and array feature names and single column</span>
    <span class="identifier">disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span>
                                   <span class="grouping">[</span><span class="grouping">(</span><span class="string-literal">'age', 'bmi'), 'bmi'</span><span class="grouping">]</span><span class="punctuation">,</span>
                                   <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
                                   <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
                                   <span class="identifier">n_cols</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">line_kw</span><span class="arithmetic-assignment">=</span><span class="grouping">{</span><span class="string-literal">"alpha"</span><span class="punctuation">:</span> <span class="float-literal">0.8</span><span class="grouping">}</span><span class="grouping">)</span>
    <span class="identifier">fig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pyplot</span><span class="punctuation">.</span><span class="identifier">gcf</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">axs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">get_axes</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">axs</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">3</span>

    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">figure_</span> <span class="relational-operator">is</span> <span class="identifier">fig</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_vlines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_hlines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_vlines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_hlines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_hlines_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">deciles_vlines_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>

    <span class="comment"># line</span>
    <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xlabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"bmi"</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"Partial dependence"</span>

    <span class="identifier">line</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span>
    <span class="identifier">avg_preds</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">pd_results</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>
    <span class="identifier">target_idx</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">target_idx</span>
    <span class="keyword">assert</span> <span class="identifier">line</span><span class="punctuation">.</span><span class="identifier">get_alpha</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="float-literal">0.8</span>

    <span class="identifier">line_data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">line</span><span class="punctuation">.</span><span class="identifier">get_data</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">line_data</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">avg_preds</span><span class="grouping">[</span><span class="string-literal">"values"</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">line_data</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">avg_preds</span><span class="punctuation">.</span><span class="identifier">average</span><span class="grouping">[</span><span class="identifier">target_idx</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># contour</span>
    <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span>
    <span class="identifier">coutour</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span>
    <span class="identifier">expect_levels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">linspace</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">pdp_lim</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">num</span><span class="arithmetic-assignment">=</span><span class="int-literal">8</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">coutour</span><span class="punctuation">.</span><span class="identifier">levels</span><span class="punctuation">,</span> <span class="identifier">expect_levels</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xlabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"age"</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"bmi"</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_custom_axes</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">grid_resolution</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">25</span>
    <span class="identifier">fig</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">ax1</span><span class="punctuation">,</span> <span class="identifier">ax2</span><span class="grouping">)</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pyplot</span><span class="punctuation">.</span><span class="identifier">subplots</span><span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
                                   <span class="grouping">[</span><span class="string-literal">'age', ('age', 'bmi'</span><span class="grouping">)</span><span class="grouping">]</span><span class="punctuation">,</span>
                                   <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
                                   <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
                                   <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="identifier">ax1</span><span class="punctuation">,</span> <span class="identifier">ax2</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">fig</span> <span class="relational-operator">is</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">figure_</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">bounding_ax_</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="identifier">ax1</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="identifier">ax2</span>

    <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xlabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"age"</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"Partial dependence"</span>

    <span class="identifier">line</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
    <span class="identifier">avg_preds</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">pd_results</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
    <span class="identifier">target_idx</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">target_idx</span>

    <span class="identifier">line_data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">line</span><span class="punctuation">.</span><span class="identifier">get_data</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">line_data</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">avg_preds</span><span class="grouping">[</span><span class="string-literal">"values"</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">line_data</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">avg_preds</span><span class="punctuation">.</span><span class="identifier">average</span><span class="grouping">[</span><span class="identifier">target_idx</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># contour</span>
    <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>
    <span class="identifier">coutour</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>
    <span class="identifier">expect_levels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">linspace</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">pdp_lim</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">num</span><span class="arithmetic-assignment">=</span><span class="int-literal">8</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">coutour</span><span class="punctuation">.</span><span class="identifier">levels</span><span class="punctuation">,</span> <span class="identifier">expect_levels</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xlabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"age"</span>
    <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"bmi"</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">"kind, lines"</span><span class="punctuation">,</span> <span class="grouping">[</span>
    <span class="grouping">(</span><span class="string-literal">'average', 1), ('individual', 442), ('both'</span><span class="punctuation">,</span> <span class="int-literal">443</span><span class="grouping">)</span>
<span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_passing_numpy_axes</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span>
                                                    <span class="identifier">diabetes</span><span class="punctuation">,</span> <span class="identifier">kind</span><span class="punctuation">,</span> <span class="identifier">lines</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">grid_resolution</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">25</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span>
    <span class="identifier">disp1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
                                    <span class="grouping">[</span><span class="string-literal">'age', 'bmi'</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">kind</span><span class="arithmetic-assignment">=</span><span class="identifier">kind</span><span class="punctuation">,</span>
                                    <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
                                    <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp1</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp1</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"Partial dependence"</span>
    <span class="keyword">assert</span> <span class="identifier">disp1</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">""</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">disp1</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_lines</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">lines</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">disp1</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_lines</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">lines</span>

    <span class="identifier">lr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LinearRegression</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">lr</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">target</span><span class="grouping">)</span>

    <span class="identifier">disp2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">lr</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
                                    <span class="grouping">[</span><span class="string-literal">'age', 'bmi'</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">kind</span><span class="arithmetic-assignment">=</span><span class="identifier">kind</span><span class="punctuation">,</span>
                                    <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
                                    <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
                                    <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="identifier">disp1</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="identifier">disp1</span><span class="punctuation">.</span><span class="identifier">axes_</span> <span class="relational-operator">==</span> <span class="identifier">disp2</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">disp2</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_lines</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">lines</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">disp2</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_lines</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">lines</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">"nrows, ncols"</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_incorrent_num_axes</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span>
                                                    <span class="identifier">diabetes</span><span class="punctuation">,</span> <span class="identifier">nrows</span><span class="punctuation">,</span> <span class="identifier">ncols</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">grid_resolution</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">5</span>
    <span class="identifier">fig</span><span class="punctuation">,</span> <span class="identifier">axes</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pyplot</span><span class="punctuation">.</span><span class="identifier">subplots</span><span class="grouping">(</span><span class="identifier">nrows</span><span class="punctuation">,</span> <span class="identifier">ncols</span><span class="grouping">)</span>
    <span class="identifier">axes_formats</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">list</span><span class="grouping">(</span><span class="identifier">axes</span><span class="punctuation">.</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">tuple</span><span class="grouping">(</span><span class="identifier">axes</span><span class="punctuation">.</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">axes</span><span class="grouping">]</span>

    <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"Expected ax to have 2 axes, got {}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">nrows</span> <span class="arithmetic-operator">*</span> <span class="identifier">ncols</span><span class="grouping">)</span>

    <span class="identifier">disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
                                   <span class="grouping">[</span><span class="string-literal">'age', 'bmi'</span><span class="grouping">]</span><span class="punctuation">,</span>
                                   <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
                                   <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">)</span>

    <span class="keyword">for</span> <span class="identifier">ax_format</span> <span class="relational-operator">in</span> <span class="identifier">axes_formats</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
                                    <span class="grouping">[</span><span class="string-literal">'age', 'bmi'</span><span class="grouping">]</span><span class="punctuation">,</span>
                                    <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
                                    <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
                                    <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="identifier">ax_format</span><span class="grouping">)</span>

        <span class="comment"># with axes object</span>
        <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="identifier">ax_format</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_with_same_axes</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span>
                                                <span class="identifier">diabetes</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># The first call to plot_partial_dependence will create two new axes to</span>
    <span class="comment"># place in the space of the passed in axes, which results in a total of</span>
    <span class="comment"># three axes in the figure.</span>
    <span class="comment"># Currently the API does not allow for the second call to</span>
    <span class="comment"># plot_partial_dependence to use the same axes again, because it will</span>
    <span class="comment"># create two new axes in the space resulting in five axes. To get the</span>
    <span class="comment"># expected behavior one needs to pass the generated axes into the second</span>
    <span class="comment"># call:</span>
    <span class="comment"># disp1 = plot_partial_dependence(...)</span>
    <span class="comment"># disp2 = plot_partial_dependence(..., ax=disp1.axes_)</span>

    <span class="identifier">grid_resolution</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">25</span>
    <span class="identifier">fig</span><span class="punctuation">,</span> <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pyplot</span><span class="punctuation">.</span><span class="identifier">subplots</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="string-literal">'age', 'bmi'</span><span class="grouping">]</span><span class="punctuation">,</span>
                            <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
                            <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="identifier">ax</span><span class="grouping">)</span>

    <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">"The ax was already used in another plot function, please set "</span>
           <span class="string-literal">"ax=display.axes_ instead"</span><span class="grouping">)</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
                                <span class="grouping">[</span><span class="string-literal">'age', 'bmi'</span><span class="grouping">]</span><span class="punctuation">,</span>
                                <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
                                <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="identifier">ax</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_feature_name_reuse</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span>
                                                    <span class="identifier">diabetes</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># second call to plot does not change the feature names from the first</span>
    <span class="comment"># call</span>

    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span>
    <span class="identifier">disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
                                   <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span>
                                   <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span>
                                   <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="grouping">)</span>

    <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span>
                            <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">)</span>

    <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">ax</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="punctuation">.</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xlabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">feature_names</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_multiclass</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">grid_resolution</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">25</span>
    <span class="identifier">clf_int</span> <span class="arithmetic-assignment">=</span> <span class="identifier">GradientBoostingClassifier</span><span class="grouping">(</span><span class="identifier">n_estimators</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
    <span class="identifier">iris</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_iris</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="comment"># Test partial dependence plot function on multi-class input.</span>
    <span class="identifier">clf_int</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">target</span><span class="grouping">)</span>
    <span class="identifier">disp_target_0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_int</span><span class="punctuation">,</span> <span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span>
                                            <span class="identifier">target</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span>
                                            <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">figure_</span> <span class="relational-operator">is</span> <span class="identifier">pyplot</span><span class="punctuation">.</span><span class="identifier">gcf</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">deciles_vlines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">deciles_hlines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">all</span><span class="grouping">(</span><span class="identifier">c</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">for</span> <span class="identifier">c</span> <span class="relational-operator">in</span> <span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="punctuation">.</span><span class="identifier">flat</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">target_idx</span> <span class="relational-operator">==</span> <span class="int-literal">0</span>

    <span class="comment"># now with symbol labels</span>
    <span class="identifier">target</span> <span class="arithmetic-assignment">=</span> <span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">target_names</span><span class="grouping">[</span><span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">target</span><span class="grouping">]</span>
    <span class="identifier">clf_symbol</span> <span class="arithmetic-assignment">=</span> <span class="identifier">GradientBoostingClassifier</span><span class="grouping">(</span><span class="identifier">n_estimators</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
    <span class="identifier">clf_symbol</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">target</span><span class="grouping">)</span>
    <span class="identifier">disp_symbol</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_symbol</span><span class="punctuation">,</span> <span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span>
                                          <span class="identifier">target</span><span class="arithmetic-assignment">=</span><span class="string-literal">'setosa'</span><span class="punctuation">,</span>
                                          <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_symbol</span><span class="punctuation">.</span><span class="identifier">figure_</span> <span class="relational-operator">is</span> <span class="identifier">pyplot</span><span class="punctuation">.</span><span class="identifier">gcf</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_symbol</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_symbol</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_symbol</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_symbol</span><span class="punctuation">.</span><span class="identifier">deciles_vlines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_symbol</span><span class="punctuation">.</span><span class="identifier">deciles_hlines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">all</span><span class="grouping">(</span><span class="identifier">c</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">for</span> <span class="identifier">c</span> <span class="relational-operator">in</span> <span class="identifier">disp_symbol</span><span class="punctuation">.</span><span class="identifier">contours_</span><span class="punctuation">.</span><span class="identifier">flat</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">disp_symbol</span><span class="punctuation">.</span><span class="identifier">target_idx</span> <span class="relational-operator">==</span> <span class="int-literal">0</span>

    <span class="keyword">for</span> <span class="identifier">int_result</span><span class="punctuation">,</span> <span class="identifier">symbol_result</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">pd_results</span><span class="punctuation">,</span>
                                         <span class="identifier">disp_symbol</span><span class="punctuation">.</span><span class="identifier">pd_results</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int_result</span><span class="punctuation">.</span><span class="identifier">average</span><span class="punctuation">,</span> <span class="identifier">symbol_result</span><span class="punctuation">.</span><span class="identifier">average</span><span class="grouping">)</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int_result</span><span class="grouping">[</span><span class="string-literal">"values"], symbol_result["values"</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="comment"># check that the pd plots are different for another target</span>
    <span class="identifier">disp_target_1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_int</span><span class="punctuation">,</span> <span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span>
                                            <span class="identifier">target</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span>
                                            <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="grouping">)</span>
    <span class="identifier">target_0_data_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp_target_0</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_data</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>
    <span class="identifier">target_1_data_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp_target_1</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_data</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>
    <span class="keyword">assert</span> <span class="identifier">any</span><span class="grouping">(</span><span class="identifier">target_0_data_y</span> <span class="relational-operator">!=</span> <span class="identifier">target_1_data_y</span><span class="grouping">)</span>


<span class="identifier">multioutput_regression_data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_regression</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">50</span><span class="punctuation">,</span> <span class="identifier">n_targets</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                              <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">"target"</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_multioutput</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">target</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Test partial dependence plot function on multi-output input.</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">multioutput_regression_data</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LinearRegression</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="identifier">grid_resolution</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">25</span>
    <span class="identifier">disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">target</span><span class="arithmetic-assignment">=</span><span class="identifier">target</span><span class="punctuation">,</span>
                                   <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="grouping">)</span>
    <span class="identifier">fig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pyplot</span><span class="punctuation">.</span><span class="identifier">gcf</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">axs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">get_axes</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">axs</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">3</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">target_idx</span> <span class="relational-operator">==</span> <span class="identifier">target</span>
    <span class="keyword">assert</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">bounding_ax_</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>

    <span class="identifier">positions</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">]</span>
    <span class="identifier">expected_label</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"Partial dependence", ""</span><span class="grouping">]</span>

    <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">pos</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">positions</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="grouping">[</span><span class="identifier">pos</span><span class="grouping">]</span>
        <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_label</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span>
        <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xlabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">i</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_dataframe</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">pd</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">i</span><span class="invalid">p</span><span class="grouping">(</span><span class="string-literal">'pandas'</span><span class="grouping">)</span>
    <span class="identifier">df</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pd</span><span class="punctuation">.</span><span class="identifier">DataFrame</span><span class="grouping">(</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">columns</span><span class="arithmetic-assignment">=</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">)</span>

    <span class="identifier">grid_resolution</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">25</span>

    <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span>
        <span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">df</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="string-literal">'bp', 's1'</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
        <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">df</span><span class="punctuation">.</span><span class="identifier">columns</span><span class="punctuation">.</span><span class="identifier">tolist</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="grouping">)</span>


<span class="identifier">dummy_classification_data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_classification</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="string-literal">"data, params, err_msg"</span><span class="punctuation">,</span>
    <span class="grouping">[</span><span class="grouping">(</span><span class="identifier">multioutput_regression_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">"target"</span><span class="punctuation">:</span> <span class="none-literal">None</span><span class="punctuation">,</span> <span class="string-literal">'features'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">"target must be specified for multi-output"</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">multioutput_regression_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">"target"</span><span class="punctuation">:</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="string-literal">'features'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="identifier">r</span><span class="string-literal">'target must be in \[0, n_tasks\]'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">multioutput_regression_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">"target"</span><span class="punctuation">:</span> <span class="int-literal">100</span><span class="punctuation">,</span> <span class="string-literal">'features'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="identifier">r</span><span class="string-literal">'target must be in \[0, n_tasks\]'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span>
     <span class="grouping">{</span><span class="string-literal">'features': ['foobar'], 'feature_names'</span><span class="punctuation">:</span> <span class="none-literal">None</span><span class="grouping">}</span><span class="punctuation">,</span>
     <span class="string-literal">'Feature foobar not in feature_names'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span>
     <span class="grouping">{</span><span class="string-literal">'features': ['foobar'], 'feature_names': ['abcd', 'def'</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">'Feature foobar not in feature_names'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">'features'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">'Each entry in features must be either an int, '</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">'features'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="grouping">}</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">'Each entry in features must be either an int, '</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">'features'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="identifier">tuple</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">'Each entry in features must be either an int, '</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span>
      <span class="grouping">{</span><span class="string-literal">'features': [123], 'feature_names': ['blahblah'</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">'All entries of features must be less than '</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span>
      <span class="grouping">{</span><span class="string-literal">'features': [0, 1, 2], 'feature_names': ['a', 'b', 'a'</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">'feature_names should not contain duplicates'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">'features': [(1, 2)], 'kind': 'individual'</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">'It is not possible to display individual effects for more than one'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">'features': [(1, 2)], 'kind': 'both'</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">'It is not possible to display individual effects for more than one'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">'features': [1], 'subsample'</span><span class="punctuation">:</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="string-literal">'When an integer, subsample=-1 should be positive.'</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">dummy_classification_data</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">'features': [1], 'subsample'</span><span class="punctuation">:</span> <span class="float-literal">1.2</span><span class="grouping">}</span><span class="punctuation">,</span>
      <span class="identifier">r</span><span class="string-literal">'When a floating-point, subsample=1.2 should be in the \(0, 1\) range'</span><span class="grouping">)</span><span class="grouping">]</span>
<span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_error</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">params</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span>
    <span class="identifier">estimator</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LinearRegression</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">params</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">"ignore:A Bunch will be returned"</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">"params, err_msg"</span><span class="punctuation">,</span> <span class="grouping">[</span>
    <span class="grouping">(</span><span class="grouping">{</span><span class="string-literal">'target': 4, 'features'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
     <span class="string-literal">'target not in est.classes_, got 4'</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="grouping">{</span><span class="string-literal">'target': None, 'features'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
     <span class="string-literal">'target must be specified for multi-class'</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="grouping">{</span><span class="string-literal">'target': 1, 'features'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="float-literal">4.5</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span>
     <span class="string-literal">'Each entry in features must be either an int,'</span><span class="grouping">)</span><span class="punctuation">,</span>
<span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_multiclass_error</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">params</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">iris</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_iris</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">GradientBoostingClassifier</span><span class="grouping">(</span><span class="identifier">n_estimators</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">target</span><span class="grouping">)</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">iris</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">params</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_does_not_override_ylabel</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span>
                                                          <span class="identifier">diabetes</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Non-regression test to be sure to not override the ylabel if it has been</span>
    <span class="comment"># See https://github.com/scikit-learn/scikit-learn/issues/15772</span>
    <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">axes</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pyplot</span><span class="punctuation">.</span><span class="identifier">subplots</span><span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">axes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="string-literal">"Hello world"</span><span class="grouping">)</span>
    <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span><span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
                            <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="identifier">axes</span><span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">axes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"Hello world"</span>
    <span class="keyword">assert</span> <span class="identifier">axes</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_ylabel</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"Partial dependence"</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="string-literal">"kind, expected_shape"</span><span class="punctuation">,</span>
    <span class="grouping">[</span><span class="grouping">(</span><span class="string-literal">"average", (1, 2)), ("individual", (1, 2, 50)), ("both"</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">51</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">]</span><span class="punctuation">,</span>
<span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_plot_partial_dependence_subsampling</span><span class="grouping">(</span>
    <span class="identifier">pyplot</span><span class="punctuation">,</span> <span class="identifier">clf_diabetes</span><span class="punctuation">,</span> <span class="identifier">diabetes</span><span class="punctuation">,</span> <span class="identifier">kind</span><span class="punctuation">,</span> <span class="identifier">expected_shape</span>
<span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># check that the subsampling is properly working</span>
    <span class="comment"># non-regression test for:</span>
    <span class="comment"># https://github.com/scikit-learn/scikit-learn/pull/18359</span>
    <span class="identifier">matplotlib</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">i</span><span class="invalid">p</span><span class="grouping">(</span><span class="string-literal">"matplotlib"</span><span class="grouping">)</span>
    <span class="identifier">grid_resolution</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">25</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span>

    <span class="identifier">disp1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span>
        <span class="identifier">clf_diabetes</span><span class="punctuation">,</span>
        <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
        <span class="grouping">[</span><span class="string-literal">"age", "bmi"</span><span class="grouping">]</span><span class="punctuation">,</span>
        <span class="identifier">kind</span><span class="arithmetic-assignment">=</span><span class="identifier">kind</span><span class="punctuation">,</span>
        <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="identifier">grid_resolution</span><span class="punctuation">,</span>
        <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
        <span class="identifier">subsample</span><span class="arithmetic-assignment">=</span><span class="int-literal">50</span><span class="punctuation">,</span>
        <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span>
    <span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">disp1</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="identifier">expected_shape</span>
    <span class="keyword">assert</span> <span class="identifier">all</span><span class="grouping">(</span>
        <span class="grouping">[</span>
            <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">line</span><span class="punctuation">,</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">lines</span><span class="punctuation">.</span><span class="identifier">Line2D</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">line</span> <span class="relational-operator">in</span> <span class="identifier">disp1</span><span class="punctuation">.</span><span class="identifier">lines_</span><span class="punctuation">.</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="grouping">]</span>
    <span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="string-literal">"kind, line_kw, label"</span><span class="punctuation">,</span>
    <span class="grouping">[</span>
        <span class="grouping">(</span><span class="string-literal">"individual"</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="grouping">}</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">"individual", {"label": "xxx"</span><span class="grouping">}</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">"average"</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="grouping">}</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">"average", {"label": "xxx"}, "xxx"</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">"both", {}, "average"</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">"both", {"label": "xxx"}, "xxx"</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">]</span><span class="punctuation">,</span>
<span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_partial_dependence_overwrite_labels</span><span class="grouping">(</span>
    <span class="identifier">pyplot</span><span class="punctuation">,</span>
    <span class="identifier">clf_diabetes</span><span class="punctuation">,</span>
    <span class="identifier">diabetes</span><span class="punctuation">,</span>
    <span class="identifier">kind</span><span class="punctuation">,</span>
    <span class="identifier">line_kw</span><span class="punctuation">,</span>
    <span class="identifier">label</span><span class="punctuation">,</span>
<span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Test that make sure that we can overwrite the label of the PDP plot"""</span>
    <span class="identifier">disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_partial_dependence</span><span class="grouping">(</span>
        <span class="identifier">clf_diabetes</span><span class="punctuation">,</span>
        <span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span>
        <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span>
        <span class="identifier">grid_resolution</span><span class="arithmetic-assignment">=</span><span class="int-literal">25</span><span class="punctuation">,</span>
        <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">diabetes</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
        <span class="identifier">kind</span><span class="arithmetic-assignment">=</span><span class="identifier">kind</span><span class="punctuation">,</span>
        <span class="identifier">line_kw</span><span class="arithmetic-assignment">=</span><span class="identifier">line_kw</span><span class="punctuation">,</span>
    <span class="grouping">)</span>

    <span class="keyword">for</span> <span class="identifier">ax</span> <span class="relational-operator">in</span> <span class="identifier">disp</span><span class="punctuation">.</span><span class="identifier">axes_</span><span class="punctuation">.</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">label</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="keyword">assert</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_legend</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">legend_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_legend</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">get_texts</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">legend_text</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>
            <span class="keyword">assert</span> <span class="identifier">legend_text</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_text</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">label</span>

    </pre>
  </body>
</html>