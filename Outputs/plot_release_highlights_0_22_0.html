<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
========================================
Release Highlights for scikit-learn 0.22
========================================

.. currentmodule:: sklearn

We are pleased to announce the release of scikit-learn 0.22, which comes
with many bug fixes and new features! We detail below a few of the major
features of this release. For an exhaustive list of all the changes, please
refer to the :ref:`release notes &lt;changes_0_22&gt;`.

To install the latest version (with pip)::

    pip install --upgrade scikit-learn

or with conda::

    conda install -c conda-forge scikit-learn
"""</span>

<span class="comment"># %%</span>
<span class="comment"># New plotting API</span>
<span class="comment"># ----------------</span>
<span class="comment">#</span>
<span class="comment"># A new plotting API is available for creating visualizations. This new API</span>
<span class="comment"># allows for quickly adjusting the visuals of a plot without involving any</span>
<span class="comment"># recomputation. It is also possible to add different plots to the same</span>
<span class="comment"># figure. The following example illustrates :class:`~metrics.plot_roc_curve`,</span>
<span class="comment"># but other plots utilities are supported like</span>
<span class="comment"># :class:`~inspection.plot_partial_dependence`,</span>
<span class="comment"># :class:`~metrics.plot_precision_recall_curve`, and</span>
<span class="comment"># :class:`~metrics.plot_confusion_matrix`. Read more about this new API in the</span>
<span class="comment"># :ref:`User Guide &lt;visualizations&gt;`.</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">model_selection</span> <span class="keyword">import</span> <span class="identifier">train_test_split</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">svm</span> <span class="keyword">import</span> <span class="identifier">SVC</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="identifier">plot_roc_curve</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">RandomForestClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">make_classification</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>

<span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_classification</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
<span class="identifier">X_train</span><span class="punctuation">,</span> <span class="identifier">X_test</span><span class="punctuation">,</span> <span class="identifier">y_train</span><span class="punctuation">,</span> <span class="identifier">y_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">train_test_split</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span><span class="grouping">)</span>

<span class="identifier">svc</span> <span class="arithmetic-assignment">=</span> <span class="identifier">SVC</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span><span class="grouping">)</span>
<span class="identifier">svc</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_train</span><span class="punctuation">,</span> <span class="identifier">y_train</span><span class="grouping">)</span>
<span class="identifier">rfc</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RandomForestClassifier</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span><span class="grouping">)</span>
<span class="identifier">rfc</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_train</span><span class="punctuation">,</span> <span class="identifier">y_train</span><span class="grouping">)</span>

<span class="identifier">svc_disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_roc_curve</span><span class="grouping">(</span><span class="identifier">svc</span><span class="punctuation">,</span> <span class="identifier">X_test</span><span class="punctuation">,</span> <span class="identifier">y_test</span><span class="grouping">)</span>
<span class="identifier">rfc_disp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_roc_curve</span><span class="grouping">(</span><span class="identifier">rfc</span><span class="punctuation">,</span> <span class="identifier">X_test</span><span class="punctuation">,</span> <span class="identifier">y_test</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="identifier">svc_disp</span><span class="punctuation">.</span><span class="identifier">ax_</span><span class="grouping">)</span>
<span class="identifier">rfc_disp</span><span class="punctuation">.</span><span class="identifier">figure_</span><span class="punctuation">.</span><span class="identifier">suptitle</span><span class="grouping">(</span><span class="string-literal">"ROC curve comparison"</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># Stacking Classifier and Regressor</span>
<span class="comment"># ---------------------------------</span>
<span class="comment"># :class:`~ensemble.StackingClassifier` and</span>
<span class="comment"># :class:`~ensemble.StackingRegressor`</span>
<span class="comment"># allow you to have a stack of estimators with a final classifier or</span>
<span class="comment"># a regressor.</span>
<span class="comment"># Stacked generalization consists in stacking the output of individual</span>
<span class="comment"># estimators and use a classifier to compute the final prediction. Stacking</span>
<span class="comment"># allows to use the strength of each individual estimator by using their output</span>
<span class="comment"># as input of a final estimator.</span>
<span class="comment"># Base estimators are fitted on the full ``X`` while</span>
<span class="comment"># the final estimator is trained using cross-validated predictions of the</span>
<span class="comment"># base estimators using ``cross_val_predict``.</span>
<span class="comment">#</span>
<span class="comment"># Read more in the :ref:`User Guide &lt;stacking&gt;`.</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_iris</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">svm</span> <span class="keyword">import</span> <span class="identifier">LinearSVC</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">LogisticRegression</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">StandardScaler</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">pipeline</span> <span class="keyword">import</span> <span class="identifier">make_pipeline</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">StackingClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">model_selection</span> <span class="keyword">import</span> <span class="identifier">train_test_split</span>

<span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_iris</span><span class="grouping">(</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">X</span><span class="invalid">_</span><span class="invalid">y</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
<span class="identifier">estimators</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
    <span class="grouping">(</span><span class="string-literal">'rf'</span><span class="punctuation">,</span> <span class="identifier">RandomForestClassifier</span><span class="grouping">(</span><span class="identifier">n_estimators</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'svr'</span><span class="punctuation">,</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span><span class="identifier">StandardScaler</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
                          <span class="identifier">LinearSVC</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="grouping">]</span>
<span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">StackingClassifier</span><span class="grouping">(</span>
    <span class="identifier">estimators</span><span class="arithmetic-assignment">=</span><span class="identifier">estimators</span><span class="punctuation">,</span> <span class="identifier">final_estimator</span><span class="arithmetic-assignment">=</span><span class="identifier">LogisticRegression</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="grouping">)</span>
<span class="identifier">X_train</span><span class="punctuation">,</span> <span class="identifier">X_test</span><span class="punctuation">,</span> <span class="identifier">y_train</span><span class="punctuation">,</span> <span class="identifier">y_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">train_test_split</span><span class="grouping">(</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">stratify</span><span class="arithmetic-assignment">=</span><span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span>
<span class="grouping">)</span>
<span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_train</span><span class="punctuation">,</span> <span class="identifier">y_train</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">score</span><span class="grouping">(</span><span class="identifier">X_test</span><span class="punctuation">,</span> <span class="identifier">y_test</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># Permutation-based feature importance</span>
<span class="comment"># ------------------------------------</span>
<span class="comment">#</span>
<span class="comment"># The :func:`inspection.permutation_importance` can be used to get an</span>
<span class="comment"># estimate of the importance of each feature, for any fitted estimator:</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">make_classification</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">RandomForestClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">inspection</span> <span class="keyword">import</span> <span class="identifier">permutation_importance</span>

<span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_classification</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">n_informative</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="grouping">)</span>
<span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">f</span><span class="string-literal">'x_{i}'</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>

<span class="identifier">rf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RandomForestClassifier</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">result</span> <span class="arithmetic-assignment">=</span> <span class="identifier">permutation_importance</span><span class="grouping">(</span><span class="identifier">rf</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">n_repeats</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span>
                                <span class="identifier">n_jobs</span><span class="arithmetic-assignment">=</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">)</span>

<span class="identifier">fig</span><span class="punctuation">,</span> <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplots</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">sorted_idx</span> <span class="arithmetic-assignment">=</span> <span class="identifier">result</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">a</span><span class="invalid">n</span><span class="punctuation">.</span><span class="identifier">argsort</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">boxplot</span><span class="grouping">(</span><span class="identifier">result</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">[</span><span class="identifier">sorted_idx</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">T</span><span class="punctuation">,</span>
           <span class="identifier">vert</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="identifier">sorted_idx</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_title</span><span class="grouping">(</span><span class="string-literal">"Permutation Importance of each feature"</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="string-literal">"Features"</span><span class="grouping">)</span>
<span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">tight_layout</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># Native support for missing values for gradient boosting</span>
<span class="comment"># -------------------------------------------------------</span>
<span class="comment">#</span>
<span class="comment"># The :class:`ensemble.HistGradientBoostingClassifier`</span>
<span class="comment"># and :class:`ensemble.HistGradientBoostingRegressor` now have native</span>
<span class="comment"># support for missing values (NaNs). This means that there is no need for</span>
<span class="comment"># imputing data when training or predicting.</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">HistGradientBoostingClassifier</span>

<span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">nan</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">reshape</span><span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>
<span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>

<span class="identifier">gbdt</span> <span class="arithmetic-assignment">=</span> <span class="identifier">HistGradientBoostingClassifier</span><span class="grouping">(</span><span class="identifier">min_samples_leaf</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">gbdt</span><span class="punctuation">.</span><span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># Precomputed sparse nearest neighbors graph</span>
<span class="comment"># ------------------------------------------</span>
<span class="comment"># Most estimators based on nearest neighbors graphs now accept precomputed</span>
<span class="comment"># sparse graphs as input, to reuse the same graph for multiple estimator fits.</span>
<span class="comment"># To use this feature in a pipeline, one can use the `memory` parameter, along</span>
<span class="comment"># with one of the two new transformers,</span>
<span class="comment"># :class:`neighbors.KNeighborsTransformer` and</span>
<span class="comment"># :class:`neighbors.RadiusNeighborsTransformer`. The precomputation</span>
<span class="comment"># can also be performed by custom estimators to use alternative</span>
<span class="comment"># implementations, such as approximate nearest neighbors methods.</span>
<span class="comment"># See more details in the :ref:`User Guide &lt;neighbors_transformer&gt;`.</span>

<span class="keyword">from</span> <span class="identifier">tempfile</span> <span class="keyword">import</span> <span class="identifier">TemporaryDirectory</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">neighbors</span> <span class="keyword">import</span> <span class="identifier">KNeighborsTransformer</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">manifold</span> <span class="keyword">import</span> <span class="identifier">Isomap</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">pipeline</span> <span class="keyword">import</span> <span class="identifier">make_pipeline</span>

<span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_classification</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

<span class="keyword">with</span> <span class="identifier">TemporaryDirectory</span><span class="grouping">(</span><span class="identifier">prefix</span><span class="arithmetic-assignment">=</span><span class="string-literal">"sklearn_cache_"</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">tmpdir</span><span class="punctuation">:</span>
    <span class="identifier">estimator</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span>
        <span class="identifier">KNeighborsTransformer</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="string-literal">'distance'</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="identifier">Isomap</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'precomputed'</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="identifier">memory</span><span class="arithmetic-assignment">=</span><span class="identifier">tmpdir</span><span class="grouping">)</span>
    <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>

    <span class="comment"># We can decrease the number of neighbors and the graph will not be</span>
    <span class="comment"># recomputed.</span>
    <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">set_params</span><span class="grouping">(</span><span class="identifier">isomap__n_neighbors</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="grouping">)</span>
    <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># KNN Based Imputation</span>
<span class="comment"># ------------------------------------</span>
<span class="comment"># We now support imputation for completing missing values using k-Nearest</span>
<span class="comment"># Neighbors.</span>
<span class="comment">#</span>
<span class="comment"># Each sample's missing values are imputed using the mean value from</span>
<span class="comment"># ``n_neighbors`` nearest neighbors found in the training set. Two samples are</span>
<span class="comment"># close if the features that neither is missing are close.</span>
<span class="comment"># By default, a euclidean distance metric</span>
<span class="comment"># that supports missing values,</span>
<span class="comment"># :func:`~metrics.nan_euclidean_distances`, is used to find the nearest</span>
<span class="comment"># neighbors.</span>
<span class="comment">#</span>
<span class="comment"># Read more in the :ref:`User Guide &lt;knnimpute&gt;`.</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">impute</span> <span class="keyword">import</span> <span class="identifier">KNNImputer</span>

<span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">nan</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">nan</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">8</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="punctuation">,</span> <span class="int-literal">7</span><span class="grouping">]</span><span class="grouping">]</span>
<span class="identifier">imputer</span> <span class="arithmetic-assignment">=</span> <span class="identifier">KNNImputer</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">imputer</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># Tree pruning</span>
<span class="comment"># ------------</span>
<span class="comment">#</span>
<span class="comment"># It is now possible to prune most tree-based estimators once the trees are</span>
<span class="comment"># built. The pruning is based on minimal cost-complexity. Read more in the</span>
<span class="comment"># :ref:`User Guide &lt;minimal_cost_complexity_pruning&gt;` for details.</span>

<span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_classification</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

<span class="identifier">rf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RandomForestClassifier</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">ccp_alpha</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Average number of nodes without pruning {:.1f}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span>
    <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">mean</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">e</span><span class="punctuation">.</span><span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">node_count</span> <span class="keyword">for</span> <span class="identifier">e</span> <span class="relational-operator">in</span> <span class="identifier">rf</span><span class="punctuation">.</span><span class="identifier">estimators_</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="identifier">rf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RandomForestClassifier</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">ccp_alpha</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.05</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Average number of nodes with pruning {:.1f}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span>
    <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">mean</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">e</span><span class="punctuation">.</span><span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">node_count</span> <span class="keyword">for</span> <span class="identifier">e</span> <span class="relational-operator">in</span> <span class="identifier">rf</span><span class="punctuation">.</span><span class="identifier">estimators_</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># Retrieve dataframes from OpenML</span>
<span class="comment"># -------------------------------</span>
<span class="comment"># :func:`datasets.fetch_openml` can now return pandas dataframe and thus</span>
<span class="comment"># properly handle datasets with heterogeneous data:</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">fetch_openml</span>

<span class="identifier">titanic</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fetch_openml</span><span class="grouping">(</span><span class="string-literal">'titanic'</span><span class="punctuation">,</span> <span class="identifier">version</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">titanic</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">head</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">[</span><span class="grouping">[</span><span class="string-literal">'pclass', 'embarked'</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># Checking scikit-learn compatibility of an estimator</span>
<span class="comment"># ---------------------------------------------------</span>
<span class="comment"># Developers can check the compatibility of their scikit-learn compatible</span>
<span class="comment"># estimators using :func:`~utils.estimator_checks.check_estimator`. For</span>
<span class="comment"># instance, the ``check_estimator(LinearSVC())`` passes.</span>
<span class="comment">#</span>
<span class="comment"># We now provide a ``pytest`` specific decorator which allows ``pytest``</span>
<span class="comment"># to run all checks independently and report the checks that are failing.</span>
<span class="comment">#</span>
<span class="comment"># ..note::</span>
<span class="comment">#   This entry was slightly updated in version 0.24, where passing classes</span>
<span class="comment">#   isn't supported anymore: pass instances instead.</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">LogisticRegression</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">tree</span> <span class="keyword">import</span> <span class="identifier">DecisionTreeRegressor</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">estimator_checks</span> <span class="keyword">import</span> <span class="identifier">parametrize_with_checks</span>


<span class="punctuation">@</span><span class="identifier">parametrize_with_checks</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">LogisticRegression</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">DecisionTreeRegressor</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_sklearn_compatible_estimator</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="punctuation">,</span> <span class="identifier">check</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">check</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># ROC AUC now supports multiclass classification</span>
<span class="comment"># ----------------------------------------------</span>
<span class="comment"># The :func:`roc_auc_score` function can also be used in multi-class</span>
<span class="comment"># classification. Two averaging strategies are currently supported: the</span>
<span class="comment"># one-vs-one algorithm computes the average of the pairwise ROC AUC scores, and</span>
<span class="comment"># the one-vs-rest algorithm computes the average of the ROC AUC scores for each</span>
<span class="comment"># class against all other classes. In both cases, the multiclass ROC AUC scores</span>
<span class="comment"># are computed from the probability estimates that a sample belongs to a</span>
<span class="comment"># particular class according to the model. The OvO and OvR algorithms support</span>
<span class="comment"># weighting uniformly (``average='macro'``) and weighting by the prevalence</span>
<span class="comment"># (``average='weighted'``).</span>
<span class="comment">#</span>
<span class="comment"># Read more in the :ref:`User Guide &lt;roc_metrics&gt;`.</span>


<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">make_classification</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">svm</span> <span class="keyword">import</span> <span class="identifier">SVC</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="identifier">roc_auc_score</span>

<span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_classification</span><span class="grouping">(</span><span class="identifier">n_classes</span><span class="arithmetic-assignment">=</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="identifier">n_informative</span><span class="arithmetic-assignment">=</span><span class="int-literal">16</span><span class="grouping">)</span>
<span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">SVC</span><span class="grouping">(</span><span class="identifier">decision_function_shape</span><span class="arithmetic-assignment">=</span><span class="string-literal">'ovo'</span><span class="punctuation">,</span> <span class="identifier">probability</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">roc_auc_score</span><span class="grouping">(</span><span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">predict_proba</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">multi_class</span><span class="arithmetic-assignment">=</span><span class="string-literal">'ovo'</span><span class="grouping">)</span><span class="grouping">)</span>

    </pre>
  </body>
</html>