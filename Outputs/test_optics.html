<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment"># Authors: Shane Grigsby &lt;refuge@rocktalus.com&gt;</span>
<span class="comment">#          Adrin Jalali &lt;adrin.jalali@gmail.com&gt;</span>
<span class="comment"># License: BSD 3 clause</span>
<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">pytest</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">make_blobs</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">cluster</span> <span class="keyword">import</span> <span class="identifier">OPTICS</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">cluster</span><span class="punctuation">.</span><span class="identifier">_optics</span> <span class="keyword">import</span> <span class="identifier">_extend_region</span><span class="punctuation">,</span> <span class="identifier">_extract_xi_labels</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="invalid">e</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">s</span> <span class="keyword">import</span> <span class="identifier">DataConversionWarning</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span><span class="punctuation">.</span><span class="identifier">cluster</span> <span class="keyword">import</span> <span class="identifier">contingency_matrix</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span><span class="punctuation">.</span><span class="identifier">pairwise</span> <span class="keyword">import</span> <span class="identifier">pairwise_distances</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">cluster</span> <span class="keyword">import</span> <span class="identifier">DBSCAN</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">shuffle</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">cluster</span><span class="punctuation">.</span><span class="identifier">tests</span><span class="punctuation">.</span><span class="identifier">common</span> <span class="keyword">import</span> <span class="identifier">generate_clustered_data</span>


<span class="identifier">rng</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">RandomState</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>
<span class="identifier">n_points_per_cluster</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">10</span>
<span class="identifier">C1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.8</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">C2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.1</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">C3</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.2</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">C4</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.3</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">C5</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">1.6</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">C6</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">vstack</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">C1</span><span class="punctuation">,</span> <span class="identifier">C2</span><span class="punctuation">,</span> <span class="identifier">C3</span><span class="punctuation">,</span> <span class="identifier">C4</span><span class="punctuation">,</span> <span class="identifier">C5</span><span class="punctuation">,</span> <span class="identifier">C6</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="grouping">(</span><span class="string-literal">'r_plot', 'end'</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">[</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="float-literal">8.9</span><span class="punctuation">,</span> <span class="float-literal">8.8</span><span class="punctuation">,</span> <span class="float-literal">8.7</span><span class="punctuation">,</span> <span class="int-literal">7</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="float-literal">8.9</span><span class="punctuation">,</span> <span class="float-literal">8.8</span><span class="punctuation">,</span> <span class="float-literal">8.7</span><span class="punctuation">,</span> <span class="float-literal">8.6</span><span class="punctuation">,</span> <span class="int-literal">7</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="float-literal">8.9</span><span class="punctuation">,</span> <span class="float-literal">8.8</span><span class="punctuation">,</span> <span class="float-literal">8.7</span><span class="punctuation">,</span> <span class="int-literal">7</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="float-literal">8.9</span><span class="punctuation">,</span> <span class="float-literal">8.8</span><span class="punctuation">,</span> <span class="float-literal">8.7</span><span class="punctuation">,</span> <span class="int-literal">7</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_extend_downward</span><span class="grouping">(</span><span class="identifier">r_plot</span><span class="punctuation">,</span> <span class="identifier">end</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">r_plot</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">r_plot</span><span class="grouping">)</span>
    <span class="identifier">ratio</span> <span class="arithmetic-assignment">=</span> <span class="identifier">r_plot</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">/</span> <span class="identifier">r_plot</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">:</span><span class="grouping">]</span>
    <span class="identifier">steep_downward</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ratio</span> <span class="relational-operator">&gt;=</span> <span class="int-literal">1</span> <span class="arithmetic-operator">/</span> <span class="float-literal">.9</span>
    <span class="identifier">upward</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ratio</span> <span class="relational-operator">&lt;</span> <span class="int-literal">1</span>

    <span class="identifier">e</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_extend_region</span><span class="grouping">(</span><span class="identifier">steep_downward</span><span class="punctuation">,</span> <span class="identifier">upward</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">e</span> <span class="relational-operator">==</span> <span class="identifier">end</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="grouping">(</span><span class="string-literal">'r_plot', 'end'</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">[</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="float-literal">2.1</span><span class="punctuation">,</span> <span class="float-literal">2.2</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="float-literal">2.1</span><span class="punctuation">,</span> <span class="float-literal">2.2</span><span class="punctuation">,</span> <span class="float-literal">2.3</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="float-literal">2.1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="float-literal">2.1</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_extend_upward</span><span class="grouping">(</span><span class="identifier">r_plot</span><span class="punctuation">,</span> <span class="identifier">end</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">r_plot</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">r_plot</span><span class="grouping">)</span>
    <span class="identifier">ratio</span> <span class="arithmetic-assignment">=</span> <span class="identifier">r_plot</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">/</span> <span class="identifier">r_plot</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">:</span><span class="grouping">]</span>
    <span class="identifier">steep_upward</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ratio</span> <span class="relational-operator">&lt;=</span> <span class="float-literal">.9</span>
    <span class="identifier">downward</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ratio</span> <span class="relational-operator">&gt;</span> <span class="int-literal">1</span>

    <span class="identifier">e</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_extend_region</span><span class="grouping">(</span><span class="identifier">steep_upward</span><span class="punctuation">,</span> <span class="identifier">downward</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">e</span> <span class="relational-operator">==</span> <span class="identifier">end</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="grouping">(</span><span class="string-literal">'ordering', 'clusters', 'expected'</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">[</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_the_extract_xi_labels</span><span class="grouping">(</span><span class="identifier">ordering</span><span class="punctuation">,</span> <span class="identifier">clusters</span><span class="punctuation">,</span> <span class="identifier">expected</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_extract_xi_labels</span><span class="grouping">(</span><span class="identifier">ordering</span><span class="punctuation">,</span> <span class="identifier">clusters</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">labels</span><span class="punctuation">,</span> <span class="identifier">expected</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_extract_xi</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># small and easy test (no clusters around other clusters)</span>
    <span class="comment"># but with a clear noise data.</span>
    <span class="identifier">rng</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">RandomState</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">n_points_per_cluster</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">5</span>

    <span class="identifier">C1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.8</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">C2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.1</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">C3</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.2</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">C4</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.3</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">C5</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.6</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">C6</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.2</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>

    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">vstack</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">C1</span><span class="punctuation">,</span> <span class="identifier">C2</span><span class="punctuation">,</span> <span class="identifier">C3</span><span class="punctuation">,</span> <span class="identifier">C4</span><span class="punctuation">,</span> <span class="identifier">C5</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">100</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">C6</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">expected_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">r_</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span>
                            <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="grouping">]</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">shuffle</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">rng</span><span class="grouping">)</span>

    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">min_cluster_size</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                   <span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="int-literal">20</span><span class="punctuation">,</span> <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'xi'</span><span class="punctuation">,</span>
                   <span class="identifier">xi</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.4</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="grouping">)</span>

    <span class="comment"># check float min_samples and min_cluster_size</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="identifier">min_cluster_size</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.08</span><span class="punctuation">,</span>
                   <span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="int-literal">20</span><span class="punctuation">,</span> <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'xi'</span><span class="punctuation">,</span>
                   <span class="identifier">xi</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.4</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="grouping">)</span>

    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">vstack</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">C1</span><span class="punctuation">,</span> <span class="identifier">C2</span><span class="punctuation">,</span> <span class="identifier">C3</span><span class="punctuation">,</span> <span class="identifier">C4</span><span class="punctuation">,</span> <span class="identifier">C5</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">100</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">C6</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">expected_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">r_</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="punctuation">,</span>
                            <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="grouping">]</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">shuffle</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">rng</span><span class="grouping">)</span>

    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">min_cluster_size</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                   <span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="int-literal">20</span><span class="punctuation">,</span> <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'xi'</span><span class="punctuation">,</span>
                   <span class="identifier">xi</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.3</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="comment"># this may fail if the predecessor correction is not at work!</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="grouping">)</span>

    <span class="identifier">C1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="float-literal">0.1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="float-literal">-.1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">C2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">9</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">11</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">9</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">C3</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">100</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">90</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">110</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">90</span><span class="punctuation">,</span> <span class="int-literal">100</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">vstack</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">C1</span><span class="punctuation">,</span> <span class="identifier">C2</span><span class="punctuation">,</span> <span class="identifier">C3</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">expected_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">r_</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">4</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">4</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">4</span><span class="grouping">]</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">shuffle</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">rng</span><span class="grouping">)</span>

    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">min_cluster_size</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                   <span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'xi'</span><span class="punctuation">,</span>
                   <span class="identifier">xi</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.04</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_cluster_hierarchy_</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">rng</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">RandomState</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">n_points_per_cluster</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">100</span>
    <span class="identifier">C1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">C2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="int-literal">50</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">vstack</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">C1</span><span class="punctuation">,</span> <span class="identifier">C2</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">shuffle</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

    <span class="identifier">clusters</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">20</span><span class="punctuation">,</span> <span class="identifier">xi</span><span class="arithmetic-assignment">=</span><span class="float-literal">.1</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">cluster_hierarchy_</span>
    <span class="keyword">assert</span> <span class="identifier">clusters</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">diff</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">clusters</span> <span class="arithmetic-operator">-</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">99</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">199</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">diff</span> <span class="arithmetic-operator">/</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span> <span class="relational-operator">&lt;</span> <span class="float-literal">0.05</span>


<span class="keyword">def</span> <span class="identifier">test_correct_number_of_clusters</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># in 'auto' mode</span>

    <span class="identifier">n_clusters</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">3</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">generate_clustered_data</span><span class="grouping">(</span><span class="identifier">n_clusters</span><span class="arithmetic-assignment">=</span><span class="identifier">n_clusters</span><span class="grouping">)</span>
    <span class="comment"># Parameters chosen specifically for this task.</span>
    <span class="comment"># Compute OPTICS</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">5.0</span> <span class="arithmetic-operator">*</span> <span class="float-literal">6.0</span><span class="punctuation">,</span> <span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="identifier">xi</span><span class="arithmetic-assignment">=</span><span class="float-literal">.1</span><span class="grouping">)</span>
    <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="comment"># number of clusters, ignoring noise if present</span>
    <span class="identifier">n_clusters_1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="grouping">)</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">int</span><span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span> <span class="relational-operator">in</span> <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">n_clusters_1</span> <span class="relational-operator">==</span> <span class="identifier">n_clusters</span>

    <span class="comment"># check attribute types and sizes</span>
    <span class="keyword">assert</span> <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">,</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">.</span><span class="identifier">dtype</span><span class="punctuation">.</span><span class="identifier">kind</span> <span class="relational-operator">==</span> <span class="string-literal">'i'</span>

    <span class="keyword">assert</span> <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">reachability_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">,</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">reachability_</span><span class="punctuation">.</span><span class="identifier">dtype</span><span class="punctuation">.</span><span class="identifier">kind</span> <span class="relational-operator">==</span> <span class="string-literal">'f'</span>

    <span class="keyword">assert</span> <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">core_distances_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">,</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">core_distances_</span><span class="punctuation">.</span><span class="identifier">dtype</span><span class="punctuation">.</span><span class="identifier">kind</span> <span class="relational-operator">==</span> <span class="string-literal">'f'</span>

    <span class="keyword">assert</span> <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">,</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="punctuation">.</span><span class="identifier">dtype</span><span class="punctuation">.</span><span class="identifier">kind</span> <span class="relational-operator">==</span> <span class="string-literal">'i'</span>
    <span class="keyword">assert</span> <span class="identifier">set</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">set</span><span class="grouping">(</span><span class="identifier">range</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_minimum_number_of_sample_check</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># test that we check a minimum number of samples</span>
    <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"min_samples must be no greater than"</span>

    <span class="comment"># Compute OPTICS</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">5.0</span> <span class="arithmetic-operator">*</span> <span class="float-literal">0.3</span><span class="punctuation">,</span> <span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">min_cluster_size</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>

    <span class="comment"># Run the fit</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_bad_extract</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Test an extraction of eps too close to original eps</span>
    <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"Specify an epsilon smaller than 0.15. Got 0.3."</span>
    <span class="identifier">centers</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels_true</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_blobs</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">750</span><span class="punctuation">,</span> <span class="identifier">centers</span><span class="arithmetic-assignment">=</span><span class="identifier">centers</span><span class="punctuation">,</span>
                                <span class="identifier">cluster_std</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.4</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

    <span class="comment"># Compute OPTICS</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">5.0</span> <span class="arithmetic-operator">*</span> <span class="float-literal">0.03</span><span class="punctuation">,</span>
                   <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'dbscan'</span><span class="punctuation">,</span>
                   <span class="identifier">eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.3</span><span class="punctuation">,</span> <span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_bad_reachability</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"All reachability values are inf. Set a larger max_eps."</span>
    <span class="identifier">centers</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels_true</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_blobs</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">750</span><span class="punctuation">,</span> <span class="identifier">centers</span><span class="arithmetic-assignment">=</span><span class="identifier">centers</span><span class="punctuation">,</span>
                                <span class="identifier">cluster_std</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.4</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">warns</span><span class="grouping">(</span><span class="identifier">UserWarning</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">5.0</span> <span class="arithmetic-operator">*</span> <span class="float-literal">0.003</span><span class="punctuation">,</span> <span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.015</span><span class="grouping">)</span>
        <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_nowarn_if_metric_bool_data_bool</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># make sure no warning is raised if metric and data are both boolean</span>
    <span class="comment"># non-regression test for</span>
    <span class="comment"># https://github.com/scikit-learn/scikit-learn/issues/18996</span>

    <span class="identifier">pairwise_metric</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'rogerstanimoto'</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">randint</span><span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">bool</span><span class="grouping">)</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">warns</span><span class="grouping">(</span><span class="none-literal">None</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">warn_record</span><span class="punctuation">:</span>
        <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="identifier">pairwise_metric</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">warn_record</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span>


<span class="keyword">def</span> <span class="identifier">test_warn_if_metric_bool_data_no_bool</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># make sure a *single* conversion warning is raised if metric is boolean</span>
    <span class="comment"># but data isn't</span>
    <span class="comment"># non-regression test for</span>
    <span class="comment"># https://github.com/scikit-learn/scikit-learn/issues/18996</span>

    <span class="identifier">pairwise_metric</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'rogerstanimoto'</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">randint</span><span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">int32</span><span class="grouping">)</span>
    <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="identifier">f</span><span class="string-literal">"Data will be converted to boolean for metric {pairwise_metric}"</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">warns</span><span class="grouping">(</span><span class="identifier">DataConversionWarning</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">msg</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">warn_record</span><span class="punctuation">:</span>
        <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="identifier">pairwise_metric</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">warn_record</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>


<span class="keyword">def</span> <span class="identifier">test_nowarn_if_metric_no_bool</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># make sure no conversion warning is raised if</span>
    <span class="comment"># metric isn't boolean, no matter what the data type is</span>
    <span class="identifier">pairwise_metric</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'minkowski'</span>
    <span class="identifier">X_bool</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">randint</span><span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">bool</span><span class="grouping">)</span>
    <span class="identifier">X_num</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">randint</span><span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">int32</span><span class="grouping">)</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">warns</span><span class="grouping">(</span><span class="none-literal">None</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">warn_record</span><span class="punctuation">:</span>
        <span class="comment"># fit boolean data</span>
        <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="identifier">pairwise_metric</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_bool</span><span class="grouping">)</span>
        <span class="comment"># fit numeric data</span>
        <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="identifier">pairwise_metric</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_num</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">warn_record</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span>


<span class="keyword">def</span> <span class="identifier">test_close_extract</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Test extract where extraction eps is close to scaled max_eps</span>

    <span class="identifier">centers</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels_true</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_blobs</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">750</span><span class="punctuation">,</span> <span class="identifier">centers</span><span class="arithmetic-assignment">=</span><span class="identifier">centers</span><span class="punctuation">,</span>
                                <span class="identifier">cluster_std</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.4</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

    <span class="comment"># Compute OPTICS</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">1.0</span><span class="punctuation">,</span> <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'dbscan'</span><span class="punctuation">,</span>
                   <span class="identifier">eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.3</span><span class="punctuation">,</span> <span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="comment"># Cluster ordering starts at 0; max cluster label = 2 is 3 clusters</span>
    <span class="keyword">assert</span> <span class="identifier">max</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'eps'</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="float-literal">.3</span><span class="punctuation">,</span> <span class="float-literal">.5</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'min_samples'</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">20</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_dbscan_optics_parity</span><span class="grouping">(</span><span class="identifier">eps</span><span class="punctuation">,</span> <span class="identifier">min_samples</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Test that OPTICS clustering labels are &lt;= 5% difference of DBSCAN</span>

    <span class="identifier">centers</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels_true</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_blobs</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">750</span><span class="punctuation">,</span> <span class="identifier">centers</span><span class="arithmetic-assignment">=</span><span class="identifier">centers</span><span class="punctuation">,</span>
                                <span class="identifier">cluster_std</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.4</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

    <span class="comment"># calculate optics with dbscan extract at 0.3 epsilon</span>
    <span class="identifier">op</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="identifier">min_samples</span><span class="punctuation">,</span> <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'dbscan'</span><span class="punctuation">,</span>
                <span class="identifier">eps</span><span class="arithmetic-assignment">=</span><span class="identifier">eps</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>

    <span class="comment"># calculate dbscan labels</span>
    <span class="identifier">db</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DBSCAN</span><span class="grouping">(</span><span class="identifier">eps</span><span class="arithmetic-assignment">=</span><span class="identifier">eps</span><span class="punctuation">,</span> <span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="identifier">min_samples</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>

    <span class="identifier">contingency</span> <span class="arithmetic-assignment">=</span> <span class="identifier">contingency_matrix</span><span class="grouping">(</span><span class="identifier">db</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="grouping">)</span>
    <span class="identifier">agree</span> <span class="arithmetic-assignment">=</span> <span class="identifier">min</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="identifier">contingency</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="identifier">contingency</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">disagree</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">-</span> <span class="identifier">agree</span>

    <span class="identifier">percent_mismatch</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">round</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">disagree</span> <span class="arithmetic-operator">-</span> <span class="int-literal">1</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>

    <span class="comment"># verify label mismatch is &lt;= 5% labels</span>
    <span class="keyword">assert</span> <span class="identifier">percent_mismatch</span> <span class="relational-operator">&lt;=</span> <span class="float-literal">0.05</span>


<span class="keyword">def</span> <span class="identifier">test_min_samples_edge_case</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">C1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="float-literal">0.1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="float-literal">-.1</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">C2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">9</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">11</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">C3</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">100</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">96</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">106</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">vstack</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">C1</span><span class="punctuation">,</span> <span class="identifier">C2</span><span class="punctuation">,</span> <span class="identifier">C3</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="identifier">expected_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">r_</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">3</span><span class="grouping">]</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                   <span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="int-literal">7</span><span class="punctuation">,</span> <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'xi'</span><span class="punctuation">,</span>
                   <span class="identifier">xi</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.04</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="grouping">)</span>

    <span class="identifier">expected_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">r_</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">3</span><span class="grouping">]</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                   <span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'xi'</span><span class="punctuation">,</span>
                   <span class="identifier">xi</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.04</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="grouping">)</span>

    <span class="identifier">expected_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">r_</span><span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">9</span><span class="grouping">]</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">warns</span><span class="grouping">(</span><span class="identifier">UserWarning</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"All reachability values"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">4</span><span class="punctuation">,</span>
                       <span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'xi'</span><span class="punctuation">,</span>
                       <span class="identifier">xi</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.04</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">expected_labels</span><span class="grouping">)</span>


<span class="comment"># try arbitrary minimum sizes</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'min_cluster_size'</span><span class="punctuation">,</span> <span class="identifier">range</span><span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">//</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">23</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_min_cluster_size</span><span class="grouping">(</span><span class="identifier">min_cluster_size</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">redX</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="int-literal">2</span><span class="grouping">]</span>  <span class="comment"># reduce for speed</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">9</span><span class="punctuation">,</span> <span class="identifier">min_cluster_size</span><span class="arithmetic-assignment">=</span><span class="identifier">min_cluster_size</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">redX</span><span class="grouping">)</span>
    <span class="identifier">cluster_sizes</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">bincount</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="grouping">[</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span> <span class="relational-operator">!=</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">cluster_sizes</span><span class="punctuation">.</span><span class="identifier">size</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="identifier">min</span><span class="grouping">(</span><span class="identifier">cluster_sizes</span><span class="grouping">)</span> <span class="relational-operator">&gt;=</span> <span class="identifier">min_cluster_size</span>
    <span class="comment"># check behaviour is the same when min_cluster_size is a fraction</span>
    <span class="identifier">clust_frac</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">9</span><span class="punctuation">,</span>
                        <span class="identifier">min_cluster_size</span><span class="arithmetic-assignment">=</span><span class="identifier">min_cluster_size</span> <span class="arithmetic-operator">/</span> <span class="identifier">redX</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="identifier">clust_frac</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">redX</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">clust_frac</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'min_cluster_size'</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="float-literal">1.1</span><span class="punctuation">,</span> <span class="float-literal">2.2</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_min_cluster_size_invalid</span><span class="grouping">(</span><span class="identifier">min_cluster_size</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_cluster_size</span><span class="arithmetic-assignment">=</span><span class="identifier">min_cluster_size</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"must be a positive integer or a "</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_min_cluster_size_invalid2</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_cluster_size</span><span class="arithmetic-assignment">=</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"must be no greater than the "</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_processing_order</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Ensure that we consider all unprocessed points,</span>
    <span class="comment"># not only direct neighbors. when picking the next point.</span>
    <span class="identifier">Y</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">10</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">10</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">25</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="int-literal">15</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">Y</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">reachability_</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">core_distances_</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_compare_to_ELKI</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Expected values, computed with (future) ELKI 0.7.5 using:</span>
    <span class="comment"># java -jar elki.jar cli -dbc.in csv -dbc.filter FixedDBIDsFilter</span>
    <span class="comment">#   -algorithm clustering.optics.OPTICSHeap -optics.minpts 5</span>
    <span class="comment"># where the FixedDBIDsFilter gives 0-indexed ids.</span>
    <span class="identifier">r1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="float-literal">1.0574896366427478</span><span class="punctuation">,</span> <span class="float-literal">0.7587934993548423</span><span class="punctuation">,</span> <span class="float-literal">0.7290174038973836</span><span class="punctuation">,</span>
          <span class="float-literal">0.7290174038973836</span><span class="punctuation">,</span> <span class="float-literal">0.7290174038973836</span><span class="punctuation">,</span> <span class="float-literal">0.6861627576116127</span><span class="punctuation">,</span>
          <span class="float-literal">0.7587934993548423</span><span class="punctuation">,</span> <span class="float-literal">0.9280118450166668</span><span class="punctuation">,</span> <span class="float-literal">1.1748022534146194</span><span class="punctuation">,</span>
          <span class="float-literal">3.3355455741292257</span><span class="punctuation">,</span> <span class="float-literal">0.49618389254482587</span><span class="punctuation">,</span> <span class="float-literal">0.2552805046961355</span><span class="punctuation">,</span>
          <span class="float-literal">0.2552805046961355</span><span class="punctuation">,</span> <span class="float-literal">0.24944622248445714</span><span class="punctuation">,</span> <span class="float-literal">0.24944622248445714</span><span class="punctuation">,</span>
          <span class="float-literal">0.24944622248445714</span><span class="punctuation">,</span> <span class="float-literal">0.2552805046961355</span><span class="punctuation">,</span> <span class="float-literal">0.2552805046961355</span><span class="punctuation">,</span>
          <span class="float-literal">0.3086779122185853</span><span class="punctuation">,</span> <span class="float-literal">4.163024452756142</span><span class="punctuation">,</span> <span class="float-literal">1.623152630340929</span><span class="punctuation">,</span>
          <span class="float-literal">0.45315840475822655</span><span class="punctuation">,</span> <span class="float-literal">0.25468325192031926</span><span class="punctuation">,</span> <span class="float-literal">0.2254004358159971</span><span class="punctuation">,</span>
          <span class="float-literal">0.18765711877083036</span><span class="punctuation">,</span> <span class="float-literal">0.1821471333893275</span><span class="punctuation">,</span> <span class="float-literal">0.1821471333893275</span><span class="punctuation">,</span>
          <span class="float-literal">0.18765711877083036</span><span class="punctuation">,</span> <span class="float-literal">0.18765711877083036</span><span class="punctuation">,</span> <span class="float-literal">0.2240202988740153</span><span class="punctuation">,</span>
          <span class="float-literal">1.154337614548715</span><span class="punctuation">,</span> <span class="float-literal">1.342604473837069</span><span class="punctuation">,</span> <span class="float-literal">1.323308536402633</span><span class="punctuation">,</span>
          <span class="float-literal">0.8607514948648837</span><span class="punctuation">,</span> <span class="float-literal">0.27219111215810565</span><span class="punctuation">,</span> <span class="float-literal">0.13260875220533205</span><span class="punctuation">,</span>
          <span class="float-literal">0.13260875220533205</span><span class="punctuation">,</span> <span class="float-literal">0.09890587675958984</span><span class="punctuation">,</span> <span class="float-literal">0.09890587675958984</span><span class="punctuation">,</span>
          <span class="float-literal">0.13548790801634494</span><span class="punctuation">,</span> <span class="float-literal">0.1575483940837384</span><span class="punctuation">,</span> <span class="float-literal">0.17515137170530226</span><span class="punctuation">,</span>
          <span class="float-literal">0.17575920159442388</span><span class="punctuation">,</span> <span class="float-literal">0.27219111215810565</span><span class="punctuation">,</span> <span class="float-literal">0.6101447895405373</span><span class="punctuation">,</span>
          <span class="float-literal">1.3189208094864302</span><span class="punctuation">,</span> <span class="float-literal">1.323308536402633</span><span class="punctuation">,</span> <span class="float-literal">2.2509184159764577</span><span class="punctuation">,</span>
          <span class="float-literal">2.4517810628594527</span><span class="punctuation">,</span> <span class="float-literal">3.675977064404973</span><span class="punctuation">,</span> <span class="float-literal">3.8264795626020365</span><span class="punctuation">,</span>
          <span class="float-literal">2.9130735341510614</span><span class="punctuation">,</span> <span class="float-literal">2.9130735341510614</span><span class="punctuation">,</span> <span class="float-literal">2.9130735341510614</span><span class="punctuation">,</span>
          <span class="float-literal">2.9130735341510614</span><span class="punctuation">,</span> <span class="float-literal">2.8459300127258036</span><span class="punctuation">,</span> <span class="float-literal">2.8459300127258036</span><span class="punctuation">,</span>
          <span class="float-literal">2.8459300127258036</span><span class="punctuation">,</span> <span class="float-literal">3.0321982337972537</span><span class="grouping">]</span>
    <span class="identifier">o1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">7</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">9</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">31</span><span class="punctuation">,</span> <span class="int-literal">30</span><span class="punctuation">,</span> <span class="int-literal">32</span><span class="punctuation">,</span> <span class="int-literal">34</span><span class="punctuation">,</span> <span class="int-literal">33</span><span class="punctuation">,</span> <span class="int-literal">38</span><span class="punctuation">,</span> <span class="int-literal">39</span><span class="punctuation">,</span> <span class="int-literal">35</span><span class="punctuation">,</span> <span class="int-literal">37</span><span class="punctuation">,</span> <span class="int-literal">36</span><span class="punctuation">,</span>
          <span class="int-literal">44</span><span class="punctuation">,</span> <span class="int-literal">21</span><span class="punctuation">,</span> <span class="int-literal">23</span><span class="punctuation">,</span> <span class="int-literal">24</span><span class="punctuation">,</span> <span class="int-literal">22</span><span class="punctuation">,</span> <span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">27</span><span class="punctuation">,</span> <span class="int-literal">29</span><span class="punctuation">,</span> <span class="int-literal">26</span><span class="punctuation">,</span> <span class="int-literal">28</span><span class="punctuation">,</span> <span class="int-literal">20</span><span class="punctuation">,</span> <span class="int-literal">40</span><span class="punctuation">,</span> <span class="int-literal">45</span><span class="punctuation">,</span> <span class="int-literal">46</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">11</span><span class="punctuation">,</span>
          <span class="int-literal">13</span><span class="punctuation">,</span> <span class="int-literal">17</span><span class="punctuation">,</span> <span class="int-literal">19</span><span class="punctuation">,</span> <span class="int-literal">18</span><span class="punctuation">,</span> <span class="int-literal">12</span><span class="punctuation">,</span> <span class="int-literal">16</span><span class="punctuation">,</span> <span class="int-literal">14</span><span class="punctuation">,</span> <span class="int-literal">47</span><span class="punctuation">,</span> <span class="int-literal">49</span><span class="punctuation">,</span> <span class="int-literal">43</span><span class="punctuation">,</span> <span class="int-literal">48</span><span class="punctuation">,</span> <span class="int-literal">42</span><span class="punctuation">,</span> <span class="int-literal">41</span><span class="punctuation">,</span> <span class="int-literal">53</span><span class="punctuation">,</span> <span class="int-literal">57</span><span class="punctuation">,</span> <span class="int-literal">51</span><span class="punctuation">,</span> <span class="int-literal">52</span><span class="punctuation">,</span>
          <span class="int-literal">56</span><span class="punctuation">,</span> <span class="int-literal">59</span><span class="punctuation">,</span> <span class="int-literal">54</span><span class="punctuation">,</span> <span class="int-literal">55</span><span class="punctuation">,</span> <span class="int-literal">58</span><span class="punctuation">,</span> <span class="int-literal">50</span><span class="grouping">]</span>
    <span class="identifier">p1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">7</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">31</span><span class="punctuation">,</span> <span class="int-literal">30</span><span class="punctuation">,</span> <span class="int-literal">30</span><span class="punctuation">,</span> <span class="int-literal">34</span><span class="punctuation">,</span> <span class="int-literal">34</span><span class="punctuation">,</span> <span class="int-literal">34</span><span class="punctuation">,</span> <span class="int-literal">32</span><span class="punctuation">,</span> <span class="int-literal">32</span><span class="punctuation">,</span> <span class="int-literal">37</span><span class="punctuation">,</span>
          <span class="int-literal">36</span><span class="punctuation">,</span> <span class="int-literal">44</span><span class="punctuation">,</span> <span class="int-literal">21</span><span class="punctuation">,</span> <span class="int-literal">23</span><span class="punctuation">,</span> <span class="int-literal">24</span><span class="punctuation">,</span> <span class="int-literal">22</span><span class="punctuation">,</span> <span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">22</span><span class="punctuation">,</span> <span class="int-literal">22</span><span class="punctuation">,</span> <span class="int-literal">22</span><span class="punctuation">,</span> <span class="int-literal">21</span><span class="punctuation">,</span> <span class="int-literal">40</span><span class="punctuation">,</span> <span class="int-literal">45</span><span class="punctuation">,</span> <span class="int-literal">46</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span>
          <span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">13</span><span class="punctuation">,</span> <span class="int-literal">13</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">11</span><span class="punctuation">,</span> <span class="int-literal">19</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">47</span><span class="punctuation">,</span> <span class="int-literal">12</span><span class="punctuation">,</span> <span class="int-literal">45</span><span class="punctuation">,</span> <span class="int-literal">14</span><span class="punctuation">,</span> <span class="int-literal">43</span><span class="punctuation">,</span> <span class="int-literal">42</span><span class="punctuation">,</span> <span class="int-literal">53</span><span class="punctuation">,</span> <span class="int-literal">57</span><span class="punctuation">,</span> <span class="int-literal">57</span><span class="punctuation">,</span>
          <span class="int-literal">57</span><span class="punctuation">,</span> <span class="int-literal">57</span><span class="punctuation">,</span> <span class="int-literal">59</span><span class="punctuation">,</span> <span class="int-literal">59</span><span class="punctuation">,</span> <span class="int-literal">59</span><span class="punctuation">,</span> <span class="int-literal">58</span><span class="grouping">]</span>

    <span class="comment"># Tests against known extraction array</span>
    <span class="comment"># Does NOT work with metric='euclidean', because sklearn euclidean has</span>
    <span class="comment"># worse numeric precision. 'minkowski' is slower but more accurate.</span>
    <span class="identifier">clust1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">o1</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">predecessor_</span><span class="grouping">[</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">p1</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">reachability_</span><span class="grouping">[</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">r1</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="comment"># ELKI currently does not print the core distances (which are not used much</span>
    <span class="comment"># in literature, but we can at least ensure to have this consistency:</span>
    <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">:</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="grouping">(</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">reachability_</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="relational-operator">&gt;=</span>
                <span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">core_distances_</span><span class="grouping">[</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">predecessor_</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="comment"># Expected values, computed with (future) ELKI 0.7.5 using</span>
    <span class="identifier">r2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span>
          <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="float-literal">0.27219111215810565</span><span class="punctuation">,</span> <span class="float-literal">0.13260875220533205</span><span class="punctuation">,</span>
          <span class="float-literal">0.13260875220533205</span><span class="punctuation">,</span> <span class="float-literal">0.09890587675958984</span><span class="punctuation">,</span> <span class="float-literal">0.09890587675958984</span><span class="punctuation">,</span>
          <span class="float-literal">0.13548790801634494</span><span class="punctuation">,</span> <span class="float-literal">0.1575483940837384</span><span class="punctuation">,</span> <span class="float-literal">0.17515137170530226</span><span class="punctuation">,</span>
          <span class="float-literal">0.17575920159442388</span><span class="punctuation">,</span> <span class="float-literal">0.27219111215810565</span><span class="punctuation">,</span> <span class="float-literal">0.4928068613197889</span><span class="punctuation">,</span>
          <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="float-literal">0.2666183922512113</span><span class="punctuation">,</span> <span class="float-literal">0.18765711877083036</span><span class="punctuation">,</span> <span class="float-literal">0.1821471333893275</span><span class="punctuation">,</span>
          <span class="float-literal">0.1821471333893275</span><span class="punctuation">,</span> <span class="float-literal">0.1821471333893275</span><span class="punctuation">,</span> <span class="float-literal">0.18715928772277457</span><span class="punctuation">,</span>
          <span class="float-literal">0.18765711877083036</span><span class="punctuation">,</span> <span class="float-literal">0.18765711877083036</span><span class="punctuation">,</span> <span class="float-literal">0.25468325192031926</span><span class="punctuation">,</span>
          <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="float-literal">0.2552805046961355</span><span class="punctuation">,</span> <span class="float-literal">0.2552805046961355</span><span class="punctuation">,</span> <span class="float-literal">0.24944622248445714</span><span class="punctuation">,</span>
          <span class="float-literal">0.24944622248445714</span><span class="punctuation">,</span> <span class="float-literal">0.24944622248445714</span><span class="punctuation">,</span> <span class="float-literal">0.2552805046961355</span><span class="punctuation">,</span>
          <span class="float-literal">0.2552805046961355</span><span class="punctuation">,</span> <span class="float-literal">0.3086779122185853</span><span class="punctuation">,</span> <span class="float-literal">0.34466409325984865</span><span class="punctuation">,</span>
          <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span>
          <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span>
          <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">inf</span><span class="grouping">]</span>
    <span class="identifier">o2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="punctuation">,</span> <span class="int-literal">7</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="punctuation">,</span> <span class="int-literal">9</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">11</span><span class="punctuation">,</span> <span class="int-literal">13</span><span class="punctuation">,</span> <span class="int-literal">17</span><span class="punctuation">,</span> <span class="int-literal">19</span><span class="punctuation">,</span> <span class="int-literal">18</span><span class="punctuation">,</span> <span class="int-literal">12</span><span class="punctuation">,</span> <span class="int-literal">16</span><span class="punctuation">,</span> <span class="int-literal">14</span><span class="punctuation">,</span>
          <span class="int-literal">47</span><span class="punctuation">,</span> <span class="int-literal">46</span><span class="punctuation">,</span> <span class="int-literal">20</span><span class="punctuation">,</span> <span class="int-literal">22</span><span class="punctuation">,</span> <span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">23</span><span class="punctuation">,</span> <span class="int-literal">27</span><span class="punctuation">,</span> <span class="int-literal">29</span><span class="punctuation">,</span> <span class="int-literal">24</span><span class="punctuation">,</span> <span class="int-literal">26</span><span class="punctuation">,</span> <span class="int-literal">28</span><span class="punctuation">,</span> <span class="int-literal">21</span><span class="punctuation">,</span> <span class="int-literal">30</span><span class="punctuation">,</span> <span class="int-literal">32</span><span class="punctuation">,</span> <span class="int-literal">34</span><span class="punctuation">,</span> <span class="int-literal">33</span><span class="punctuation">,</span> <span class="int-literal">38</span><span class="punctuation">,</span>
          <span class="int-literal">39</span><span class="punctuation">,</span> <span class="int-literal">35</span><span class="punctuation">,</span> <span class="int-literal">37</span><span class="punctuation">,</span> <span class="int-literal">36</span><span class="punctuation">,</span> <span class="int-literal">31</span><span class="punctuation">,</span> <span class="int-literal">40</span><span class="punctuation">,</span> <span class="int-literal">41</span><span class="punctuation">,</span> <span class="int-literal">42</span><span class="punctuation">,</span> <span class="int-literal">43</span><span class="punctuation">,</span> <span class="int-literal">44</span><span class="punctuation">,</span> <span class="int-literal">45</span><span class="punctuation">,</span> <span class="int-literal">48</span><span class="punctuation">,</span> <span class="int-literal">49</span><span class="punctuation">,</span> <span class="int-literal">50</span><span class="punctuation">,</span> <span class="int-literal">51</span><span class="punctuation">,</span> <span class="int-literal">52</span><span class="punctuation">,</span> <span class="int-literal">53</span><span class="punctuation">,</span>
          <span class="int-literal">54</span><span class="punctuation">,</span> <span class="int-literal">55</span><span class="punctuation">,</span> <span class="int-literal">56</span><span class="punctuation">,</span> <span class="int-literal">57</span><span class="punctuation">,</span> <span class="int-literal">58</span><span class="punctuation">,</span> <span class="int-literal">59</span><span class="grouping">]</span>
    <span class="identifier">p2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">13</span><span class="punctuation">,</span> <span class="int-literal">13</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span>
          <span class="int-literal">11</span><span class="punctuation">,</span> <span class="int-literal">19</span><span class="punctuation">,</span> <span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">47</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">20</span><span class="punctuation">,</span> <span class="int-literal">22</span><span class="punctuation">,</span> <span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">22</span><span class="punctuation">,</span> <span class="int-literal">22</span><span class="punctuation">,</span> <span class="int-literal">23</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">30</span><span class="punctuation">,</span>
          <span class="int-literal">30</span><span class="punctuation">,</span> <span class="int-literal">34</span><span class="punctuation">,</span> <span class="int-literal">34</span><span class="punctuation">,</span> <span class="int-literal">34</span><span class="punctuation">,</span> <span class="int-literal">32</span><span class="punctuation">,</span> <span class="int-literal">32</span><span class="punctuation">,</span> <span class="int-literal">37</span><span class="punctuation">,</span> <span class="int-literal">38</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span>
          <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>
    <span class="identifier">clust2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">max_eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.5</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust2</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">o2</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust2</span><span class="punctuation">.</span><span class="identifier">predecessor_</span><span class="grouping">[</span><span class="identifier">clust2</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">p2</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">clust2</span><span class="punctuation">.</span><span class="identifier">reachability_</span><span class="grouping">[</span><span class="identifier">clust2</span><span class="punctuation">.</span><span class="identifier">ordering_</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">r2</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="identifier">index</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">where</span><span class="grouping">(</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">core_distances_</span> <span class="relational-operator">&lt;=</span> <span class="float-literal">0.5</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">core_distances_</span><span class="grouping">[</span><span class="identifier">index</span><span class="grouping">]</span><span class="punctuation">,</span>
                    <span class="identifier">clust2</span><span class="punctuation">.</span><span class="identifier">core_distances_</span><span class="grouping">[</span><span class="identifier">index</span><span class="grouping">]</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_wrong_cluster_method</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'superfancy'</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"cluster_method should be one of "</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_extract_dbscan</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># testing an easy dbscan case. Not including clusters with different</span>
    <span class="comment"># densities.</span>
    <span class="identifier">rng</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">RandomState</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">n_points_per_cluster</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">20</span>
    <span class="identifier">C1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.2</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">C2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.2</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">C3</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.2</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">C4</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.2</span> <span class="arithmetic-operator">*</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">n_points_per_cluster</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">vstack</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">C1</span><span class="punctuation">,</span> <span class="identifier">C2</span><span class="punctuation">,</span> <span class="identifier">C3</span><span class="punctuation">,</span> <span class="identifier">C4</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="identifier">clust</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">cluster_method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'dbscan'</span><span class="punctuation">,</span> <span class="identifier">eps</span><span class="arithmetic-assignment">=</span><span class="float-literal">.5</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sort</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">unique</span><span class="grouping">(</span><span class="identifier">clust</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_precomputed_dists</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">redX</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="int-literal">2</span><span class="grouping">]</span>
    <span class="identifier">dists</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pairwise_distances</span><span class="grouping">(</span><span class="identifier">redX</span><span class="punctuation">,</span> <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'euclidean'</span><span class="grouping">)</span>
    <span class="identifier">clust1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">algorithm</span><span class="arithmetic-assignment">=</span><span class="string-literal">'brute'</span><span class="punctuation">,</span>
                    <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'precomputed'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">dists</span><span class="grouping">)</span>
    <span class="identifier">clust2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OPTICS</span><span class="grouping">(</span><span class="identifier">min_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">algorithm</span><span class="arithmetic-assignment">=</span><span class="string-literal">'brute'</span><span class="punctuation">,</span>
                    <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'euclidean'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">redX</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">reachability_</span><span class="punctuation">,</span> <span class="identifier">clust2</span><span class="punctuation">.</span><span class="identifier">reachability_</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">clust1</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="punctuation">,</span> <span class="identifier">clust2</span><span class="punctuation">.</span><span class="identifier">labels_</span><span class="grouping">)</span>

    </pre>
  </body>
</html>