<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
==================================================
Explicit feature map approximation for RBF kernels
==================================================

An example illustrating the approximation of the feature map
of an RBF kernel.

.. currentmodule:: sklearn.kernel_approximation

It shows how to use :class:`RBFSampler` and :class:`Nystroem` to
approximate the feature map of an RBF kernel for classification with an SVM on
the digits dataset. Results using a linear SVM in the original space, a linear
SVM using the approximate mappings and using a kernelized SVM are compared.
Timings and accuracy for varying amounts of Monte Carlo samplings (in the case
of :class:`RBFSampler`, which uses random Fourier features) and different sized
subsets of the training set (for :class:`Nystroem`) for the approximate mapping
are shown.

Please note that the dataset here is not large enough to show the benefits
of kernel approximation, as the exact SVM is still reasonably fast.

Sampling more dimensions clearly leads to better classification results, but
comes at a greater cost. This means there is a tradeoff between runtime and
accuracy, given by the parameter n_components. Note that solving the Linear
SVM and also the approximate kernel SVM could be greatly accelerated by using
stochastic gradient descent via :class:`~sklearn.linear_model.SGDClassifier`.
This is not easily possible for the case of the kernelized SVM.

"""</span>

<span class="comment"># %%</span>
<span class="comment"># Python package and dataset imports, load dataset</span>
<span class="comment"># ---------------------------------------------------</span>


<span class="comment"># Author: Gael Varoquaux &lt;gael dot varoquaux at normalesup dot org&gt;</span>
<span class="comment">#         Andreas Mueller &lt;amueller@ais.uni-bonn.de&gt;</span>
<span class="comment"># License: BSD 3 clause</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">__doc__</span><span class="grouping">)</span>

<span class="comment"># Standard scientific Python imports</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">from</span> <span class="identifier">time</span> <span class="keyword">import</span> <span class="identifier">time</span>

<span class="comment"># Import datasets, classifiers and performance metrics</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span> <span class="keyword">import</span> <span class="identifier">datasets</span><span class="punctuation">,</span> <span class="identifier">svm</span><span class="punctuation">,</span> <span class="identifier">pipeline</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">kernel_approximation</span> <span class="keyword">import</span> <span class="grouping">(</span><span class="identifier">RBFSampler</span><span class="punctuation">,</span>
                                          <span class="identifier">Nystroem</span><span class="grouping">)</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">decomposition</span> <span class="keyword">import</span> <span class="identifier">PCA</span>

<span class="comment"># The digits dataset</span>
<span class="identifier">digits</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">load_digits</span><span class="grouping">(</span><span class="identifier">n_class</span><span class="arithmetic-assignment">=</span><span class="int-literal">9</span><span class="grouping">)</span>


<span class="comment"># %%</span>
<span class="comment"># Timing and accuracy plots</span>
<span class="comment"># --------------------------------------------------</span>
<span class="comment"># To apply an classifier on this data, we need to flatten the image, to</span>
<span class="comment"># turn the data in a (samples, feature) matrix:</span>
<span class="identifier">n_samples</span> <span class="arithmetic-assignment">=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">digits</span><span class="punctuation">.</span><span class="identifier">data</span><span class="grouping">)</span>
<span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">digits</span><span class="punctuation">.</span><span class="identifier">data</span> <span class="arithmetic-operator">/</span> <span class="int-literal">16</span><span class="punctuation">.</span>
<span class="identifier">data</span> <span class="arithmetic-assignment">-=</span> <span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">mean</span><span class="grouping">(</span><span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

<span class="comment"># We learn the digits on the first half of the digits</span>
<span class="identifier">data_train</span><span class="punctuation">,</span> <span class="identifier">targets_train</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">data</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">n_samples</span> <span class="arithmetic-operator">//</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span>
                             <span class="identifier">digits</span><span class="punctuation">.</span><span class="identifier">target</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">n_samples</span> <span class="arithmetic-operator">//</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">)</span>


<span class="comment"># Now predict the value of the digit on the second half:</span>
<span class="identifier">data_test</span><span class="punctuation">,</span> <span class="identifier">targets_test</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">data</span><span class="grouping">[</span><span class="identifier">n_samples</span> <span class="arithmetic-operator">//</span> <span class="int-literal">2</span><span class="punctuation">:</span><span class="grouping">]</span><span class="punctuation">,</span>
                           <span class="identifier">digits</span><span class="punctuation">.</span><span class="identifier">target</span><span class="grouping">[</span><span class="identifier">n_samples</span> <span class="arithmetic-operator">//</span> <span class="int-literal">2</span><span class="punctuation">:</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="comment"># data_test = scaler.transform(data_test)</span>

<span class="comment"># Create a classifier: a support vector classifier</span>
<span class="identifier">kernel_svm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">svm</span><span class="punctuation">.</span><span class="identifier">SVC</span><span class="grouping">(</span><span class="identifier">gamma</span><span class="arithmetic-assignment">=</span><span class="float-literal">.2</span><span class="grouping">)</span>
<span class="identifier">linear_svm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">svm</span><span class="punctuation">.</span><span class="identifier">LinearSVC</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="comment"># create pipeline from kernel approximation</span>
<span class="comment"># and linear svm</span>
<span class="identifier">feature_map_fourier</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RBFSampler</span><span class="grouping">(</span><span class="identifier">gamma</span><span class="arithmetic-assignment">=</span><span class="float-literal">.2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
<span class="identifier">feature_map_nystroem</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Nystroem</span><span class="grouping">(</span><span class="identifier">gamma</span><span class="arithmetic-assignment">=</span><span class="float-literal">.2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
<span class="identifier">fourier_approx_svm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pipeline</span><span class="punctuation">.</span><span class="identifier">Pipeline</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">(</span><span class="string-literal">"feature_map"</span><span class="punctuation">,</span> <span class="identifier">feature_map_fourier</span><span class="grouping">)</span><span class="punctuation">,</span>
                                        <span class="grouping">(</span><span class="string-literal">"svm"</span><span class="punctuation">,</span> <span class="identifier">svm</span><span class="punctuation">.</span><span class="identifier">LinearSVC</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>

<span class="identifier">nystroem_approx_svm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pipeline</span><span class="punctuation">.</span><span class="identifier">Pipeline</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">(</span><span class="string-literal">"feature_map"</span><span class="punctuation">,</span> <span class="identifier">feature_map_nystroem</span><span class="grouping">)</span><span class="punctuation">,</span>
                                        <span class="grouping">(</span><span class="string-literal">"svm"</span><span class="punctuation">,</span> <span class="identifier">svm</span><span class="punctuation">.</span><span class="identifier">LinearSVC</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>

<span class="comment"># fit and predict using linear and kernel svm:</span>

<span class="identifier">kernel_svm_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">kernel_svm</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="punctuation">,</span> <span class="identifier">targets_train</span><span class="grouping">)</span>
<span class="identifier">kernel_svm_score</span> <span class="arithmetic-assignment">=</span> <span class="identifier">kernel_svm</span><span class="punctuation">.</span><span class="identifier">score</span><span class="grouping">(</span><span class="identifier">data_test</span><span class="punctuation">,</span> <span class="identifier">targets_test</span><span class="grouping">)</span>
<span class="identifier">kernel_svm_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">kernel_svm_time</span>

<span class="identifier">linear_svm_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">linear_svm</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="punctuation">,</span> <span class="identifier">targets_train</span><span class="grouping">)</span>
<span class="identifier">linear_svm_score</span> <span class="arithmetic-assignment">=</span> <span class="identifier">linear_svm</span><span class="punctuation">.</span><span class="identifier">score</span><span class="grouping">(</span><span class="identifier">data_test</span><span class="punctuation">,</span> <span class="identifier">targets_test</span><span class="grouping">)</span>
<span class="identifier">linear_svm_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">linear_svm_time</span>

<span class="identifier">sample_sizes</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">30</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">)</span>
<span class="identifier">fourier_scores</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
<span class="identifier">nystroem_scores</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
<span class="identifier">fourier_times</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
<span class="identifier">nystroem_times</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>

<span class="keyword">for</span> <span class="identifier">D</span> <span class="relational-operator">in</span> <span class="identifier">sample_sizes</span><span class="punctuation">:</span>
    <span class="identifier">fourier_approx_svm</span><span class="punctuation">.</span><span class="identifier">set_params</span><span class="grouping">(</span><span class="identifier">feature_map__n_components</span><span class="arithmetic-assignment">=</span><span class="identifier">D</span><span class="grouping">)</span>
    <span class="identifier">nystroem_approx_svm</span><span class="punctuation">.</span><span class="identifier">set_params</span><span class="grouping">(</span><span class="identifier">feature_map__n_components</span><span class="arithmetic-assignment">=</span><span class="identifier">D</span><span class="grouping">)</span>
    <span class="identifier">start</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">nystroem_approx_svm</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="punctuation">,</span> <span class="identifier">targets_train</span><span class="grouping">)</span>
    <span class="identifier">nystroem_times</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">start</span><span class="grouping">)</span>

    <span class="identifier">start</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">fourier_approx_svm</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="punctuation">,</span> <span class="identifier">targets_train</span><span class="grouping">)</span>
    <span class="identifier">fourier_times</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">start</span><span class="grouping">)</span>

    <span class="identifier">fourier_score</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fourier_approx_svm</span><span class="punctuation">.</span><span class="identifier">score</span><span class="grouping">(</span><span class="identifier">data_test</span><span class="punctuation">,</span> <span class="identifier">targets_test</span><span class="grouping">)</span>
    <span class="identifier">nystroem_score</span> <span class="arithmetic-assignment">=</span> <span class="identifier">nystroem_approx_svm</span><span class="punctuation">.</span><span class="identifier">score</span><span class="grouping">(</span><span class="identifier">data_test</span><span class="punctuation">,</span> <span class="identifier">targets_test</span><span class="grouping">)</span>
    <span class="identifier">nystroem_scores</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">nystroem_score</span><span class="grouping">)</span>
    <span class="identifier">fourier_scores</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">fourier_score</span><span class="grouping">)</span>

<span class="comment"># plot the results:</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="identifier">figsize</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">16</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">accuracy</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplot</span><span class="grouping">(</span><span class="int-literal">121</span><span class="grouping">)</span>
<span class="comment"># second y axis for timings</span>
<span class="identifier">timescale</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplot</span><span class="grouping">(</span><span class="int-literal">122</span><span class="grouping">)</span>

<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">sample_sizes</span><span class="punctuation">,</span> <span class="identifier">nystroem_scores</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Nystroem approx. kernel"</span><span class="grouping">)</span>
<span class="identifier">timescale</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">sample_sizes</span><span class="punctuation">,</span> <span class="identifier">nystroem_times</span><span class="punctuation">,</span> <span class="string-literal">'--'</span><span class="punctuation">,</span>
               <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Nystroem approx. kernel'</span><span class="grouping">)</span>

<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">sample_sizes</span><span class="punctuation">,</span> <span class="identifier">fourier_scores</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Fourier approx. kernel"</span><span class="grouping">)</span>
<span class="identifier">timescale</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">sample_sizes</span><span class="punctuation">,</span> <span class="identifier">fourier_times</span><span class="punctuation">,</span> <span class="string-literal">'--'</span><span class="punctuation">,</span>
               <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Fourier approx. kernel'</span><span class="grouping">)</span>

<span class="comment"># horizontal lines for exact rbf and linear kernels:</span>
<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
              <span class="grouping">[</span><span class="identifier">linear_svm_score</span><span class="punctuation">,</span> <span class="identifier">linear_svm_score</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"linear svm"</span><span class="grouping">)</span>
<span class="identifier">timescale</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
               <span class="grouping">[</span><span class="identifier">linear_svm_time</span><span class="punctuation">,</span> <span class="identifier">linear_svm_time</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="string-literal">'--', label='linear svm'</span><span class="grouping">)</span>

<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
              <span class="grouping">[</span><span class="identifier">kernel_svm_score</span><span class="punctuation">,</span> <span class="identifier">kernel_svm_score</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"rbf svm"</span><span class="grouping">)</span>
<span class="identifier">timescale</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
               <span class="grouping">[</span><span class="identifier">kernel_svm_time</span><span class="punctuation">,</span> <span class="identifier">kernel_svm_time</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="string-literal">'--', label='rbf svm'</span><span class="grouping">)</span>

<span class="comment"># vertical line for dataset dimensionality = 64</span>
<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="grouping">[</span><span class="int-literal">64</span><span class="punctuation">,</span> <span class="int-literal">64</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="float-literal">0.7</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"n_features"</span><span class="grouping">)</span>

<span class="comment"># legends and labels</span>
<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">set_title</span><span class="grouping">(</span><span class="string-literal">"Classification accuracy"</span><span class="grouping">)</span>
<span class="identifier">timescale</span><span class="punctuation">.</span><span class="identifier">set_title</span><span class="grouping">(</span><span class="string-literal">"Training times"</span><span class="grouping">)</span>
<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">set_xlim</span><span class="grouping">(</span><span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">sample_sizes</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">set_xticks</span><span class="grouping">(</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">set_ylim</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="identifier">fourier_scores</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>
<span class="identifier">timescale</span><span class="punctuation">.</span><span class="identifier">set_xlabel</span><span class="grouping">(</span><span class="string-literal">"Sampling steps = transformed feature dimension"</span><span class="grouping">)</span>
<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="string-literal">"Classification accuracy"</span><span class="grouping">)</span>
<span class="identifier">timescale</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="string-literal">"Training time in seconds"</span><span class="grouping">)</span>
<span class="identifier">accuracy</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="identifier">loc</span><span class="arithmetic-assignment">=</span><span class="string-literal">'best'</span><span class="grouping">)</span>
<span class="identifier">timescale</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="identifier">loc</span><span class="arithmetic-assignment">=</span><span class="string-literal">'best'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">tight_layout</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="comment"># %%</span>
<span class="comment"># Decision Surfaces of RBF Kernel SVM and Linear SVM</span>
<span class="comment"># --------------------------------------------------------</span>
<span class="comment"># The second plot visualized the decision surfaces of the RBF kernel SVM and</span>
<span class="comment"># the linear SVM with approximate kernel maps.</span>
<span class="comment"># The plot shows decision surfaces of the classifiers projected onto</span>
<span class="comment"># the first two principal components of the data. This visualization should</span>
<span class="comment"># be taken with a grain of salt since it is just an interesting slice through</span>
<span class="comment"># the decision surface in 64 dimensions. In particular note that</span>
<span class="comment"># a datapoint (represented as a dot) does not necessarily be classified</span>
<span class="comment"># into the region it is lying in, since it will not lie on the plane</span>
<span class="comment"># that the first two principal components span.</span>
<span class="comment"># The usage of :class:`RBFSampler` and :class:`Nystroem` is described in detail</span>
<span class="comment"># in :ref:`kernel_approximation`.</span>

<span class="comment"># visualize the decision surface, projected down to the first</span>
<span class="comment"># two principal components of the dataset</span>
<span class="identifier">pca</span> <span class="arithmetic-assignment">=</span> <span class="identifier">PCA</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">8</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="grouping">)</span>

<span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pca</span><span class="punctuation">.</span><span class="identifier">transform</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="grouping">)</span>

<span class="comment"># Generate grid along first two principal components</span>
<span class="identifier">multiples</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="float-literal">0.1</span><span class="grouping">)</span>
<span class="comment"># steps along first component</span>
<span class="identifier">first</span> <span class="arithmetic-assignment">=</span> <span class="identifier">multiples</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">newaxis</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="identifier">pca</span><span class="punctuation">.</span><span class="identifier">components_</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span>
<span class="comment"># steps along second component</span>
<span class="identifier">second</span> <span class="arithmetic-assignment">=</span> <span class="identifier">multiples</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">newaxis</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="identifier">pca</span><span class="punctuation">.</span><span class="identifier">components_</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span>
<span class="comment"># combine</span>
<span class="identifier">grid</span> <span class="arithmetic-assignment">=</span> <span class="identifier">first</span><span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">newaxis</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="identifier">second</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">newaxis</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span>
<span class="identifier">flat_grid</span> <span class="arithmetic-assignment">=</span> <span class="identifier">grid</span><span class="punctuation">.</span><span class="identifier">reshape</span><span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>

<span class="comment"># title for the plots</span>
<span class="identifier">titles</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'SVC with rbf kernel'</span><span class="punctuation">,</span>
          <span class="string-literal">'SVC (linear kernel)\n with Fourier rbf feature map\n'</span>
          <span class="string-literal">'n_components=100'</span><span class="punctuation">,</span>
          <span class="string-literal">'SVC (linear kernel)\n with Nystroem rbf feature map\n'</span>
          <span class="string-literal">'n_components=100'</span><span class="grouping">]</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="identifier">figsize</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">18</span><span class="punctuation">,</span> <span class="float-literal">7.5</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">rcParams</span><span class="punctuation">.</span><span class="identifier">update</span><span class="grouping">(</span><span class="grouping">{</span><span class="string-literal">'font.size'</span><span class="punctuation">:</span> <span class="int-literal">14</span><span class="grouping">}</span><span class="grouping">)</span>
<span class="comment"># predict and plot</span>
<span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">clf</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">kernel_svm</span><span class="punctuation">,</span> <span class="identifier">nystroem_approx_svm</span><span class="punctuation">,</span>
                         <span class="identifier">fourier_approx_svm</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Plot the decision boundary. For that, we will assign a color to each</span>
    <span class="comment"># point in the mesh [x_min, x_max]x[y_min, y_max].</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplot</span><span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">i</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span>
    <span class="identifier">Z</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">flat_grid</span><span class="grouping">)</span>

    <span class="comment"># Put the result into a color plot</span>
    <span class="identifier">Z</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Z</span><span class="punctuation">.</span><span class="identifier">reshape</span><span class="grouping">(</span><span class="identifier">grid</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">contourf</span><span class="grouping">(</span><span class="identifier">multiples</span><span class="punctuation">,</span> <span class="identifier">multiples</span><span class="punctuation">,</span> <span class="identifier">Z</span><span class="punctuation">,</span> <span class="identifier">cmap</span><span class="arithmetic-assignment">=</span><span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">cm</span><span class="punctuation">.</span><span class="identifier">Paired</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axis</span><span class="grouping">(</span><span class="string-literal">'off'</span><span class="grouping">)</span>

    <span class="comment"># Plot also the training points</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">scatter</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="arithmetic-assignment">=</span><span class="identifier">targets_train</span><span class="punctuation">,</span> <span class="identifier">cmap</span><span class="arithmetic-assignment">=</span><span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">cm</span><span class="punctuation">.</span><span class="identifier">Paired</span><span class="punctuation">,</span>
                <span class="identifier">edgecolors</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="identifier">titles</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">tight_layout</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>