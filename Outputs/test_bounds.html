<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">from</span> <span class="identifier">scipy</span> <span class="keyword">import</span> <span class="identifier">sparse</span> <span class="keyword">as</span> <span class="identifier">sp</span>
<span class="keyword">from</span> <span class="identifier">scipy</span> <span class="keyword">import</span> <span class="identifier">stats</span>

<span class="keyword">import</span> <span class="identifier">pytest</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">svm</span><span class="punctuation">.</span><span class="identifier">_bounds</span> <span class="keyword">import</span> <span class="identifier">l1_min_c</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">svm</span> <span class="keyword">import</span> <span class="identifier">LinearSVC</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">LogisticRegression</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">svm</span><span class="punctuation">.</span><span class="identifier">_newrand</span> <span class="keyword">import</span> <span class="identifier">set_seed_wrap</span><span class="punctuation">,</span> <span class="identifier">bounded_rand_int_wrap</span>


<span class="identifier">dense_X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>
<span class="identifier">sparse_X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">csr_matrix</span><span class="grouping">(</span><span class="identifier">dense_X</span><span class="grouping">)</span>

<span class="identifier">Y1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>
<span class="identifier">Y2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'loss', ['squared_hinge', 'log'</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'X_label', ['sparse', 'dense'</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'Y_label', ['two-classes', 'multi-class'</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'intercept_label', ['no-intercept', 'fit-intercept'</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_l1_min_c</span><span class="grouping">(</span><span class="identifier">loss</span><span class="punctuation">,</span> <span class="identifier">X_label</span><span class="punctuation">,</span> <span class="identifier">Y_label</span><span class="punctuation">,</span> <span class="identifier">intercept_label</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">Xs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'sparse': sparse_X, 'dense'</span><span class="punctuation">:</span> <span class="identifier">dense_X</span><span class="grouping">}</span>
    <span class="identifier">Ys</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'two-classes': Y1, 'multi-class'</span><span class="punctuation">:</span> <span class="identifier">Y2</span><span class="grouping">}</span>
    <span class="identifier">intercepts</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'no-intercept': {'fit_intercept'</span><span class="punctuation">:</span> <span class="bool-literal">False</span><span class="grouping">}</span><span class="punctuation">,</span>
                  <span class="string-literal">'fit-intercept': {'fit_intercept'</span><span class="punctuation">:</span> <span class="bool-literal">True</span><span class="punctuation">,</span>
                                    <span class="string-literal">'intercept_scaling'</span><span class="punctuation">:</span> <span class="int-literal">10</span><span class="grouping">}</span><span class="grouping">}</span>

    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Xs</span><span class="grouping">[</span><span class="identifier">X_label</span><span class="grouping">]</span>
    <span class="identifier">Y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Ys</span><span class="grouping">[</span><span class="identifier">Y_label</span><span class="grouping">]</span>
    <span class="identifier">intercept_params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">intercepts</span><span class="grouping">[</span><span class="identifier">intercept_label</span><span class="grouping">]</span>
    <span class="identifier">check_l1_min_c</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">Y</span><span class="punctuation">,</span> <span class="identifier">loss</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">intercept_params</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_l1_min_c_l2_loss</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># loss='l2' should raise ValueError</span>
    <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'loss type not in'</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">l1_min_c</span><span class="grouping">(</span><span class="identifier">dense_X</span><span class="punctuation">,</span> <span class="identifier">Y1</span><span class="punctuation">,</span> <span class="identifier">loss</span><span class="arithmetic-assignment">=</span><span class="string-literal">"l2"</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">check_l1_min_c</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">loss</span><span class="punctuation">,</span> <span class="identifier">fit_intercept</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">intercept_scaling</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">min_c</span> <span class="arithmetic-assignment">=</span> <span class="identifier">l1_min_c</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">loss</span><span class="arithmetic-assignment">=</span><span class="identifier">loss</span><span class="punctuation">,</span> <span class="identifier">fit_intercept</span><span class="arithmetic-assignment">=</span><span class="identifier">fit_intercept</span><span class="punctuation">,</span>
                     <span class="identifier">intercept_scaling</span><span class="arithmetic-assignment">=</span><span class="identifier">intercept_scaling</span><span class="grouping">)</span>

    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span>
        <span class="string-literal">'log': LogisticRegression(penalty='l1', solver='liblinear'</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="string-literal">'squared_hinge': LinearSVC(loss='squared_hinge'</span><span class="punctuation">,</span>
                                   <span class="identifier">penalty</span><span class="arithmetic-assignment">=</span><span class="string-literal">'l1'</span><span class="punctuation">,</span> <span class="identifier">dual</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">}</span><span class="grouping">[</span><span class="identifier">loss</span><span class="grouping">]</span>

    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit_intercept</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fit_intercept</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">intercept_scaling</span> <span class="arithmetic-assignment">=</span> <span class="identifier">intercept_scaling</span>

    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">C</span> <span class="arithmetic-assignment">=</span> <span class="identifier">min_c</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">coef_</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">intercept_</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">C</span> <span class="arithmetic-assignment">=</span> <span class="identifier">min_c</span> <span class="arithmetic-operator">*</span> <span class="float-literal">1.01</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">coef_</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">any</span><span class="grouping">(</span><span class="grouping">)</span> <span class="logical-operator">or</span>
            <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">intercept_</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">any</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_ill_posed_min_c</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">l1_min_c</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_unsupported_loss</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">l1_min_c</span><span class="grouping">(</span><span class="identifier">dense_X</span><span class="punctuation">,</span> <span class="identifier">Y1</span><span class="punctuation">,</span> <span class="identifier">loss</span><span class="arithmetic-assignment">=</span><span class="string-literal">'l1'</span><span class="grouping">)</span>


<span class="identifier">_MAX_UNSIGNED_INT</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">4294967295</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'seed, val'</span><span class="punctuation">,</span>
                         <span class="grouping">[</span><span class="grouping">(</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="int-literal">81</span><span class="grouping">)</span><span class="punctuation">,</span>
                          <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">54</span><span class="grouping">)</span><span class="punctuation">,</span>
                          <span class="grouping">(</span><span class="identifier">_MAX_UNSIGNED_INT</span><span class="punctuation">,</span> <span class="int-literal">9</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_newrand_set_seed</span><span class="grouping">(</span><span class="identifier">seed</span><span class="punctuation">,</span> <span class="identifier">val</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Test that `set_seed` produces deterministic results"""</span>
    <span class="keyword">if</span> <span class="identifier">seed</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">set_seed_wrap</span><span class="grouping">(</span><span class="identifier">seed</span><span class="grouping">)</span>
    <span class="identifier">x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">bounded_rand_int_wrap</span><span class="grouping">(</span><span class="int-literal">100</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">x</span> <span class="relational-operator">==</span> <span class="identifier">val</span><span class="punctuation">,</span> <span class="identifier">f</span><span class="string-literal">'Expected {val} but got {x} instead'</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'seed'</span><span class="punctuation">,</span>
                         <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">_MAX_UNSIGNED_INT</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_newrand_set_seed_overflow</span><span class="grouping">(</span><span class="identifier">seed</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Test that `set_seed_wrap` is defined for unsigned 32bits ints"""</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">OverflowError</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">set_seed_wrap</span><span class="grouping">(</span><span class="identifier">seed</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'range_, n_pts'</span><span class="punctuation">,</span>
                         <span class="grouping">[</span><span class="grouping">(</span><span class="identifier">_MAX_UNSIGNED_INT</span><span class="punctuation">,</span> <span class="int-literal">10000</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">25</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_newrand_bounded_rand_int</span><span class="grouping">(</span><span class="identifier">range_</span><span class="punctuation">,</span> <span class="identifier">n_pts</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Test that `bounded_rand_int` follows a uniform distribution"""</span>
    <span class="identifier">n_iter</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">100</span>
    <span class="identifier">ks_pvals</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="identifier">uniform_dist</span> <span class="arithmetic-assignment">=</span> <span class="identifier">stats</span><span class="punctuation">.</span><span class="identifier">uniform</span><span class="grouping">(</span><span class="identifier">loc</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">scale</span><span class="arithmetic-assignment">=</span><span class="identifier">range_</span><span class="grouping">)</span>
    <span class="comment"># perform multiple samplings to make chance of outlier sampling negligible</span>
    <span class="keyword">for</span> <span class="identifier">_</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">n_iter</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># Deterministic random sampling</span>
        <span class="identifier">sample</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">bounded_rand_int_wrap</span><span class="grouping">(</span><span class="identifier">range_</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">_</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">n_pts</span><span class="grouping">)</span><span class="grouping">]</span>
        <span class="identifier">res</span> <span class="arithmetic-assignment">=</span> <span class="identifier">stats</span><span class="punctuation">.</span><span class="identifier">kstest</span><span class="grouping">(</span><span class="identifier">sample</span><span class="punctuation">,</span> <span class="identifier">uniform_dist</span><span class="punctuation">.</span><span class="identifier">cdf</span><span class="grouping">)</span>
        <span class="identifier">ks_pvals</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">pvalue</span><span class="grouping">)</span>
    <span class="comment"># Null hypothesis = samples come from an uniform distribution.</span>
    <span class="comment"># Under the null hypothesis, p-values should be uniformly distributed</span>
    <span class="comment"># and not concentrated on low values</span>
    <span class="comment"># (this may seem counter-intuitive but is backed by multiple refs)</span>
    <span class="comment"># So we can do two checks:</span>

    <span class="comment"># (1) check uniformity of p-values</span>
    <span class="identifier">uniform_p_vals_dist</span> <span class="arithmetic-assignment">=</span> <span class="identifier">stats</span><span class="punctuation">.</span><span class="identifier">uniform</span><span class="grouping">(</span><span class="identifier">loc</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">scale</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
    <span class="identifier">res_pvals</span> <span class="arithmetic-assignment">=</span> <span class="identifier">stats</span><span class="punctuation">.</span><span class="identifier">kstest</span><span class="grouping">(</span><span class="identifier">ks_pvals</span><span class="punctuation">,</span> <span class="identifier">uniform_p_vals_dist</span><span class="punctuation">.</span><span class="identifier">cdf</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">res_pvals</span><span class="punctuation">.</span><span class="identifier">pvalue</span> <span class="relational-operator">&gt;</span> <span class="float-literal">0.05</span><span class="punctuation">,</span> <span class="grouping">(</span>
        <span class="string-literal">"Null hypothesis rejected: generated random numbers are not uniform."</span>
        <span class="string-literal">" Details: the (meta) p-value of the test of uniform distribution"</span>
        <span class="identifier">f</span><span class="string-literal">" of p-values is {res_pvals.pvalue} which is not &gt; 0.05"</span><span class="grouping">)</span>

    <span class="comment"># (2) (safety belt) check that 90% of p-values are above 0.05</span>
    <span class="identifier">min_10pct_pval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">percentile</span><span class="grouping">(</span><span class="identifier">ks_pvals</span><span class="punctuation">,</span> <span class="identifier">q</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="grouping">)</span>
    <span class="comment"># lower 10th quantile pvalue &lt;= 0.05 means that the test rejects the</span>
    <span class="comment"># null hypothesis that the sample came from the uniform distribution</span>
    <span class="keyword">assert</span> <span class="identifier">min_10pct_pval</span> <span class="relational-operator">&gt;</span> <span class="float-literal">0.05</span><span class="punctuation">,</span> <span class="grouping">(</span>
        <span class="string-literal">"Null hypothesis rejected: generated random numbers are not uniform. "</span>
        <span class="identifier">f</span><span class="string-literal">"Details: lower 10th quantile p-value of {min_10pct_pval} not &gt; 0.05."</span>
        <span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'range_'</span><span class="punctuation">,</span>
                         <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">_MAX_UNSIGNED_INT</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_newrand_bounded_rand_int_limits</span><span class="grouping">(</span><span class="identifier">range_</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Test that `bounded_rand_int_wrap` is defined for unsigned 32bits ints"""</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">OverflowError</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">bounded_rand_int_wrap</span><span class="grouping">(</span><span class="identifier">range_</span><span class="grouping">)</span>

    </pre>
  </body>
</html>