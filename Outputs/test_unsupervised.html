<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">sparse</span> <span class="keyword">as</span> <span class="identifier">sp</span>
<span class="keyword">import</span> <span class="identifier">pytest</span>
<span class="keyword">from</span> <span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">sparse</span> <span class="keyword">import</span> <span class="identifier">csr_matrix</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span> <span class="keyword">import</span> <span class="identifier">datasets</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span><span class="punctuation">.</span><span class="identifier">cluster</span> <span class="keyword">import</span> <span class="identifier">silhouette_score</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span><span class="punctuation">.</span><span class="identifier">cluster</span> <span class="keyword">import</span> <span class="identifier">silhouette_samples</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="identifier">pairwise_distances</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span><span class="punctuation">.</span><span class="identifier">cluster</span> <span class="keyword">import</span> <span class="identifier">calinski_harabasz_score</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span><span class="punctuation">.</span><span class="identifier">cluster</span> <span class="keyword">import</span> <span class="identifier">davies_bouldin_score</span>


<span class="keyword">def</span> <span class="identifier">test_silhouette</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Tests the Silhouette Coefficient.</span>
    <span class="identifier">dataset</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">load_iris</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">X_dense</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">data</span>
    <span class="identifier">X_csr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">csr_matrix</span><span class="grouping">(</span><span class="identifier">X_dense</span><span class="grouping">)</span>
    <span class="identifier">X_dok</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">dok_matrix</span><span class="grouping">(</span><span class="identifier">X_dense</span><span class="grouping">)</span>
    <span class="identifier">X_lil</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">lil_matrix</span><span class="grouping">(</span><span class="identifier">X_dense</span><span class="grouping">)</span>
    <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">target</span>

    <span class="keyword">for</span> <span class="identifier">X</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="identifier">X_dense</span><span class="punctuation">,</span> <span class="identifier">X_csr</span><span class="punctuation">,</span> <span class="identifier">X_dok</span><span class="punctuation">,</span> <span class="identifier">X_lil</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">D</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pairwise_distances</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'euclidean'</span><span class="grouping">)</span>
        <span class="comment"># Given that the actual labels are used, we can assume that S would be</span>
        <span class="comment"># positive.</span>
        <span class="identifier">score_precomputed</span> <span class="arithmetic-assignment">=</span> <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">D</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'precomputed'</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="identifier">score_precomputed</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span>
        <span class="comment"># Test without calculating D</span>
        <span class="identifier">score_euclidean</span> <span class="arithmetic-assignment">=</span> <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'euclidean'</span><span class="grouping">)</span>
        <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="identifier">score_precomputed</span><span class="punctuation">,</span> <span class="identifier">score_euclidean</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">X</span> <span class="relational-operator">is</span> <span class="identifier">X_dense</span><span class="punctuation">:</span>
            <span class="identifier">score_dense_without_sampling</span> <span class="arithmetic-assignment">=</span> <span class="identifier">score_precomputed</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="identifier">score_euclidean</span><span class="punctuation">,</span>
                          <span class="identifier">score_dense_without_sampling</span><span class="grouping">)</span>

        <span class="comment"># Test with sampling</span>
        <span class="identifier">score_precomputed</span> <span class="arithmetic-assignment">=</span> <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">D</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'precomputed'</span><span class="punctuation">,</span>
                                             <span class="identifier">sample_size</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span>
                                             <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
        <span class="identifier">score_euclidean</span> <span class="arithmetic-assignment">=</span> <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'euclidean'</span><span class="punctuation">,</span>
                                           <span class="identifier">sample_size</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span>
                                           <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="identifier">score_precomputed</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span>
        <span class="keyword">assert</span> <span class="identifier">score_euclidean</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span>
        <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="identifier">score_euclidean</span><span class="punctuation">,</span> <span class="identifier">score_precomputed</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">X</span> <span class="relational-operator">is</span> <span class="identifier">X_dense</span><span class="punctuation">:</span>
            <span class="identifier">score_dense_with_sampling</span> <span class="arithmetic-assignment">=</span> <span class="identifier">score_precomputed</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="identifier">score_euclidean</span><span class="punctuation">,</span> <span class="identifier">score_dense_with_sampling</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_cluster_size_1</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Assert Silhouette Coefficient == 0 when there is 1 sample in a cluster</span>
    <span class="comment"># (cluster 0). We also test the case where there are identical samples</span>
    <span class="comment"># as the only members of a cluster (cluster 2). To our knowledge, this case</span>
    <span class="comment"># is not discussed in reference material, and we choose for it a sample</span>
    <span class="comment"># score of 1.</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">.</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">.</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">.</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="punctuation">.</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">.</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">.</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="comment"># Cluster 0: 1 sample -&gt; score of 0 by Rousseeuw's convention</span>
    <span class="comment"># Cluster 1: intra-cluster = [.5, .5, 1]</span>
    <span class="comment">#            inter-cluster = [1, 1, 1]</span>
    <span class="comment">#            silhouette    = [.5, .5, 0]</span>
    <span class="comment"># Cluster 2: intra-cluster = [0, 0]</span>
    <span class="comment">#            inter-cluster = [arbitrary, arbitrary]</span>
    <span class="comment">#            silhouette    = [1., 1.]</span>

    <span class="identifier">silhouette</span> <span class="arithmetic-assignment">=</span> <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">isnan</span><span class="grouping">(</span><span class="identifier">silhouette</span><span class="grouping">)</span>
    <span class="identifier">ss</span> <span class="arithmetic-assignment">=</span> <span class="identifier">silhouette_samples</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">ss</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="float-literal">.5</span><span class="punctuation">,</span> <span class="float-literal">.5</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_silhouette_paper_example</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Explicitly check per-sample results against Rousseeuw (1987)</span>
    <span class="comment"># Data from Table 1</span>
    <span class="identifier">lower</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="float-literal">5.58</span><span class="punctuation">,</span>
             <span class="float-literal">7.00</span><span class="punctuation">,</span> <span class="float-literal">6.50</span><span class="punctuation">,</span>
             <span class="float-literal">7.08</span><span class="punctuation">,</span> <span class="float-literal">7.00</span><span class="punctuation">,</span> <span class="float-literal">3.83</span><span class="punctuation">,</span>
             <span class="float-literal">4.83</span><span class="punctuation">,</span> <span class="float-literal">5.08</span><span class="punctuation">,</span> <span class="float-literal">8.17</span><span class="punctuation">,</span> <span class="float-literal">5.83</span><span class="punctuation">,</span>
             <span class="float-literal">2.17</span><span class="punctuation">,</span> <span class="float-literal">5.75</span><span class="punctuation">,</span> <span class="float-literal">6.67</span><span class="punctuation">,</span> <span class="float-literal">6.92</span><span class="punctuation">,</span> <span class="float-literal">4.92</span><span class="punctuation">,</span>
             <span class="float-literal">6.42</span><span class="punctuation">,</span> <span class="float-literal">5.00</span><span class="punctuation">,</span> <span class="float-literal">5.58</span><span class="punctuation">,</span> <span class="float-literal">6.00</span><span class="punctuation">,</span> <span class="float-literal">4.67</span><span class="punctuation">,</span> <span class="float-literal">6.42</span><span class="punctuation">,</span>
             <span class="float-literal">3.42</span><span class="punctuation">,</span> <span class="float-literal">5.50</span><span class="punctuation">,</span> <span class="float-literal">6.42</span><span class="punctuation">,</span> <span class="float-literal">6.42</span><span class="punctuation">,</span> <span class="float-literal">5.00</span><span class="punctuation">,</span> <span class="float-literal">3.92</span><span class="punctuation">,</span> <span class="float-literal">6.17</span><span class="punctuation">,</span>
             <span class="float-literal">2.50</span><span class="punctuation">,</span> <span class="float-literal">4.92</span><span class="punctuation">,</span> <span class="float-literal">6.25</span><span class="punctuation">,</span> <span class="float-literal">7.33</span><span class="punctuation">,</span> <span class="float-literal">4.50</span><span class="punctuation">,</span> <span class="float-literal">2.25</span><span class="punctuation">,</span> <span class="float-literal">6.33</span><span class="punctuation">,</span> <span class="float-literal">2.75</span><span class="punctuation">,</span>
             <span class="float-literal">6.08</span><span class="punctuation">,</span> <span class="float-literal">6.67</span><span class="punctuation">,</span> <span class="float-literal">4.25</span><span class="punctuation">,</span> <span class="float-literal">2.67</span><span class="punctuation">,</span> <span class="float-literal">6.00</span><span class="punctuation">,</span> <span class="float-literal">6.17</span><span class="punctuation">,</span> <span class="float-literal">6.17</span><span class="punctuation">,</span> <span class="float-literal">6.92</span><span class="punctuation">,</span> <span class="float-literal">6.17</span><span class="punctuation">,</span>
             <span class="float-literal">5.25</span><span class="punctuation">,</span> <span class="float-literal">6.83</span><span class="punctuation">,</span> <span class="float-literal">4.50</span><span class="punctuation">,</span> <span class="float-literal">3.75</span><span class="punctuation">,</span> <span class="float-literal">5.75</span><span class="punctuation">,</span> <span class="float-literal">5.42</span><span class="punctuation">,</span> <span class="float-literal">6.08</span><span class="punctuation">,</span> <span class="float-literal">5.83</span><span class="punctuation">,</span> <span class="float-literal">6.67</span><span class="punctuation">,</span> <span class="float-literal">3.67</span><span class="punctuation">,</span>
             <span class="float-literal">4.75</span><span class="punctuation">,</span> <span class="float-literal">3.00</span><span class="punctuation">,</span> <span class="float-literal">6.08</span><span class="punctuation">,</span> <span class="float-literal">6.67</span><span class="punctuation">,</span> <span class="float-literal">5.00</span><span class="punctuation">,</span> <span class="float-literal">5.58</span><span class="punctuation">,</span> <span class="float-literal">4.83</span><span class="punctuation">,</span> <span class="float-literal">6.17</span><span class="punctuation">,</span> <span class="float-literal">5.67</span><span class="punctuation">,</span> <span class="float-literal">6.50</span><span class="punctuation">,</span> <span class="float-literal">6.92</span><span class="grouping">]</span>
    <span class="identifier">D</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">12</span><span class="punctuation">,</span> <span class="int-literal">12</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">D</span><span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">tril_indices</span><span class="grouping">(</span><span class="int-literal">12</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">lower</span>
    <span class="identifier">D</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">D</span><span class="punctuation">.</span><span class="identifier">T</span>

    <span class="identifier">names</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'BEL', 'BRA', 'CHI', 'CUB', 'EGY', 'FRA', 'IND', 'ISR', 'USA'</span><span class="punctuation">,</span>
             <span class="string-literal">'USS', 'YUG', 'ZAI'</span><span class="grouping">]</span>

    <span class="comment"># Data from Figure 2</span>
    <span class="identifier">labels1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>
    <span class="identifier">expected1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'USA': .43, 'BEL': .39, 'FRA': .35, 'ISR': .30, 'BRA'</span><span class="punctuation">:</span> <span class="float-literal">.22</span><span class="punctuation">,</span>
                 <span class="string-literal">'EGY': .20, 'ZAI': .19, 'CUB': .40, 'USS': .34, 'CHI'</span><span class="punctuation">:</span> <span class="float-literal">.33</span><span class="punctuation">,</span>
                 <span class="string-literal">'YUG': .26, 'IND'</span><span class="punctuation">:</span> <span class="float-literal">-.04</span><span class="grouping">}</span>
    <span class="identifier">score1</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">.28</span>

    <span class="comment"># Data from Figure 3</span>
    <span class="identifier">labels2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span>
    <span class="identifier">expected2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'USA': .47, 'FRA': .44, 'BEL': .42, 'ISR': .37, 'EGY'</span><span class="punctuation">:</span> <span class="float-literal">.02</span><span class="punctuation">,</span>
                 <span class="string-literal">'ZAI': .28, 'BRA': .25, 'IND': .17, 'CUB': .48, 'USS'</span><span class="punctuation">:</span> <span class="float-literal">.44</span><span class="punctuation">,</span>
                 <span class="string-literal">'YUG': .31, 'CHI'</span><span class="punctuation">:</span> <span class="float-literal">.31</span><span class="grouping">}</span>
    <span class="identifier">score2</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">.33</span>

    <span class="keyword">for</span> <span class="identifier">labels</span><span class="punctuation">,</span> <span class="identifier">expected</span><span class="punctuation">,</span> <span class="identifier">score</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="grouping">(</span><span class="identifier">labels1</span><span class="punctuation">,</span> <span class="identifier">expected1</span><span class="punctuation">,</span> <span class="identifier">score1</span><span class="grouping">)</span><span class="punctuation">,</span>
                                    <span class="grouping">(</span><span class="identifier">labels2</span><span class="punctuation">,</span> <span class="identifier">expected2</span><span class="punctuation">,</span> <span class="identifier">score2</span><span class="grouping">)</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">expected</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">expected</span><span class="grouping">[</span><span class="identifier">name</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">name</span> <span class="relational-operator">in</span> <span class="identifier">names</span><span class="grouping">]</span>
        <span class="comment"># we check to 2dp because that's what's in the paper</span>
        <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="identifier">expected</span><span class="punctuation">,</span>
                      <span class="identifier">silhouette_samples</span><span class="grouping">(</span><span class="identifier">D</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">labels</span><span class="grouping">)</span><span class="punctuation">,</span>
                                         <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'precomputed'</span><span class="grouping">)</span><span class="punctuation">,</span>
                      <span class="identifier">abs</span><span class="arithmetic-assignment">=</span><span class="float-literal">1e-2</span><span class="grouping">)</span>
        <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="identifier">score</span><span class="punctuation">,</span>
                      <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">D</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">labels</span><span class="grouping">)</span><span class="punctuation">,</span>
                                       <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'precomputed'</span><span class="grouping">)</span><span class="punctuation">,</span>
                      <span class="identifier">abs</span><span class="arithmetic-assignment">=</span><span class="float-literal">1e-2</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_correct_labelsize</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Assert 1 &lt; n_labels &lt; n_samples</span>
    <span class="identifier">dataset</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">load_iris</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">data</span>

    <span class="comment"># n_labels = n_samples</span>
    <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="identifier">err_msg</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">'Number of labels is %d\. Valid values are 2 '</span>
               <span class="identifier">r</span><span class="string-literal">'to n_samples - 1 \(inclusive\)'</span> <span class="arithmetic-operator">%</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">unique</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="comment"># n_labels = 1</span>
    <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="identifier">err_msg</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">'Number of labels is %d\. Valid values are 2 '</span>
               <span class="identifier">r</span><span class="string-literal">'to n_samples - 1 \(inclusive\)'</span> <span class="arithmetic-operator">%</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">unique</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_non_encoded_labels</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">dataset</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">load_iris</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">data</span>
    <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">target</span>
    <span class="keyword">assert</span> <span class="grouping">(</span>
        <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span> <span class="arithmetic-operator">*</span> <span class="int-literal">2</span> <span class="arithmetic-operator">+</span> <span class="int-literal">10</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span>
        <span class="identifier">silhouette_samples</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span> <span class="arithmetic-operator">*</span> <span class="int-literal">2</span> <span class="arithmetic-operator">+</span> <span class="int-literal">10</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">silhouette_samples</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_non_numpy_labels</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">dataset</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">load_iris</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">data</span>
    <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">target</span>
    <span class="keyword">assert</span> <span class="grouping">(</span>
        <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">list</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">silhouette_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'dtype'</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float32</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_silhouette_nonzero_diag</span><span class="grouping">(</span><span class="identifier">dtype</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Make sure silhouette_samples requires diagonal to be zero.</span>
    <span class="comment"># Non-regression test for #12178</span>

    <span class="comment"># Construct a zero-diagonal matrix</span>
    <span class="identifier">dists</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pairwise_distances</span><span class="grouping">(</span>
        <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="float-literal">0.2</span><span class="punctuation">,</span> <span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="float-literal">0.12</span><span class="punctuation">,</span> <span class="float-literal">1.34</span><span class="punctuation">,</span> <span class="float-literal">1.11</span><span class="punctuation">,</span> <span class="float-literal">1.6</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">T</span><span class="grouping">)</span>
    <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>

    <span class="comment"># small values on the diagonal are OK</span>
    <span class="identifier">dists</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">finfo</span><span class="grouping">(</span><span class="identifier">dists</span><span class="punctuation">.</span><span class="identifier">dtype</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">eps</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span>
    <span class="identifier">silhouette_samples</span><span class="grouping">(</span><span class="identifier">dists</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="punctuation">,</span> <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'precomputed'</span><span class="grouping">)</span>

    <span class="comment"># values bigger than eps * 100 are not</span>
    <span class="identifier">dists</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">finfo</span><span class="grouping">(</span><span class="identifier">dists</span><span class="punctuation">.</span><span class="identifier">dtype</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">eps</span> <span class="arithmetic-operator">*</span> <span class="int-literal">1000</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">'contains non-zero'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">silhouette_samples</span><span class="grouping">(</span><span class="identifier">dists</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="punctuation">,</span> <span class="identifier">metric</span><span class="arithmetic-assignment">=</span><span class="string-literal">'precomputed'</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">l</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">b</span><span class="invalid">e</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Assert message when there is only one label"""</span>
    <span class="identifier">rng</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">RandomState</span><span class="grouping">(</span><span class="identifier">seed</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Number of labels is"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">func</span><span class="grouping">(</span><span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">rand</span><span class="grouping">(</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="int-literal">10</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">_</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">t</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">u</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Assert message when all point are in different clusters"""</span>
    <span class="identifier">rng</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">RandomState</span><span class="grouping">(</span><span class="identifier">seed</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Number of labels is"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">func</span><span class="grouping">(</span><span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">rand</span><span class="grouping">(</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="int-literal">10</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_calinski_harabasz_score</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">l</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">b</span><span class="invalid">e</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">calinski_harabasz_score</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">_</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">t</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">u</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">calinski_harabasz_score</span><span class="grouping">)</span>

    <span class="comment"># Assert the value is 1. when all samples are equals</span>
    <span class="keyword">assert</span> <span class="int-literal">1</span><span class="punctuation">.</span> <span class="relational-operator">==</span> <span class="identifier">calinski_harabasz_score</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
                                         <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="grouping">)</span>

    <span class="comment"># Assert the value is 0. when all the mean cluster are equal</span>
    <span class="keyword">assert</span> <span class="int-literal">0</span><span class="punctuation">.</span> <span class="relational-operator">==</span> <span class="identifier">calinski_harabasz_score</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span><span class="punctuation">,</span>
                                         <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span><span class="grouping">)</span>

    <span class="comment"># General case (with non numpy arrays)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span> <span class="arithmetic-operator">+</span>
         <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="grouping">)</span>
    <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span>
    <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="identifier">calinski_harabasz_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="grouping">)</span><span class="punctuation">,</span>
                  <span class="int-literal">45</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="int-literal">40</span> <span class="arithmetic-operator">-</span> <span class="int-literal">4</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="grouping">(</span><span class="int-literal">5</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="int-literal">4</span> <span class="arithmetic-operator">-</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_davies_bouldin_score</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">l</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">b</span><span class="invalid">e</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">davies_bouldin_score</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">_</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">t</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">u</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">davies_bouldin_score</span><span class="grouping">)</span>

    <span class="comment"># Assert the value is 0. when all samples are equals</span>
    <span class="keyword">assert</span> <span class="identifier">davies_bouldin_score</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
                                <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="float-literal">0.0</span><span class="grouping">)</span>

    <span class="comment"># Assert the value is 0. when all the mean cluster are equal</span>
    <span class="keyword">assert</span> <span class="identifier">davies_bouldin_score</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span><span class="punctuation">,</span>
                                <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="float-literal">0.0</span><span class="grouping">)</span>

    <span class="comment"># General case (with non numpy arrays)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span> <span class="arithmetic-operator">+</span>
         <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">5</span><span class="grouping">)</span>
    <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="int-literal">10</span>
    <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="identifier">davies_bouldin_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sqrt</span><span class="grouping">(</span><span class="float-literal">0.5</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="int-literal">3</span><span class="grouping">)</span>

    <span class="comment"># Ensure divide by zero warning is not raised in general case</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">warns</span><span class="grouping">(</span><span class="none-literal">None</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">record</span><span class="punctuation">:</span>
        <span class="identifier">davies_bouldin_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="grouping">)</span>
    <span class="identifier">div_zero_warnings</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
        <span class="identifier">warning</span> <span class="keyword">for</span> <span class="identifier">warning</span> <span class="relational-operator">in</span> <span class="identifier">record</span>
        <span class="keyword">if</span> <span class="string-literal">"divide by zero encountered"</span> <span class="relational-operator">in</span> <span class="identifier">warning</span><span class="punctuation">.</span><span class="identifier">message</span><span class="punctuation">.</span><span class="identifier">args</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
    <span class="grouping">]</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">div_zero_warnings</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span>

    <span class="comment"># General case - cluster have one sample</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span>
    <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">approx</span><span class="grouping">(</span><span class="identifier">davies_bouldin_score</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">.</span> <span class="arithmetic-operator">/</span> <span class="int-literal">4</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="int-literal">3</span><span class="grouping">)</span>

    </pre>
  </body>
</html>