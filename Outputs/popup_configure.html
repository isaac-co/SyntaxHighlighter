<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">#!/usr/bin python3</span>
<span class="comment">""" The pop-up window of the Faceswap GUI for the setting of configuration options. """</span>

<span class="keyword">from</span> <span class="identifier">collections</span> <span class="keyword">import</span> <span class="identifier">OrderedDict</span>
<span class="keyword">from</span> <span class="identifier">configparser</span> <span class="keyword">import</span> <span class="identifier">ConfigParser</span>
<span class="keyword">import</span> <span class="identifier">gettext</span>
<span class="keyword">import</span> <span class="identifier">logging</span>
<span class="keyword">import</span> <span class="identifier">os</span>
<span class="keyword">import</span> <span class="identifier">sys</span>
<span class="keyword">import</span> <span class="identifier">tkinter</span> <span class="keyword">as</span> <span class="identifier">tk</span>
<span class="keyword">from</span> <span class="identifier">tkinter</span> <span class="keyword">import</span> <span class="identifier">ttk</span>
<span class="keyword">from</span> <span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">b</span> <span class="keyword">import</span> <span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">o</span><span class="invalid">d</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">e</span>

<span class="keyword">from</span> <span class="identifier">lib</span><span class="punctuation">.</span><span class="identifier">serializer</span> <span class="keyword">import</span> <span class="identifier">get_serializer</span>

<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">control_helper</span> <span class="keyword">import</span> <span class="identifier">ControlPanel</span><span class="punctuation">,</span> <span class="identifier">ControlPanelOption</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">custom_widgets</span> <span class="keyword">import</span> <span class="identifier">Tooltip</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">FileHandler</span><span class="punctuation">,</span> <span class="identifier">get_config</span><span class="punctuation">,</span> <span class="identifier">get_images</span><span class="punctuation">,</span> <span class="identifier">PATHCACHE</span>

<span class="identifier">logger</span> <span class="arithmetic-assignment">=</span> <span class="identifier">logging</span><span class="punctuation">.</span><span class="identifier">getLogger</span><span class="grouping">(</span><span class="identifier">__name__</span><span class="grouping">)</span>  <span class="comment"># pylint: disable=invalid-name</span>

<span class="comment"># LOCALES</span>
<span class="identifier">_LANG</span> <span class="arithmetic-assignment">=</span> <span class="identifier">gettext</span><span class="punctuation">.</span><span class="identifier">translation</span><span class="grouping">(</span><span class="string-literal">"gui.tooltips", localedir="locales"</span><span class="punctuation">,</span> <span class="identifier">fallback</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
<span class="identifier">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_LANG</span><span class="punctuation">.</span><span class="identifier">gettext</span>

<span class="identifier">_POPUP</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
<span class="identifier">_CONFIG_FILES</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
<span class="identifier">_CONFIGS</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_State</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">""" Holds the existing config files and the current state of the popup window. """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="comment"># The GUI Config cannot be scanned until GUI is launched, so this is populated</span>
        <span class="comment"># on the first call to load the settings</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_configs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">open_popup</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Launch the popup, ensuring only one instance is ever open

        Parameters
        ----------
        name: str, Optional
            The name of the configuration file. Used for selecting the correct section if required.
            Set to ``None`` if no initial section should be selected. Default: ``None``
        """</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_configs</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_scan_for_configs</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"name: %s"</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Restoring existing popup"</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span><span class="punctuation">.</span><span class="identifier">update</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span><span class="punctuation">.</span><span class="identifier">deiconify</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span><span class="punctuation">.</span><span class="identifier">lift</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_ConfigurePlugins</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_configs</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">close_popup</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Destroy the open popup and remove it from tracking. """</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"No popup to close. Returning"</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span><span class="punctuation">.</span><span class="identifier">destroy</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">del</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>

    <span class="keyword">def</span> <span class="identifier">_scan_for_configs</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Scan the plugin folders for configuration settings. Add in the GUI configuration also.

        Populates the attribute :attr:`_configs`.
        """</span>
        <span class="identifier">root_path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">abspath</span><span class="grouping">(</span><span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">argv</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">plugins_path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">root_path</span><span class="punctuation">,</span> <span class="string-literal">"plugins"</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Scanning path: '%s'"</span><span class="punctuation">,</span> <span class="identifier">plugins_path</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">dirpath</span><span class="punctuation">,</span> <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">filenames</span> <span class="relational-operator">in</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">walk</span><span class="grouping">(</span><span class="identifier">plugins_path</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="string-literal">"_config.py"</span> <span class="relational-operator">in</span> <span class="identifier">filenames</span><span class="punctuation">:</span>
                <span class="identifier">plugin_type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="identifier">dirpath</span><span class="grouping">)</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>
                <span class="identifier">config</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_load_config</span><span class="grouping">(</span><span class="identifier">plugin_type</span><span class="grouping">)</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_configs</span><span class="grouping">[</span><span class="identifier">plugin_type</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">config</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_configs</span><span class="grouping">[</span><span class="string-literal">"gui"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">user_config</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Configs loaded: %s"</span><span class="punctuation">,</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">list</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_configs</span><span class="punctuation">.</span><span class="identifier">keys</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">o</span><span class="invalid">d</span>
    <span class="keyword">def</span> <span class="identifier">_load_config</span><span class="grouping">(</span><span class="identifier">cls</span><span class="punctuation">,</span> <span class="identifier">plugin_type</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Load the config from disk. If the file doesn't exist, then it will be generated.

        Parameters
        ----------
        plugin_type: str
            The plugin type (i.e. extract, train convert) that the config should be loaded for

        Returns
        -------
        :class:`lib.config.FaceswapConfig`
            The Configuration for the selected plugin
        """</span>
        <span class="comment"># Load config to generate default if doesn't exist</span>
        <span class="identifier">mod</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">".".join(("plugins", plugin_type, "_config"</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">module</span> <span class="arithmetic-assignment">=</span> <span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">o</span><span class="invalid">d</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">mod</span><span class="grouping">)</span>
        <span class="identifier">config</span> <span class="arithmetic-assignment">=</span> <span class="identifier">module</span><span class="punctuation">.</span><span class="identifier">Config</span><span class="grouping">(</span><span class="none-literal">None</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Found '%s' config at '%s'"</span><span class="punctuation">,</span> <span class="identifier">plugin_type</span><span class="punctuation">,</span> <span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">configfile</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">config</span>


<span class="identifier">_STATE</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_State</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">open_popup</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_STATE</span><span class="punctuation">.</span><span class="identifier">open_popup</span>  <span class="comment"># pylint:disable=invalid-name</span>


<span class="keyword">class</span> <span class="identifier">_ConfigurePlugins</span><span class="grouping">(</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Toplevel</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">""" Pop-up window for the setting of Faceswap Configuration Options.

    Parameters
    ----------
    name: str
        The name of the section that is being navigated to. Used for opening on the correct
        page in the Tree View.
    configurations: dict
        Dictionary containing the :class:`~lib.config.FaceswapConfig` object for each
        configuration section for the requested pop-up window
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">configurations</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing %s: (name: %s, configurations: %s)"</span><span class="punctuation">,</span>
                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">configurations</span><span class="grouping">)</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_root</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">root</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_geometry</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_vars</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">header</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">StringVar</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="identifier">theme</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="arithmetic-operator">**</span><span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">user_theme</span><span class="grouping">[</span><span class="string-literal">"group_panel"</span><span class="grouping">]</span><span class="punctuation">,</span>
                 <span class="arithmetic-operator">**</span><span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">user_theme</span><span class="grouping">[</span><span class="string-literal">"group_settings"</span><span class="grouping">]</span><span class="grouping">}</span>
        <span class="identifier">header_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_build_header</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">content_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_Tree</span><span class="grouping">(</span><span class="identifier">content_frame</span><span class="punctuation">,</span> <span class="identifier">configurations</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">theme</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tree</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">bind</span><span class="grouping">(</span><span class="string-literal">"&lt;ButtonRelease-1&gt;"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_select_item</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_opts_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DisplayArea</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">content_frame</span><span class="punctuation">,</span> <span class="identifier">configurations</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">,</span> <span class="identifier">theme</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_opts_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTH</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="grouping">)</span>
        <span class="identifier">footer_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_build_footer</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">header_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="grouping">)</span>
        <span class="identifier">content_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTH</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="grouping">)</span>
        <span class="identifier">footer_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTTOM</span><span class="grouping">)</span>

        <span class="identifier">select</span> <span class="arithmetic-assignment">=</span> <span class="identifier">name</span> <span class="keyword">if</span> <span class="identifier">name</span> <span class="keyword">else</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">get_children</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">selection_set</span><span class="grouping">(</span><span class="identifier">select</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">focus</span><span class="grouping">(</span><span class="identifier">select</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_select_item</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="string-literal">"Configure Settings"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">call</span><span class="grouping">(</span><span class="string-literal">'wm', 'iconphoto'</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_w</span><span class="punctuation">,</span> <span class="identifier">get_images</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">icons</span><span class="grouping">[</span><span class="string-literal">"favicon"</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">protocol</span><span class="grouping">(</span><span class="string-literal">"WM_DELETE_WINDOW"</span><span class="punctuation">,</span> <span class="identifier">_STATE</span><span class="punctuation">.</span><span class="identifier">close_popup</span><span class="grouping">)</span>

        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_set_geometry</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the geometry of the pop-up window """</span>
        <span class="identifier">scaling_factor</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">scaling_factor</span>
        <span class="identifier">pos_x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_root</span><span class="punctuation">.</span><span class="identifier">winfo_x</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="int-literal">80</span>
        <span class="identifier">pos_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_root</span><span class="punctuation">.</span><span class="identifier">winfo_y</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="int-literal">80</span>
        <span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">int</span><span class="grouping">(</span><span class="int-literal">600</span> <span class="arithmetic-operator">*</span> <span class="identifier">scaling_factor</span><span class="grouping">)</span>
        <span class="identifier">height</span> <span class="arithmetic-assignment">=</span> <span class="identifier">int</span><span class="grouping">(</span><span class="int-literal">536</span> <span class="arithmetic-operator">*</span> <span class="identifier">scaling_factor</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Pop up Geometry: %sx%s, %s+%s"</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="punctuation">,</span> <span class="identifier">pos_x</span><span class="punctuation">,</span> <span class="identifier">pos_y</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">geometry</span><span class="grouping">(</span><span class="string-literal">"{}x{}+{}+{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="punctuation">,</span> <span class="identifier">pos_x</span><span class="punctuation">,</span> <span class="identifier">pos_y</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_build_header</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Build the main header text and separator. """</span>
        <span class="identifier">header_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">lbl_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">header_frame</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_vars</span><span class="grouping">[</span><span class="string-literal">"header"].set("Settings"</span><span class="grouping">)</span>
        <span class="identifier">lbl_header</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">lbl_frame</span><span class="punctuation">,</span>
                               <span class="identifier">textvariable</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_vars</span><span class="grouping">[</span><span class="string-literal">"header"</span><span class="grouping">]</span><span class="punctuation">,</span>
                               <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">W</span><span class="punctuation">,</span>
                               <span class="identifier">style</span><span class="arithmetic-assignment">=</span><span class="string-literal">"SPanel.Header1.TLabel"</span><span class="grouping">)</span>
        <span class="identifier">lbl_header</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="grouping">)</span>

        <span class="identifier">sep</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">header_frame</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">relief</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIDGE</span><span class="grouping">)</span>

        <span class="identifier">lbl_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="grouping">)</span>
        <span class="identifier">sep</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTTOM</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">header_frame</span>

    <span class="keyword">def</span> <span class="identifier">_build_footer</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Build the main footer buttons and separator. """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Adding action buttons"</span><span class="grouping">)</span>
        <span class="identifier">frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">left_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">frame</span><span class="grouping">)</span>
        <span class="identifier">right_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">frame</span><span class="grouping">)</span>

        <span class="identifier">btn_saveall</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Button</span><span class="grouping">(</span><span class="identifier">left_frame</span><span class="punctuation">,</span>
                                 <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Save All"</span><span class="punctuation">,</span>
                                 <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span>
                                 <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_opts_frame</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">)</span>
        <span class="identifier">btn_rstall</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Button</span><span class="grouping">(</span><span class="identifier">left_frame</span><span class="punctuation">,</span>
                                <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Reset All"</span><span class="punctuation">,</span>
                                <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span>
                                <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_opts_frame</span><span class="punctuation">.</span><span class="identifier">reset</span><span class="grouping">)</span>

        <span class="identifier">btn_cls</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Button</span><span class="grouping">(</span><span class="identifier">right_frame</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Cancel"</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="identifier">_STATE</span><span class="punctuation">.</span><span class="identifier">close_popup</span><span class="grouping">)</span>
        <span class="identifier">btn_save</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Button</span><span class="grouping">(</span><span class="identifier">right_frame</span><span class="punctuation">,</span>
                              <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Save"</span><span class="punctuation">,</span>
                              <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span>
                              <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="keyword">lambda</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_opts_frame</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">(</span><span class="identifier">page_only</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">btn_rst</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Button</span><span class="grouping">(</span><span class="identifier">right_frame</span><span class="punctuation">,</span>
                             <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Reset"</span><span class="punctuation">,</span>
                             <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span>
                             <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="keyword">lambda</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_opts_frame</span><span class="punctuation">.</span><span class="identifier">reset</span><span class="grouping">(</span><span class="identifier">page_only</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="identifier">Tooltip</span><span class="grouping">(</span><span class="identifier">btn_cls</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">_</span><span class="grouping">(</span><span class="string-literal">"Close without saving"</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">wrap_length</span><span class="arithmetic-assignment">=</span><span class="int-literal">720</span><span class="grouping">)</span>
        <span class="identifier">Tooltip</span><span class="grouping">(</span><span class="identifier">btn_save</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">_</span><span class="grouping">(</span><span class="string-literal">"Save this page's config"</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">wrap_length</span><span class="arithmetic-assignment">=</span><span class="int-literal">720</span><span class="grouping">)</span>
        <span class="identifier">Tooltip</span><span class="grouping">(</span><span class="identifier">btn_rst</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">_</span><span class="grouping">(</span><span class="string-literal">"Reset this page's config to default values"</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">wrap_length</span><span class="arithmetic-assignment">=</span><span class="int-literal">720</span><span class="grouping">)</span>
        <span class="identifier">Tooltip</span><span class="grouping">(</span><span class="identifier">btn_saveall</span><span class="punctuation">,</span>
                <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">_</span><span class="grouping">(</span><span class="string-literal">"Save all settings for the currently selected config"</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="identifier">wrap_length</span><span class="arithmetic-assignment">=</span><span class="int-literal">720</span><span class="grouping">)</span>
        <span class="identifier">Tooltip</span><span class="grouping">(</span><span class="identifier">btn_rstall</span><span class="punctuation">,</span>
                <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">_</span><span class="grouping">(</span><span class="string-literal">"Reset all settings for the currently selected config to default values"</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="identifier">wrap_length</span><span class="arithmetic-assignment">=</span><span class="int-literal">720</span><span class="grouping">)</span>

        <span class="identifier">btn_cls</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="grouping">)</span>
        <span class="identifier">btn_save</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="grouping">)</span>
        <span class="identifier">btn_rst</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="grouping">)</span>
        <span class="identifier">btn_saveall</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="grouping">)</span>
        <span class="identifier">btn_rstall</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="grouping">)</span>

        <span class="identifier">left_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="grouping">)</span>
        <span class="identifier">right_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Added action buttons"</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">frame</span>

    <span class="keyword">def</span> <span class="identifier">_select_item</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">event</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" Update the session summary info with the selected item or launch graph.

        If the mouse is clicked on the graph icon, then the session summary pop-up graph is
        launched. Otherwise the selected ID is stored.

        Parameters
        ----------
        event: :class:`tkinter.Event`
            The tkinter mouse button release event. Unused.
        """</span>
        <span class="identifier">selection</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">focus</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">section</span> <span class="arithmetic-assignment">=</span> <span class="identifier">selection</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"|"</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="identifier">subsections</span> <span class="arithmetic-assignment">=</span> <span class="identifier">selection</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"|")[1:] if "|"</span> <span class="relational-operator">in</span> <span class="identifier">selection</span> <span class="keyword">else</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_vars</span><span class="grouping">[</span><span class="string-literal">"header"].set("{} Settings"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">section</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_opts_frame</span><span class="punctuation">.</span><span class="identifier">select_options</span><span class="grouping">(</span><span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">subsections</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_Tree</span><span class="grouping">(</span><span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=too-many-ancestors</span>
    <span class="comment">""" Frame that holds the Tree View Navigator and scroll bar for the configuration pop-up.

    Parameters
    ----------
    parent: :class:`tkinter.ttk.Frame`
        The parent frame to the Tree View area
    configurations: dict
        Dictionary containing the :class:`~lib.config.FaceswapConfig` object for each
        configuration section for the requested pop-up window
    name: str
        The name of the section that is being navigated to. Used for opening on the correct
        page in the Tree View. ``None`` if no specific area is being navigated to
    theme: dict
        The color mapping for the settings pop-up theme
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">configurations</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">theme</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">parent</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_fix_styles</span><span class="grouping">(</span><span class="identifier">theme</span><span class="grouping">)</span>

        <span class="identifier">frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">relief</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">SOLID</span><span class="punctuation">,</span> <span class="identifier">borderwidth</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_build_tree</span><span class="grouping">(</span><span class="identifier">frame</span><span class="punctuation">,</span> <span class="identifier">configurations</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="grouping">)</span>
        <span class="identifier">scrollbar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Scrollbar</span><span class="grouping">(</span><span class="identifier">frame</span><span class="punctuation">,</span> <span class="identifier">orient</span><span class="arithmetic-assignment">=</span><span class="string-literal">"vertical"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">yview</span><span class="grouping">)</span>

        <span class="identifier">scrollbar</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Y</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Y</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">configure</span><span class="grouping">(</span><span class="identifier">yscrollcommand</span><span class="arithmetic-assignment">=</span><span class="identifier">scrollbar</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">)</span>
        <span class="identifier">frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Y</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Y</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">tree</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" :class:`tkinter.ttk.TreeView` The Tree View held within the frame """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span>

    <span class="punctuation">@</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">o</span><span class="invalid">d</span>
    <span class="keyword">def</span> <span class="identifier">_fix_styles</span><span class="grouping">(</span><span class="identifier">cls</span><span class="punctuation">,</span> <span class="identifier">theme</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Tkinter has a bug when setting the background style on certain OSes. This fixes the
        issue so we can set different colored backgrounds.

        We also set some default styles for our tree view.

        Parameters
        ----------
        theme: dict
            The color mapping for the settings pop-up theme
        """</span>
        <span class="identifier">style</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Style</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="comment"># Fix a bug in Tree-view that doesn't show alternate foreground on selection</span>
        <span class="identifier">fix_map</span> <span class="arithmetic-assignment">=</span> <span class="keyword">lambda</span> <span class="identifier">o</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="identifier">elm</span> <span class="keyword">for</span> <span class="identifier">elm</span> <span class="relational-operator">in</span> <span class="identifier">style</span><span class="punctuation">.</span><span class="identifier">map</span><span class="grouping">(</span><span class="string-literal">"Treeview"</span><span class="punctuation">,</span> <span class="identifier">query_opt</span><span class="arithmetic-assignment">=</span><span class="identifier">o</span><span class="grouping">)</span>  <span class="comment"># noqa</span>
                             <span class="keyword">if</span> <span class="identifier">elm</span><span class="grouping">[</span><span class="punctuation">:</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="relational-operator">!=</span> <span class="grouping">(</span><span class="string-literal">"!disabled", "!selected"</span><span class="grouping">)</span><span class="grouping">]</span>

        <span class="comment"># Remove the Borders</span>
        <span class="identifier">style</span><span class="punctuation">.</span><span class="identifier">configure</span><span class="grouping">(</span><span class="string-literal">"ConfigNav.Treeview", bd=0, background="#F0F0F0"</span><span class="grouping">)</span>
        <span class="identifier">style</span><span class="punctuation">.</span><span class="identifier">layout</span><span class="grouping">(</span><span class="string-literal">"ConfigNav.Treeview"</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">(</span><span class="string-literal">'ConfigNav.Treeview.treearea', {'sticky': 'nswe'</span><span class="grouping">}</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="comment"># Set colors</span>
        <span class="identifier">style</span><span class="punctuation">.</span><span class="identifier">map</span><span class="grouping">(</span><span class="string-literal">"ConfigNav.Treeview"</span><span class="punctuation">,</span>
                  <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">u</span><span class="invalid">n</span><span class="invalid">d</span><span class="arithmetic-assignment">=</span><span class="identifier">fix_map</span><span class="grouping">(</span><span class="string-literal">"foreground"</span><span class="grouping">)</span><span class="punctuation">,</span>
                  <span class="identifier">background</span><span class="arithmetic-assignment">=</span><span class="identifier">fix_map</span><span class="grouping">(</span><span class="string-literal">"background"</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">style</span><span class="punctuation">.</span><span class="identifier">map</span><span class="grouping">(</span><span class="string-literal">'ConfigNav.Treeview', background=[('selected'</span><span class="punctuation">,</span> <span class="identifier">theme</span><span class="grouping">[</span><span class="string-literal">"tree_select"</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_build_tree</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">configurations</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Build the configuration pop-up window.

        Parameters
        ----------
        configurations: dict
            Dictionary containing the :class:`~lib.config.FaceswapConfig` object for each
            configuration section for the requested pop-up window
        name: str
            The name of the section that is being navigated to. Used for opening on the correct
            page in the Tree View. ``None`` if no specific area is being navigated to

        Returns
        -------
        :class:`tkinter.ttk.TreeView`
            The populated tree view
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Building Tree View Navigator"</span><span class="grouping">)</span>
        <span class="identifier">tree</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Treeview</span><span class="grouping">(</span><span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">show</span><span class="arithmetic-assignment">=</span><span class="string-literal">"tree", style="ConfigNav.Treeview"</span><span class="grouping">)</span>
        <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">category</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="identifier">sect</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"."</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">sect</span> <span class="relational-operator">in</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">conf</span><span class="punctuation">.</span><span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">sections</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">]</span>
                <span class="keyword">for</span> <span class="identifier">category</span><span class="punctuation">,</span> <span class="identifier">conf</span> <span class="relational-operator">in</span> <span class="identifier">configurations</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">}</span>
        <span class="identifier">ordered</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">list</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">keys</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">categories</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"extract", "train", "convert"</span><span class="grouping">]</span>
        <span class="identifier">categories</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="identifier">x</span> <span class="keyword">for</span> <span class="identifier">x</span> <span class="relational-operator">in</span> <span class="identifier">ordered</span> <span class="keyword">if</span> <span class="identifier">x</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">categories</span><span class="grouping">]</span>

        <span class="keyword">for</span> <span class="identifier">cat</span> <span class="relational-operator">in</span> <span class="identifier">categories</span><span class="punctuation">:</span>
            <span class="identifier">img</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_images</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">icons</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"settings_{}".format(cat), ""</span><span class="grouping">)</span>
            <span class="identifier">text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cat</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">"_", " "</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">text</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">" "</span> <span class="arithmetic-operator">+</span> <span class="identifier">text</span> <span class="keyword">if</span> <span class="identifier">img</span> <span class="keyword">else</span> <span class="identifier">text</span>
            <span class="identifier">is_open</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="bool-literal">TRUE</span> <span class="keyword">if</span> <span class="identifier">name</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">or</span> <span class="identifier">name</span> <span class="relational-operator">==</span> <span class="identifier">cat</span> <span class="keyword">else</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="bool-literal">FALSE</span>
            <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">insert</span><span class="grouping">(</span><span class="string-literal">"", "end", cat, text=text, image=img, open=is_open, tags="category"</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_process_sections</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">[</span><span class="identifier">cat</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">cat</span><span class="punctuation">,</span> <span class="identifier">name</span> <span class="relational-operator">==</span> <span class="identifier">cat</span><span class="grouping">)</span>

        <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">tag_configure</span><span class="grouping">(</span><span class="string-literal">'category', background='#DFDFDF'</span><span class="grouping">)</span>
        <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">tag_configure</span><span class="grouping">(</span><span class="string-literal">'section', background='#E8E8E8'</span><span class="grouping">)</span>
        <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">tag_configure</span><span class="grouping">(</span><span class="string-literal">'option', background='#F0F0F0'</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Tree View Navigator"</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">tree</span>

    <span class="punctuation">@</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">o</span><span class="invalid">d</span>
    <span class="keyword">def</span> <span class="identifier">_process_sections</span><span class="grouping">(</span><span class="identifier">cls</span><span class="punctuation">,</span> <span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">sections</span><span class="punctuation">,</span> <span class="identifier">category</span><span class="punctuation">,</span> <span class="identifier">is_open</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Process the sections of a category's configuration.

        Creates a category's sections, then the sub options for that category

        Parameters
        ----------
        tree: :class:`tkinter.ttk.TreeView`
            The tree view to insert sections into
        sections: list
            The sections to insert into the Tree View
        category: str
            The category node that these sections sit in
        is_open: bool
            ``True`` if the node should be created in "open" mode. ``False`` if it should be
            closed.
        """</span>
        <span class="identifier">seen</span> <span class="arithmetic-assignment">=</span> <span class="identifier">set</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">section</span> <span class="relational-operator">in</span> <span class="identifier">sections</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">section</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="string-literal">"global"</span><span class="punctuation">:</span>  <span class="comment"># Global categories get escalated to parent</span>
                <span class="keyword">continue</span>
            <span class="identifier">sect</span> <span class="arithmetic-assignment">=</span> <span class="identifier">section</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
            <span class="identifier">section_id</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{}|{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">category</span><span class="punctuation">,</span> <span class="identifier">sect</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">sect</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">seen</span><span class="punctuation">:</span>
                <span class="identifier">seen</span><span class="punctuation">.</span><span class="identifier">add</span><span class="grouping">(</span><span class="identifier">sect</span><span class="grouping">)</span>
                <span class="identifier">text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sect</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">"_", " "</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="grouping">)</span>
                <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">insert</span><span class="grouping">(</span><span class="identifier">category</span><span class="punctuation">,</span> <span class="string-literal">"end", section_id, text=text, open=is_open, tags="section"</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">section</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span><span class="punctuation">:</span>
                <span class="identifier">opt</span> <span class="arithmetic-assignment">=</span> <span class="identifier">section</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>
                <span class="identifier">opt_id</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{}|{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">section_id</span><span class="punctuation">,</span> <span class="identifier">opt</span><span class="grouping">)</span>
                <span class="identifier">opt_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">opt</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">"_", " "</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="grouping">)</span>
                <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">insert</span><span class="grouping">(</span><span class="identifier">section_id</span><span class="punctuation">,</span> <span class="string-literal">"end", opt_id, text=opt_text, open=is_open, tags="option"</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">DisplayArea</span><span class="grouping">(</span><span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=too-many-ancestors</span>
    <span class="comment">""" The option configuration area of the pop up options.

    Parameters
    ----------
    top_level: :class:``tk.Toplevel``
        The tkinter Top Level widget
    parent: :class:`tkinter.ttk.Frame`
        The parent frame that holds the Display Area of the pop up configuration window
    tree: :class:`tkinter.ttk.TreeView`
        The Tree View navigator for the pop up configuration window
    configurations: dict
        Dictionary containing the :class:`~lib.config.FaceswapConfig` object for each
        configuration section for the requested pop-up window
    theme: dict
        The color mapping for the settings pop-up theme
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">top_level</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">configurations</span><span class="punctuation">,</span> <span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">theme</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">parent</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_configs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">configurations</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span> <span class="arithmetic-assignment">=</span> <span class="identifier">theme</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tree</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_vars</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cache</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config_cpanel_dict</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_get_config</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_displayed_frame</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_displayed_key</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_presets</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_Presets</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">top_level</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_build_header</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">displayed_key</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: The current display page's lookup key for configuration options. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_displayed_key</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">config_dict</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" dict: The configuration dictionary for all display pages. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config_cpanel_dict</span>

    <span class="keyword">def</span> <span class="identifier">_get_config</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Format the configuration options stored in :attr:`_config` into a dict of
        :class:`~lib.gui.control_helper.ControlPanelOption's for placement into option frames.

        Returns
        -------
        dict
            A dictionary of section names to :class:`~lib.gui.control_helper.ControlPanelOption`
            objects
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Formatting Config for GUI"</span><span class="grouping">)</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">plugin</span><span class="punctuation">,</span> <span class="identifier">conf</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_configs</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">for</span> <span class="identifier">section</span> <span class="relational-operator">in</span> <span class="identifier">conf</span><span class="punctuation">.</span><span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">sections</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">conf</span><span class="punctuation">.</span><span class="identifier">section</span> <span class="arithmetic-assignment">=</span> <span class="identifier">section</span>
                <span class="identifier">category</span> <span class="arithmetic-assignment">=</span> <span class="identifier">section</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"."</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
                <span class="identifier">sect</span> <span class="arithmetic-assignment">=</span> <span class="identifier">section</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"."</span><span class="grouping">)</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>
                <span class="comment"># Elevate global to root</span>
                <span class="identifier">key</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plugin</span> <span class="keyword">if</span> <span class="identifier">sect</span> <span class="relational-operator">==</span> <span class="string-literal">"global" else "{}|{}|{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">plugin</span><span class="punctuation">,</span> <span class="identifier">category</span><span class="punctuation">,</span> <span class="identifier">sect</span><span class="grouping">)</span>
                <span class="identifier">retval</span><span class="grouping">[</span><span class="identifier">key</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">helptext</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">options</span><span class="arithmetic-assignment">=</span><span class="identifier">OrderedDict</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

                <span class="keyword">for</span> <span class="identifier">option</span><span class="punctuation">,</span> <span class="identifier">params</span> <span class="relational-operator">in</span> <span class="identifier">conf</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">[</span><span class="identifier">section</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                    <span class="keyword">if</span> <span class="identifier">option</span> <span class="relational-operator">==</span> <span class="string-literal">"helptext"</span><span class="punctuation">:</span>
                        <span class="identifier">retval</span><span class="grouping">[</span><span class="identifier">key</span><span class="grouping">]</span><span class="grouping">[</span><span class="string-literal">"helptext"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">params</span>
                        <span class="keyword">continue</span>
                    <span class="identifier">initial_value</span> <span class="arithmetic-assignment">=</span> <span class="identifier">conf</span><span class="punctuation">.</span><span class="identifier">config_dict</span><span class="grouping">[</span><span class="identifier">option</span><span class="grouping">]</span>
                    <span class="identifier">initial_value</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"none"</span> <span class="keyword">if</span> <span class="identifier">initial_value</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="identifier">initial_value</span>
                    <span class="keyword">if</span> <span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"type"</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="identifier">list</span> <span class="logical-operator">and</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">initial_value</span><span class="punctuation">,</span> <span class="identifier">list</span><span class="grouping">)</span><span class="punctuation">:</span>
                        <span class="comment"># Split multi-select lists into space separated strings for tk variables</span>
                        <span class="identifier">initial_value</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">" "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">initial_value</span><span class="grouping">)</span>

                    <span class="identifier">retval</span><span class="grouping">[</span><span class="identifier">key</span><span class="grouping">]</span><span class="grouping">[</span><span class="string-literal">"options"</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">option</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ControlPanelOption</span><span class="grouping">(</span>
                        <span class="identifier">title</span><span class="arithmetic-assignment">=</span><span class="identifier">option</span><span class="punctuation">,</span>
                        <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"type"</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="identifier">group</span><span class="arithmetic-assignment">=</span><span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"group"</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"default"</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="identifier">initial_value</span><span class="arithmetic-assignment">=</span><span class="identifier">initial_value</span><span class="punctuation">,</span>
                        <span class="identifier">choices</span><span class="arithmetic-assignment">=</span><span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"choices"</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="identifier">is_radio</span><span class="arithmetic-assignment">=</span><span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"gui_radio"</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="identifier">is_multi_option</span><span class="arithmetic-assignment">=</span><span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"type"</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="identifier">list</span><span class="punctuation">,</span>
                        <span class="identifier">rounding</span><span class="arithmetic-assignment">=</span><span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"rounding"</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="identifier">min_max</span><span class="arithmetic-assignment">=</span><span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"min_max"</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="identifier">helptext</span><span class="arithmetic-assignment">=</span><span class="identifier">params</span><span class="grouping">[</span><span class="string-literal">"helptext"</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Formatted Config for GUI: %s"</span><span class="punctuation">,</span> <span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="keyword">def</span> <span class="identifier">_build_header</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Build the dynamic header text. """</span>
        <span class="identifier">header_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">lbl_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">header_frame</span><span class="grouping">)</span>

        <span class="identifier">var</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">StringVar</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">lbl</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">lbl_frame</span><span class="punctuation">,</span> <span class="identifier">textvariable</span><span class="arithmetic-assignment">=</span><span class="identifier">var</span><span class="punctuation">,</span> <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">W</span><span class="punctuation">,</span> <span class="identifier">style</span><span class="arithmetic-assignment">=</span><span class="string-literal">"SPanel.Header2.TLabel"</span><span class="grouping">)</span>
        <span class="identifier">lbl</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_build_presets_buttons</span><span class="grouping">(</span><span class="identifier">header_frame</span><span class="grouping">)</span>
        <span class="identifier">lbl_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">header_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_vars</span><span class="grouping">[</span><span class="string-literal">"header"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">var</span>

    <span class="keyword">def</span> <span class="identifier">_build_presets_buttons</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">frame</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Build the section that holds the preset load and save buttons.

        Parameters
        ----------
        frame: :class:`ttk.Frame`
            The frame that holds the preset buttons
        """</span>
        <span class="identifier">presets_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">frame</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">lbl</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="string-literal">"load", "save"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">btn</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Button</span><span class="grouping">(</span><span class="identifier">presets_frame</span><span class="punctuation">,</span>
                             <span class="identifier">image</span><span class="arithmetic-assignment">=</span><span class="identifier">get_images</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">icons</span><span class="grouping">[</span><span class="identifier">lbl</span><span class="grouping">]</span><span class="punctuation">,</span>
                             <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_presets</span><span class="punctuation">,</span> <span class="identifier">lbl</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="identifier">Tooltip</span><span class="grouping">(</span><span class="identifier">btn</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">_</span><span class="grouping">(</span><span class="identifier">f</span><span class="string-literal">"{lbl.title()} preset for this plugin"</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">wrap_length</span><span class="arithmetic-assignment">=</span><span class="int-literal">720</span><span class="grouping">)</span>
            <span class="identifier">btn</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="grouping">)</span>
        <span class="identifier">presets_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">select_options</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">subsections</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Display the page for the given section and subsections.

        Parameters
        ----------
        section: str
            The main section to be navigated to (or root node)
        subsections: list
            The full list of subsections ending on the required node
        """</span>
        <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"global"</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">subsections</span> <span class="keyword">else</span> <span class="identifier">subsections</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_vars</span><span class="grouping">[</span><span class="string-literal">"header"].set(" - ".join(sect.replace("_", " "</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">sect</span> <span class="relational-operator">in</span> <span class="identifier">labels</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_display</span><span class="grouping">(</span><span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">subsections</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_set_display</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">subsections</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the correct display page for the given section and subsections.

        Parameters
        ----------
        section: str
            The main section to be navigated to (or root node)
        subsections: list
            The full list of subsections ending on the required node
        """</span>
        <span class="identifier">key</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"|"</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">section</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="identifier">subsections</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_displayed_frame</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_displayed_frame</span><span class="punctuation">.</span><span class="identifier">pack_forget</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">key</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cache</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cache_page</span><span class="grouping">(</span><span class="identifier">key</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_displayed_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cache</span><span class="grouping">[</span><span class="identifier">key</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_displayed_key</span> <span class="arithmetic-assignment">=</span> <span class="identifier">key</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_displayed_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTTOM</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTH</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_cache_page</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Create the control panel options for the requested configuration and cache.

        Parameters
        ----------
        key: str
            The lookup key to the settings cache
        """</span>
        <span class="identifier">info</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config_cpanel_dict</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="identifier">key</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">info</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"key '%s' does not exist in options. Creating links page."</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cache</span><span class="grouping">[</span><span class="identifier">key</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_create_links_page</span><span class="grouping">(</span><span class="identifier">key</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cache</span><span class="grouping">[</span><span class="identifier">key</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ControlPanel</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span>
                                            <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">info</span><span class="grouping">[</span><span class="string-literal">"options"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">values</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
                                            <span class="identifier">header_text</span><span class="arithmetic-assignment">=</span><span class="identifier">info</span><span class="grouping">[</span><span class="string-literal">"helptext"</span><span class="grouping">]</span><span class="punctuation">,</span>
                                            <span class="identifier">columns</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span>
                                            <span class="identifier">max_columns</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span>
                                            <span class="identifier">option_columns</span><span class="arithmetic-assignment">=</span><span class="int-literal">4</span><span class="punctuation">,</span>
                                            <span class="identifier">style</span><span class="arithmetic-assignment">=</span><span class="string-literal">"SPanel"</span><span class="punctuation">,</span>
                                            <span class="identifier">blank_nones</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_create_links_page</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" For headings which don't have settings, build a links page to the subsections.

        Parameters
        ----------
        key: str
            The lookup key to set the links page for
        """</span>
        <span class="identifier">frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">links</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">item</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="identifier">key</span><span class="punctuation">,</span> <span class="string-literal">"")[1:].split("|"</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
                 <span class="keyword">for</span> <span class="identifier">item</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config_cpanel_dict</span>
                 <span class="keyword">if</span> <span class="identifier">item</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="identifier">key</span><span class="grouping">)</span><span class="grouping">}</span>

        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">links</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">frame</span>

        <span class="identifier">header_lbl</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">frame</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">_</span><span class="grouping">(</span><span class="string-literal">"Select a plugin to configure:"</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">header_lbl</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">link</span> <span class="relational-operator">in</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">links</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">lbl</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">frame</span><span class="punctuation">,</span>
                            <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">link</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">"_", " "</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
                            <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">W</span><span class="punctuation">,</span>
                            <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">u</span><span class="invalid">n</span><span class="invalid">d</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span><span class="grouping">[</span><span class="string-literal">"link_color"</span><span class="grouping">]</span><span class="punctuation">,</span>
                            <span class="identifier">cursor</span><span class="arithmetic-assignment">=</span><span class="string-literal">"hand2"</span><span class="grouping">)</span>
            <span class="identifier">lbl</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="identifier">bind</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{}|{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">link</span><span class="grouping">)</span>
            <span class="identifier">lbl</span><span class="punctuation">.</span><span class="identifier">bind</span><span class="grouping">(</span><span class="string-literal">"&lt;Button-1&gt;"</span><span class="punctuation">,</span> <span class="keyword">lambda</span> <span class="identifier">e</span><span class="punctuation">,</span> <span class="identifier">l</span><span class="arithmetic-assignment">=</span><span class="identifier">bind</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_link_callback</span><span class="grouping">(</span><span class="identifier">l</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="keyword">return</span> <span class="identifier">frame</span>

    <span class="keyword">def</span> <span class="identifier">_link_callback</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">identifier</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the tree view to the selected item and display the requested page on a link click.

        Parameters
        ----------
        identifier: str
            The identifier from the tree view for the page to display
        """</span>
        <span class="identifier">parent</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"|".join(identifier.split("|"</span><span class="grouping">)</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">item</span><span class="grouping">(</span><span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">open</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">selection_set</span><span class="grouping">(</span><span class="identifier">identifier</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">focus</span><span class="grouping">(</span><span class="identifier">identifier</span><span class="grouping">)</span>
        <span class="identifier">split</span> <span class="arithmetic-assignment">=</span> <span class="identifier">identifier</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"|"</span><span class="grouping">)</span>
        <span class="identifier">section</span> <span class="arithmetic-assignment">=</span> <span class="identifier">split</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="identifier">subsections</span> <span class="arithmetic-assignment">=</span> <span class="identifier">split</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">:</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">split</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">1</span> <span class="keyword">else</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">select_options</span><span class="grouping">(</span><span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">subsections</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">reset</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">page_only</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Reset all configuration options to their default values.

        Parameters
        ----------
        page_only: bool, optional
            ``True`` resets just the currently selected page's options to default, ``False`` resets
            all plugins within the currently selected config to default. Default: ``False``
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Resetting config, page_only: %s"</span><span class="punctuation">,</span> <span class="identifier">page_only</span><span class="grouping">)</span>
        <span class="identifier">selection</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">focus</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">page_only</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">selection</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config_cpanel_dict</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"No configuration options to reset for current page: %s"</span><span class="punctuation">,</span> <span class="identifier">selection</span><span class="grouping">)</span>
                <span class="keyword">return</span>
            <span class="identifier">items</span> <span class="arithmetic-assignment">=</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config_cpanel_dict</span><span class="grouping">[</span><span class="identifier">selection</span><span class="grouping">]</span><span class="grouping">[</span><span class="string-literal">"options"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">values</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">items</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">opt</span>
                     <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config_cpanel_dict</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span>
                     <span class="keyword">for</span> <span class="identifier">opt</span> <span class="relational-operator">in</span> <span class="identifier">val</span><span class="grouping">[</span><span class="string-literal">"options"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">values</span><span class="grouping">(</span><span class="grouping">)</span>
                     <span class="keyword">if</span> <span class="identifier">key</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="identifier">selection</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"|"</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">]</span>
        <span class="keyword">for</span> <span class="identifier">item</span> <span class="relational-operator">in</span> <span class="identifier">items</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Resetting item '%s' from '%s' to default '%s'"</span><span class="punctuation">,</span>
                         <span class="identifier">item</span><span class="punctuation">.</span><span class="identifier">title</span><span class="punctuation">,</span> <span class="identifier">item</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">item</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="grouping">)</span>
            <span class="identifier">item</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">item</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Reset config"</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">save</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">page_only</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Save the configuration file to disk.

        Parameters
        ----------
        page_only: bool, optional
            ``True`` saves just the currently selected page's options, ``False`` saves all the
            plugins options within the currently selected config. Default: ``False``
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Saving config"</span><span class="grouping">)</span>
        <span class="identifier">selection</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">focus</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">category</span> <span class="arithmetic-assignment">=</span> <span class="identifier">selection</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"|"</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="identifier">config</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_configs</span><span class="grouping">[</span><span class="identifier">category</span><span class="grouping">]</span>
        <span class="comment"># Create a new config to pull through any defaults change</span>
        <span class="identifier">new_config</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ConfigParser</span><span class="grouping">(</span><span class="identifier">allow_no_value</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="string-literal">"|"</span> <span class="relational-operator">in</span> <span class="identifier">selection</span><span class="punctuation">:</span>
            <span class="identifier">lookup</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">".".join(selection.split("|"</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">:</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>  <span class="comment"># Expand global out from root node</span>
            <span class="identifier">lookup</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"global"</span>

        <span class="keyword">if</span> <span class="identifier">page_only</span> <span class="logical-operator">and</span> <span class="identifier">lookup</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">sections</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"No settings to save for the current page"</span><span class="grouping">)</span>
            <span class="keyword">return</span>

        <span class="keyword">for</span> <span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">items</span> <span class="relational-operator">in</span> <span class="identifier">config</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">s</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Adding section: '%s')"</span><span class="punctuation">,</span> <span class="identifier">section</span><span class="grouping">)</span>
            <span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">insert_config_section</span><span class="grouping">(</span><span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">items</span><span class="grouping">[</span><span class="string-literal">"helptext"</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">config</span><span class="arithmetic-assignment">=</span><span class="identifier">new_config</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">item</span><span class="punctuation">,</span> <span class="identifier">options</span> <span class="relational-operator">in</span> <span class="identifier">items</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">if</span> <span class="identifier">item</span> <span class="relational-operator">==</span> <span class="string-literal">"helptext"</span><span class="punctuation">:</span>
                    <span class="keyword">continue</span>
                <span class="keyword">if</span> <span class="identifier">page_only</span> <span class="logical-operator">and</span> <span class="identifier">section</span> <span class="relational-operator">!=</span> <span class="identifier">lookup</span><span class="punctuation">:</span>
                    <span class="comment"># Keep existing values for pages we are not updating</span>
                    <span class="identifier">new_opt</span> <span class="arithmetic-assignment">=</span> <span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">item</span><span class="grouping">)</span>
                    <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Retain existing value '%s' for %s"</span><span class="punctuation">,</span>
                                 <span class="identifier">new_opt</span><span class="punctuation">,</span> <span class="string-literal">"."</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">item</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>
                <span class="keyword">else</span><span class="punctuation">:</span>
                    <span class="comment"># Get currently selected value</span>
                    <span class="identifier">key</span> <span class="arithmetic-assignment">=</span> <span class="identifier">category</span>
                    <span class="keyword">if</span> <span class="identifier">section</span> <span class="relational-operator">!=</span> <span class="string-literal">"global"</span><span class="punctuation">:</span>
                        <span class="identifier">key</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">"|{}".format(section.replace(".", "|"</span><span class="grouping">)</span><span class="grouping">)</span>
                    <span class="identifier">new_opt</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config_cpanel_dict</span><span class="grouping">[</span><span class="identifier">key</span><span class="grouping">]</span><span class="grouping">[</span><span class="string-literal">"options"</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">item</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span>
                    <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Updating value to '%s' for %s"</span><span class="punctuation">,</span>
                                 <span class="identifier">new_opt</span><span class="punctuation">,</span> <span class="string-literal">"."</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">item</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>
                <span class="identifier">helptext</span> <span class="arithmetic-assignment">=</span> <span class="identifier">config</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">p</span><span class="grouping">(</span><span class="identifier">options</span><span class="grouping">[</span><span class="string-literal">"helptext"</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">is_section</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
                <span class="identifier">new_config</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">helptext</span><span class="grouping">)</span>
                <span class="keyword">if</span> <span class="identifier">options</span><span class="grouping">[</span><span class="string-literal">"type"</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="identifier">list</span><span class="punctuation">:</span>  <span class="comment"># Comma separated multi select options</span>
                    <span class="identifier">new_opt</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">", "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">new_opt</span> <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">new_opt</span><span class="punctuation">,</span> <span class="identifier">list</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="identifier">new_opt</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
                <span class="identifier">new_config</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">section</span><span class="punctuation">,</span> <span class="identifier">item</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">new_opt</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">config</span> <span class="arithmetic-assignment">=</span> <span class="identifier">new_config</span>
        <span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">save_config</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"Saved config: '%s'"</span><span class="punctuation">,</span> <span class="identifier">config</span><span class="punctuation">.</span><span class="identifier">configfile</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">category</span> <span class="relational-operator">==</span> <span class="string-literal">"gui"</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tk_vars</span><span class="grouping">[</span><span class="string-literal">"runningtask"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">root</span><span class="punctuation">.</span><span class="identifier">rebuild</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"Can't redraw GUI whilst a task is running. GUI Settings will be "</span>
                            <span class="string-literal">"applied at the next restart."</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Saved config"</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_Presets</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">""" Handles the file dialog and loading and saving of plugin preset files.

    Parameters
    ----------
    parent: :class:`ttk.Frame`
        The parent display area frame
    top_level: :class:`tkinter.Toplevel`
        The top level pop up window
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">top_level</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing: %s (top_level: %s)"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">top_level</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_parent</span> <span class="arithmetic-assignment">=</span> <span class="identifier">parent</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span> <span class="arithmetic-assignment">=</span> <span class="identifier">top_level</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_base_path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">PATHCACHE</span><span class="punctuation">,</span> <span class="string-literal">"presets"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_serializer</span><span class="grouping">(</span><span class="string-literal">"json"</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized: %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_preset_path</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: The path to the default preset folder for the currently displayed plugin. """</span>
        <span class="keyword">return</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_base_path</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_parent</span><span class="punctuation">.</span><span class="identifier">displayed_key</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"|"</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_full_key</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: The full extrapolated lookup key for the currently displayed page. """</span>
        <span class="identifier">full_key</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_parent</span><span class="punctuation">.</span><span class="identifier">displayed_key</span>
        <span class="keyword">return</span> <span class="identifier">full_key</span> <span class="keyword">if</span> <span class="string-literal">"|" in full_key else f"{full_key}|global"</span>

    <span class="keyword">def</span> <span class="identifier">load</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Action to perform when load preset button is pressed.

        Loads parameters from a saved json file and updates the displayed page.
        """</span>
        <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_get_filename</span><span class="grouping">(</span><span class="string-literal">"load"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">filename</span><span class="punctuation">:</span>
            <span class="keyword">return</span>

        <span class="identifier">opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"__filetype") != "faceswap_preset"</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">warning</span><span class="grouping">(</span><span class="string-literal">"'%s' is not a valid plugin preset file"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"__section"</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_full_key</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">warning</span><span class="grouping">(</span><span class="string-literal">"You are attempting to load a preset for '%s' into '%s'. Aborted."</span><span class="punctuation">,</span>
                           <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"__section", "no section"</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_full_key</span><span class="grouping">)</span>
            <span class="keyword">return</span>

        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Loaded preset: %s"</span><span class="punctuation">,</span> <span class="identifier">opts</span><span class="grouping">)</span>

        <span class="identifier">exist</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_parent</span><span class="punctuation">.</span><span class="identifier">config_dict</span><span class="grouping">[</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_parent</span><span class="punctuation">.</span><span class="identifier">displayed_key</span><span class="grouping">]</span><span class="grouping">[</span><span class="string-literal">"options"</span><span class="grouping">]</span>
        <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">key</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">"__"</span><span class="grouping">)</span> <span class="logical-operator">or</span> <span class="identifier">key</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">exist</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Skipping non-existent item: '%s'"</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="grouping">)</span>
                <span class="keyword">continue</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Setting '%s' to '%s'"</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">val</span><span class="grouping">)</span>
            <span class="identifier">exist</span><span class="grouping">[</span><span class="identifier">key</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">val</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"Preset loaded from: '%s'"</span><span class="punctuation">,</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">basename</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">save</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Action to perform when save preset button is pressed.

        Compiles currently displayed configuration options into a json file and saves into selected
        location.
        """</span>
        <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_get_filename</span><span class="grouping">(</span><span class="string-literal">"save"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">filename</span><span class="punctuation">:</span>
            <span class="keyword">return</span>

        <span class="identifier">opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_parent</span><span class="punctuation">.</span><span class="identifier">config_dict</span><span class="grouping">[</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_parent</span><span class="punctuation">.</span><span class="identifier">displayed_key</span><span class="grouping">]</span><span class="grouping">[</span><span class="string-literal">"options"</span><span class="grouping">]</span>
        <span class="identifier">preset</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">opt</span><span class="punctuation">:</span> <span class="identifier">val</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">opt</span><span class="punctuation">,</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">}</span>
        <span class="identifier">preset</span><span class="grouping">[</span><span class="string-literal">"__filetype"] = "faceswap_preset"</span>
        <span class="identifier">preset</span><span class="grouping">[</span><span class="string-literal">"__section"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_full_key</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">(</span><span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">preset</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"Preset '%s' saved to: '%s'"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_full_key</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_get_filename</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">action</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Obtain the filename for load and save preset actions.

        Parameters
        ----------
        action: ["load", "save"]
            The preset action that is being performed

        Returns
        -------
        str: The requested preset filename
        """</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_parent</span><span class="punctuation">.</span><span class="identifier">config_dict</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_parent</span><span class="punctuation">.</span><span class="identifier">displayed_key</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"No settings to %s for the current page."</span><span class="punctuation">,</span> <span class="identifier">action</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="none-literal">None</span>

        <span class="identifier">args</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">"save_filename", "json") if action == "save" else ("filename", "json"</span><span class="grouping">)</span>
        <span class="identifier">kwargs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">title</span><span class="arithmetic-assignment">=</span><span class="identifier">f</span><span class="string-literal">"{action.title()} Preset..."</span><span class="punctuation">,</span>
                      <span class="identifier">initial_folder</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_preset_path</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">action</span> <span class="relational-operator">==</span> <span class="string-literal">"save"</span><span class="punctuation">:</span>
            <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">"initial_file"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_get_initial_filename</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">FileHandler</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">i</span><span class="invalid">l</span><span class="invalid">e</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">filename</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"%s cancelled"</span><span class="punctuation">,</span> <span class="identifier">action</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_raise_toplevel</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">filename</span>

    <span class="keyword">def</span> <span class="identifier">_get_initial_filename</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Obtain the initial filename for saving a preset.

        The name is based on the plugin's display key. A scan of the default presets folder is done
        to ensure no filename clash. If a filename does clash, then an integer is added to the end.

        Returns
        -------
        str
            The initial preset filename
        """</span>
        <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">key</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_full_key</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"|"</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>
        <span class="identifier">base_filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">f</span><span class="string-literal">"{key.replace('|', '_')}_preset"</span>

        <span class="identifier">i</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
        <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">f</span><span class="string-literal">"{base_filename}.json"</span>
        <span class="keyword">while</span> <span class="bool-literal">True</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_preset_path</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">break</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"File pre-exists: %s"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
            <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">f</span><span class="string-literal">"{base_filename}_{i}.json"</span>
            <span class="identifier">i</span> <span class="arithmetic-assignment">+=</span> <span class="int-literal">1</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initial filename: %s"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">filename</span>

    <span class="keyword">def</span> <span class="identifier">_raise_toplevel</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Opening a file dialog tends to hide the top level pop up, so bring back to the
        fore. """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span><span class="punctuation">.</span><span class="identifier">update</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span><span class="punctuation">.</span><span class="identifier">deiconify</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_popup</span><span class="punctuation">.</span><span class="identifier">lift</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>