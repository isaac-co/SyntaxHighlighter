<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
==========================
Model Complexity Influence
==========================

Demonstrate how model complexity influences both prediction accuracy and
computational performance.

We will be using two datasets:
    - :ref:`diabetes_dataset` for regression.
      This dataset consists of 10 measurements taken from diabetes patients.
      The task is to predict disease progression;
    - :ref:`20newsgroups_dataset` for classification. This dataset consists of
      newsgroup posts. The task is to predict on which topic (out of 20 topics)
      the post is written about.

We will model the complexity influence on three different estimators:
    - :class:`~sklearn.linear_model.SGDClassifier` (for classification data)
      which implements stochastic gradient descent learning;

    - :class:`~sklearn.svm.NuSVR` (for regression data) which implements
      Nu support vector regression;

    - :class:`~sklearn.ensemble.GradientBoostingRegressor` (for regression
      data) which builds an additive model in a forward stage-wise fashion.


We make the model complexity vary through the choice of relevant model
parameters in each of our selected models. Next, we will measure the influence
on both computational performance (latency) and predictive power (MSE or
Hamming Loss).

"""</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">__doc__</span><span class="grouping">)</span>

<span class="comment"># Authors: Eustache Diemert &lt;eustache@diemert.fr&gt;</span>
<span class="comment">#          Maria Telenczuk &lt;https://github.com/maikia&gt;</span>
<span class="comment">#          Guillaume Lemaitre &lt;g.lemaitre58@gmail.com&gt;</span>
<span class="comment"># License: BSD 3 clause</span>

<span class="keyword">import</span> <span class="identifier">time</span>
<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span> <span class="keyword">import</span> <span class="identifier">datasets</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">shuffle</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="identifier">mean_squared_error</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">svm</span> <span class="keyword">import</span> <span class="identifier">NuSVR</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">GradientBoostingRegressor</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">SGDClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="identifier">hamming_loss</span>


<span class="comment"># Initialize random generator</span>
<span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">seed</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>

<span class="comment">##############################################################################</span>
<span class="comment"># Load the data</span>
<span class="comment"># -------------</span>
<span class="comment">#</span>
<span class="comment"># First we load both datasets.</span>
<span class="comment">#</span>
<span class="comment"># .. note:: We are using</span>
<span class="comment">#    :func:`~sklearn.datasets.fetch_20newsgroups_vectorized` to download 20</span>
<span class="comment">#    newsgroups dataset. It returns ready-to-use features.</span>
<span class="comment">#</span>
<span class="comment"># .. note:: ``X`` of the 20 newsgroups dataset is a sparse matrix while ``X``</span>
<span class="comment">#    of diabetes dataset is a numpy array.</span>
<span class="comment">#</span>


<span class="keyword">def</span> <span class="identifier">generate_data</span><span class="grouping">(</span><span class="identifier">case</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Generate regression/classification data."""</span>
    <span class="keyword">if</span> <span class="identifier">case</span> <span class="relational-operator">==</span> <span class="string-literal">'regression'</span><span class="punctuation">:</span>
        <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">load_diabetes</span><span class="grouping">(</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">X</span><span class="invalid">_</span><span class="invalid">y</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">case</span> <span class="relational-operator">==</span> <span class="string-literal">'classification'</span><span class="punctuation">:</span>
        <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">fetch_20newsgroups_vectorized</span><span class="grouping">(</span><span class="identifier">subset</span><span class="arithmetic-assignment">=</span><span class="string-literal">'all'</span><span class="punctuation">,</span>
                                                      <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">X</span><span class="invalid">_</span><span class="invalid">y</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">shuffle</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
    <span class="identifier">offset</span> <span class="arithmetic-assignment">=</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="float-literal">0.8</span><span class="grouping">)</span>
    <span class="identifier">X_train</span><span class="punctuation">,</span> <span class="identifier">y_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">offset</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">offset</span><span class="grouping">]</span>
    <span class="identifier">X_test</span><span class="punctuation">,</span> <span class="identifier">y_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="grouping">[</span><span class="identifier">offset</span><span class="punctuation">:</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">[</span><span class="identifier">offset</span><span class="punctuation">:</span><span class="grouping">]</span>

    <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'X_train': X_train, 'X_test': X_test, 'y_train'</span><span class="punctuation">:</span> <span class="identifier">y_train</span><span class="punctuation">,</span>
            <span class="string-literal">'y_test'</span><span class="punctuation">:</span> <span class="identifier">y_test</span><span class="grouping">}</span>
    <span class="keyword">return</span> <span class="identifier">data</span>


<span class="identifier">regression_data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">generate_data</span><span class="grouping">(</span><span class="string-literal">'regression'</span><span class="grouping">)</span>
<span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">f</span><span class="invalid">i</span><span class="invalid">c</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span> <span class="arithmetic-assignment">=</span> <span class="identifier">generate_data</span><span class="grouping">(</span><span class="string-literal">'classification'</span><span class="grouping">)</span>


<span class="comment">##############################################################################</span>
<span class="comment"># Benchmark influence</span>
<span class="comment"># -------------------</span>
<span class="comment"># Next, we can calculate the influence of the parameters on the given</span>
<span class="comment"># estimator. In each round, we will set the estimator with the new value of</span>
<span class="comment"># ``changing_param`` and we will be collecting the prediction times, prediction</span>
<span class="comment"># performance and complexities to see how those changes affect the estimator.</span>
<span class="comment"># We will calculate the complexity using ``complexity_computer`` passed as a</span>
<span class="comment"># parameter.</span>
<span class="comment">#</span>


<span class="keyword">def</span> <span class="identifier">benchmark_influence</span><span class="grouping">(</span><span class="identifier">conf</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Benchmark influence of `changing_param` on both MSE and latency.
    """</span>
    <span class="identifier">prediction_times</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="identifier">prediction_powers</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="identifier">complexities</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="keyword">for</span> <span class="identifier">param_value</span> <span class="relational-operator">in</span> <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'changing_param_values'</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'tuned_params'][conf['changing_param'</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">param_value</span>
        <span class="identifier">estimator</span> <span class="arithmetic-assignment">=</span> <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'estimator'](**conf['tuned_params'</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Benchmarking %s"</span> <span class="arithmetic-operator">%</span> <span class="identifier">estimator</span><span class="grouping">)</span>
        <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'data']['X_train'], conf['data']['y_train'</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'postfit_hook'</span><span class="grouping">]</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span>
        <span class="identifier">complexity</span> <span class="arithmetic-assignment">=</span> <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'complexity_computer'</span><span class="grouping">]</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span>
        <span class="identifier">complexities</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">complexity</span><span class="grouping">)</span>
        <span class="identifier">start_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="punctuation">.</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">_</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'n_samples'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">y_pred</span> <span class="arithmetic-assignment">=</span> <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'data']['X_test'</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">elapsed_time</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">time</span><span class="punctuation">.</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">start_time</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">float</span><span class="grouping">(</span><span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'n_samples'</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">prediction_times</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">elapsed_time</span><span class="grouping">)</span>
        <span class="identifier">pred_score</span> <span class="arithmetic-assignment">=</span> <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'prediction_performance_computer'</span><span class="grouping">]</span><span class="grouping">(</span>
            <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'data']['y_test'</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">y_pred</span><span class="grouping">)</span>
        <span class="identifier">prediction_powers</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">pred_score</span><span class="grouping">)</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Complexity: %d | %s: %.4f | Pred. Time: %fs\n"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span>
            <span class="identifier">complexity</span><span class="punctuation">,</span> <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'prediction_performance_label'</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">pred_score</span><span class="punctuation">,</span>
            <span class="identifier">elapsed_time</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">prediction_powers</span><span class="punctuation">,</span> <span class="identifier">prediction_times</span><span class="punctuation">,</span> <span class="identifier">complexities</span>


<span class="comment">##############################################################################</span>
<span class="comment"># Choose parameters</span>
<span class="comment"># -----------------</span>
<span class="comment">#</span>
<span class="comment"># We choose the parameters for each of our estimators by making</span>
<span class="comment"># a dictionary with all the necessary values.</span>
<span class="comment"># ``changing_param`` is the name of the parameter which will vary in each</span>
<span class="comment"># estimator.</span>
<span class="comment"># Complexity will be defined by the ``complexity_label`` and calculated using</span>
<span class="comment"># `complexity_computer`.</span>
<span class="comment"># Also note that depending on the estimator type we are passing</span>
<span class="comment"># different data.</span>
<span class="comment">#</span>

<span class="keyword">def</span> <span class="identifier">_count_nonzero_coefficients</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">a</span> <span class="arithmetic-assignment">=</span> <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">coef_</span><span class="punctuation">.</span><span class="identifier">toarray</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">count_nonzero</span><span class="grouping">(</span><span class="identifier">a</span><span class="grouping">)</span>


<span class="identifier">configurations</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
    <span class="grouping">{</span><span class="string-literal">'estimator'</span><span class="punctuation">:</span> <span class="identifier">SGDClassifier</span><span class="punctuation">,</span>
     <span class="string-literal">'tuned_params': {'penalty': 'elasticnet', 'alpha': 0.001, 'loss'</span><span class="punctuation">:</span>
                      <span class="string-literal">'modified_huber', 'fit_intercept': True, 'tol'</span><span class="punctuation">:</span> <span class="float-literal">1e-3</span><span class="grouping">}</span><span class="punctuation">,</span>
     <span class="string-literal">'changing_param': 'l1_ratio'</span><span class="punctuation">,</span>
     <span class="string-literal">'changing_param_values'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="float-literal">0.25</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="punctuation">,</span> <span class="float-literal">0.75</span><span class="punctuation">,</span> <span class="float-literal">0.9</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="string-literal">'complexity_label': 'non_zero coefficients'</span><span class="punctuation">,</span>
     <span class="string-literal">'complexity_computer'</span><span class="punctuation">:</span> <span class="identifier">_count_nonzero_coefficients</span><span class="punctuation">,</span>
     <span class="string-literal">'prediction_performance_computer'</span><span class="punctuation">:</span> <span class="identifier">hamming_loss</span><span class="punctuation">,</span>
     <span class="string-literal">'prediction_performance_label': 'Hamming Loss (Misclassification Ratio)'</span><span class="punctuation">,</span>
     <span class="string-literal">'postfit_hook'</span><span class="punctuation">:</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="identifier">x</span><span class="punctuation">.</span><span class="identifier">sparsify</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="string-literal">'data'</span><span class="punctuation">:</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">f</span><span class="invalid">i</span><span class="invalid">c</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">,</span>
     <span class="string-literal">'n_samples'</span><span class="punctuation">:</span> <span class="int-literal">30</span><span class="grouping">}</span><span class="punctuation">,</span>
    <span class="grouping">{</span><span class="string-literal">'estimator'</span><span class="punctuation">:</span> <span class="identifier">NuSVR</span><span class="punctuation">,</span>
     <span class="string-literal">'tuned_params': {'C': 1e3, 'gamma'</span><span class="punctuation">:</span> <span class="int-literal">2</span> <span class="arithmetic-operator">**</span> <span class="arithmetic-operator">-</span><span class="int-literal">15</span><span class="grouping">}</span><span class="punctuation">,</span>
     <span class="string-literal">'changing_param': 'nu'</span><span class="punctuation">,</span>
     <span class="string-literal">'changing_param_values'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="float-literal">0.25</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="punctuation">,</span> <span class="float-literal">0.75</span><span class="punctuation">,</span> <span class="float-literal">0.9</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="string-literal">'complexity_label': 'n_support_vectors'</span><span class="punctuation">,</span>
     <span class="string-literal">'complexity_computer'</span><span class="punctuation">:</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">x</span><span class="punctuation">.</span><span class="identifier">support_vectors_</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="string-literal">'data'</span><span class="punctuation">:</span> <span class="identifier">regression_data</span><span class="punctuation">,</span>
     <span class="string-literal">'postfit_hook'</span><span class="punctuation">:</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="identifier">x</span><span class="punctuation">,</span>
     <span class="string-literal">'prediction_performance_computer'</span><span class="punctuation">:</span> <span class="identifier">mean_squared_error</span><span class="punctuation">,</span>
     <span class="string-literal">'prediction_performance_label': 'MSE'</span><span class="punctuation">,</span>
     <span class="string-literal">'n_samples'</span><span class="punctuation">:</span> <span class="int-literal">30</span><span class="grouping">}</span><span class="punctuation">,</span>
    <span class="grouping">{</span><span class="string-literal">'estimator'</span><span class="punctuation">:</span> <span class="identifier">GradientBoostingRegressor</span><span class="punctuation">,</span>
     <span class="string-literal">'tuned_params': {'loss': 'squared_error'</span><span class="grouping">}</span><span class="punctuation">,</span>
     <span class="string-literal">'changing_param': 'n_estimators'</span><span class="punctuation">,</span>
     <span class="string-literal">'changing_param_values'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">50</span><span class="punctuation">,</span> <span class="int-literal">100</span><span class="punctuation">,</span> <span class="int-literal">200</span><span class="punctuation">,</span> <span class="int-literal">500</span><span class="grouping">]</span><span class="punctuation">,</span>
     <span class="string-literal">'complexity_label': 'n_trees'</span><span class="punctuation">,</span>
     <span class="string-literal">'complexity_computer'</span><span class="punctuation">:</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="identifier">x</span><span class="punctuation">.</span><span class="identifier">n_estimators</span><span class="punctuation">,</span>
     <span class="string-literal">'data'</span><span class="punctuation">:</span> <span class="identifier">regression_data</span><span class="punctuation">,</span>
     <span class="string-literal">'postfit_hook'</span><span class="punctuation">:</span> <span class="keyword">lambda</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="identifier">x</span><span class="punctuation">,</span>
     <span class="string-literal">'prediction_performance_computer'</span><span class="punctuation">:</span> <span class="identifier">mean_squared_error</span><span class="punctuation">,</span>
     <span class="string-literal">'prediction_performance_label': 'MSE'</span><span class="punctuation">,</span>
     <span class="string-literal">'n_samples'</span><span class="punctuation">:</span> <span class="int-literal">30</span><span class="grouping">}</span><span class="punctuation">,</span>
<span class="grouping">]</span>


<span class="comment">##############################################################################</span>
<span class="comment"># Run the code and plot the results</span>
<span class="comment"># ---------------------------------</span>
<span class="comment">#</span>
<span class="comment"># We defined all the functions required to run our benchmark. Now, we will loop</span>
<span class="comment"># over the different configurations that we defined previously. Subsequently,</span>
<span class="comment"># we can analyze the plots obtained from the benchmark:</span>
<span class="comment"># Relaxing the `L1` penalty in the SGD classifier reduces the prediction error</span>
<span class="comment"># but leads to an increase in the training time.</span>
<span class="comment"># We can draw a similar analysis regarding the training time which increases</span>
<span class="comment"># with the number of support vectors with a Nu-SVR. However, we observed that</span>
<span class="comment"># there is an optimal number of support vectors which reduces the prediction</span>
<span class="comment"># error. Indeed, too few support vectors lead to an under-fitted model while</span>
<span class="comment"># too many support vectors lead to an over-fitted model.</span>
<span class="comment"># The exact same conclusion can be drawn for the gradient-boosting model. The</span>
<span class="comment"># only the difference with the Nu-SVR is that having too many trees in the</span>
<span class="comment"># ensemble is not as detrimental.</span>
<span class="comment">#</span>

<span class="keyword">def</span> <span class="identifier">plot_influence</span><span class="grouping">(</span><span class="identifier">conf</span><span class="punctuation">,</span> <span class="identifier">mse_values</span><span class="punctuation">,</span> <span class="identifier">prediction_times</span><span class="punctuation">,</span> <span class="identifier">complexities</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Plot influence of model complexity on both accuracy and latency.
    """</span>

    <span class="identifier">fig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">subplots_adjust</span><span class="grouping">(</span><span class="identifier">right</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.75</span><span class="grouping">)</span>

    <span class="comment"># first axes (prediction error)</span>
    <span class="identifier">ax1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">add_subplot</span><span class="grouping">(</span><span class="int-literal">111</span><span class="grouping">)</span>
    <span class="identifier">line1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax1</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">complexities</span><span class="punctuation">,</span> <span class="identifier">mse_values</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="arithmetic-assignment">=</span><span class="string-literal">'tab:blue', ls='-'</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
    <span class="identifier">ax1</span><span class="punctuation">.</span><span class="identifier">set_xlabel</span><span class="grouping">(</span><span class="string-literal">'Model Complexity (%s)' % conf['complexity_label'</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="identifier">y1_label</span> <span class="arithmetic-assignment">=</span> <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'prediction_performance_label'</span><span class="grouping">]</span>
    <span class="identifier">ax1</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="identifier">y1_label</span><span class="grouping">)</span>

    <span class="identifier">ax1</span><span class="punctuation">.</span><span class="identifier">spines</span><span class="grouping">[</span><span class="string-literal">'left'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">set_color</span><span class="grouping">(</span><span class="identifier">line1</span><span class="punctuation">.</span><span class="identifier">get_color</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">ax1</span><span class="punctuation">.</span><span class="identifier">yaxis</span><span class="punctuation">.</span><span class="identifier">label</span><span class="punctuation">.</span><span class="identifier">set_color</span><span class="grouping">(</span><span class="identifier">line1</span><span class="punctuation">.</span><span class="identifier">get_color</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">ax1</span><span class="punctuation">.</span><span class="identifier">tick_params</span><span class="grouping">(</span><span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="string-literal">'y'</span><span class="punctuation">,</span> <span class="identifier">colors</span><span class="arithmetic-assignment">=</span><span class="identifier">line1</span><span class="punctuation">.</span><span class="identifier">get_color</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># second axes (latency)</span>
    <span class="identifier">ax2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">add_subplot</span><span class="grouping">(</span><span class="int-literal">111</span><span class="punctuation">,</span> <span class="identifier">sharex</span><span class="arithmetic-assignment">=</span><span class="identifier">ax1</span><span class="punctuation">,</span> <span class="identifier">frameon</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
    <span class="identifier">line2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax2</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">complexities</span><span class="punctuation">,</span> <span class="identifier">prediction_times</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="arithmetic-assignment">=</span><span class="string-literal">'tab:orange', ls='-'</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
    <span class="identifier">ax2</span><span class="punctuation">.</span><span class="identifier">yaxis</span><span class="punctuation">.</span><span class="identifier">tick_right</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">ax2</span><span class="punctuation">.</span><span class="identifier">yaxis</span><span class="punctuation">.</span><span class="identifier">set_label_position</span><span class="grouping">(</span><span class="string-literal">"right"</span><span class="grouping">)</span>
    <span class="identifier">y2_label</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"Time (s)"</span>
    <span class="identifier">ax2</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="identifier">y2_label</span><span class="grouping">)</span>
    <span class="identifier">ax1</span><span class="punctuation">.</span><span class="identifier">spines</span><span class="grouping">[</span><span class="string-literal">'right'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">set_color</span><span class="grouping">(</span><span class="identifier">line2</span><span class="punctuation">.</span><span class="identifier">get_color</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">ax2</span><span class="punctuation">.</span><span class="identifier">yaxis</span><span class="punctuation">.</span><span class="identifier">label</span><span class="punctuation">.</span><span class="identifier">set_color</span><span class="grouping">(</span><span class="identifier">line2</span><span class="punctuation">.</span><span class="identifier">get_color</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">ax2</span><span class="punctuation">.</span><span class="identifier">tick_params</span><span class="grouping">(</span><span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="string-literal">'y'</span><span class="punctuation">,</span> <span class="identifier">colors</span><span class="arithmetic-assignment">=</span><span class="identifier">line2</span><span class="punctuation">.</span><span class="identifier">get_color</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">line1</span><span class="punctuation">,</span> <span class="identifier">line2</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="string-literal">"prediction error", "latency"</span><span class="grouping">)</span><span class="punctuation">,</span>
               <span class="identifier">loc</span><span class="arithmetic-assignment">=</span><span class="string-literal">'upper right'</span><span class="grouping">)</span>

    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="string-literal">"Influence of varying '%s' on %s"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'changing_param'</span><span class="grouping">]</span><span class="punctuation">,</span>
                                                   <span class="identifier">conf</span><span class="grouping">[</span><span class="string-literal">'estimator'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">for</span> <span class="identifier">conf</span> <span class="relational-operator">in</span> <span class="identifier">configurations</span><span class="punctuation">:</span>
    <span class="identifier">prediction_performances</span><span class="punctuation">,</span> <span class="identifier">prediction_times</span><span class="punctuation">,</span> <span class="identifier">complexities</span> <span class="arithmetic-assignment">=</span> <span class="invalid">\</span>
        <span class="identifier">benchmark_influence</span><span class="grouping">(</span><span class="identifier">conf</span><span class="grouping">)</span>
    <span class="identifier">plot_influence</span><span class="grouping">(</span><span class="identifier">conf</span><span class="punctuation">,</span> <span class="identifier">prediction_performances</span><span class="punctuation">,</span> <span class="identifier">prediction_times</span><span class="punctuation">,</span>
                   <span class="identifier">complexities</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="comment">##############################################################################</span>
<span class="comment"># Conclusion</span>
<span class="comment"># ----------</span>
<span class="comment">#</span>
<span class="comment"># As a conclusion, we can deduce the following insights:</span>
<span class="comment">#</span>
<span class="comment"># * a model which is more complex (or expressive) will require a larger</span>
<span class="comment">#   training time;</span>
<span class="comment"># * a more complex model does not guarantee to reduce the prediction error.</span>
<span class="comment">#</span>
<span class="comment"># These aspects are related to model generalization and avoiding model</span>
<span class="comment"># under-fitting or over-fitting.</span>

    </pre>
  </body>
</html>