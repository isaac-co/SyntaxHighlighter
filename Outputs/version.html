<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""Vendoered from
https://github.com/pypa/packaging/blob/main/packaging/version.py
"""</span>
<span class="comment"># Copyright (c) Donald Stufft and individual contributors.</span>
<span class="comment"># All rights reserved.</span>

<span class="comment"># Redistribution and use in source and binary forms, with or without</span>
<span class="comment"># modification, are permitted provided that the following conditions are met:</span>

<span class="comment">#     1. Redistributions of source code must retain the above copyright notice,</span>
<span class="comment">#        this list of conditions and the following disclaimer.</span>

<span class="comment">#     2. Redistributions in binary form must reproduce the above copyright</span>
<span class="comment">#        notice, this list of conditions and the following disclaimer in the</span>
<span class="comment">#        documentation and/or other materials provided with the distribution.</span>

<span class="comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND</span>
<span class="comment"># ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<span class="comment"># WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="comment"># DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<span class="comment"># FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="comment"># DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="comment"># SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="comment"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="comment"># OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="comment"># OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>

<span class="keyword">import</span> <span class="identifier">collections</span>
<span class="keyword">import</span> <span class="identifier">itertools</span>
<span class="keyword">import</span> <span class="identifier">re</span>
<span class="keyword">import</span> <span class="identifier">warnings</span>
<span class="keyword">from</span> <span class="identifier">typing</span> <span class="keyword">import</span> <span class="identifier">Callable</span><span class="punctuation">,</span> <span class="identifier">Iterator</span><span class="punctuation">,</span> <span class="identifier">List</span><span class="punctuation">,</span> <span class="identifier">Optional</span><span class="punctuation">,</span> <span class="identifier">SupportsInt</span><span class="punctuation">,</span> <span class="identifier">Tuple</span><span class="punctuation">,</span> <span class="identifier">Union</span>

<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">_structures</span> <span class="keyword">import</span> <span class="identifier">Infinity</span><span class="punctuation">,</span> <span class="identifier">InfinityType</span><span class="punctuation">,</span> <span class="identifier">NegativeInfinity</span><span class="punctuation">,</span> <span class="identifier">NegativeInfinityType</span>

<span class="identifier">__all__</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"parse", "Version", "LegacyVersion", "InvalidVersion", "VERSION_PATTERN"</span><span class="grouping">]</span>

<span class="identifier">InfiniteTypes</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Union</span><span class="grouping">[</span><span class="identifier">InfinityType</span><span class="punctuation">,</span> <span class="identifier">NegativeInfinityType</span><span class="grouping">]</span>
<span class="identifier">PrePostDevType</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Union</span><span class="grouping">[</span><span class="identifier">InfiniteTypes</span><span class="punctuation">,</span> <span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">str</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">]</span><span class="grouping">]</span>
<span class="identifier">SubLocalType</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Union</span><span class="grouping">[</span><span class="identifier">InfiniteTypes</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">]</span>
<span class="identifier">LocalType</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Union</span><span class="grouping">[</span>
    <span class="identifier">NegativeInfinityType</span><span class="punctuation">,</span>
    <span class="identifier">Tuple</span><span class="grouping">[</span>
        <span class="identifier">Union</span><span class="grouping">[</span>
            <span class="identifier">SubLocalType</span><span class="punctuation">,</span>
            <span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">SubLocalType</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">]</span><span class="punctuation">,</span>
            <span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">NegativeInfinityType</span><span class="punctuation">,</span> <span class="identifier">SubLocalType</span><span class="grouping">]</span><span class="punctuation">,</span>
        <span class="grouping">]</span><span class="punctuation">,</span>
        <span class="punctuation">.</span><span class="punctuation">.</span><span class="punctuation">.</span><span class="punctuation">,</span>
    <span class="grouping">]</span><span class="punctuation">,</span>
<span class="grouping">]</span>
<span class="identifier">CmpKey</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Tuple</span><span class="grouping">[</span>
    <span class="identifier">int</span><span class="punctuation">,</span> <span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">int</span><span class="punctuation">,</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="punctuation">.</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">PrePostDevType</span><span class="punctuation">,</span> <span class="identifier">PrePostDevType</span><span class="punctuation">,</span> <span class="identifier">PrePostDevType</span><span class="punctuation">,</span> <span class="identifier">LocalType</span>
<span class="grouping">]</span>
<span class="identifier">LegacyCmpKey</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">int</span><span class="punctuation">,</span> <span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">str</span><span class="punctuation">,</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="punctuation">.</span><span class="grouping">]</span><span class="grouping">]</span>
<span class="identifier">VersionComparisonMethod</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Callable</span><span class="grouping">[</span>
    <span class="grouping">[</span><span class="identifier">Union</span><span class="grouping">[</span><span class="identifier">CmpKey</span><span class="punctuation">,</span> <span class="identifier">LegacyCmpKey</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">Union</span><span class="grouping">[</span><span class="identifier">CmpKey</span><span class="punctuation">,</span> <span class="identifier">LegacyCmpKey</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">bool</span>
<span class="grouping">]</span>

<span class="identifier">_Version</span> <span class="arithmetic-assignment">=</span> <span class="identifier">collections</span><span class="punctuation">.</span><span class="identifier">namedtuple</span><span class="grouping">(</span>
    <span class="string-literal">"_Version", ["epoch", "release", "dev", "pre", "post", "local"</span><span class="grouping">]</span>
<span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">parse</span><span class="grouping">(</span><span class="identifier">version</span><span class="punctuation">:</span> <span class="identifier">str</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">Union</span><span class="grouping">[</span><span class="string-literal">"LegacyVersion", "Version"</span><span class="grouping">]</span><span class="punctuation">:</span>
    <span class="comment">"""
    Parse the given version string and return either a :class:`Version` object
    or a :class:`LegacyVersion` object depending on if the given version is
    a valid PEP 440 version or a legacy version.
    """</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">Version</span><span class="grouping">(</span><span class="identifier">version</span><span class="grouping">)</span>
    <span class="keyword">except</span> <span class="identifier">InvalidVersion</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">LegacyVersion</span><span class="grouping">(</span><span class="identifier">version</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">InvalidVersion</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    An invalid version was found, users should refer to PEP 440.
    """</span>


<span class="keyword">class</span> <span class="identifier">_BaseVersion</span><span class="punctuation">:</span>
    <span class="identifier">_key</span><span class="punctuation">:</span> <span class="identifier">Union</span><span class="grouping">[</span><span class="identifier">CmpKey</span><span class="punctuation">,</span> <span class="identifier">LegacyCmpKey</span><span class="grouping">]</span>

    <span class="keyword">def</span> <span class="identifier">__hash__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">int</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">hash</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_key</span><span class="grouping">)</span>

    <span class="comment"># Please keep the duplicated `isinstance` check</span>
    <span class="comment"># in the six comparisons hereunder</span>
    <span class="comment"># unless you find a way to avoid adding overhead function calls.</span>
    <span class="keyword">def</span> <span class="identifier">__lt__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">other</span><span class="punctuation">:</span> <span class="string-literal">"_BaseVersion"</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">other</span><span class="punctuation">,</span> <span class="identifier">_BaseVersion</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">NotImplemented</span>

        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_key</span> <span class="relational-operator">&lt;</span> <span class="identifier">other</span><span class="punctuation">.</span><span class="identifier">_key</span>

    <span class="keyword">def</span> <span class="identifier">__le__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">other</span><span class="punctuation">:</span> <span class="string-literal">"_BaseVersion"</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">other</span><span class="punctuation">,</span> <span class="identifier">_BaseVersion</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">NotImplemented</span>

        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_key</span> <span class="relational-operator">&lt;=</span> <span class="identifier">other</span><span class="punctuation">.</span><span class="identifier">_key</span>

    <span class="keyword">def</span> <span class="identifier">__eq__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">other</span><span class="punctuation">:</span> <span class="identifier">object</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">other</span><span class="punctuation">,</span> <span class="identifier">_BaseVersion</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">NotImplemented</span>

        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_key</span> <span class="relational-operator">==</span> <span class="identifier">other</span><span class="punctuation">.</span><span class="identifier">_key</span>

    <span class="keyword">def</span> <span class="identifier">__ge__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">other</span><span class="punctuation">:</span> <span class="string-literal">"_BaseVersion"</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">other</span><span class="punctuation">,</span> <span class="identifier">_BaseVersion</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">NotImplemented</span>

        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_key</span> <span class="relational-operator">&gt;=</span> <span class="identifier">other</span><span class="punctuation">.</span><span class="identifier">_key</span>

    <span class="keyword">def</span> <span class="identifier">__gt__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">other</span><span class="punctuation">:</span> <span class="string-literal">"_BaseVersion"</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">other</span><span class="punctuation">,</span> <span class="identifier">_BaseVersion</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">NotImplemented</span>

        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_key</span> <span class="relational-operator">&gt;</span> <span class="identifier">other</span><span class="punctuation">.</span><span class="identifier">_key</span>

    <span class="keyword">def</span> <span class="identifier">__ne__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">other</span><span class="punctuation">:</span> <span class="identifier">object</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">other</span><span class="punctuation">,</span> <span class="identifier">_BaseVersion</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">NotImplemented</span>

        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_key</span> <span class="relational-operator">!=</span> <span class="identifier">other</span><span class="punctuation">.</span><span class="identifier">_key</span>


<span class="keyword">class</span> <span class="identifier">LegacyVersion</span><span class="grouping">(</span><span class="identifier">_BaseVersion</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">version</span><span class="punctuation">:</span> <span class="identifier">str</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span> <span class="arithmetic-assignment">=</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">version</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_key</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_legacy_cmpkey</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="grouping">)</span>

        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span>
            <span class="string-literal">"Creating a LegacyVersion has been deprecated and will be "</span>
            <span class="string-literal">"removed in the next major release"</span><span class="punctuation">,</span>
            <span class="identifier">DeprecationWarning</span><span class="punctuation">,</span>
        <span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">__str__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">str</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span>

    <span class="keyword">def</span> <span class="identifier">__repr__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">str</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">f</span><span class="string-literal">"&lt;LegacyVersion('{self}')&gt;"</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">public</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">str</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">base_version</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">str</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">epoch</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">int</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">release</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">pre</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">post</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">dev</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">local</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">is_prerelease</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="bool-literal">False</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">is_postrelease</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="bool-literal">False</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">is_devrelease</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="bool-literal">False</span>


<span class="identifier">_legacy_version_component_re</span> <span class="arithmetic-assignment">=</span> <span class="identifier">re</span><span class="punctuation">.</span><span class="identifier">compile</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">"(\d+ | [a-z]+ | \.| -)"</span><span class="punctuation">,</span> <span class="identifier">re</span><span class="punctuation">.</span><span class="identifier">VERBOSE</span><span class="grouping">)</span>

<span class="identifier">_legacy_version_replacement_map</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span>
    <span class="string-literal">"pre": "c"</span><span class="punctuation">,</span>
    <span class="string-literal">"preview": "c"</span><span class="punctuation">,</span>
    <span class="string-literal">"-": "final-"</span><span class="punctuation">,</span>
    <span class="string-literal">"rc": "c"</span><span class="punctuation">,</span>
    <span class="string-literal">"dev": "@"</span><span class="punctuation">,</span>
<span class="grouping">}</span>


<span class="keyword">def</span> <span class="identifier">_parse_version_parts</span><span class="grouping">(</span><span class="identifier">s</span><span class="punctuation">:</span> <span class="identifier">str</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">Iterator</span><span class="grouping">[</span><span class="identifier">str</span><span class="grouping">]</span><span class="punctuation">:</span>
    <span class="keyword">for</span> <span class="identifier">part</span> <span class="relational-operator">in</span> <span class="identifier">_legacy_version_component_re</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="identifier">s</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">part</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_legacy_version_replacement_map</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="identifier">part</span><span class="punctuation">,</span> <span class="identifier">part</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">part</span> <span class="logical-operator">or</span> <span class="identifier">part</span> <span class="relational-operator">==</span> <span class="string-literal">"."</span><span class="punctuation">:</span>
            <span class="keyword">continue</span>

        <span class="keyword">if</span> <span class="identifier">part</span><span class="grouping">[</span><span class="punctuation">:</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">in</span> <span class="string-literal">"0123456789"</span><span class="punctuation">:</span>
            <span class="comment"># pad for numeric comparison</span>
            <span class="keyword">yield</span> <span class="identifier">part</span><span class="punctuation">.</span><span class="identifier">zfill</span><span class="grouping">(</span><span class="int-literal">8</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">yield</span> <span class="string-literal">"*"</span> <span class="arithmetic-operator">+</span> <span class="identifier">part</span>

    <span class="comment"># ensure that alpha/beta/candidate are before final</span>
    <span class="keyword">yield</span> <span class="string-literal">"*final"</span>


<span class="keyword">def</span> <span class="identifier">_legacy_cmpkey</span><span class="grouping">(</span><span class="identifier">version</span><span class="punctuation">:</span> <span class="identifier">str</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">LegacyCmpKey</span><span class="punctuation">:</span>

    <span class="comment"># We hardcode an epoch of -1 here. A PEP 440 version can only have a epoch</span>
    <span class="comment"># greater than or equal to 0. This will effectively put the LegacyVersion,</span>
    <span class="comment"># which uses the defacto standard originally implemented by setuptools,</span>
    <span class="comment"># as before all PEP 440 versions.</span>
    <span class="identifier">epoch</span> <span class="arithmetic-assignment">=</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span>

    <span class="comment"># This scheme is taken from pkg_resources.parse_version setuptools prior to</span>
    <span class="comment"># it's adoption of the packaging library.</span>
    <span class="identifier">parts</span><span class="punctuation">:</span> <span class="identifier">List</span><span class="grouping">[</span><span class="identifier">str</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="keyword">for</span> <span class="identifier">part</span> <span class="relational-operator">in</span> <span class="identifier">_parse_version_parts</span><span class="grouping">(</span><span class="identifier">version</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">part</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">"*"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="comment"># remove "-" before a prerelease tag</span>
            <span class="keyword">if</span> <span class="identifier">part</span> <span class="relational-operator">&lt;</span> <span class="string-literal">"*final"</span><span class="punctuation">:</span>
                <span class="keyword">while</span> <span class="identifier">parts</span> <span class="logical-operator">and</span> <span class="identifier">parts</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="string-literal">"*final-"</span><span class="punctuation">:</span>
                    <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">pop</span><span class="grouping">(</span><span class="grouping">)</span>

            <span class="comment"># remove trailing zeros from each series of numeric parts</span>
            <span class="keyword">while</span> <span class="identifier">parts</span> <span class="logical-operator">and</span> <span class="identifier">parts</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="string-literal">"00000000"</span><span class="punctuation">:</span>
                <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">pop</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">part</span><span class="grouping">)</span>

    <span class="keyword">return</span> <span class="identifier">epoch</span><span class="punctuation">,</span> <span class="identifier">tuple</span><span class="grouping">(</span><span class="identifier">parts</span><span class="grouping">)</span>


<span class="comment"># Deliberately not anchored to the start and end of the string, to make it</span>
<span class="comment"># easier for 3rd party code to reuse</span>
<span class="identifier">VERSION_PATTERN</span> <span class="arithmetic-assignment">=</span> <span class="identifier">r</span><span class="comment">"""
    v?
    (?:
        (?:(?P&lt;epoch&gt;[0-9]+)!)?                           # epoch
        (?P&lt;release&gt;[0-9]+(?:\.[0-9]+)*)                  # release segment
        (?P&lt;pre&gt;                                          # pre-release
            [-_\.]?
            (?P&lt;pre_l&gt;(a|b|c|rc|alpha|beta|pre|preview))
            [-_\.]?
            (?P&lt;pre_n&gt;[0-9]+)?
        )?
        (?P&lt;post&gt;                                         # post release
            (?:-(?P&lt;post_n1&gt;[0-9]+))
            |
            (?:
                [-_\.]?
                (?P&lt;post_l&gt;post|rev|r)
                [-_\.]?
                (?P&lt;post_n2&gt;[0-9]+)?
            )
        )?
        (?P&lt;dev&gt;                                          # dev release
            [-_\.]?
            (?P&lt;dev_l&gt;dev)
            [-_\.]?
            (?P&lt;dev_n&gt;[0-9]+)?
        )?
    )
    (?:\+(?P&lt;local&gt;[a-z0-9]+(?:[-_\.][a-z0-9]+)*))?       # local version
"""</span>


<span class="keyword">class</span> <span class="identifier">Version</span><span class="grouping">(</span><span class="identifier">_BaseVersion</span><span class="grouping">)</span><span class="punctuation">:</span>

    <span class="identifier">_regex</span> <span class="arithmetic-assignment">=</span> <span class="identifier">re</span><span class="punctuation">.</span><span class="identifier">compile</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">"^\s*" + VERSION_PATTERN + r"\s*$"</span><span class="punctuation">,</span> <span class="identifier">re</span><span class="punctuation">.</span><span class="identifier">VERBOSE</span> <span class="bitwise-operator">|</span> <span class="identifier">re</span><span class="punctuation">.</span><span class="identifier">IGNORECASE</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">version</span><span class="punctuation">:</span> <span class="identifier">str</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>

        <span class="comment"># Validate the version and parse it into pieces</span>
        <span class="identifier">match</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_regex</span><span class="punctuation">.</span><span class="identifier">search</span><span class="grouping">(</span><span class="identifier">version</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">match</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">InvalidVersion</span><span class="grouping">(</span><span class="identifier">f</span><span class="string-literal">"Invalid version: '{version}'"</span><span class="grouping">)</span>

        <span class="comment"># Store the parsed out pieces of the version</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_Version</span><span class="grouping">(</span>
            <span class="identifier">epoch</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">match</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="string-literal">"epoch")) if match.group("epoch"</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="int-literal">0</span><span class="punctuation">,</span>
            <span class="identifier">release</span><span class="arithmetic-assignment">=</span><span class="identifier">tuple</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">i</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">match</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="string-literal">"release").split("."</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
            <span class="identifier">pre</span><span class="arithmetic-assignment">=</span><span class="identifier">_parse_letter_version</span><span class="grouping">(</span><span class="identifier">match</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="string-literal">"pre_l"), match.group("pre_n"</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
            <span class="identifier">post</span><span class="arithmetic-assignment">=</span><span class="identifier">_parse_letter_version</span><span class="grouping">(</span>
                <span class="identifier">match</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="string-literal">"post_l"), match.group("post_n1") or match.group("post_n2"</span><span class="grouping">)</span>
            <span class="grouping">)</span><span class="punctuation">,</span>
            <span class="identifier">dev</span><span class="arithmetic-assignment">=</span><span class="identifier">_parse_letter_version</span><span class="grouping">(</span><span class="identifier">match</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="string-literal">"dev_l"), match.group("dev_n"</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
            <span class="identifier">local</span><span class="arithmetic-assignment">=</span><span class="identifier">_parse_local_version</span><span class="grouping">(</span><span class="identifier">match</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="string-literal">"local"</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">)</span>

        <span class="comment"># Generate a key which will be used for sorting</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_key</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_cmpkey</span><span class="grouping">(</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">epoch</span><span class="punctuation">,</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">release</span><span class="punctuation">,</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">pre</span><span class="punctuation">,</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">post</span><span class="punctuation">,</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">dev</span><span class="punctuation">,</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">local</span><span class="punctuation">,</span>
        <span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">__repr__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">str</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">f</span><span class="string-literal">"&lt;Version('{self}')&gt;"</span>

    <span class="keyword">def</span> <span class="identifier">__str__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">str</span><span class="punctuation">:</span>
        <span class="identifier">parts</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>

        <span class="comment"># Epoch</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">epoch</span> <span class="relational-operator">!=</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">f</span><span class="string-literal">"{self.epoch}!"</span><span class="grouping">)</span>

        <span class="comment"># Release segment</span>
        <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">"."</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">x</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">x</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">release</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="comment"># Pre-release</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">pre</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">""</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">x</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">x</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">pre</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="comment"># Post-release</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">post</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">f</span><span class="string-literal">".post{self.post}"</span><span class="grouping">)</span>

        <span class="comment"># Development release</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dev</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">f</span><span class="string-literal">".dev{self.dev}"</span><span class="grouping">)</span>

        <span class="comment"># Local version segment</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">local</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">f</span><span class="string-literal">"+{self.local}"</span><span class="grouping">)</span>

        <span class="keyword">return</span> <span class="string-literal">""</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">parts</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">epoch</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">int</span><span class="punctuation">:</span>
        <span class="identifier">_epoch</span><span class="punctuation">:</span> <span class="identifier">int</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">epoch</span>
        <span class="keyword">return</span> <span class="identifier">_epoch</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">release</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">int</span><span class="punctuation">,</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="punctuation">.</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">_release</span><span class="punctuation">:</span> <span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">int</span><span class="punctuation">,</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="punctuation">.</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">release</span>
        <span class="keyword">return</span> <span class="identifier">_release</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">pre</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">str</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">_pre</span><span class="punctuation">:</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">str</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">]</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">pre</span>
        <span class="keyword">return</span> <span class="identifier">_pre</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">post</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">int</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">post</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">post</span> <span class="keyword">else</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">dev</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">int</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">dev</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">dev</span> <span class="keyword">else</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">local</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">str</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">local</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="string-literal">"."</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">x</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">x</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_version</span><span class="punctuation">.</span><span class="identifier">local</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">public</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">str</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"+"</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">base_version</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">str</span><span class="punctuation">:</span>
        <span class="identifier">parts</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>

        <span class="comment"># Epoch</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">epoch</span> <span class="relational-operator">!=</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">f</span><span class="string-literal">"{self.epoch}!"</span><span class="grouping">)</span>

        <span class="comment"># Release segment</span>
        <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">"."</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">x</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">x</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">release</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="keyword">return</span> <span class="string-literal">""</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">parts</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">is_prerelease</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dev</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">or</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">pre</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">is_postrelease</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">post</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">is_devrelease</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">bool</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dev</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">major</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">int</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">release</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">release</span><span class="grouping">)</span> <span class="relational-operator">&gt;=</span> <span class="int-literal">1</span> <span class="keyword">else</span> <span class="int-literal">0</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">minor</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">int</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">release</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">release</span><span class="grouping">)</span> <span class="relational-operator">&gt;=</span> <span class="int-literal">2</span> <span class="keyword">else</span> <span class="int-literal">0</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">micro</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">int</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">release</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">release</span><span class="grouping">)</span> <span class="relational-operator">&gt;=</span> <span class="int-literal">3</span> <span class="keyword">else</span> <span class="int-literal">0</span>


<span class="keyword">def</span> <span class="identifier">_parse_letter_version</span><span class="grouping">(</span>
    <span class="identifier">letter</span><span class="punctuation">:</span> <span class="identifier">str</span><span class="punctuation">,</span> <span class="identifier">number</span><span class="punctuation">:</span> <span class="identifier">Union</span><span class="grouping">[</span><span class="identifier">str</span><span class="punctuation">,</span> <span class="identifier">bytes</span><span class="punctuation">,</span> <span class="identifier">SupportsInt</span><span class="grouping">]</span>
<span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">str</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">:</span>

    <span class="keyword">if</span> <span class="identifier">letter</span><span class="punctuation">:</span>
        <span class="comment"># We consider there to be an implicit 0 in a pre-release if there is</span>
        <span class="comment"># not a numeral associated with it.</span>
        <span class="keyword">if</span> <span class="identifier">number</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">number</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>

        <span class="comment"># We normalize any letters to their lower case form</span>
        <span class="identifier">letter</span> <span class="arithmetic-assignment">=</span> <span class="identifier">letter</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="comment"># We consider some words to be alternate spellings of other words and</span>
        <span class="comment"># in those cases we want to normalize the spellings to our preferred</span>
        <span class="comment"># spelling.</span>
        <span class="keyword">if</span> <span class="identifier">letter</span> <span class="relational-operator">==</span> <span class="string-literal">"alpha"</span><span class="punctuation">:</span>
            <span class="identifier">letter</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"a"</span>
        <span class="keyword">elif</span> <span class="identifier">letter</span> <span class="relational-operator">==</span> <span class="string-literal">"beta"</span><span class="punctuation">:</span>
            <span class="identifier">letter</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"b"</span>
        <span class="keyword">elif</span> <span class="identifier">letter</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">"c", "pre", "preview"</span><span class="grouping">]</span><span class="punctuation">:</span>
            <span class="identifier">letter</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"rc"</span>
        <span class="keyword">elif</span> <span class="identifier">letter</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">"rev", "r"</span><span class="grouping">]</span><span class="punctuation">:</span>
            <span class="identifier">letter</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"post"</span>

        <span class="keyword">return</span> <span class="identifier">letter</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">number</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">letter</span> <span class="logical-operator">and</span> <span class="identifier">number</span><span class="punctuation">:</span>
        <span class="comment"># We assume if we are given a number, but we are not given a letter</span>
        <span class="comment"># then this is using the implicit post release syntax (e.g. 1.0-1)</span>
        <span class="identifier">letter</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"post"</span>

        <span class="keyword">return</span> <span class="identifier">letter</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">number</span><span class="grouping">)</span>

    <span class="keyword">return</span> <span class="none-literal">None</span>


<span class="identifier">_local_version_separators</span> <span class="arithmetic-assignment">=</span> <span class="identifier">re</span><span class="punctuation">.</span><span class="identifier">compile</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">"[\._-]"</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_parse_local_version</span><span class="grouping">(</span><span class="identifier">local</span><span class="punctuation">:</span> <span class="identifier">str</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">LocalType</span><span class="grouping">]</span><span class="punctuation">:</span>
    <span class="comment">"""
    Takes a string like abc.1.twelve and turns it into ("abc", 1, "twelve").
    """</span>
    <span class="keyword">if</span> <span class="identifier">local</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">tuple</span><span class="grouping">(</span>
            <span class="identifier">part</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">part</span><span class="punctuation">.</span><span class="identifier">isdigit</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">part</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">part</span> <span class="relational-operator">in</span> <span class="identifier">_local_version_separators</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="identifier">local</span><span class="grouping">)</span>
        <span class="grouping">)</span>
    <span class="keyword">return</span> <span class="none-literal">None</span>


<span class="keyword">def</span> <span class="identifier">_cmpkey</span><span class="grouping">(</span>
    <span class="identifier">epoch</span><span class="punctuation">:</span> <span class="identifier">int</span><span class="punctuation">,</span>
    <span class="identifier">release</span><span class="punctuation">:</span> <span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">int</span><span class="punctuation">,</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="punctuation">.</span><span class="grouping">]</span><span class="punctuation">,</span>
    <span class="identifier">pre</span><span class="punctuation">:</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">str</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
    <span class="identifier">post</span><span class="punctuation">:</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">str</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
    <span class="identifier">dev</span><span class="punctuation">:</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">str</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
    <span class="identifier">local</span><span class="punctuation">:</span> <span class="identifier">Optional</span><span class="grouping">[</span><span class="identifier">Tuple</span><span class="grouping">[</span><span class="identifier">SubLocalType</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span>
<span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">CmpKey</span><span class="punctuation">:</span>

    <span class="comment"># When we compare a release version, we want to compare it with all of the</span>
    <span class="comment"># trailing zeros removed. So we'll use a reverse the list, drop all the now</span>
    <span class="comment"># leading zeros until we come to something non zero, then take the rest</span>
    <span class="comment"># re-reverse it back into the correct order and make it a tuple and use</span>
    <span class="comment"># that for our sorting key.</span>
    <span class="identifier">_release</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tuple</span><span class="grouping">(</span>
        <span class="identifier">reversed</span><span class="grouping">(</span><span class="identifier">list</span><span class="grouping">(</span><span class="identifier">itertools</span><span class="punctuation">.</span><span class="identifier">dropwhile</span><span class="grouping">(</span><span class="keyword">lambda</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="identifier">x</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">reversed</span><span class="grouping">(</span><span class="identifier">release</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="grouping">)</span>

    <span class="comment"># We need to "trick" the sorting algorithm to put 1.0.dev0 before 1.0a0.</span>
    <span class="comment"># We'll do this by abusing the pre segment, but we _only_ want to do this</span>
    <span class="comment"># if there is not a pre or a post segment. If we have one of those then</span>
    <span class="comment"># the normal sorting rules will handle this case correctly.</span>
    <span class="keyword">if</span> <span class="identifier">pre</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">post</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">dev</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">_pre</span><span class="punctuation">:</span> <span class="identifier">PrePostDevType</span> <span class="arithmetic-assignment">=</span> <span class="identifier">NegativeInfinity</span>
    <span class="comment"># Versions without a pre-release (except as noted above) should sort after</span>
    <span class="comment"># those with one.</span>
    <span class="keyword">elif</span> <span class="identifier">pre</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">_pre</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Infinity</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">_pre</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pre</span>

    <span class="comment"># Versions without a post segment should sort before those with one.</span>
    <span class="keyword">if</span> <span class="identifier">post</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">_post</span><span class="punctuation">:</span> <span class="identifier">PrePostDevType</span> <span class="arithmetic-assignment">=</span> <span class="identifier">NegativeInfinity</span>

    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">_post</span> <span class="arithmetic-assignment">=</span> <span class="identifier">post</span>

    <span class="comment"># Versions without a development segment should sort after those with one.</span>
    <span class="keyword">if</span> <span class="identifier">dev</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">_dev</span><span class="punctuation">:</span> <span class="identifier">PrePostDevType</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Infinity</span>

    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">_dev</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dev</span>

    <span class="keyword">if</span> <span class="identifier">local</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="comment"># Versions without a local segment should sort before those with one.</span>
        <span class="identifier">_local</span><span class="punctuation">:</span> <span class="identifier">LocalType</span> <span class="arithmetic-assignment">=</span> <span class="identifier">NegativeInfinity</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="comment"># Versions with a local segment need that segment parsed to implement</span>
        <span class="comment"># the sorting rules in PEP440.</span>
        <span class="comment"># - Alpha numeric segments sort before numeric segments</span>
        <span class="comment"># - Alpha numeric segments sort lexicographically</span>
        <span class="comment"># - Numeric segments sort numerically</span>
        <span class="comment"># - Shorter versions sort before longer versions when the prefixes</span>
        <span class="comment">#   match exactly</span>
        <span class="identifier">_local</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tuple</span><span class="grouping">(</span>
            <span class="grouping">(</span><span class="identifier">i</span><span class="punctuation">,</span> <span class="string-literal">""</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="grouping">(</span><span class="identifier">NegativeInfinity</span><span class="punctuation">,</span> <span class="identifier">i</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">local</span>
        <span class="grouping">)</span>

    <span class="keyword">return</span> <span class="identifier">epoch</span><span class="punctuation">,</span> <span class="identifier">_release</span><span class="punctuation">,</span> <span class="identifier">_pre</span><span class="punctuation">,</span> <span class="identifier">_post</span><span class="punctuation">,</span> <span class="identifier">_dev</span><span class="punctuation">,</span> <span class="identifier">_local</span>

    </pre>
  </body>
</html>