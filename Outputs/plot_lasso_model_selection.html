<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
===================================================
Lasso model selection: Cross-Validation / AIC / BIC
===================================================

Use the Akaike information criterion (AIC), the Bayes Information
criterion (BIC) and cross-validation to select an optimal value
of the regularization parameter alpha of the :ref:`lasso` estimator.

Results obtained with LassoLarsIC are based on AIC/BIC criteria.

Information-criterion based model selection is very fast, but it
relies on a proper estimation of degrees of freedom, are
derived for large samples (asymptotic results) and assume the model
is correct, i.e. that the data are actually generated by this model.
They also tend to break when the problem is badly conditioned
(more features than samples).

For cross-validation, we use 20-fold with 2 algorithms to compute the
Lasso path: coordinate descent, as implemented by the LassoCV class, and
Lars (least angle regression) as implemented by the LassoLarsCV class.
Both algorithms give roughly the same results. They differ with regards
to their execution speed and sources of numerical errors.

Lars computes a path solution only for each kink in the path. As a
result, it is very efficient when there are only of few kinks, which is
the case if there are few features or samples. Also, it is able to
compute the full path without setting any meta parameter. On the
opposite, coordinate descent compute the path points on a pre-specified
grid (here we use the default). Thus it is more efficient if the number
of grid points is smaller than the number of kinks in the path. Such a
strategy can be interesting if the number of features is really large
and there are enough samples to select a large amount. In terms of
numerical errors, for heavily correlated variables, Lars will accumulate
more errors, while the coordinate descent algorithm will only sample the
path on a grid.

Note how the optimal value of alpha varies for each fold. This
illustrates why nested-cross validation is necessary when trying to
evaluate the performance of a method for which a parameter is chosen by
cross-validation: this choice of parameter may not be optimal for unseen
data.
"""</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">__doc__</span><span class="grouping">)</span>

<span class="comment"># Author: Olivier Grisel, Gael Varoquaux, Alexandre Gramfort</span>
<span class="comment"># License: BSD 3 clause</span>

<span class="keyword">import</span> <span class="identifier">time</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">LassoCV</span><span class="punctuation">,</span> <span class="identifier">LassoLarsCV</span><span class="punctuation">,</span> <span class="identifier">LassoLarsIC</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span> <span class="keyword">import</span> <span class="identifier">datasets</span>

<span class="comment"># This is to avoid division by zero while doing np.log10</span>
<span class="identifier">EPSILON</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">1e-4</span>

<span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">load_diabetes</span><span class="grouping">(</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">X</span><span class="invalid">_</span><span class="invalid">y</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

<span class="identifier">rng</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">RandomState</span><span class="grouping">(</span><span class="int-literal">42</span><span class="grouping">)</span>
<span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">c_</span><span class="grouping">[</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randn</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="int-literal">14</span><span class="grouping">)</span><span class="grouping">]</span>  <span class="comment"># add some bad features</span>

<span class="comment"># normalize data as done by Lars to allow for comparison</span>
<span class="identifier">X</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sqrt</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">X</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># #############################################################################</span>
<span class="comment"># LassoLarsIC: least angle regression with BIC/AIC criterion</span>

<span class="identifier">model_bic</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LassoLarsIC</span><span class="grouping">(</span><span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">'bic'</span><span class="grouping">)</span>
<span class="identifier">t1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="punctuation">.</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">model_bic</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">t_bic</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="punctuation">.</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t1</span>
<span class="identifier">alpha_bic_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">model_bic</span><span class="punctuation">.</span><span class="identifier">alpha_</span>

<span class="identifier">model_aic</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LassoLarsIC</span><span class="grouping">(</span><span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">'aic'</span><span class="grouping">)</span>
<span class="identifier">model_aic</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">alpha_aic_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">model_aic</span><span class="punctuation">.</span><span class="identifier">alpha_</span>


<span class="keyword">def</span> <span class="identifier">plot_ic_criterion</span><span class="grouping">(</span><span class="identifier">model</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">criterion_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">criterion_</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">semilogx</span><span class="grouping">(</span><span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">alphas_</span> <span class="arithmetic-operator">+</span> <span class="identifier">EPSILON</span><span class="punctuation">,</span> <span class="identifier">criterion_</span><span class="punctuation">,</span> <span class="string-literal">'--'</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="identifier">color</span><span class="punctuation">,</span>
                 <span class="identifier">linewidth</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'%s criterion'</span> <span class="arithmetic-operator">%</span> <span class="identifier">name</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axvline</span><span class="grouping">(</span><span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">alpha_</span> <span class="arithmetic-operator">+</span> <span class="identifier">EPSILON</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="identifier">color</span><span class="punctuation">,</span> <span class="identifier">linewidth</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'alpha: %s estimate'</span> <span class="arithmetic-operator">%</span> <span class="identifier">name</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">xlabel</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">'$\alpha$'</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">ylabel</span><span class="grouping">(</span><span class="string-literal">'criterion'</span><span class="grouping">)</span>


<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">plot_ic_criterion</span><span class="grouping">(</span><span class="identifier">model_aic</span><span class="punctuation">,</span> <span class="string-literal">'AIC', 'b'</span><span class="grouping">)</span>
<span class="identifier">plot_ic_criterion</span><span class="grouping">(</span><span class="identifier">model_bic</span><span class="punctuation">,</span> <span class="string-literal">'BIC', 'r'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="string-literal">'Information-criterion for model selection (training time %.3fs)'</span>
          <span class="arithmetic-operator">%</span> <span class="identifier">t_bic</span><span class="grouping">)</span>

<span class="comment"># #############################################################################</span>
<span class="comment"># LassoCV: coordinate descent</span>

<span class="comment"># Compute paths</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing regularization path using the coordinate descent lasso..."</span><span class="grouping">)</span>
<span class="identifier">t1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="punctuation">.</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">model</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LassoCV</span><span class="grouping">(</span><span class="identifier">cv</span><span class="arithmetic-assignment">=</span><span class="int-literal">20</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">t_lasso_cv</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="punctuation">.</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t1</span>

<span class="comment"># Display results</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">ymin</span><span class="punctuation">,</span> <span class="identifier">ymax</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">2300</span><span class="punctuation">,</span> <span class="int-literal">3800</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">semilogx</span><span class="grouping">(</span><span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">alphas_</span> <span class="arithmetic-operator">+</span> <span class="identifier">EPSILON</span><span class="punctuation">,</span> <span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">mse_path_</span><span class="punctuation">,</span> <span class="string-literal">':'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">alphas_</span> <span class="arithmetic-operator">+</span> <span class="identifier">EPSILON</span><span class="punctuation">,</span> <span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">mse_path_</span><span class="punctuation">.</span><span class="identifier">mean</span><span class="grouping">(</span><span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">'k'</span><span class="punctuation">,</span>
         <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Average across the folds'</span><span class="punctuation">,</span> <span class="identifier">linewidth</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axvline</span><span class="grouping">(</span><span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">alpha_</span> <span class="arithmetic-operator">+</span> <span class="identifier">EPSILON</span><span class="punctuation">,</span> <span class="identifier">linestyle</span><span class="arithmetic-assignment">=</span><span class="string-literal">'--', color='k'</span><span class="punctuation">,</span>
            <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'alpha: CV estimate'</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">xlabel</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">'$\alpha$'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">ylabel</span><span class="grouping">(</span><span class="string-literal">'Mean square error'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="string-literal">'Mean square error on each fold: coordinate descent '</span>
          <span class="string-literal">'(train time: %.2fs)'</span> <span class="arithmetic-operator">%</span> <span class="identifier">t_lasso_cv</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axis</span><span class="grouping">(</span><span class="string-literal">'tight'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">ylim</span><span class="grouping">(</span><span class="identifier">ymin</span><span class="punctuation">,</span> <span class="identifier">ymax</span><span class="grouping">)</span>

<span class="comment"># #############################################################################</span>
<span class="comment"># LassoLarsCV: least angle regression</span>

<span class="comment"># Compute paths</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing regularization path using the Lars lasso..."</span><span class="grouping">)</span>
<span class="identifier">t1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="punctuation">.</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">model</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LassoLarsCV</span><span class="grouping">(</span><span class="identifier">cv</span><span class="arithmetic-assignment">=</span><span class="int-literal">20</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">t_lasso_lars_cv</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="punctuation">.</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t1</span>

<span class="comment"># Display results</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">semilogx</span><span class="grouping">(</span><span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">cv_alphas_</span> <span class="arithmetic-operator">+</span> <span class="identifier">EPSILON</span><span class="punctuation">,</span> <span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">mse_path_</span><span class="punctuation">,</span> <span class="string-literal">':'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">semilogx</span><span class="grouping">(</span><span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">cv_alphas_</span> <span class="arithmetic-operator">+</span> <span class="identifier">EPSILON</span><span class="punctuation">,</span> <span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">mse_path_</span><span class="punctuation">.</span><span class="identifier">mean</span><span class="grouping">(</span><span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">'k'</span><span class="punctuation">,</span>
             <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Average across the folds'</span><span class="punctuation">,</span> <span class="identifier">linewidth</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axvline</span><span class="grouping">(</span><span class="identifier">model</span><span class="punctuation">.</span><span class="identifier">alpha_</span><span class="punctuation">,</span> <span class="identifier">linestyle</span><span class="arithmetic-assignment">=</span><span class="string-literal">'--', color='k'</span><span class="punctuation">,</span>
            <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'alpha CV'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">xlabel</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">'$\alpha$'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">ylabel</span><span class="grouping">(</span><span class="string-literal">'Mean square error'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="string-literal">'Mean square error on each fold: Lars (train time: %.2fs)'</span>
          <span class="arithmetic-operator">%</span> <span class="identifier">t_lasso_lars_cv</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axis</span><span class="grouping">(</span><span class="string-literal">'tight'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">ylim</span><span class="grouping">(</span><span class="identifier">ymin</span><span class="punctuation">,</span> <span class="identifier">ymax</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>