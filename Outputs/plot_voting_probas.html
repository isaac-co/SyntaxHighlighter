<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
===========================================================
Plot class probabilities calculated by the VotingClassifier
===========================================================

.. currentmodule:: sklearn

Plot the class probabilities of the first sample in a toy dataset predicted by
three different classifiers and averaged by the
:class:`~ensemble.VotingClassifier`.

First, three examplary classifiers are initialized
(:class:`~linear_model.LogisticRegression`, :class:`~naive_bayes.GaussianNB`,
and :class:`~ensemble.RandomForestClassifier`) and used to initialize a
soft-voting :class:`~ensemble.VotingClassifier` with weights `[1, 1, 5]`, which
means that the predicted probabilities of the
:class:`~ensemble.RandomForestClassifier` count 5 times as much as the weights
of the other classifiers when the averaged probability is calculated.

To visualize the probability weighting, we fit each classifier on the training
set and plot the predicted class probabilities for the first sample in this
example dataset.

"""</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">__doc__</span><span class="grouping">)</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">LogisticRegression</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">naive_bayes</span> <span class="keyword">import</span> <span class="identifier">GaussianNB</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">RandomForestClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">VotingClassifier</span>

<span class="identifier">clf1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LogisticRegression</span><span class="grouping">(</span><span class="identifier">max_iter</span><span class="arithmetic-assignment">=</span><span class="int-literal">1000</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">123</span><span class="grouping">)</span>
<span class="identifier">clf2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RandomForestClassifier</span><span class="grouping">(</span><span class="identifier">n_estimators</span><span class="arithmetic-assignment">=</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">123</span><span class="grouping">)</span>
<span class="identifier">clf3</span> <span class="arithmetic-assignment">=</span> <span class="identifier">GaussianNB</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="float-literal">-1.0</span><span class="punctuation">,</span> <span class="float-literal">-1.0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="float-literal">-1.2</span><span class="punctuation">,</span> <span class="float-literal">-1.4</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="float-literal">-3.4</span><span class="punctuation">,</span> <span class="float-literal">-2.2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="float-literal">1.1</span><span class="punctuation">,</span> <span class="float-literal">1.2</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">)</span>

<span class="identifier">eclf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">VotingClassifier</span><span class="grouping">(</span><span class="identifier">estimators</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="grouping">(</span><span class="string-literal">'lr', clf1), ('rf', clf2), ('gnb'</span><span class="punctuation">,</span> <span class="identifier">clf3</span><span class="grouping">)</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="identifier">voting</span><span class="arithmetic-assignment">=</span><span class="string-literal">'soft'</span><span class="punctuation">,</span>
                        <span class="identifier">weights</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">)</span>

<span class="comment"># predict class probabilities for all classifiers</span>
<span class="identifier">probas</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">c</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">predict_proba</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">c</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="identifier">clf1</span><span class="punctuation">,</span> <span class="identifier">clf2</span><span class="punctuation">,</span> <span class="identifier">clf3</span><span class="punctuation">,</span> <span class="identifier">eclf</span><span class="grouping">)</span><span class="grouping">]</span>

<span class="comment"># get class probabilities for the first sample in the dataset</span>
<span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="int-literal">1</span><span class="invalid">_</span><span class="int-literal">1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">pr</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">pr</span> <span class="relational-operator">in</span> <span class="identifier">probas</span><span class="grouping">]</span>
<span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="int-literal">2</span><span class="invalid">_</span><span class="int-literal">1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">pr</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">pr</span> <span class="relational-operator">in</span> <span class="identifier">probas</span><span class="grouping">]</span>


<span class="comment"># plotting</span>

<span class="identifier">N</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">4</span>  <span class="comment"># number of groups</span>
<span class="identifier">ind</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="identifier">N</span><span class="grouping">)</span>  <span class="comment"># group positions</span>
<span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.35</span>  <span class="comment"># bar width</span>

<span class="identifier">fig</span><span class="punctuation">,</span> <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplots</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="comment"># bars for classifier 1-3</span>
<span class="identifier">p1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">hstack</span><span class="grouping">(</span><span class="grouping">(</span><span class="grouping">[</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="int-literal">1</span><span class="invalid">_</span><span class="int-literal">1</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span>
            <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'green', edgecolor='k'</span><span class="grouping">)</span>
<span class="identifier">p2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">hstack</span><span class="grouping">(</span><span class="grouping">(</span><span class="grouping">[</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="int-literal">2</span><span class="invalid">_</span><span class="int-literal">1</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span>
            <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'lightgreen', edgecolor='k'</span><span class="grouping">)</span>

<span class="comment"># bars for VotingClassifier</span>
<span class="identifier">p3</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="int-literal">1</span><span class="invalid">_</span><span class="int-literal">1</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span>
            <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'blue', edgecolor='k'</span><span class="grouping">)</span>
<span class="identifier">p4</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="int-literal">2</span><span class="invalid">_</span><span class="int-literal">1</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span>
            <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'steelblue', edgecolor='k'</span><span class="grouping">)</span>

<span class="comment"># plot annotations</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axvline</span><span class="grouping">(</span><span class="float-literal">2.8</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'k', linestyle='dashed'</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xticks</span><span class="grouping">(</span><span class="identifier">ind</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xticklabels</span><span class="grouping">(</span><span class="grouping">[</span><span class="string-literal">'LogisticRegression\nweight 1'</span><span class="punctuation">,</span>
                    <span class="string-literal">'GaussianNB\nweight 1'</span><span class="punctuation">,</span>
                    <span class="string-literal">'RandomForestClassifier\nweight 5'</span><span class="punctuation">,</span>
                    <span class="string-literal">'VotingClassifier\n(average probabilities)'</span><span class="grouping">]</span><span class="punctuation">,</span>
                   <span class="identifier">rotation</span><span class="arithmetic-assignment">=</span><span class="int-literal">40</span><span class="punctuation">,</span>
                   <span class="identifier">ha</span><span class="arithmetic-assignment">=</span><span class="string-literal">'right'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">ylim</span><span class="grouping">(</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="string-literal">'Class probabilities for sample 1 by different classifiers'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">p1</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">p2</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="string-literal">'class 1', 'class 2'], loc='upper left'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">tight_layout</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>