<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">#!/usr/bin/env python3</span>
<span class="comment">""" Handling of Faceswap GUI Projects, Tasks and Last Session """</span>

<span class="keyword">import</span> <span class="identifier">logging</span>
<span class="keyword">import</span> <span class="identifier">os</span>
<span class="keyword">import</span> <span class="identifier">tkinter</span> <span class="keyword">as</span> <span class="identifier">tk</span>
<span class="keyword">from</span> <span class="identifier">tkinter</span> <span class="keyword">import</span> <span class="identifier">messagebox</span>

<span class="keyword">from</span> <span class="identifier">lib</span><span class="punctuation">.</span><span class="identifier">serializer</span> <span class="keyword">import</span> <span class="identifier">get_serializer</span>

<span class="identifier">logger</span> <span class="arithmetic-assignment">=</span> <span class="identifier">logging</span><span class="punctuation">.</span><span class="identifier">getLogger</span><span class="grouping">(</span><span class="identifier">__name__</span><span class="grouping">)</span>  <span class="comment"># pylint: disable=invalid-name</span>


<span class="keyword">class</span> <span class="identifier">_GuiSession</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=too-few-public-methods</span>
    <span class="comment">""" Parent class for GUI Session Handlers.

    Parameters
    ----------
    config: :class:`lib.gui.utils.Config`
        The master GUI config
    file_handler: :class:`lib.gui.utils.FileHandler`
        A file handler object

    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">config</span><span class="punctuation">,</span> <span class="identifier">file_handler</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># NB file_handler has to be passed in to avoid circular imports</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing: %s: (config: %s, file_handler: %s)"</span><span class="punctuation">,</span>
                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">config</span><span class="punctuation">,</span> <span class="identifier">file_handler</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_serializer</span><span class="grouping">(</span><span class="string-literal">"json"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span> <span class="arithmetic-assignment">=</span> <span class="identifier">config</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_file_handler</span> <span class="arithmetic-assignment">=</span> <span class="identifier">file_handler</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_saved_tasks</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_modified</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized: %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_active_tab</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: The name of the currently selected :class:`lib.gui.command.CommandNotebook`
        tab. """</span>
        <span class="identifier">notebook</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">command_notebook</span>
        <span class="identifier">toolsbook</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">tools_notebook</span>
        <span class="identifier">command</span> <span class="arithmetic-assignment">=</span> <span class="identifier">notebook</span><span class="punctuation">.</span><span class="identifier">tab</span><span class="grouping">(</span><span class="identifier">notebook</span><span class="punctuation">.</span><span class="identifier">select</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">"text"</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">command</span> <span class="relational-operator">==</span> <span class="string-literal">"tools"</span><span class="punctuation">:</span>
            <span class="identifier">command</span> <span class="arithmetic-assignment">=</span> <span class="identifier">toolsbook</span><span class="punctuation">.</span><span class="identifier">tab</span><span class="grouping">(</span><span class="identifier">toolsbook</span><span class="punctuation">.</span><span class="identifier">select</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">"text"</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Active tab: %s"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">command</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_modified_vars</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" dict: The tkinter Boolean vars indicating the modified state for each tab. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">modified_vars</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_file_exists</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" bool: ``True`` if :attr:`_filename` exists otherwise ``False``. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">isfile</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_cli_options</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" dict: the raw cli options from :attr:`_options` with project fields removed. """</span>
        <span class="keyword">return</span> <span class="grouping">{</span><span class="identifier">key</span><span class="punctuation">:</span> <span class="identifier">val</span> <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">val</span><span class="punctuation">,</span> <span class="identifier">dict</span><span class="grouping">)</span><span class="grouping">}</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_default_options</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" dict: The default options for all tabs """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">o</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">s</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_dirname</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: The folder name that :attr:`_filename` resides in. Returns ``None`` if
        filename is ``None``. """</span>
        <span class="keyword">return</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_basename</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: The base name of :attr:`_filename`. Returns ``None`` if filename is ``None``. """</span>
        <span class="keyword">return</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">basename</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="none-literal">None</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_stored_tab_name</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""str: The tab_name stored in :attr:`_options` or ``None`` if it does not exist """</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="none-literal">None</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"tab_name"</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_selected_to_choices</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" dict: The selected value and valid choices for multi-option, radio or combo options.
        """</span>
        <span class="identifier">valid_choices</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">cmd</span><span class="punctuation">:</span> <span class="grouping">{</span><span class="identifier">opt</span><span class="punctuation">:</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">choices</span><span class="arithmetic-assignment">=</span><span class="identifier">val</span><span class="grouping">[</span><span class="string-literal">"cpanel_option"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">choices</span><span class="punctuation">,</span>
                                         <span class="identifier">is_multi</span><span class="arithmetic-assignment">=</span><span class="identifier">val</span><span class="grouping">[</span><span class="string-literal">"cpanel_option"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">is_multi_option</span><span class="grouping">)</span>
                               <span class="keyword">for</span> <span class="identifier">opt</span><span class="punctuation">,</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span>
                               <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">val</span><span class="punctuation">,</span> <span class="identifier">dict</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="string-literal">"cpanel_option"</span> <span class="relational-operator">in</span> <span class="identifier">val</span>
                               <span class="logical-operator">and</span> <span class="identifier">val</span><span class="grouping">[</span><span class="string-literal">"cpanel_option"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">choices</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="grouping">}</span>
                         <span class="keyword">for</span> <span class="identifier">cmd</span><span class="punctuation">,</span> <span class="identifier">data</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">cli_opts</span><span class="punctuation">.</span><span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">}</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"valid_choices: %s"</span><span class="punctuation">,</span> <span class="identifier">valid_choices</span><span class="grouping">)</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">command</span><span class="punctuation">:</span> <span class="grouping">{</span><span class="identifier">option</span><span class="punctuation">:</span> <span class="grouping">{</span><span class="string-literal">"value"</span><span class="punctuation">:</span> <span class="identifier">value</span><span class="punctuation">,</span>
                                     <span class="string-literal">"is_multi": valid_choices[command][option]["is_multi"</span><span class="grouping">]</span><span class="punctuation">,</span>
                                     <span class="string-literal">"choices":  valid_choices[command][option]["choices"</span><span class="grouping">]</span><span class="grouping">}</span>
                            <span class="keyword">for</span> <span class="identifier">option</span><span class="punctuation">,</span> <span class="identifier">value</span> <span class="relational-operator">in</span> <span class="identifier">options</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span>
                            <span class="keyword">if</span> <span class="identifier">value</span> <span class="logical-operator">and</span> <span class="identifier">command</span> <span class="relational-operator">in</span> <span class="identifier">valid_choices</span>
                            <span class="logical-operator">and</span> <span class="identifier">option</span> <span class="relational-operator">in</span> <span class="identifier">valid_choices</span><span class="grouping">[</span><span class="identifier">command</span><span class="grouping">]</span><span class="grouping">}</span>
                  <span class="keyword">for</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">options</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span>
                  <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">options</span><span class="punctuation">,</span> <span class="identifier">dict</span><span class="grouping">)</span><span class="grouping">}</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"returning: %s"</span><span class="punctuation">,</span> <span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="keyword">def</span> <span class="identifier">_current_gui_state</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" The current state of the GUI.

        Parameters
        ----------
        command: str, optional
        If provided, returns the state of just the given tab command. If ``None`` returns options
        for all tabs. Default ``None``

        Returns
        -------
        dict: The options currently set in the GUI
        """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">cli_opts</span><span class="punctuation">.</span><span class="identifier">get_option_values</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_set_filename</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">sess_type</span><span class="arithmetic-assignment">=</span><span class="string-literal">"project"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the :attr:`_filename` attribute.

        :attr:`_filename` is set either from a given filename or the result from
        a :attr:`_file_handler`.

        Parameters
        ----------
        filename: str, optional
            An optional filename. If given then this filename will be used otherwise it will be
            collected by a :attr:`_file_handler`

        sess_type: {all, project, task}, optional
            The session type that the filename is being set for. Dictates the type of file handler
            that is opened.

        Returns
        -------
        bool: `True` if filename has been successfully set otherwise ``False``
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"filename: '%s', sess_type: '%s'"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">sess_type</span><span class="grouping">)</span>
        <span class="identifier">handler</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"config_{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">sess_type</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">filename</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Popping file handler"</span><span class="grouping">)</span>
            <span class="identifier">cfgfile</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_file_handler</span><span class="grouping">(</span><span class="string-literal">"open"</span><span class="punctuation">,</span> <span class="identifier">handler</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">i</span><span class="invalid">l</span><span class="invalid">e</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">cfgfile</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No filename given"</span><span class="grouping">)</span>
                <span class="keyword">return</span> <span class="bool-literal">False</span>
            <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cfgfile</span><span class="punctuation">.</span><span class="identifier">name</span>
            <span class="identifier">cfgfile</span><span class="punctuation">.</span><span class="identifier">close</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">isfile</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"File does not exist: '{}'"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">error</span><span class="grouping">(</span><span class="identifier">msg</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="bool-literal">False</span>
        <span class="identifier">ext</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">splitext</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">sess_type</span> <span class="relational-operator">==</span> <span class="string-literal">"project" and ext != ".fsw") or (sess_type == "task" and ext != ".fst"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Invalid file extension for session type: (sess_type: '%s', "</span>
                         <span class="string-literal">"extension: '%s')"</span><span class="punctuation">,</span> <span class="identifier">sess_type</span><span class="punctuation">,</span> <span class="identifier">ext</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="bool-literal">False</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Setting filename: '%s'"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">filename</span>
        <span class="keyword">return</span> <span class="bool-literal">True</span>

    <span class="comment"># GUI STATE SETTING</span>
    <span class="keyword">def</span> <span class="identifier">_set_options</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the GUI options based on the currently stored properties of :attr:`_options`
        and sets the active tab.

        Parameters
        ----------
        command: str, optional
            The tab to set the options for. If None then sets options for all tabs.
            Default: ``None``
        """</span>
        <span class="identifier">opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_get_options_for_command</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">command</span> <span class="keyword">else</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cli_options</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"command: %s, opts: %s"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">opts</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">opts</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No options found. Returning"</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="keyword">for</span> <span class="identifier">cmd</span><span class="punctuation">,</span> <span class="identifier">opt</span> <span class="relational-operator">in</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_gui_state_for_command</span><span class="grouping">(</span><span class="identifier">cmd</span><span class="punctuation">,</span> <span class="identifier">opt</span><span class="grouping">)</span>
        <span class="identifier">tab_name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"tab_name"</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">command</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="identifier">command</span>
        <span class="identifier">tab_name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tab_name</span> <span class="keyword">if</span> <span class="identifier">tab_name</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="string-literal">"extract"</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"tab_name: %s"</span><span class="punctuation">,</span> <span class="identifier">tab_name</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">set_active_tab_by_name</span><span class="grouping">(</span><span class="identifier">tab_name</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_get_options_for_command</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Return a single command's options from :attr:`_options` formatted consistently with
        an all options dict.

        Parameters
        ----------
        command: str
            The command to return the options for

        Returns
        -------
        dict: The options for a single command in the format {command: options}. If the command
        is not found then returns ``None``
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="identifier">opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="identifier">command</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">command</span><span class="punctuation">:</span> <span class="identifier">opts</span><span class="grouping">}</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">opts</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">tk_vars</span><span class="grouping">[</span><span class="string-literal">"console_clear"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="bool-literal">True</span><span class="grouping">)</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"No  %s section found in file"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="grouping">)</span>
            <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="keyword">def</span> <span class="identifier">_set_gui_state_for_command</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">options</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the GUI state for the given command.

        Parameters
        ----------
        command: str
            The tab to set the options for
        options: dict
            The option values to set the GUI to
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"command: %s: options: %s"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">options</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">options</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No options provided, not updating GUI"</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="keyword">for</span> <span class="identifier">srcopt</span><span class="punctuation">,</span> <span class="identifier">srcval</span> <span class="relational-operator">in</span> <span class="identifier">options</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">optvar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">cli_opts</span><span class="punctuation">.</span><span class="identifier">get_one_option_variable</span><span class="grouping">(</span><span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">srcopt</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">optvar</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"setting option: (srcopt: %s, optvar: %s, srcval: %s)"</span><span class="punctuation">,</span>
                         <span class="identifier">srcopt</span><span class="punctuation">,</span> <span class="identifier">optvar</span><span class="punctuation">,</span> <span class="identifier">srcval</span><span class="grouping">)</span>
            <span class="identifier">optvar</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">srcval</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_reset_modified_var</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Reset :attr:`_modified_vars` variables back to unmodified (`False`) for all
        commands or for the given command.

        Parameters
        ----------
        command: str, optional
            The command to reset the modified tkinter variable for. If ``None`` then all tkinter
            modified variables are reset to `False`. Default: ``None``
        """</span>
        <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">tk_var</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_modified_vars</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">command</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">or</span> <span class="identifier">command</span> <span class="relational-operator">==</span> <span class="identifier">key</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="identifier">tk_var</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Reset modified state for: %s"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="grouping">)</span>
                <span class="identifier">tk_var</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="bool-literal">False</span><span class="grouping">)</span>

    <span class="comment"># RECENT FILE HANDLING</span>
    <span class="keyword">def</span> <span class="identifier">_add_to_recent</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Add the file for this session to the recent files list.

        Parameters
        ----------
        command: str, optional
            The command that this session relates to. If `None` then the whole project is added.
            Default: ``None``
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No filename for selected file. Not adding to recent."</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="identifier">recent_filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">pathcache</span><span class="punctuation">,</span> <span class="string-literal">".recent.json"</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Adding to recent files '%s': (%s, %s)"</span><span class="punctuation">,</span>
                     <span class="identifier">recent_filename</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">recent_filename</span><span class="grouping">)</span> <span class="logical-operator">or</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">getsize</span><span class="grouping">(</span><span class="identifier">recent_filename</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Starting with empty recent_files list"</span><span class="grouping">)</span>
            <span class="identifier">recent_files</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"loading recent_files list: %s"</span><span class="punctuation">,</span> <span class="identifier">recent_filename</span><span class="grouping">)</span>
            <span class="identifier">recent_files</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">recent_filename</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initial recent files: %s"</span><span class="punctuation">,</span> <span class="identifier">recent_files</span><span class="grouping">)</span>
        <span class="identifier">recent_files</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_del_from_recent</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">recent_files</span><span class="grouping">)</span>
        <span class="identifier">ftype</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"project"</span> <span class="keyword">if</span> <span class="identifier">command</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="identifier">command</span>
        <span class="identifier">recent_files</span><span class="punctuation">.</span><span class="identifier">insert</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">ftype</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">recent_files</span> <span class="arithmetic-assignment">=</span> <span class="identifier">recent_files</span><span class="grouping">[</span><span class="punctuation">:</span><span class="int-literal">20</span><span class="grouping">]</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Final recent files: %s"</span><span class="punctuation">,</span> <span class="identifier">recent_files</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">(</span><span class="identifier">recent_filename</span><span class="punctuation">,</span> <span class="identifier">recent_files</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_del_from_recent</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">recent_files</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">save</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Remove an item from the recent files list.

        Parameters
        ----------
        filename: str
            The filename to be removed from the recent files list
        recent_files: list, optional
            If the recent files list has already been loaded, it can be passed in to avoid
            loading again. If ``None`` then load the recent files list from disk. Default: ``None``
        save: bool, optional
            Whether the recent files list should be saved after removing the file. ``True`` saves
            the file, ``False`` does not. Default: ``False``
        """</span>
        <span class="identifier">recent_filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">pathcache</span><span class="punctuation">,</span> <span class="string-literal">".recent.json"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">recent_files</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Loading file list from disk: %s"</span><span class="punctuation">,</span> <span class="identifier">recent_filename</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">recent_filename</span><span class="grouping">)</span> <span class="logical-operator">or</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">getsize</span><span class="grouping">(</span><span class="identifier">recent_filename</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No recent file list"</span><span class="grouping">)</span>
                <span class="keyword">return</span> <span class="none-literal">None</span>
            <span class="identifier">recent_files</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">recent_filename</span><span class="grouping">)</span>
        <span class="identifier">filenames</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">recent</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">recent</span> <span class="relational-operator">in</span> <span class="identifier">recent_files</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">filename</span> <span class="relational-operator">in</span> <span class="identifier">filenames</span><span class="punctuation">:</span>
            <span class="identifier">idx</span> <span class="arithmetic-assignment">=</span> <span class="identifier">filenames</span><span class="punctuation">.</span><span class="identifier">index</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Removing from recent file list: %s"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
            <span class="keyword">del</span> <span class="identifier">recent_files</span><span class="grouping">[</span><span class="identifier">idx</span><span class="grouping">]</span>
            <span class="keyword">if</span> <span class="identifier">save</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Saving recent files list: %s"</span><span class="punctuation">,</span> <span class="identifier">recent_filename</span><span class="grouping">)</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">(</span><span class="identifier">recent_filename</span><span class="punctuation">,</span> <span class="identifier">recent_files</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Filename '%s' does not appear in recent file list"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">recent_files</span>

    <span class="keyword">def</span> <span class="identifier">_get_lone_task</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Get the sole command name from :attr:`_options`.

        Returns
        -------
        str: The only existing command name in the current :attr:`_options` dict or ``None`` if
        there are multiple commands stored.
        """</span>
        <span class="identifier">command</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cli_options</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="identifier">command</span> <span class="arithmetic-assignment">=</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cli_options</span><span class="punctuation">.</span><span class="identifier">keys</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">command</span>

    <span class="comment"># DISK IO</span>
    <span class="keyword">def</span> <span class="identifier">_load</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Load GUI options from :attr:`_filename` location and set to :attr:`_options`.

        Returns
        -------
        bool: ``True`` if successfully loaded otherwise ``False``
        """</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_file_exists</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Loading config"</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_check_valid_choices</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"File doesn't exist. Aborting"</span><span class="grouping">)</span>
            <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="keyword">def</span> <span class="identifier">_check_valid_choices</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Check whether the loaded file has any selected combo/radio/multi-option values that are
        no longer valid and remove them so that they are not passed into faceswap. """</span>
        <span class="keyword">for</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">options</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_selected_to_choices</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">for</span> <span class="identifier">option</span><span class="punctuation">,</span> <span class="identifier">data</span> <span class="relational-operator">in</span> <span class="identifier">options</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">if</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">data</span><span class="grouping">[</span><span class="string-literal">"is_multi"] and all(v in data["choices"] for v in data["value"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
                        <span class="logical-operator">or</span> <span class="logical-operator">not</span> <span class="identifier">data</span><span class="grouping">[</span><span class="string-literal">"is_multi"] and data["value"] in data["choices"</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
                    <span class="keyword">continue</span>
                <span class="keyword">if</span> <span class="identifier">data</span><span class="grouping">[</span><span class="string-literal">"is_multi"</span><span class="grouping">]</span><span class="punctuation">:</span>
                    <span class="identifier">val</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">" ".join([v for v in data["value"].split() if v in data["choices"</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span>
                <span class="keyword">else</span><span class="punctuation">:</span>
                    <span class="identifier">val</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">""</span>
                <span class="identifier">val</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_default_options</span><span class="grouping">[</span><span class="identifier">command</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">option</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">val</span> <span class="keyword">else</span> <span class="identifier">val</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Updating invalid value to default: (command: '%s', option: '%s', "</span>
                             <span class="string-literal">"original value: '%s', new value: '%s')"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">option</span><span class="punctuation">,</span>
                             <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="grouping">[</span><span class="identifier">command</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">option</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">val</span><span class="grouping">)</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="grouping">[</span><span class="identifier">command</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">option</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">val</span>

    <span class="keyword">def</span> <span class="identifier">_save_as_to_filename</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">session_type</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set :attr:`_filename` from a save as dialog.

        Parameters
        ----------
        session_type: ['all', 'task', 'project']
            The type of session to pop the save as dialog for. Limits the allowed filetypes

        Returns
        -------
        bool:
            True if :attr:`filename` successfully set otherwise ``False``
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Popping save as file handler. session_type: '%s'"</span><span class="punctuation">,</span> <span class="identifier">session_type</span><span class="grouping">)</span>
        <span class="identifier">title</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"Save {}As...".format("{} "</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">session_type</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
                                      <span class="keyword">if</span> <span class="identifier">session_type</span> <span class="relational-operator">!=</span> <span class="string-literal">"all" else ""</span><span class="grouping">)</span>
        <span class="identifier">cfgfile</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_file_handler</span><span class="grouping">(</span><span class="string-literal">"save"</span><span class="punctuation">,</span>
                                     <span class="string-literal">"config_{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">session_type</span><span class="grouping">)</span><span class="punctuation">,</span>
                                     <span class="identifier">title</span><span class="arithmetic-assignment">=</span><span class="identifier">title</span><span class="punctuation">,</span>
                                     <span class="identifier">initial_folder</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_dirname</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">i</span><span class="invalid">l</span><span class="invalid">e</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">cfgfile</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No filename provided. session_type: '%s'"</span><span class="punctuation">,</span> <span class="identifier">session_type</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="bool-literal">False</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cfgfile</span><span class="punctuation">.</span><span class="identifier">name</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Set filename: (session_type: '%s', filename: '%s'"</span><span class="punctuation">,</span>
                     <span class="identifier">session_type</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>
        <span class="identifier">cfgfile</span><span class="punctuation">.</span><span class="identifier">close</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="bool-literal">True</span>

    <span class="keyword">def</span> <span class="identifier">_save</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Collect the options in the current GUI state and save.

        Obtains the current options set in the GUI with the selected tab and applies them to
        :attr:`_options`. Saves :attr:`_options` to :attr:`_filename`. Resets :attr:_modified_vars
        for either the given command or all commands,

        Parameters
        ----------
        command: str, optional
            The tab to collect the current state for. If ``None`` then collects the current
            state for all tabs. Default: ``None``
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_current_gui_state</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="grouping">[</span><span class="string-literal">"tab_name"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_active_tab</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Saving options: (filename: %s, options: %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_reset_modified_var</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_add_to_recent</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">Tasks</span><span class="grouping">(</span><span class="identifier">_GuiSession</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">""" Faceswap ``.fst`` Task File handling.

    Faceswap tasks handle the management of each individual task tab in the GUI. Unlike
    :class:`Projects`, Tasks contains all the active tasks currently running, rather than an
    individual task.

    Parameters
    ----------
    config: :class:`lib.gui.utils.Config`
        The master GUI config
    file_handler: :class:`lib.gui.utils.FileHandler`
        A file handler object
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">config</span><span class="punctuation">,</span> <span class="identifier">file_handler</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">config</span><span class="punctuation">,</span> <span class="identifier">file_handler</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_is_project</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: ``True`` if all tasks are from an overarching session project else ``False``."""</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span> <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span> <span class="keyword">else</span> <span class="identifier">all</span><span class="grouping">(</span><span class="identifier">v</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"is_project"</span><span class="punctuation">,</span> <span class="bool-literal">False</span><span class="grouping">)</span>
                                                   <span class="keyword">for</span> <span class="identifier">v</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span><span class="punctuation">.</span><span class="identifier">values</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_project_filename</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: The overarching session project filename."""</span>
        <span class="identifier">fname</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_is_project</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">fname</span>

        <span class="keyword">for</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span><span class="punctuation">.</span><span class="identifier">values</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">fname</span> <span class="arithmetic-assignment">=</span> <span class="identifier">val</span><span class="grouping">[</span><span class="string-literal">"filename"</span><span class="grouping">]</span>
            <span class="keyword">break</span>
        <span class="keyword">return</span> <span class="identifier">fname</span>

    <span class="keyword">def</span> <span class="identifier">load</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span>  <span class="comment"># pylint:disable=unused-argument</span>
             <span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">current_tab</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Load a task into this :class:`Tasks` class.

        Tasks can be loaded from project ``.fsw`` files or task ``.fst`` files, depending on where
        this function is being called from.

        Parameters
        ----------
        *args: tuple
            Unused, but needs to be present for arguments passed by tkinter event handling
        filename: str, optional
            If a filename is passed in, This will be used, otherwise a file handler will be
            launched to select the relevant file.
        current_tab: bool, optional
            ``True`` if the task to be loaded must be for the currently selected tab. ``False``
            if loading a task into any tab. If current_tab is `True` then tasks can be loaded from
            ``.fsw`` and ``.fst`` files, otherwise they can only be loaded from ``.fst`` files.
            Default: ``True``
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Loading task config: (filename: '%s', current_tab: '%s')"</span><span class="punctuation">,</span>
                     <span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">current_tab</span><span class="grouping">)</span>

        <span class="comment"># Option to load specific task from project files:</span>
        <span class="identifier">sess_type</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"all" if current_tab else "task"</span>

        <span class="identifier">is_legacy</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_is_project</span> <span class="logical-operator">and</span>
                     <span class="identifier">filename</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">sess_type</span> <span class="relational-operator">==</span> <span class="string-literal">"task"</span> <span class="logical-operator">and</span>
                     <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">splitext</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="string-literal">".fsw"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">is_legacy</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Legacy task found: '%s'"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
            <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_legacy_task</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span>

        <span class="identifier">filename_set</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_filename</span><span class="grouping">(</span><span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">sess_type</span><span class="arithmetic-assignment">=</span><span class="identifier">sess_type</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">filename_set</span><span class="punctuation">:</span>
            <span class="keyword">return</span>
        <span class="identifier">loaded</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_load</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">loaded</span><span class="punctuation">:</span>
            <span class="keyword">return</span>

        <span class="identifier">command</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_active_tab</span> <span class="keyword">if</span> <span class="identifier">current_tab</span> <span class="keyword">else</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_stored_tab_name</span>
        <span class="identifier">command</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_get_lone_task</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">command</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="identifier">command</span>
        <span class="keyword">if</span> <span class="identifier">command</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">error</span><span class="grouping">(</span><span class="string-literal">"Unable to determine task from the given file: '%s'"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="keyword">if</span> <span class="identifier">command</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">error</span><span class="grouping">(</span><span class="string-literal">"No '%s' task in '%s'"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>
            <span class="keyword">return</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_options</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_add_to_recent</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_is_project</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_project_filename</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">.</span><span class="identifier">endswith</span><span class="grouping">(</span><span class="string-literal">".fsw"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_add_task</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">is_legacy</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Loaded task config: (command: '%s', filename: '%s')"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_update_legacy_task</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Update legacy ``.fsw`` tasks to ``.fst`` tasks.

        Tasks loaded from the recent files menu may be passed in with a ``.fsw`` extension.
        This renames the file and removes it from the recent file list.

        Parameters
        ----------
        filename: str
            The filename of the `.fsw` file that needs converting

        Returns
        -------
        str:
            The new filename of the updated tasks file
        """</span>
        <span class="comment"># TODO remove this code after a period of time. Implemented November 2019</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"original filename: '%s'"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
        <span class="identifier">fname</span><span class="punctuation">,</span> <span class="identifier">ext</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">splitext</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">ext</span> <span class="relational-operator">!=</span> <span class="string-literal">".fsw"</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Not a .fsw file: '%s'"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">filename</span>

        <span class="identifier">new_filename</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{}.fst"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">fname</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Renaming '%s' to '%s'"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">new_filename</span><span class="grouping">)</span>
        <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">rename</span><span class="grouping">(</span><span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">new_filename</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_del_from_recent</span><span class="grouping">(</span><span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">save</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"new filename: '%s'"</span><span class="punctuation">,</span> <span class="identifier">new_filename</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">new_filename</span>

    <span class="keyword">def</span> <span class="identifier">save</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">save_as</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Save the current GUI state for the active tab to a ``.fst`` faceswap task file.

        Parameters
        ----------
        save_as: bool, optional
            Whether to save to the stored filename, or pop open a file handler to ask for a
            location. If there is no stored filename, then a file handler will automatically be
            popped.
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Saving config..."</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_active_task</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">save_as</span> <span class="arithmetic-assignment">=</span> <span class="identifier">save_as</span> <span class="logical-operator">or</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_is_project</span> <span class="logical-operator">or</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>

        <span class="keyword">if</span> <span class="identifier">save_as</span> <span class="logical-operator">and</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_save_as_to_filename</span><span class="grouping">(</span><span class="string-literal">"task"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span>

        <span class="identifier">command</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_active_tab</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_save</span><span class="grouping">(</span><span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_add_task</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">save_as</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"Saved project to: '%s'"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Saved project to: '%s'"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">clear</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Reset all GUI options to their default values for the active tab. """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">cli_opts</span><span class="punctuation">.</span><span class="identifier">reset</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_active_tab</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">reload</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Reset currently selected tab GUI options to their last saved state. """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_active_task</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"No active task to reload"</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Reloading task"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">current_tab</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_is_project</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_reset_modified_var</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_active_tab</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_add_task</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Add the currently active task to the internal :attr:`_tasks` dict.

        If the currently stored task is from an overarching session project, then
        only the options are updated. When resetting a tab to saved a project will always
        be preferred to a task loaded into the project, so the original reference file name
        stays with the project.

        Parameters
        ----------
        command: str
            The tab that pertains to the currently active task

        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span><span class="grouping">[</span><span class="identifier">command</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span>
                                    <span class="identifier">options</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="punctuation">,</span>
                                    <span class="identifier">is_project</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_is_project</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">clear_tasks</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Clears all of the stored tasks.

        This is required when loading a task stored in a legacy project file, and is only to be
        called by :class:`Project` when a project has been loaded which is in fact a task.
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Clearing stored tasks"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">add_project_task</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">options</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Add an individual task from a loaded :class:`Project` to the internal :attr:`_tasks`
        dict.

        Project tasks take priority over any other tasks, so the individual tasks from a new
        project must be placed in the _tasks dict.

        Parameters
        ----------
        filename: str
            The filename of the session project file
        command: str
            The tab that this task's options belong to
        options: dict
            The options for this task loaded from the project
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span><span class="grouping">[</span><span class="identifier">command</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">options</span><span class="arithmetic-assignment">=</span><span class="identifier">options</span><span class="punctuation">,</span> <span class="identifier">is_project</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_set_active_task</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the active :attr:`_filename` and :attr:`_options` to currently selected tab's
        options.

        Parameters
        ----------
        command: str, optional
            If a command is passed in then set the given tab to active, If this is none set the tab
            which currently has focus to active. Default: ``None``
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">command</span><span class="grouping">)</span>
        <span class="identifier">command</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_active_tab</span> <span class="keyword">if</span> <span class="identifier">command</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="identifier">command</span>
        <span class="identifier">task</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="identifier">command</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">task</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">task</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"filename", None), task.get("options"</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"tab: %s, filename: %s, options: %s"</span><span class="punctuation">,</span>
                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_active_tab</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">Project</span><span class="grouping">(</span><span class="identifier">_GuiSession</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">""" Faceswap ``.fsw`` Project File handling.

    Faceswap projects handle the management of all task tabs in the GUI and updates
    the main Faceswap title bar with the project name and modified state.

    Parameters
    ----------
    config: :class:`lib.gui.utils.Config`
        The master GUI config
    file_handler: :class:`lib.gui.utils.FileHandler`
        A file handler object
    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">config</span><span class="punctuation">,</span> <span class="identifier">file_handler</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">config</span><span class="punctuation">,</span> <span class="identifier">file_handler</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_root_title</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">filename</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: The currently active project filename. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">cli_options</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" dict: the raw cli options from :attr:`_options` with project fields removed. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cli_options</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_project_modified</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""bool: ``True`` if the project has been modified otherwise ``False``. """</span>
        <span class="keyword">return</span> <span class="identifier">any</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">var</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">var</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_modified_vars</span><span class="punctuation">.</span><span class="identifier">values</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_tasks</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" :class:`Tasks`: The current session's :class:``Tasks``. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">tasks</span>

    <span class="keyword">def</span> <span class="identifier">set_default_options</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the default options. The Default GUI options are stored on Faceswap startup.

        Exposed as the :attr:`_default_options` for a project cannot be set until after the main
        Command Tabs have been loaded.
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Setting options to default"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_default_options</span>

    <span class="comment"># MODIFIED STATE CALLBACK</span>
    <span class="keyword">def</span> <span class="identifier">set_modified_callback</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Adds a callback to each of the :attr:`_modified_vars` tkinter variables
        When one of these variables is changed, triggers :func:`_modified_callback`
        with the command that was changed.

        This is exposed as the callback can only be added after the main Command Tabs have
        been drawn, and their options' initial values have been set.

        """</span>
        <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">tkvar</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_modified_vars</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Adding callback for tab: %s"</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="grouping">)</span>
            <span class="identifier">tkvar</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"w"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_modified_callback</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_modified_callback</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" Update the project modified state on a GUI modification change and
        update the Faceswap title bar. """</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_project_modified</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_current_gui_state</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cli_options</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Project is same as stored. Setting modified to False"</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_reset_modified_var</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_modified</span> <span class="relational-operator">!=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_project_modified</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Updating project state from variable: (modified: %s)"</span><span class="punctuation">,</span>
                         <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_project_modified</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_modified</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_project_modified</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_root_title</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">load</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" Load a project from a saved ``.fsw`` project file.

        Parameters
        ----------
        *args: tuple
            Unused, but needs to be present for arguments passed by tkinter event handling
        filename: str, optional
            If a filename is passed in, This will be used, otherwise a file handler will be
            launched to select the relevant file.
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Loading project config: (filename: '%s')"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
        <span class="identifier">filename_set</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_filename</span><span class="grouping">(</span><span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">sess_type</span><span class="arithmetic-assignment">=</span><span class="string-literal">"project"</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">filename_set</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No filename set"</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="identifier">loaded</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_load</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">loaded</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Options not loaded"</span><span class="grouping">)</span>
            <span class="keyword">return</span>

        <span class="comment"># Legacy .fsw files could store projects or tasks. Check if this is a legacy file</span>
        <span class="comment"># and hand off file to Tasks if necessary</span>
        <span class="identifier">command</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_get_lone_task</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">legacy</span> <span class="arithmetic-assignment">=</span> <span class="identifier">command</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span>
        <span class="keyword">if</span> <span class="identifier">legacy</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_handoff_legacy_task</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">return</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_options</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_tasks</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_add_to_recent</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_reset_modified_var</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_root_title</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Loaded project config: (command: '%s', filename: '%s')"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_handoff_legacy_task</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Update legacy tasks saved with the old file extension ``.fsw`` to tasks ``.fst``.

        Hands off file handling to :class:`Tasks` and resets project to default.
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Updating legacy task '%s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>
        <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">set_default_options</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span><span class="punctuation">.</span><span class="identifier">clear_tasks</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">current_tab</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Updated legacy task and reset project"</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_update_tasks</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Add the tasks from the loaded project to the :class:`Tasks` class. """</span>
        <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cli_options</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">opts</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">key</span><span class="punctuation">:</span> <span class="identifier">val</span><span class="grouping">}</span>
            <span class="identifier">opts</span><span class="grouping">[</span><span class="string-literal">"tab_name"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">key</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tasks</span><span class="punctuation">.</span><span class="identifier">add_project_task</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">opts</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">reload</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" Reset all GUI's option tabs to their last saved state.

        Parameters
        ----------
        *args: tuple
            Unused, but needs to be present for arguments passed by tkinter event handling
        """</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"No active project to reload"</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Reloading project"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_options</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_tasks</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_reset_modified_var</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_root_title</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_update_root_title</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Update the root Window title with the project name. Add a asterisk
        if the file is modified. """</span>
        <span class="identifier">text</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"&lt;untitled project&gt;"</span> <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_basename</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_basename</span>
        <span class="identifier">text</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">"*" if self._modified else ""</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">set_root_title</span><span class="grouping">(</span><span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">text</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">save</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="identifier">save_as</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" Save the current GUI state to a ``.fsw`` project file.

        Parameters
        ----------
        *args: tuple
            Unused, but needs to be present for arguments passed by tkinter event handling
        save_as: bool, optional
            Whether to save to the stored filename, or pop open a file handler to ask for a
            location. If there is no stored filename, then a file handler will automatically be
            popped.
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Saving config as..."</span><span class="grouping">)</span>

        <span class="identifier">save_as</span> <span class="arithmetic-assignment">=</span> <span class="identifier">save_as</span> <span class="logical-operator">or</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
        <span class="keyword">if</span> <span class="identifier">save_as</span> <span class="logical-operator">and</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_save_as_to_filename</span><span class="grouping">(</span><span class="string-literal">"project"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_save</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_tasks</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_root_title</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">save_as</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"Saved project to: '%s'"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Saved project to: '%s'"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">new</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" Create a new project with default options.

        Pops a file handler to select location.

        Parameters
        ----------
        *args: tuple
            Unused, but needs to be present for arguments passed by tkinter event handling
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Creating new project"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">confirm_close</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Creating new project cancelled"</span><span class="grouping">)</span>
            <span class="keyword">return</span>

        <span class="identifier">cfgfile</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_file_handler</span><span class="grouping">(</span><span class="string-literal">"save"</span><span class="punctuation">,</span>
                                     <span class="string-literal">"config_project"</span><span class="punctuation">,</span>
                                     <span class="identifier">title</span><span class="arithmetic-assignment">=</span><span class="string-literal">"New Project..."</span><span class="punctuation">,</span>
                                     <span class="identifier">initial_folder</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_basename</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">i</span><span class="invalid">l</span><span class="invalid">e</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">cfgfile</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No filename selected"</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cfgfile</span><span class="punctuation">.</span><span class="identifier">name</span>
        <span class="identifier">cfgfile</span><span class="punctuation">.</span><span class="identifier">close</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">set_default_options</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">cli_opts</span><span class="punctuation">.</span><span class="identifier">reset</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_save</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_root_title</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">close</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" Clear the current project and set all options to default.

        Parameters
        ----------
        *args: tuple
            Unused, but needs to be present for arguments passed by tkinter event handling
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Close requested"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">confirm_close</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Close cancelled"</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">cli_opts</span><span class="punctuation">.</span><span class="identifier">reset</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">set_default_options</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_reset_modified_var</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_update_root_title</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">set_active_tab_by_name</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">user_config_dict</span><span class="grouping">[</span><span class="string-literal">"tab"</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">confirm_close</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Pop a message box to get confirmation that an unsaved project should be closed

        Returns
        -------
        bool: ``True`` if user confirms close, ``False`` if user cancels close
        """</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_modified</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Project is not modified"</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="bool-literal">True</span>
        <span class="identifier">confirmtxt</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"You have unsaved changes.\n\nAre you sure you want to close the project?"</span>
        <span class="keyword">if</span> <span class="identifier">messagebox</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">o</span><span class="invalid">k</span><span class="invalid">c</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">l</span><span class="grouping">(</span><span class="string-literal">"Close", confirmtxt, default="cancel", icon="warning"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Close Cancelled"</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="bool-literal">True</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Close confirmed"</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="bool-literal">False</span>


<span class="keyword">class</span> <span class="identifier">LastSession</span><span class="grouping">(</span><span class="identifier">_GuiSession</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">""" Faceswap Last Session handling.

    Faceswap :class:`LastSession` handles saving the state of the Faceswap GUI at close and
    reloading the state  at launch.

    Last Session behavior can be configured in :file:`config.gui.ini`.

    Parameters
    ----------
    config: :class:`lib.gui.utils.Config`
        The master GUI config
    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">config</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">config</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">pathcache</span><span class="punctuation">,</span> <span class="string-literal">".last_session.json"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_enabled</span><span class="punctuation">:</span>
            <span class="keyword">return</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_save_option</span> <span class="relational-operator">==</span> <span class="string-literal">"prompt"</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">_</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">a</span><span class="invalid">d</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_save_option</span> <span class="relational-operator">==</span> <span class="string-literal">"always"</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_save_option</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" str: The user config autosave option. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">user_config_dict</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"autosave_last_session", "never"</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_enabled</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" bool: ``True`` if autosave is enabled otherwise ``False``. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_save_option</span> <span class="relational-operator">!=</span> <span class="string-literal">"never"</span>

    <span class="keyword">def</span> <span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">i</span><span class="invalid">c</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">options</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the :attr:`_options` property based on the given options dictionary
        and update the GUI to use these values.

        This function is required for reloading the GUI state when the GUI has been force
        refreshed on a config change.

        Parameters
        ----------
        options: dict
            The options to set. Should be the output of :func:`to_dict`
        """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Setting options from dict: %s"</span><span class="punctuation">,</span> <span class="identifier">options</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span> <span class="arithmetic-assignment">=</span> <span class="identifier">options</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_options</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">to_dict</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Collect the current GUI options and place them in a dict for retrieval or storage.

        This function is required for reloading the GUI state when the GUI has been force
        refreshed on a config change.

        Returns
        -------
        dict: The current cli options ready for saving or retrieval by :func:`from_dict`
        """</span>
        <span class="identifier">opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_current_gui_state</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Collected opts: %s"</span><span class="punctuation">,</span> <span class="identifier">opts</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">opts</span> <span class="logical-operator">or</span> <span class="identifier">opts</span> <span class="relational-operator">==</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_default_options</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Default session, or no opts found. Not saving last session."</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="none-literal">None</span>
        <span class="identifier">opts</span><span class="grouping">[</span><span class="string-literal">"tab_name"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_active_tab</span>
        <span class="identifier">opts</span><span class="grouping">[</span><span class="string-literal">"project"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">project</span><span class="punctuation">.</span><span class="identifier">filename</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Added project items: %s"</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="identifier">k</span><span class="punctuation">:</span> <span class="identifier">v</span> <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span> <span class="relational-operator">in</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span>
                                                 <span class="keyword">if</span> <span class="identifier">k</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="string-literal">"tab_name", "project"</span><span class="grouping">)</span><span class="grouping">}</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">opts</span>

    <span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">_</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">a</span><span class="invalid">d</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Pop a message box to ask the user if they wish to load their last session.  """</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_file_exists</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No last session file found"</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">messagebox</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">y</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">n</span><span class="invalid">o</span><span class="grouping">(</span><span class="string-literal">"Last Session", "Load last session?"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Loading last session at user request"</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Not loading last session at user request"</span><span class="grouping">)</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Deleting LastSession file"</span><span class="grouping">)</span>
            <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">remove</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">load</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Load the last session.

        Loads the last saved session options. Checks if a previous project was loaded
        and whether there have been changes since the last saved version of the project.
        Sets the display and :class:`Project` and :class:`Task` objects accordingly.
        """</span>
        <span class="identifier">loaded</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_load</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">loaded</span><span class="punctuation">:</span>
            <span class="keyword">return</span>
        <span class="identifier">needs_update</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_project</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">needs_update</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_options</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_set_project</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the :class:`Project` if session is resuming from one.

        Returns
        -------
        bool:
            ``True`` If the GUI still needs to be updated from the last session, ``False`` if
            the returned GUI state is the last session
        """</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"project"</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"No project stored"</span><span class="grouping">)</span>
            <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Loading stored project"</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">project</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">filename</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_options</span><span class="grouping">[</span><span class="string-literal">"project"</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_cli_options</span> <span class="relational-operator">!=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_config</span><span class="punctuation">.</span><span class="identifier">project</span><span class="punctuation">.</span><span class="identifier">cli_options</span>

        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Needs update: %s"</span><span class="punctuation">,</span> <span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="keyword">def</span> <span class="identifier">save</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Save a snapshot of currently set GUI config options.

        Called on Faceswap shutdown.
        """</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_enabled</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"LastSession not enabled"</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Deleting existing LastSession file"</span><span class="grouping">)</span>
                <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">remove</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>
            <span class="keyword">return</span>

        <span class="identifier">opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">to_dict</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">opts</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Last session default or blank. Clearing saved last session."</span><span class="grouping">)</span>
            <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">remove</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">opts</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_serializer</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">opts</span><span class="grouping">)</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Saved last session. (filename: '%s', opts: %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filename</span><span class="punctuation">,</span> <span class="identifier">opts</span><span class="grouping">)</span>

    </pre>
  </body>
</html>