<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
This module defines export functions for decision trees.
"""</span>

<span class="comment"># Authors: Gilles Louppe &lt;g.louppe@gmail.com&gt;</span>
<span class="comment">#          Peter Prettenhofer &lt;peter.prettenhofer@gmail.com&gt;</span>
<span class="comment">#          Brian Holt &lt;bdholt1@gmail.com&gt;</span>
<span class="comment">#          Noel Dawe &lt;noel@dawe.me&gt;</span>
<span class="comment">#          Satrajit Gosh &lt;satrajit.ghosh@gmail.com&gt;</span>
<span class="comment">#          Trevor Stephens &lt;trev.stephens@gmail.com&gt;</span>
<span class="comment">#          Li Li &lt;aiki.nogard@gmail.com&gt;</span>
<span class="comment">#          Giuseppe Vettigli &lt;vettigli@gmail.com&gt;</span>
<span class="comment"># License: BSD 3 clause</span>
<span class="keyword">from</span> <span class="identifier">io</span> <span class="keyword">import</span> <span class="identifier">StringIO</span>
<span class="keyword">from</span> <span class="identifier">numbers</span> <span class="keyword">import</span> <span class="identifier">Integral</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>

<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">validation</span> <span class="keyword">import</span> <span class="identifier">check_is_fitted</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">base</span> <span class="keyword">import</span> <span class="identifier">is_classifier</span>

<span class="keyword">from</span> <span class="punctuation">.</span> <span class="keyword">import</span> <span class="identifier">_criterion</span>
<span class="keyword">from</span> <span class="punctuation">.</span> <span class="keyword">import</span> <span class="identifier">_tree</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">_reingold_tilford</span> <span class="keyword">import</span> <span class="identifier">buchheim</span><span class="punctuation">,</span> <span class="identifier">Tree</span>
<span class="keyword">from</span> <span class="punctuation">.</span> <span class="keyword">import</span> <span class="identifier">DecisionTreeClassifier</span>


<span class="keyword">def</span> <span class="identifier">_color_brew</span><span class="grouping">(</span><span class="identifier">n</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Generate n colors with equally spaced hues.

    Parameters
    ----------
    n : int
        The number of colors required.

    Returns
    -------
    color_list : list, length n
        List of n tuples of form (R, G, B) being the components of each color.
    """</span>
    <span class="identifier">color_list</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>

    <span class="comment"># Initialize saturation & value; calculate chroma & value shift</span>
    <span class="identifier">s</span><span class="punctuation">,</span> <span class="identifier">v</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.75</span><span class="punctuation">,</span> <span class="float-literal">0.9</span>
    <span class="identifier">c</span> <span class="arithmetic-assignment">=</span> <span class="identifier">s</span> <span class="arithmetic-operator">*</span> <span class="identifier">v</span>
    <span class="identifier">m</span> <span class="arithmetic-assignment">=</span> <span class="identifier">v</span> <span class="arithmetic-operator">-</span> <span class="identifier">c</span>

    <span class="keyword">for</span> <span class="identifier">h</span> <span class="relational-operator">in</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">385</span><span class="punctuation">,</span> <span class="int-literal">360</span><span class="punctuation">.</span> <span class="arithmetic-operator">/</span> <span class="identifier">n</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># Calculate some intermediate values</span>
        <span class="identifier">h_bar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">h</span> <span class="arithmetic-operator">/</span> <span class="int-literal">60</span><span class="punctuation">.</span>
        <span class="identifier">x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">c</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="int-literal">1</span> <span class="arithmetic-operator">-</span> <span class="identifier">abs</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">h_bar</span> <span class="arithmetic-operator">%</span> <span class="int-literal">2</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="comment"># Initialize RGB with same hue & chroma as our color</span>
        <span class="identifier">rgb</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">(</span><span class="identifier">c</span><span class="punctuation">,</span> <span class="identifier">x</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">,</span>
               <span class="grouping">(</span><span class="identifier">x</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">,</span>
               <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="punctuation">,</span> <span class="identifier">x</span><span class="grouping">)</span><span class="punctuation">,</span>
               <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">x</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="grouping">)</span><span class="punctuation">,</span>
               <span class="grouping">(</span><span class="identifier">x</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="grouping">)</span><span class="punctuation">,</span>
               <span class="grouping">(</span><span class="identifier">c</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">x</span><span class="grouping">)</span><span class="punctuation">,</span>
               <span class="grouping">(</span><span class="identifier">c</span><span class="punctuation">,</span> <span class="identifier">x</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">]</span>
        <span class="identifier">r</span><span class="punctuation">,</span> <span class="identifier">g</span><span class="punctuation">,</span> <span class="identifier">b</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rgb</span><span class="grouping">[</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">h_bar</span><span class="grouping">)</span><span class="grouping">]</span>
        <span class="comment"># Shift the initial RGB values to match value and store</span>
        <span class="identifier">rgb</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">(</span><span class="int-literal">255</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="identifier">r</span> <span class="arithmetic-operator">+</span> <span class="identifier">m</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
               <span class="grouping">(</span><span class="identifier">int</span><span class="grouping">(</span><span class="int-literal">255</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="identifier">g</span> <span class="arithmetic-operator">+</span> <span class="identifier">m</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
               <span class="grouping">(</span><span class="identifier">int</span><span class="grouping">(</span><span class="int-literal">255</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="identifier">b</span> <span class="arithmetic-operator">+</span> <span class="identifier">m</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">]</span>
        <span class="identifier">color_list</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">rgb</span><span class="grouping">)</span>

    <span class="keyword">return</span> <span class="identifier">color_list</span>


<span class="keyword">class</span> <span class="identifier">Sentinel</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__repr__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="string-literal">'"tree.dot"'</span>


<span class="identifier">SENTINEL</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Sentinel</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">plot_tree</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
              <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'all'</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
              <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
              <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">fontsize</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Plot a decision tree.

    The sample counts that are shown are weighted with any sample_weights that
    might be present.

    The visualization is fit automatically to the size of the axis.
    Use the ``figsize`` or ``dpi`` arguments of ``plt.figure``  to control
    the size of the rendering.

    Read more in the :ref:`User Guide &lt;tree&gt;`.

    .. versionadded:: 0.21

    Parameters
    ----------
    decision_tree : decision tree regressor or classifier
        The decision tree to be plotted.

    max_depth : int, default=None
        The maximum depth of the representation. If None, the tree is fully
        generated.

    feature_names : list of strings, default=None
        Names of each of the features.
        If None, generic names will be used ("X[0]", "X[1]", ...).

    class_names : list of str or bool, default=None
        Names of each of the target classes in ascending numerical order.
        Only relevant for classification and not supported for multi-output.
        If ``True``, shows a symbolic representation of the class name.

    label : {'all', 'root', 'none'}, default='all'
        Whether to show informative labels for impurity, etc.
        Options include 'all' to show at every node, 'root' to show only at
        the top root node, or 'none' to not show at any node.

    filled : bool, default=False
        When set to ``True``, paint nodes to indicate majority class for
        classification, extremity of values for regression, or purity of node
        for multi-output.

    impurity : bool, default=True
        When set to ``True``, show the impurity at each node.

    node_ids : bool, default=False
        When set to ``True``, show the ID number on each node.

    proportion : bool, default=False
        When set to ``True``, change the display of 'values' and/or 'samples'
        to be proportions and percentages respectively.

    rounded : bool, default=False
        When set to ``True``, draw node boxes with rounded corners and use
        Helvetica fonts instead of Times-Roman.

    precision : int, default=3
        Number of digits of precision for floating point in the values of
        impurity, threshold and value attributes of each node.

    ax : matplotlib axis, default=None
        Axes to plot to. If None, use current axis. Any previous content
        is cleared.

    fontsize : int, default=None
        Size of text font. If None, determined automatically to fit figure.

    Returns
    -------
    annotations : list of artists
        List containing the artists for the annotation boxes making up the
        tree.

    Examples
    --------
    &gt;&gt;&gt; from sklearn.datasets import load_iris
    &gt;&gt;&gt; from sklearn import tree

    &gt;&gt;&gt; clf = tree.DecisionTreeClassifier(random_state=0)
    &gt;&gt;&gt; iris = load_iris()

    &gt;&gt;&gt; clf = clf.fit(iris.data, iris.target)
    &gt;&gt;&gt; tree.plot_tree(clf)  # doctest: +SKIP
    [Text(251.5,345.217,'X[3] &lt;= 0.8...

    """</span>

    <span class="identifier">check_is_fitted</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="grouping">)</span>

    <span class="identifier">exporter</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_MPLTreeExporter</span><span class="grouping">(</span>
        <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="identifier">max_depth</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
        <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="identifier">label</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="identifier">filled</span><span class="punctuation">,</span> <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="identifier">impurity</span><span class="punctuation">,</span>
        <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="identifier">node_ids</span><span class="punctuation">,</span> <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="identifier">proportion</span><span class="punctuation">,</span> <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="identifier">rounded</span><span class="punctuation">,</span>
        <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="identifier">precision</span><span class="punctuation">,</span> <span class="identifier">fontsize</span><span class="arithmetic-assignment">=</span><span class="identifier">fontsize</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">exporter</span><span class="punctuation">.</span><span class="identifier">export</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="identifier">ax</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_BaseTreeExporter</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
                 <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'all'</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                 <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                 <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                 <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">fontsize</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">max_depth</span> <span class="arithmetic-assignment">=</span> <span class="identifier">max_depth</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">feature_names</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">label</span> <span class="arithmetic-assignment">=</span> <span class="identifier">label</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">filled</span> <span class="arithmetic-assignment">=</span> <span class="identifier">filled</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">impurity</span> <span class="arithmetic-assignment">=</span> <span class="identifier">impurity</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">node_ids</span> <span class="arithmetic-assignment">=</span> <span class="identifier">node_ids</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">proportion</span> <span class="arithmetic-assignment">=</span> <span class="identifier">proportion</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">rounded</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rounded</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precision</span> <span class="arithmetic-assignment">=</span> <span class="identifier">precision</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fontsize</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fontsize</span>

    <span class="keyword">def</span> <span class="identifier">get_color</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">value</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># Find the appropriate color & intensity for a node</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="grouping">[</span><span class="string-literal">'bounds'</span><span class="grouping">]</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="comment"># Classification tree</span>
            <span class="identifier">color</span> <span class="arithmetic-assignment">=</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="grouping">[</span><span class="string-literal">'rgb'</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">argmax</span><span class="grouping">(</span><span class="identifier">value</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="identifier">sorted_values</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">value</span><span class="punctuation">,</span> <span class="identifier">reverse</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">sorted_values</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
                <span class="identifier">alpha</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">alpha</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">sorted_values</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">-</span> <span class="identifier">sorted_values</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
                         <span class="arithmetic-operator">/</span> <span class="grouping">(</span><span class="int-literal">1</span> <span class="arithmetic-operator">-</span> <span class="identifier">sorted_values</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="comment"># Regression tree or multi-output</span>
            <span class="identifier">color</span> <span class="arithmetic-assignment">=</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="grouping">[</span><span class="string-literal">'rgb'</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="identifier">alpha</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">value</span> <span class="arithmetic-operator">-</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="grouping">[</span><span class="string-literal">'bounds'</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span>
                     <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="grouping">[</span><span class="string-literal">'bounds'][1] - self.colors['bounds'</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="comment"># unpack numpy scalars</span>
        <span class="identifier">alpha</span> <span class="arithmetic-assignment">=</span> <span class="identifier">float</span><span class="grouping">(</span><span class="identifier">alpha</span><span class="grouping">)</span>
        <span class="comment"># compute the color as alpha against white</span>
        <span class="identifier">color</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">round</span><span class="grouping">(</span><span class="identifier">alpha</span> <span class="arithmetic-operator">*</span> <span class="identifier">c</span> <span class="arithmetic-operator">+</span> <span class="grouping">(</span><span class="int-literal">1</span> <span class="arithmetic-operator">-</span> <span class="identifier">alpha</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="int-literal">255</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">c</span> <span class="relational-operator">in</span> <span class="identifier">color</span><span class="grouping">]</span>
        <span class="comment"># Return html color code in #RRGGBB format</span>
        <span class="keyword">return</span> <span class="string-literal">'#%2x%2x%2x'</span> <span class="arithmetic-operator">%</span> <span class="identifier">tuple</span><span class="grouping">(</span><span class="identifier">color</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">get_fill_color</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># Fetch appropriate color for node</span>
        <span class="keyword">if</span> <span class="string-literal">'rgb'</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="punctuation">:</span>
            <span class="comment"># Initialize colors and bounds if required</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="grouping">[</span><span class="string-literal">'rgb'</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_color_brew</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_classes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_outputs</span> <span class="relational-operator">!=</span> <span class="int-literal">1</span><span class="punctuation">:</span>
                <span class="comment"># Find max and min impurities for multi-output</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="grouping">[</span><span class="string-literal">'bounds'</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">impurity</span><span class="grouping">)</span><span class="punctuation">,</span>
                                         <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">impurity</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="keyword">elif</span> <span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_classes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="int-literal">1</span> <span class="logical-operator">and</span>
                  <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">unique</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">value</span><span class="grouping">)</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="comment"># Find max and min values in leaf nodes for regression</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="grouping">[</span><span class="string-literal">'bounds'</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">value</span><span class="grouping">)</span><span class="punctuation">,</span>
                                         <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">value</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_outputs</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="identifier">node_val</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">value</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span> <span class="arithmetic-operator">/</span>
                        <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">weighted_n_node_samples</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_classes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
                <span class="comment"># Regression</span>
                <span class="identifier">node_val</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">value</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="comment"># If multi-output color node by impurity</span>
            <span class="identifier">node_val</span> <span class="arithmetic-assignment">=</span> <span class="arithmetic-operator">-</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">impurity</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">get_color</span><span class="grouping">(</span><span class="identifier">node_val</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">node_to_str</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="punctuation">,</span> <span class="identifier">criterion</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># Generate the node content string</span>
        <span class="keyword">if</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_outputs</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="identifier">value</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">value</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">value</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">value</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span>

        <span class="comment"># Should labels be shown?</span>
        <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">label</span> <span class="relational-operator">==</span> <span class="string-literal">'root' and node_id == 0) or self.label == 'all'</span>

        <span class="identifier">characters</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">characters</span>
        <span class="identifier">node_string</span> <span class="arithmetic-assignment">=</span> <span class="identifier">characters</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>

        <span class="comment"># Write node ID</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">node_ids</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">labels</span><span class="punctuation">:</span>
                <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'node '</span>
            <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">node_id</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span>

        <span class="comment"># Write decision criteria</span>
        <span class="keyword">if</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">children_left</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span> <span class="relational-operator">!=</span> <span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">TREE_LEAF</span><span class="punctuation">:</span>
            <span class="comment"># Always write node decision criteria, except for leaves</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">feature_names</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
                <span class="identifier">feature</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">feature</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="grouping">]</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">feature</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"X%s%s%s"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span>
                                       <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">feature</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="punctuation">,</span>
                                       <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'%s %s %s%s'</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">feature</span><span class="punctuation">,</span>
                                           <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">,</span>
                                           <span class="identifier">round</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">threshold</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="punctuation">,</span>
                                                 <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precision</span><span class="grouping">)</span><span class="punctuation">,</span>
                                           <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="comment"># Write impurity</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">impurity</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">criterion</span><span class="punctuation">,</span> <span class="identifier">_criterion</span><span class="punctuation">.</span><span class="identifier">FriedmanMSE</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">criterion</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"friedman_mse"</span>
            <span class="keyword">elif</span> <span class="grouping">(</span><span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">criterion</span><span class="punctuation">,</span> <span class="identifier">_criterion</span><span class="punctuation">.</span><span class="identifier">MSE</span><span class="grouping">)</span>
                  <span class="logical-operator">or</span> <span class="identifier">criterion</span> <span class="relational-operator">==</span> <span class="string-literal">"squared_error"</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">criterion</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"squared_error"</span>
            <span class="keyword">elif</span> <span class="logical-operator">not</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">criterion</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">criterion</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"impurity"</span>
            <span class="keyword">if</span> <span class="identifier">labels</span><span class="punctuation">:</span>
                <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'%s = '</span> <span class="arithmetic-operator">%</span> <span class="identifier">criterion</span>
            <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">round</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">impurity</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precision</span><span class="grouping">)</span><span class="grouping">)</span>
                            <span class="arithmetic-operator">+</span> <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="comment"># Write node sample count</span>
        <span class="keyword">if</span> <span class="identifier">labels</span><span class="punctuation">:</span>
            <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'samples = '</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">proportion</span><span class="punctuation">:</span>
            <span class="identifier">percent</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="int-literal">100</span><span class="punctuation">.</span> <span class="arithmetic-operator">*</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_node_samples</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span> <span class="arithmetic-operator">/</span>
                       <span class="identifier">float</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_node_samples</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">round</span><span class="grouping">(</span><span class="identifier">percent</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="string-literal">'%'</span> <span class="arithmetic-operator">+</span>
                            <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_node_samples</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span>
                            <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="comment"># Write node class distribution / regression value</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">proportion</span> <span class="logical-operator">and</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_classes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">!=</span> <span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="comment"># For classification this will show the proportion of samples</span>
            <span class="identifier">value</span> <span class="arithmetic-assignment">=</span> <span class="identifier">value</span> <span class="arithmetic-operator">/</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">weighted_n_node_samples</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">labels</span><span class="punctuation">:</span>
            <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'value = '</span>
        <span class="keyword">if</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_classes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="comment"># Regression</span>
            <span class="identifier">value_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">around</span><span class="grouping">(</span><span class="identifier">value</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precision</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">proportion</span><span class="punctuation">:</span>
            <span class="comment"># Classification</span>
            <span class="identifier">value_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">around</span><span class="grouping">(</span><span class="identifier">value</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precision</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">equal</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">mod</span><span class="grouping">(</span><span class="identifier">value</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="comment"># Classification without floating-point weights</span>
            <span class="identifier">value_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">value</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="comment"># Classification with floating-point weights</span>
            <span class="identifier">value_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">around</span><span class="grouping">(</span><span class="identifier">value</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precision</span><span class="grouping">)</span>
        <span class="comment"># Strip whitespace</span>
        <span class="identifier">value_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">value_text</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="string-literal">'S32')).replace("b'", "'</span><span class="invalid">"</span><span class="grouping">)</span>
        <span class="identifier">value_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">value_text</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">"' '", ", ").replace("'", ""</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_classes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="int-literal">1</span> <span class="logical-operator">and</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_outputs</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="identifier">value_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">value_text</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">"[", "").replace("]", ""</span><span class="grouping">)</span>
        <span class="identifier">value_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">value_text</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">"\n "</span><span class="punctuation">,</span> <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">value_text</span> <span class="arithmetic-operator">+</span> <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span>

        <span class="comment"># Write node majority class</span>
        <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span>
                <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_classes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">!=</span> <span class="int-literal">1</span> <span class="logical-operator">and</span>
                <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">n_outputs</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="comment"># Only done for single-output classification trees</span>
            <span class="keyword">if</span> <span class="identifier">labels</span><span class="punctuation">:</span>
                <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'class = '</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="bool-literal">True</span><span class="punctuation">:</span>
                <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">argmax</span><span class="grouping">(</span><span class="identifier">value</span><span class="grouping">)</span><span class="grouping">]</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"y%s%s%s"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span>
                                          <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">argmax</span><span class="grouping">(</span><span class="identifier">value</span><span class="grouping">)</span><span class="punctuation">,</span>
                                          <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="identifier">node_string</span> <span class="arithmetic-assignment">+=</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span>

        <span class="comment"># Clean up any trailing newlines</span>
        <span class="keyword">if</span> <span class="identifier">node_string</span><span class="punctuation">.</span><span class="identifier">endswith</span><span class="grouping">(</span><span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">node_string</span> <span class="arithmetic-assignment">=</span> <span class="identifier">node_string</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">4</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">]</span>

        <span class="keyword">return</span> <span class="identifier">node_string</span> <span class="arithmetic-operator">+</span> <span class="identifier">characters</span><span class="grouping">[</span><span class="int-literal">5</span><span class="grouping">]</span>


<span class="keyword">class</span> <span class="identifier">_DOTTreeExporter</span><span class="grouping">(</span><span class="identifier">_BaseTreeExporter</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="identifier">SENTINEL</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
                 <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'all'</span><span class="punctuation">,</span>
                 <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">leaves_parallel</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
                 <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">rotate</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                 <span class="identifier">special_characters</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">fontname</span><span class="arithmetic-assignment">=</span><span class="string-literal">'helvetica'</span><span class="grouping">)</span><span class="punctuation">:</span>

        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span>
            <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="identifier">max_depth</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
            <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="identifier">label</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="identifier">filled</span><span class="punctuation">,</span>
            <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="identifier">impurity</span><span class="punctuation">,</span> <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="identifier">node_ids</span><span class="punctuation">,</span> <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="identifier">proportion</span><span class="punctuation">,</span>
            <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="identifier">rounded</span><span class="punctuation">,</span> <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="identifier">precision</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">leaves_parallel</span> <span class="arithmetic-assignment">=</span> <span class="identifier">leaves_parallel</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span> <span class="arithmetic-assignment">=</span> <span class="identifier">out_file</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">special_characters</span> <span class="arithmetic-assignment">=</span> <span class="identifier">special_characters</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fontname</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fontname</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">rotate</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rotate</span>

        <span class="comment"># PostScript compatibility for special characters</span>
        <span class="keyword">if</span> <span class="identifier">special_characters</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">characters</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'&#35;', '&lt;SUB&gt;', '&lt;/SUB&gt;', '&le;', '&lt;br/&gt;'</span><span class="punctuation">,</span>
                               <span class="string-literal">'&gt;', '&lt;'</span><span class="grouping">]</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">characters</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'#', '[', ']', '&lt;=', '\\n', '"', '"'</span><span class="grouping">]</span>

        <span class="comment"># validate</span>
        <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">precision</span><span class="punctuation">,</span> <span class="identifier">Integral</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">precision</span> <span class="relational-operator">&lt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"'precision' should be greater or equal to 0."</span>
                                 <span class="string-literal">" Got {} instead."</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">precision</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"'precision' should be an integer. Got {}"</span>
                             <span class="string-literal">" instead."</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">type</span><span class="grouping">(</span><span class="identifier">precision</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="comment"># The depth of each node for plotting with 'leaf' option</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ranks</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'leaves'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="grouping">]</span><span class="grouping">}</span>
        <span class="comment"># The colors to render each node with</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'bounds'</span><span class="punctuation">:</span> <span class="none-literal">None</span><span class="grouping">}</span>

    <span class="keyword">def</span> <span class="identifier">export</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">decision_tree</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># Check length of feature_names before getting into the tree node</span>
        <span class="comment"># Raise error if length of feature_names does not match</span>
        <span class="comment"># n_features_ in the decision_tree</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">feature_names</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="identifier">decision_tree</span><span class="punctuation">.</span><span class="identifier">n_features_</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Length of feature_names, %d "</span>
                                 <span class="string-literal">"does not match number of features, %d"</span>
                                 <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">)</span><span class="punctuation">,</span>
                                    <span class="identifier">decision_tree</span><span class="punctuation">.</span><span class="identifier">n_features_</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="comment"># each part writes to out_file</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">head</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="comment"># Now recurse the tree and add node & edge attributes</span>
        <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="punctuation">,</span> <span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">Tree</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">recurse</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">"impurity"</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">recurse</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="punctuation">.</span><span class="identifier">tree_</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span>
                         <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="identifier">decision_tree</span><span class="punctuation">.</span><span class="identifier">criterion</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tail</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">tail</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># If required, draw leaf nodes at same depth as each other</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">leaves_parallel</span><span class="punctuation">:</span>
            <span class="keyword">for</span> <span class="identifier">rank</span> <span class="relational-operator">in</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ranks</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span>
                    <span class="string-literal">"{rank=same ; "</span> <span class="arithmetic-operator">+</span>
                    <span class="string-literal">"; ".join(r for r in self.ranks[rank]) + "} ;\n"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">"}"</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">head</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'digraph Tree {\n'</span><span class="grouping">)</span>

        <span class="comment"># Specify node aesthetics</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'node [shape=box'</span><span class="grouping">)</span>
        <span class="identifier">rounded_filled</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">filled</span><span class="punctuation">:</span>
            <span class="identifier">rounded_filled</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">'filled'</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">rounded</span><span class="punctuation">:</span>
            <span class="identifier">rounded_filled</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">'rounded'</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">rounded_filled</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span>
                <span class="string-literal">', style="%s", color="black"'</span>
                <span class="arithmetic-operator">%</span> <span class="string-literal">", "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">rounded_filled</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">', fontname="%s"'</span> <span class="arithmetic-operator">%</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fontname</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'] ;\n'</span><span class="grouping">)</span>

        <span class="comment"># Specify graph & edge aesthetics</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">leaves_parallel</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span>
                <span class="string-literal">'graph [ranksep=equally, splines=polyline] ;\n'</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'edge [fontname="%s"] ;\n'</span> <span class="arithmetic-operator">%</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fontname</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">rotate</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'rankdir=LR ;\n'</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">recurse</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="punctuation">,</span> <span class="identifier">criterion</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">node_id</span> <span class="relational-operator">==</span> <span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">TREE_LEAF</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Invalid node_id %s"</span> <span class="arithmetic-operator">%</span> <span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">TREE_LEAF</span><span class="grouping">)</span>

        <span class="identifier">left_child</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">children_left</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span>
        <span class="identifier">right_child</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">children_right</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span>

        <span class="comment"># Add node with description</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">max_depth</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">or</span> <span class="identifier">depth</span> <span class="relational-operator">&lt;=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">max_depth</span><span class="punctuation">:</span>

            <span class="comment"># Collect ranks for 'leaf' option in plot_options</span>
            <span class="keyword">if</span> <span class="identifier">left_child</span> <span class="relational-operator">==</span> <span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">TREE_LEAF</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ranks</span><span class="grouping">[</span><span class="string-literal">'leaves'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">node_id</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="keyword">elif</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">depth</span><span class="grouping">)</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ranks</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ranks</span><span class="grouping">[</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">depth</span><span class="grouping">)</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">node_id</span><span class="grouping">)</span><span class="grouping">]</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ranks</span><span class="grouping">[</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">depth</span><span class="grouping">)</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">node_id</span><span class="grouping">)</span><span class="grouping">)</span>

            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span>
                <span class="string-literal">'%d [label=%s'</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">node_id</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">node_to_str</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="punctuation">,</span>
                                                            <span class="identifier">criterion</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">filled</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">', fillcolor="%s"'</span>
                                    <span class="arithmetic-operator">%</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">get_fill_color</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'] ;\n'</span><span class="grouping">)</span>

            <span class="keyword">if</span> <span class="identifier">parent</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
                <span class="comment"># Add edge to parent</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'%d -&gt; %d'</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="grouping">)</span><span class="grouping">)</span>
                <span class="keyword">if</span> <span class="identifier">parent</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="punctuation">:</span>
                    <span class="comment"># Draw True/False labels if parent is root node</span>
                    <span class="identifier">angles</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="int-literal">45</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">45</span><span class="grouping">]</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">rotate</span> <span class="arithmetic-operator">-</span> <span class="float-literal">.5</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">)</span>
                    <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">' [labeldistance=2.5, labelangle='</span><span class="grouping">)</span>
                    <span class="keyword">if</span> <span class="identifier">node_id</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
                        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'%d, headlabel="True"]'</span> <span class="arithmetic-operator">%</span>
                                            <span class="identifier">angles</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
                    <span class="keyword">else</span><span class="punctuation">:</span>
                        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'%d, headlabel="False"]'</span> <span class="arithmetic-operator">%</span>
                                            <span class="identifier">angles</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">' ;\n'</span><span class="grouping">)</span>

            <span class="keyword">if</span> <span class="identifier">left_child</span> <span class="relational-operator">!=</span> <span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">TREE_LEAF</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">recurse</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">left_child</span><span class="punctuation">,</span> <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="identifier">criterion</span><span class="punctuation">,</span>
                             <span class="identifier">parent</span><span class="arithmetic-assignment">=</span><span class="identifier">node_id</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-assignment">=</span><span class="identifier">depth</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">recurse</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">right_child</span><span class="punctuation">,</span> <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="identifier">criterion</span><span class="punctuation">,</span>
                             <span class="identifier">parent</span><span class="arithmetic-assignment">=</span><span class="identifier">node_id</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-assignment">=</span><span class="identifier">depth</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span>

        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ranks</span><span class="grouping">[</span><span class="string-literal">'leaves'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">node_id</span><span class="grouping">)</span><span class="grouping">)</span>

            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'%d [label="(...)"'</span> <span class="arithmetic-operator">%</span> <span class="identifier">node_id</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">filled</span><span class="punctuation">:</span>
                <span class="comment"># color cropped nodes grey</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">', fillcolor="#C0C0C0"'</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'] ;\n'</span> <span class="arithmetic-operator">%</span> <span class="identifier">node_id</span><span class="grouping">)</span>

            <span class="keyword">if</span> <span class="identifier">parent</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
                <span class="comment"># Add edge to parent</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">'%d -&gt; %d ;\n'</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_MPLTreeExporter</span><span class="grouping">(</span><span class="identifier">_BaseTreeExporter</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
                 <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'all'</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                 <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                 <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                 <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">fontsize</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>

        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span>
            <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="identifier">max_depth</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span>
            <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="identifier">label</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="identifier">filled</span><span class="punctuation">,</span>
            <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="identifier">impurity</span><span class="punctuation">,</span> <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="identifier">node_ids</span><span class="punctuation">,</span> <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="identifier">proportion</span><span class="punctuation">,</span>
            <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="identifier">rounded</span><span class="punctuation">,</span> <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="identifier">precision</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fontsize</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fontsize</span>

        <span class="comment"># validate</span>
        <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">precision</span><span class="punctuation">,</span> <span class="identifier">Integral</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">precision</span> <span class="relational-operator">&lt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"'precision' should be greater or equal to 0."</span>
                                 <span class="string-literal">" Got {} instead."</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">precision</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"'precision' should be an integer. Got {}"</span>
                             <span class="string-literal">" instead."</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">type</span><span class="grouping">(</span><span class="identifier">precision</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="comment"># The depth of each node for plotting with 'leaf' option</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ranks</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'leaves'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="grouping">]</span><span class="grouping">}</span>
        <span class="comment"># The colors to render each node with</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">colors</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'bounds'</span><span class="punctuation">:</span> <span class="none-literal">None</span><span class="grouping">}</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">characters</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'#', '[', ']', '&lt;=', '\n', '', ''</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">bbox_args</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">rounded</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">bbox_args</span><span class="grouping">[</span><span class="string-literal">'boxstyle'</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"round"</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">arrow_args</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">arrowstyle</span><span class="arithmetic-assignment">=</span><span class="string-literal">"&lt;-"</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_make_tree</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="punctuation">,</span> <span class="identifier">et</span><span class="punctuation">,</span> <span class="identifier">criterion</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># traverses _tree.Tree recursively, builds intermediate</span>
        <span class="comment"># "_reingold_tilford.Tree" object</span>
        <span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">node_to_str</span><span class="grouping">(</span><span class="identifier">et</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="punctuation">,</span> <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="identifier">criterion</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">et</span><span class="punctuation">.</span><span class="identifier">children_left</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span> <span class="relational-operator">!=</span> <span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">TREE_LEAF</span>
                <span class="logical-operator">and</span> <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">max_depth</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">or</span> <span class="identifier">depth</span> <span class="relational-operator">&lt;=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">max_depth</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">children</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_make_tree</span><span class="grouping">(</span><span class="identifier">et</span><span class="punctuation">.</span><span class="identifier">children_left</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">et</span><span class="punctuation">,</span>
                                        <span class="identifier">criterion</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-assignment">=</span><span class="identifier">depth</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">,</span>
                        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_make_tree</span><span class="grouping">(</span><span class="identifier">et</span><span class="punctuation">.</span><span class="identifier">children_right</span><span class="grouping">[</span><span class="identifier">node_id</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">et</span><span class="punctuation">,</span>
                                        <span class="identifier">criterion</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-assignment">=</span><span class="identifier">depth</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">]</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">Tree</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">Tree</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">node_id</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">children</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">export</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">decision_tree</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
        <span class="keyword">from</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">text</span> <span class="keyword">import</span> <span class="identifier">Annotation</span>

        <span class="keyword">if</span> <span class="identifier">ax</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">gca</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">clear</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_axis_off</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">my_tree</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_make_tree</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">decision_tree</span><span class="punctuation">.</span><span class="identifier">tree_</span><span class="punctuation">,</span>
                                  <span class="identifier">decision_tree</span><span class="punctuation">.</span><span class="identifier">criterion</span><span class="grouping">)</span>
        <span class="identifier">draw_tree</span> <span class="arithmetic-assignment">=</span> <span class="identifier">buchheim</span><span class="grouping">(</span><span class="identifier">my_tree</span><span class="grouping">)</span>

        <span class="comment"># important to make sure we're still</span>
        <span class="comment"># inside the axis after drawing the box</span>
        <span class="comment"># this makes sense because the width of a box</span>
        <span class="comment"># is about the same as the distance between boxes</span>
        <span class="identifier">max_x</span><span class="punctuation">,</span> <span class="identifier">max_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">draw_tree</span><span class="punctuation">.</span><span class="identifier">max_extents</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span>
        <span class="identifier">ax_width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_window_extent</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">width</span>
        <span class="identifier">ax_height</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_window_extent</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">height</span>

        <span class="identifier">scale_x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax_width</span> <span class="arithmetic-operator">/</span> <span class="identifier">max_x</span>
        <span class="identifier">scale_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax_height</span> <span class="arithmetic-operator">/</span> <span class="identifier">max_y</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">recurse</span><span class="grouping">(</span><span class="identifier">draw_tree</span><span class="punctuation">,</span> <span class="identifier">decision_tree</span><span class="punctuation">.</span><span class="identifier">tree_</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="punctuation">,</span>
                     <span class="identifier">scale_x</span><span class="punctuation">,</span> <span class="identifier">scale_y</span><span class="punctuation">,</span> <span class="identifier">ax_height</span><span class="grouping">)</span>

        <span class="identifier">anns</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">ann</span> <span class="keyword">for</span> <span class="identifier">ann</span> <span class="relational-operator">in</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_children</span><span class="grouping">(</span><span class="grouping">)</span>
                <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">ann</span><span class="punctuation">,</span> <span class="identifier">Annotation</span><span class="grouping">)</span><span class="grouping">]</span>

        <span class="comment"># update sizes of all bboxes</span>
        <span class="identifier">renderer</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="punctuation">.</span><span class="identifier">canvas</span><span class="punctuation">.</span><span class="identifier">get_renderer</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="keyword">for</span> <span class="identifier">ann</span> <span class="relational-operator">in</span> <span class="identifier">anns</span><span class="punctuation">:</span>
            <span class="identifier">ann</span><span class="punctuation">.</span><span class="identifier">update_bbox_position_size</span><span class="grouping">(</span><span class="identifier">renderer</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fontsize</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="comment"># get figure to data transform</span>
            <span class="comment"># adjust fontsize to avoid overlap</span>
            <span class="comment"># get max box width and height</span>
            <span class="identifier">extents</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">ann</span><span class="punctuation">.</span><span class="identifier">get_bbox_patch</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">get_window_extent</span><span class="grouping">(</span><span class="grouping">)</span>
                       <span class="keyword">for</span> <span class="identifier">ann</span> <span class="relational-operator">in</span> <span class="identifier">anns</span><span class="grouping">]</span>
            <span class="identifier">max_width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">max</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">extent</span><span class="punctuation">.</span><span class="identifier">width</span> <span class="keyword">for</span> <span class="identifier">extent</span> <span class="relational-operator">in</span> <span class="identifier">extents</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="identifier">max_height</span> <span class="arithmetic-assignment">=</span> <span class="identifier">max</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">extent</span><span class="punctuation">.</span><span class="identifier">height</span> <span class="keyword">for</span> <span class="identifier">extent</span> <span class="relational-operator">in</span> <span class="identifier">extents</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="comment"># width should be around scale_x in axis coordinates</span>
            <span class="identifier">size</span> <span class="arithmetic-assignment">=</span> <span class="identifier">anns</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_fontsize</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">min</span><span class="grouping">(</span><span class="identifier">scale_x</span> <span class="arithmetic-operator">/</span> <span class="identifier">max_width</span><span class="punctuation">,</span>
                                                <span class="identifier">scale_y</span> <span class="arithmetic-operator">/</span> <span class="identifier">max_height</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">ann</span> <span class="relational-operator">in</span> <span class="identifier">anns</span><span class="punctuation">:</span>
                <span class="identifier">ann</span><span class="punctuation">.</span><span class="identifier">set_fontsize</span><span class="grouping">(</span><span class="identifier">size</span><span class="grouping">)</span>

        <span class="keyword">return</span> <span class="identifier">anns</span>

    <span class="keyword">def</span> <span class="identifier">recurse</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">node</span><span class="punctuation">,</span> <span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="punctuation">,</span> <span class="identifier">scale_x</span><span class="punctuation">,</span> <span class="identifier">scale_y</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
        <span class="identifier">kwargs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">bbox</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">bbox_args</span><span class="punctuation">.</span><span class="identifier">copy</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">ha</span><span class="arithmetic-assignment">=</span><span class="string-literal">'center', va='center'</span><span class="punctuation">,</span>
                      <span class="identifier">zorder</span><span class="arithmetic-assignment">=</span><span class="int-literal">100</span> <span class="arithmetic-operator">-</span> <span class="int-literal">10</span> <span class="arithmetic-operator">*</span> <span class="identifier">depth</span><span class="punctuation">,</span> <span class="identifier">xycoords</span><span class="arithmetic-assignment">=</span><span class="string-literal">'axes pixels'</span><span class="punctuation">,</span>
                      <span class="identifier">arrowprops</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">arrow_args</span><span class="punctuation">.</span><span class="identifier">copy</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">'arrowprops']['edgecolor'] = plt.rcParams['text.color'</span><span class="grouping">]</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fontsize</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">'fontsize'</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fontsize</span>

        <span class="comment"># offset things by .5 to center them in plot</span>
        <span class="identifier">xy</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">x</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.5</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">scale_x</span><span class="punctuation">,</span> <span class="identifier">height</span> <span class="arithmetic-operator">-</span> <span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">y</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.5</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">scale_y</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">max_depth</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">or</span> <span class="identifier">depth</span> <span class="relational-operator">&lt;=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">max_depth</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">filled</span><span class="punctuation">:</span>
                <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">'bbox']['fc'</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">get_fill_color</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">,</span>
                                                           <span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">node_id</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">'bbox']['fc'</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_facecolor</span><span class="grouping">(</span><span class="grouping">)</span>

            <span class="keyword">if</span> <span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">parent</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
                <span class="comment"># root</span>
                <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">annotate</span><span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">label</span><span class="punctuation">,</span> <span class="identifier">xy</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">xy_parent</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">parent</span><span class="punctuation">.</span><span class="identifier">x</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.5</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">scale_x</span><span class="punctuation">,</span>
                             <span class="identifier">height</span> <span class="arithmetic-operator">-</span> <span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">parent</span><span class="punctuation">.</span><span class="identifier">y</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.5</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">scale_y</span><span class="grouping">)</span>
                <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">annotate</span><span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">label</span><span class="punctuation">,</span> <span class="identifier">xy_parent</span><span class="punctuation">,</span> <span class="identifier">xy</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">child</span> <span class="relational-operator">in</span> <span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">children</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">recurse</span><span class="grouping">(</span><span class="identifier">child</span><span class="punctuation">,</span> <span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="punctuation">,</span> <span class="identifier">scale_x</span><span class="punctuation">,</span> <span class="identifier">scale_y</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="punctuation">,</span>
                             <span class="identifier">depth</span><span class="arithmetic-assignment">=</span><span class="identifier">depth</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span>

        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">xy_parent</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">parent</span><span class="punctuation">.</span><span class="identifier">x</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.5</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">scale_x</span><span class="punctuation">,</span>
                         <span class="identifier">height</span> <span class="arithmetic-operator">-</span> <span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">.</span><span class="identifier">parent</span><span class="punctuation">.</span><span class="identifier">y</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.5</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">scale_y</span><span class="grouping">)</span>
            <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">'bbox']['fc'] = 'grey'</span>
            <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">annotate</span><span class="grouping">(</span><span class="string-literal">"\n  (...)  \n"</span><span class="punctuation">,</span> <span class="identifier">xy_parent</span><span class="punctuation">,</span> <span class="identifier">xy</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
                    <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'all'</span><span class="punctuation">,</span>
                    <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">leaves_parallel</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
                    <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">rotate</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                    <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">special_characters</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                    <span class="identifier">fontname</span><span class="arithmetic-assignment">=</span><span class="string-literal">'helvetica'</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Export a decision tree in DOT format.

    This function generates a GraphViz representation of the decision tree,
    which is then written into `out_file`. Once exported, graphical renderings
    can be generated using, for example::

        $ dot -Tps tree.dot -o tree.ps      (PostScript format)
        $ dot -Tpng tree.dot -o tree.png    (PNG format)

    The sample counts that are shown are weighted with any sample_weights that
    might be present.

    Read more in the :ref:`User Guide &lt;tree&gt;`.

    Parameters
    ----------
    decision_tree : decision tree classifier
        The decision tree to be exported to GraphViz.

    out_file : object or str, default=None
        Handle or name of the output file. If ``None``, the result is
        returned as a string.

        .. versionchanged:: 0.20
            Default of out_file changed from "tree.dot" to None.

    max_depth : int, default=None
        The maximum depth of the representation. If None, the tree is fully
        generated.

    feature_names : list of str, default=None
        Names of each of the features.
        If None generic names will be used ("feature_0", "feature_1", ...).

    class_names : list of str or bool, default=None
        Names of each of the target classes in ascending numerical order.
        Only relevant for classification and not supported for multi-output.
        If ``True``, shows a symbolic representation of the class name.

    label : {'all', 'root', 'none'}, default='all'
        Whether to show informative labels for impurity, etc.
        Options include 'all' to show at every node, 'root' to show only at
        the top root node, or 'none' to not show at any node.

    filled : bool, default=False
        When set to ``True``, paint nodes to indicate majority class for
        classification, extremity of values for regression, or purity of node
        for multi-output.

    leaves_parallel : bool, default=False
        When set to ``True``, draw all leaf nodes at the bottom of the tree.

    impurity : bool, default=True
        When set to ``True``, show the impurity at each node.

    node_ids : bool, default=False
        When set to ``True``, show the ID number on each node.

    proportion : bool, default=False
        When set to ``True``, change the display of 'values' and/or 'samples'
        to be proportions and percentages respectively.

    rotate : bool, default=False
        When set to ``True``, orient tree left to right rather than top-down.

    rounded : bool, default=False
        When set to ``True``, draw node boxes with rounded corners.

    special_characters : bool, default=False
        When set to ``False``, ignore special characters for PostScript
        compatibility.

    precision : int, default=3
        Number of digits of precision for floating point in the values of
        impurity, threshold and value attributes of each node.

    fontname : str, default='helvetica'
        Name of font used to render text.

    Returns
    -------
    dot_data : string
        String representation of the input tree in GraphViz dot format.
        Only returned if ``out_file`` is None.

        .. versionadded:: 0.18

    Examples
    --------
    &gt;&gt;&gt; from sklearn.datasets import load_iris
    &gt;&gt;&gt; from sklearn import tree

    &gt;&gt;&gt; clf = tree.DecisionTreeClassifier()
    &gt;&gt;&gt; iris = load_iris()

    &gt;&gt;&gt; clf = clf.fit(iris.data, iris.target)
    &gt;&gt;&gt; tree.export_graphviz(clf)
    'digraph Tree {...
    """</span>

    <span class="identifier">check_is_fitted</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="grouping">)</span>
    <span class="identifier">own_file</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
    <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">r</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">out_file</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">out_file</span> <span class="arithmetic-assignment">=</span> <span class="identifier">open</span><span class="grouping">(</span><span class="identifier">out_file</span><span class="punctuation">,</span> <span class="string-literal">"w", encoding="utf-8"</span><span class="grouping">)</span>
            <span class="identifier">own_file</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>

        <span class="keyword">if</span> <span class="identifier">out_file</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">r</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
            <span class="identifier">out_file</span> <span class="arithmetic-assignment">=</span> <span class="identifier">StringIO</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">exporter</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_DOTTreeExporter</span><span class="grouping">(</span>
            <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="identifier">out_file</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="identifier">max_depth</span><span class="punctuation">,</span>
            <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="identifier">label</span><span class="punctuation">,</span>
            <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="identifier">filled</span><span class="punctuation">,</span> <span class="identifier">leaves_parallel</span><span class="arithmetic-assignment">=</span><span class="identifier">leaves_parallel</span><span class="punctuation">,</span> <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="identifier">impurity</span><span class="punctuation">,</span>
            <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="identifier">node_ids</span><span class="punctuation">,</span> <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="identifier">proportion</span><span class="punctuation">,</span> <span class="identifier">rotate</span><span class="arithmetic-assignment">=</span><span class="identifier">rotate</span><span class="punctuation">,</span>
            <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="identifier">rounded</span><span class="punctuation">,</span> <span class="identifier">special_characters</span><span class="arithmetic-assignment">=</span><span class="identifier">special_characters</span><span class="punctuation">,</span>
            <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="identifier">precision</span><span class="punctuation">,</span> <span class="identifier">fontname</span><span class="arithmetic-assignment">=</span><span class="identifier">fontname</span><span class="grouping">)</span>
        <span class="identifier">exporter</span><span class="punctuation">.</span><span class="identifier">export</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">r</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">exporter</span><span class="punctuation">.</span><span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">getvalue</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">finally</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">own_file</span><span class="punctuation">:</span>
            <span class="identifier">out_file</span><span class="punctuation">.</span><span class="identifier">close</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_compute_depth</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">,</span> <span class="identifier">node</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Returns the depth of the subtree rooted in node.
    """</span>
    <span class="keyword">def</span> <span class="identifier">compute_depth_</span><span class="grouping">(</span><span class="identifier">current_node</span><span class="punctuation">,</span> <span class="identifier">current_depth</span><span class="punctuation">,</span>
                       <span class="identifier">children_left</span><span class="punctuation">,</span> <span class="identifier">children_right</span><span class="punctuation">,</span> <span class="identifier">depths</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">depths</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="identifier">current_depth</span><span class="grouping">]</span>
        <span class="identifier">left</span> <span class="arithmetic-assignment">=</span> <span class="identifier">children_left</span><span class="grouping">[</span><span class="identifier">current_node</span><span class="grouping">]</span>
        <span class="identifier">right</span> <span class="arithmetic-assignment">=</span> <span class="identifier">children_right</span><span class="grouping">[</span><span class="identifier">current_node</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">left</span> <span class="relational-operator">!=</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span> <span class="logical-operator">and</span> <span class="identifier">right</span> <span class="relational-operator">!=</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="identifier">compute_depth_</span><span class="grouping">(</span><span class="identifier">left</span><span class="punctuation">,</span> <span class="identifier">current_depth</span><span class="arithmetic-operator">+</span><span class="int-literal">1</span><span class="punctuation">,</span>
                           <span class="identifier">children_left</span><span class="punctuation">,</span> <span class="identifier">children_right</span><span class="punctuation">,</span> <span class="identifier">depths</span><span class="grouping">)</span>
            <span class="identifier">compute_depth_</span><span class="grouping">(</span><span class="identifier">right</span><span class="punctuation">,</span> <span class="identifier">current_depth</span><span class="arithmetic-operator">+</span><span class="int-literal">1</span><span class="punctuation">,</span>
                           <span class="identifier">children_left</span><span class="punctuation">,</span> <span class="identifier">children_right</span><span class="punctuation">,</span> <span class="identifier">depths</span><span class="grouping">)</span>

    <span class="identifier">depths</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="identifier">compute_depth_</span><span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">children_left</span><span class="punctuation">,</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">children_right</span><span class="punctuation">,</span> <span class="identifier">depths</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">max</span><span class="grouping">(</span><span class="identifier">depths</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span>
                <span class="identifier">spacing</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">decimals</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">show_weights</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Build a text report showing the rules of a decision tree.

    Note that backwards compatibility may not be supported.

    Parameters
    ----------
    decision_tree : object
        The decision tree estimator to be exported.
        It can be an instance of
        DecisionTreeClassifier or DecisionTreeRegressor.

    feature_names : list of str, default=None
        A list of length n_features containing the feature names.
        If None generic names will be used ("feature_0", "feature_1", ...).

    max_depth : int, default=10
        Only the first max_depth levels of the tree are exported.
        Truncated branches will be marked with "...".

    spacing : int, default=3
        Number of spaces between edges. The higher it is, the wider the result.

    decimals : int, default=2
        Number of decimal digits to display.

    show_weights : bool, default=False
        If true the classification weights will be exported on each leaf.
        The classification weights are the number of samples each class.

    Returns
    -------
    report : string
        Text summary of all the rules in the decision tree.

    Examples
    --------

    &gt;&gt;&gt; from sklearn.datasets import load_iris
    &gt;&gt;&gt; from sklearn.tree import DecisionTreeClassifier
    &gt;&gt;&gt; from sklearn.tree import export_text
    &gt;&gt;&gt; iris = load_iris()
    &gt;&gt;&gt; X = iris['data']
    &gt;&gt;&gt; y = iris['target']
    &gt;&gt;&gt; decision_tree = DecisionTreeClassifier(random_state=0, max_depth=2)
    &gt;&gt;&gt; decision_tree = decision_tree.fit(X, y)
    &gt;&gt;&gt; r = export_text(decision_tree, feature_names=iris['feature_names'])
    &gt;&gt;&gt; print(r)
    |--- petal width (cm) &lt;= 0.80
    |   |--- class: 0
    |--- petal width (cm) &gt;  0.80
    |   |--- petal width (cm) &lt;= 1.75
    |   |   |--- class: 1
    |   |--- petal width (cm) &gt;  1.75
    |   |   |--- class: 2
    """</span>
    <span class="identifier">check_is_fitted</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="grouping">)</span>
    <span class="identifier">tree_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">decision_tree</span><span class="punctuation">.</span><span class="identifier">tree_</span>
    <span class="keyword">if</span> <span class="identifier">is_classifier</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">decision_tree</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span>
    <span class="identifier">right_child_fmt</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{} {} &lt;= {}\n"</span>
    <span class="identifier">left_child_fmt</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{} {} &gt;  {}\n"</span>
    <span class="identifier">truncation_fmt</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{} {}\n"</span>

    <span class="keyword">if</span> <span class="identifier">max_depth</span> <span class="relational-operator">&lt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"max_depth bust be &gt;= 0, given %d"</span> <span class="arithmetic-operator">%</span> <span class="identifier">max_depth</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">feature_names</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span>
            <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">feature_names</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"feature_names must contain "</span>
                         <span class="string-literal">"%d elements, got %d"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">n_features</span><span class="punctuation">,</span>
                                                  <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">feature_names</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">spacing</span> <span class="relational-operator">&lt;=</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"spacing must be &gt; 0, given %d"</span> <span class="arithmetic-operator">%</span> <span class="identifier">spacing</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">decimals</span> <span class="relational-operator">&lt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"decimals must be &gt;= 0, given %d"</span> <span class="arithmetic-operator">%</span> <span class="identifier">decimals</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="punctuation">,</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">value_fmt</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{}{} weights: {}\n"</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">show_weights</span><span class="punctuation">:</span>
            <span class="identifier">value_fmt</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{}{}{}\n"</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">value_fmt</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{}{} value: {}\n"</span>

    <span class="keyword">if</span> <span class="identifier">feature_names</span><span class="punctuation">:</span>
        <span class="identifier">feature_names_</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">i</span> <span class="relational-operator">!=</span> <span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">TREE_UNDEFINED</span>
                          <span class="keyword">else</span> <span class="none-literal">None</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">feature</span><span class="grouping">]</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">feature_names_</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"feature_{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">i</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">feature</span><span class="grouping">]</span>

    <span class="identifier">export_text</span><span class="punctuation">.</span><span class="identifier">report</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">""</span>

    <span class="keyword">def</span> <span class="identifier">_add_leaf</span><span class="grouping">(</span><span class="identifier">value</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">val</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">''</span>
        <span class="identifier">is_classification</span> <span class="arithmetic-assignment">=</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">decision_tree</span><span class="punctuation">,</span>
                                       <span class="identifier">DecisionTreeClassifier</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">show_weights</span> <span class="logical-operator">or</span> <span class="logical-operator">not</span> <span class="identifier">is_classification</span><span class="punctuation">:</span>
            <span class="identifier">val</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"{1:.{0}f}, "</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">decimals</span><span class="punctuation">,</span> <span class="identifier">v</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">v</span> <span class="relational-operator">in</span> <span class="identifier">value</span><span class="grouping">]</span>
            <span class="identifier">val</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'['+''.join(val)[:-2]+']'</span>
        <span class="keyword">if</span> <span class="identifier">is_classification</span><span class="punctuation">:</span>
            <span class="identifier">val</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">' class: '</span> <span class="arithmetic-operator">+</span> <span class="identifier">str</span><span class="grouping">(</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="grouping">)</span>
        <span class="identifier">export_text</span><span class="punctuation">.</span><span class="identifier">report</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">value_fmt</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">indent</span><span class="punctuation">,</span> <span class="string-literal">''</span><span class="punctuation">,</span> <span class="identifier">val</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">print_tree_recurse</span><span class="grouping">(</span><span class="identifier">node</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">indent</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">"|" + (" "</span> <span class="arithmetic-operator">*</span> <span class="identifier">spacing</span><span class="grouping">)</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">depth</span>
        <span class="identifier">indent</span> <span class="arithmetic-assignment">=</span> <span class="identifier">indent</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="identifier">spacing</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="string-literal">"-"</span> <span class="arithmetic-operator">*</span> <span class="identifier">spacing</span>

        <span class="identifier">value</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="keyword">if</span> <span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">n_outputs</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="identifier">value</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">value</span><span class="grouping">[</span><span class="identifier">node</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">value</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">value</span><span class="grouping">[</span><span class="identifier">node</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">T</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">argmax</span><span class="grouping">(</span><span class="identifier">value</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">n_classes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">!=</span> <span class="int-literal">1</span> <span class="logical-operator">and</span>
                <span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">n_outputs</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span> <span class="arithmetic-assignment">=</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">[</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="grouping">]</span>

        <span class="keyword">if</span> <span class="identifier">depth</span> <span class="relational-operator">&lt;=</span> <span class="identifier">max_depth</span><span class="arithmetic-operator">+</span><span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="identifier">info_fmt</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">""</span>
            <span class="identifier">info_fmt_left</span> <span class="arithmetic-assignment">=</span> <span class="identifier">info_fmt</span>
            <span class="identifier">info_fmt_right</span> <span class="arithmetic-assignment">=</span> <span class="identifier">info_fmt</span>

            <span class="keyword">if</span> <span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">feature</span><span class="grouping">[</span><span class="identifier">node</span><span class="grouping">]</span> <span class="relational-operator">!=</span> <span class="identifier">_tree</span><span class="punctuation">.</span><span class="identifier">TREE_UNDEFINED</span><span class="punctuation">:</span>
                <span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">feature_names_</span><span class="grouping">[</span><span class="identifier">node</span><span class="grouping">]</span>
                <span class="identifier">threshold</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">threshold</span><span class="grouping">[</span><span class="identifier">node</span><span class="grouping">]</span>
                <span class="identifier">threshold</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{1:.{0}f}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">decimals</span><span class="punctuation">,</span> <span class="identifier">threshold</span><span class="grouping">)</span>
                <span class="identifier">export_text</span><span class="punctuation">.</span><span class="identifier">report</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">right_child_fmt</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">indent</span><span class="punctuation">,</span>
                                                             <span class="identifier">name</span><span class="punctuation">,</span>
                                                             <span class="identifier">threshold</span><span class="grouping">)</span>
                <span class="identifier">export_text</span><span class="punctuation">.</span><span class="identifier">report</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">info_fmt_left</span>
                <span class="identifier">print_tree_recurse</span><span class="grouping">(</span><span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">children_left</span><span class="grouping">[</span><span class="identifier">node</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-operator">+</span><span class="int-literal">1</span><span class="grouping">)</span>

                <span class="identifier">export_text</span><span class="punctuation">.</span><span class="identifier">report</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">left_child_fmt</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">indent</span><span class="punctuation">,</span>
                                                            <span class="identifier">name</span><span class="punctuation">,</span>
                                                            <span class="identifier">threshold</span><span class="grouping">)</span>
                <span class="identifier">export_text</span><span class="punctuation">.</span><span class="identifier">report</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">info_fmt_right</span>
                <span class="identifier">print_tree_recurse</span><span class="grouping">(</span><span class="identifier">tree_</span><span class="punctuation">.</span><span class="identifier">children_right</span><span class="grouping">[</span><span class="identifier">node</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-operator">+</span><span class="int-literal">1</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>  <span class="comment"># leaf</span>
                <span class="identifier">_add_leaf</span><span class="grouping">(</span><span class="identifier">value</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">subtree_depth</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_compute_depth</span><span class="grouping">(</span><span class="identifier">tree_</span><span class="punctuation">,</span> <span class="identifier">node</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">subtree_depth</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
                <span class="identifier">_add_leaf</span><span class="grouping">(</span><span class="identifier">value</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">trunc_report</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'truncated branch of depth %d'</span> <span class="arithmetic-operator">%</span> <span class="identifier">subtree_depth</span>
                <span class="identifier">export_text</span><span class="punctuation">.</span><span class="identifier">report</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">truncation_fmt</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">indent</span><span class="punctuation">,</span>
                                                            <span class="identifier">trunc_report</span><span class="grouping">)</span>

    <span class="identifier">print_tree_recurse</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">export_text</span><span class="punctuation">.</span><span class="identifier">report</span>

    </pre>
  </body>
</html>