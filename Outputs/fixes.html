<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""Compatibility fixes for older version of python, numpy and scipy

If you add content to this file, please give the version of the package
at which the fixe is no longer needed.
"""</span>
<span class="comment"># Authors: Emmanuelle Gouillart &lt;emmanuelle.gouillart@normalesup.org&gt;</span>
<span class="comment">#          Gael Varoquaux &lt;gael.varoquaux@normalesup.org&gt;</span>
<span class="comment">#          Fabian Pedregosa &lt;fpedregosa@acm.org&gt;</span>
<span class="comment">#          Lars Buitinck</span>
<span class="comment">#</span>
<span class="comment"># License: BSD 3 clause</span>

<span class="keyword">from</span> <span class="identifier">functools</span> <span class="keyword">import</span> <span class="identifier">update_wrapper</span>
<span class="keyword">import</span> <span class="identifier">functools</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">sparse</span> <span class="keyword">as</span> <span class="identifier">sp</span>
<span class="keyword">import</span> <span class="identifier">scipy</span>
<span class="keyword">import</span> <span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">stats</span>
<span class="keyword">from</span> <span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">linalg</span> <span class="keyword">import</span> <span class="identifier">lsqr</span> <span class="keyword">as</span> <span class="identifier">sparse_lsqr</span>  <span class="comment"># noqa</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">_config</span> <span class="keyword">import</span> <span class="identifier">config_context</span><span class="punctuation">,</span> <span class="identifier">get_config</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">externals</span><span class="punctuation">.</span><span class="identifier">_packaging</span><span class="punctuation">.</span><span class="identifier">version</span> <span class="keyword">import</span> <span class="identifier">parse</span> <span class="keyword">as</span> <span class="identifier">parse_version</span>


<span class="identifier">np_version</span> <span class="arithmetic-assignment">=</span> <span class="identifier">parse_version</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">__version__</span><span class="grouping">)</span>
<span class="identifier">sp_version</span> <span class="arithmetic-assignment">=</span> <span class="identifier">parse_version</span><span class="grouping">(</span><span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">__version__</span><span class="grouping">)</span>


<span class="keyword">if</span> <span class="identifier">sp_version</span> <span class="relational-operator">&gt;=</span> <span class="identifier">parse_version</span><span class="grouping">(</span><span class="string-literal">'1.4'</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">from</span> <span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">linalg</span> <span class="keyword">import</span> <span class="identifier">lobpcg</span>
<span class="keyword">else</span><span class="punctuation">:</span>
    <span class="comment"># Backport of lobpcg functionality from scipy 1.4.0, can be removed</span>
    <span class="comment"># once support for sp_version &lt; parse_version('1.4') is dropped</span>
    <span class="comment"># mypy error: Name 'lobpcg' already defined (possibly by an import)</span>
    <span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">externals</span><span class="punctuation">.</span><span class="identifier">_lobpcg</span> <span class="keyword">import</span> <span class="identifier">lobpcg</span>  <span class="comment"># type: ignore  # noqa</span>


<span class="keyword">def</span> <span class="identifier">_object_dtype_isnan</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">return</span> <span class="identifier">X</span> <span class="relational-operator">!=</span> <span class="identifier">X</span>


<span class="comment"># TODO: replace by copy=False, when only scipy &gt; 1.1 is supported.</span>
<span class="keyword">def</span> <span class="identifier">_astype_copy_false</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Returns the copy=False parameter for
    {ndarray, csr_matrix, csc_matrix}.astype when possible,
    otherwise don't specify
    """</span>
    <span class="keyword">if</span> <span class="identifier">sp_version</span> <span class="relational-operator">&gt;=</span> <span class="identifier">parse_version</span><span class="grouping">(</span><span class="string-literal">'1.1'</span><span class="grouping">)</span> <span class="logical-operator">or</span> <span class="logical-operator">not</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">issparse</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="grouping">{</span><span class="string-literal">'copy'</span><span class="punctuation">:</span> <span class="bool-literal">False</span><span class="grouping">}</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="grouping">{</span><span class="grouping">}</span>


<span class="keyword">def</span> <span class="identifier">_joblib_parallel_args</span><span class="grouping">(</span><span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Set joblib.Parallel arguments in a compatible way for 0.11 and 0.12+

    For joblib 0.11 this maps both ``prefer`` and ``require`` parameters to
    a specific ``backend``.

    Parameters
    ----------

    prefer : str in {'processes', 'threads'} or None
        Soft hint to choose the default backend if no specific backend
        was selected with the parallel_backend context manager.

    require : 'sharedmem' or None
        Hard condstraint to select the backend. If set to 'sharedmem',
        the selected backend will be single-host and thread-based even
        if the user asked for a non-thread based backend with
        parallel_backend.

    See joblib.Parallel documentation for more details
    """</span>
    <span class="keyword">import</span> <span class="identifier">joblib</span>

    <span class="keyword">if</span> <span class="identifier">parse_version</span><span class="grouping">(</span><span class="identifier">joblib</span><span class="punctuation">.</span><span class="identifier">__version__</span><span class="grouping">)</span> <span class="relational-operator">&gt;=</span> <span class="identifier">parse_version</span><span class="grouping">(</span><span class="string-literal">'0.12'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">kwargs</span>

    <span class="identifier">extra_args</span> <span class="arithmetic-assignment">=</span> <span class="identifier">set</span><span class="grouping">(</span><span class="identifier">kwargs</span><span class="punctuation">.</span><span class="identifier">keys</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">difference</span><span class="grouping">(</span><span class="grouping">{</span><span class="string-literal">'prefer', 'require'</span><span class="grouping">}</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">extra_args</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">NotImplementedError</span><span class="grouping">(</span><span class="string-literal">'unhandled arguments %s with joblib %s'</span>
                                  <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">list</span><span class="grouping">(</span><span class="identifier">extra_args</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">joblib</span><span class="punctuation">.</span><span class="identifier">__version__</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">args</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="grouping">}</span>
    <span class="keyword">if</span> <span class="string-literal">'prefer'</span> <span class="relational-operator">in</span> <span class="identifier">kwargs</span><span class="punctuation">:</span>
        <span class="identifier">prefer</span> <span class="arithmetic-assignment">=</span> <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">'prefer'</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">prefer</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">'threads', 'processes'</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">]</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">'prefer=%s is not supported'</span> <span class="arithmetic-operator">%</span> <span class="identifier">prefer</span><span class="grouping">)</span>
        <span class="identifier">args</span><span class="grouping">[</span><span class="string-literal">'backend'] = {'threads': 'threading'</span><span class="punctuation">,</span>
                           <span class="string-literal">'processes': 'multiprocessing'</span><span class="punctuation">,</span>
                           <span class="none-literal">None</span><span class="punctuation">:</span> <span class="none-literal">None</span><span class="grouping">}</span><span class="grouping">[</span><span class="identifier">prefer</span><span class="grouping">]</span>

    <span class="keyword">if</span> <span class="string-literal">'require'</span> <span class="relational-operator">in</span> <span class="identifier">kwargs</span><span class="punctuation">:</span>
        <span class="identifier">require</span> <span class="arithmetic-assignment">=</span> <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">'require'</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">require</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="string-literal">'sharedmem'</span><span class="grouping">]</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">'require=%s is not supported'</span> <span class="arithmetic-operator">%</span> <span class="identifier">require</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">require</span> <span class="relational-operator">==</span> <span class="string-literal">'sharedmem'</span><span class="punctuation">:</span>
            <span class="identifier">args</span><span class="grouping">[</span><span class="string-literal">'backend'] = 'threading'</span>
    <span class="keyword">return</span> <span class="identifier">args</span>


<span class="keyword">class</span> <span class="identifier">loguniform</span><span class="grouping">(</span><span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">stats</span><span class="punctuation">.</span><span class="identifier">reciprocal</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""A class supporting log-uniform random variables.

    Parameters
    ----------
    low : float
        The minimum value
    high : float
        The maximum value

    Methods
    -------
    rvs(self, size=None, random_state=None)
        Generate log-uniform random variables

    The most useful method for Scikit-learn usage is highlighted here.
    For a full list, see
    `scipy.stats.reciprocal
    &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.reciprocal.html&gt;`_.
    This list includes all functions of ``scipy.stats`` continuous
    distributions such as ``pdf``.

    Notes
    -----
    This class generates values between ``low`` and ``high`` or

        low &lt;= loguniform(low, high).rvs() &lt;= high

    The logarithmic probability density function (PDF) is uniform. When
    ``x`` is a uniformly distributed random variable between 0 and 1, ``10**x``
    are random variables that are equally likely to be returned.

    This class is an alias to ``scipy.stats.reciprocal``, which uses the
    reciprocal distribution:
    https://en.wikipedia.org/wiki/Reciprocal_distribution

    Examples
    --------

    &gt;&gt;&gt; from sklearn.utils.fixes import loguniform
    &gt;&gt;&gt; rv = loguniform(1e-3, 1e1)
    &gt;&gt;&gt; rvs = rv.rvs(random_state=42, size=1000)
    &gt;&gt;&gt; rvs.min()  # doctest: +SKIP
    0.0010435856341129003
    &gt;&gt;&gt; rvs.max()  # doctest: +SKIP
    9.97403052786026
    """</span>


<span class="keyword">def</span> <span class="identifier">_take_along_axis</span><span class="grouping">(</span><span class="identifier">arr</span><span class="punctuation">,</span> <span class="identifier">indices</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Implements a simplified version of np.take_along_axis if numpy
    version &lt; 1.15"""</span>
    <span class="keyword">if</span> <span class="identifier">np_version</span> <span class="relational-operator">&gt;=</span> <span class="identifier">parse_version</span><span class="grouping">(</span><span class="string-literal">'1.15'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">take_along_axis</span><span class="grouping">(</span><span class="identifier">arr</span><span class="arithmetic-assignment">=</span><span class="identifier">arr</span><span class="punctuation">,</span> <span class="identifier">indices</span><span class="arithmetic-assignment">=</span><span class="identifier">indices</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="identifier">axis</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">axis</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">arr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">arr</span><span class="punctuation">.</span><span class="identifier">flatten</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">issubdtype</span><span class="grouping">(</span><span class="identifier">indices</span><span class="punctuation">.</span><span class="identifier">dtype</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">intp</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">IndexError</span><span class="grouping">(</span><span class="string-literal">'`indices` must be an integer array'</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">arr</span><span class="punctuation">.</span><span class="identifier">ndim</span> <span class="relational-operator">!=</span> <span class="identifier">indices</span><span class="punctuation">.</span><span class="identifier">ndim</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span>
                <span class="string-literal">"`indices` and `arr` must have the same number of dimensions"</span><span class="grouping">)</span>

        <span class="identifier">shape_ones</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">indices</span><span class="punctuation">.</span><span class="identifier">ndim</span>
        <span class="identifier">dest_dims</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span>
            <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">range</span><span class="grouping">(</span><span class="identifier">axis</span><span class="grouping">)</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span>
            <span class="grouping">[</span><span class="none-literal">None</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span>
            <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">range</span><span class="grouping">(</span><span class="identifier">axis</span><span class="arithmetic-operator">+</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">indices</span><span class="punctuation">.</span><span class="identifier">ndim</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="grouping">)</span>

        <span class="comment"># build a fancy index, consisting of orthogonal aranges, with the</span>
        <span class="comment"># requested index inserted at the right location</span>
        <span class="identifier">fancy_index</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="keyword">for</span> <span class="identifier">dim</span><span class="punctuation">,</span> <span class="identifier">n</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">dest_dims</span><span class="punctuation">,</span> <span class="identifier">arr</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">dim</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
                <span class="identifier">fancy_index</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">indices</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">ind_shape</span> <span class="arithmetic-assignment">=</span> <span class="identifier">shape_ones</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">dim</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">shape_ones</span><span class="grouping">[</span><span class="identifier">dim</span><span class="arithmetic-operator">+</span><span class="int-literal">1</span><span class="punctuation">:</span><span class="grouping">]</span>
                <span class="identifier">fancy_index</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="identifier">n</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">reshape</span><span class="grouping">(</span><span class="identifier">ind_shape</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="identifier">fancy_index</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tuple</span><span class="grouping">(</span><span class="identifier">fancy_index</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">arr</span><span class="grouping">[</span><span class="identifier">fancy_index</span><span class="grouping">]</span>


<span class="comment"># remove when https://github.com/joblib/joblib/issues/1071 is fixed</span>
<span class="keyword">def</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">e</span><span class="invalid">d</span><span class="grouping">(</span><span class="identifier">function</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Decorator used to capture the arguments of a function."""</span>
    <span class="punctuation">@</span><span class="identifier">functools</span><span class="punctuation">.</span><span class="identifier">wraps</span><span class="grouping">(</span><span class="identifier">function</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">u</span><span class="invalid">n</span><span class="invalid">c</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">_FuncWrapper</span><span class="grouping">(</span><span class="identifier">function</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">,</span> <span class="identifier">kwargs</span>
    <span class="keyword">return</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">u</span><span class="invalid">n</span><span class="invalid">c</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span>


<span class="keyword">class</span> <span class="identifier">_FuncWrapper</span><span class="punctuation">:</span>
    <span class="comment">""""Load the global configuration before calling the function."""</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">function</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">function</span> <span class="arithmetic-assignment">=</span> <span class="identifier">function</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">config</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">update_wrapper</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">function</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">__call__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">config_context</span><span class="grouping">(</span><span class="arithmetic-operator">**</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">config</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">function</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">linspace</span><span class="grouping">(</span><span class="identifier">start</span><span class="punctuation">,</span> <span class="identifier">stop</span><span class="punctuation">,</span> <span class="identifier">num</span><span class="arithmetic-assignment">=</span><span class="int-literal">50</span><span class="punctuation">,</span> <span class="identifier">endpoint</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">retstep</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
             <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Implements a simplified linspace function as of numpy verion &gt;= 1.16.

    As of numpy 1.16, the arguments start and stop can be array-like and
    there is an optional argument `axis`.
    For simplicity, we only allow 1d array-like to be passed to start and stop.
    See: https://github.com/numpy/numpy/pull/12388 and numpy 1.16 release
    notes about start and stop arrays for linspace logspace and geomspace.

    Returns
    -------
    out : ndarray of shape (num, n_start) or (num,)
        The output array with `n_start=start.shape[0]` columns.
    """</span>
    <span class="keyword">if</span> <span class="identifier">np_version</span> <span class="relational-operator">&lt;</span> <span class="identifier">parse_version</span><span class="grouping">(</span><span class="string-literal">'1.16'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">start</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">y</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">start</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="float-literal">1.0</span>
        <span class="identifier">stop</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">y</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">stop</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="float-literal">1.0</span>
        <span class="identifier">dt</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">result_type</span><span class="grouping">(</span><span class="identifier">start</span><span class="punctuation">,</span> <span class="identifier">stop</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">(</span><span class="identifier">num</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">dtype</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">dtype</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dt</span>

        <span class="keyword">if</span> <span class="identifier">start</span><span class="punctuation">.</span><span class="identifier">ndim</span> <span class="relational-operator">==</span> <span class="int-literal">0</span> <span class="relational-operator">==</span> <span class="identifier">stop</span><span class="punctuation">.</span><span class="identifier">ndim</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">linspace</span><span class="grouping">(</span><span class="identifier">start</span><span class="arithmetic-assignment">=</span><span class="identifier">start</span><span class="punctuation">,</span> <span class="identifier">stop</span><span class="arithmetic-assignment">=</span><span class="identifier">stop</span><span class="punctuation">,</span> <span class="identifier">num</span><span class="arithmetic-assignment">=</span><span class="identifier">num</span><span class="punctuation">,</span>
                               <span class="identifier">endpoint</span><span class="arithmetic-assignment">=</span><span class="identifier">endpoint</span><span class="punctuation">,</span> <span class="identifier">retstep</span><span class="arithmetic-assignment">=</span><span class="identifier">retstep</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">start</span><span class="punctuation">.</span><span class="identifier">ndim</span> <span class="relational-operator">!=</span> <span class="int-literal">1</span> <span class="logical-operator">or</span> <span class="identifier">stop</span><span class="punctuation">.</span><span class="identifier">ndim</span> <span class="relational-operator">!=</span> <span class="int-literal">1</span> <span class="logical-operator">or</span> <span class="identifier">start</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">!=</span> <span class="identifier">stop</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"start and stop must be 1d array-like of same"</span>
                             <span class="string-literal">" shape."</span><span class="grouping">)</span>
        <span class="identifier">n_start</span> <span class="arithmetic-assignment">=</span> <span class="identifier">start</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="identifier">out</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">empty</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">num</span><span class="punctuation">,</span> <span class="identifier">n_start</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>
        <span class="identifier">step</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">empty</span><span class="grouping">(</span><span class="identifier">n_start</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">n_start</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">out</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">i</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">step</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">linspace</span><span class="grouping">(</span><span class="identifier">start</span><span class="arithmetic-assignment">=</span><span class="identifier">start</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">stop</span><span class="arithmetic-assignment">=</span><span class="identifier">stop</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="punctuation">,</span>
                                             <span class="identifier">num</span><span class="arithmetic-assignment">=</span><span class="identifier">num</span><span class="punctuation">,</span> <span class="identifier">endpoint</span><span class="arithmetic-assignment">=</span><span class="identifier">endpoint</span><span class="punctuation">,</span>
                                             <span class="identifier">retstep</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">axis</span> <span class="relational-operator">!=</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="identifier">out</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">moveaxis</span><span class="grouping">(</span><span class="identifier">out</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">retstep</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">out</span><span class="punctuation">,</span> <span class="identifier">step</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">out</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">linspace</span><span class="grouping">(</span><span class="identifier">start</span><span class="arithmetic-assignment">=</span><span class="identifier">start</span><span class="punctuation">,</span> <span class="identifier">stop</span><span class="arithmetic-assignment">=</span><span class="identifier">stop</span><span class="punctuation">,</span> <span class="identifier">num</span><span class="arithmetic-assignment">=</span><span class="identifier">num</span><span class="punctuation">,</span> <span class="identifier">endpoint</span><span class="arithmetic-assignment">=</span><span class="identifier">endpoint</span><span class="punctuation">,</span>
                           <span class="identifier">retstep</span><span class="arithmetic-assignment">=</span><span class="identifier">retstep</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="identifier">axis</span><span class="grouping">)</span>

    </pre>
  </body>
</html>