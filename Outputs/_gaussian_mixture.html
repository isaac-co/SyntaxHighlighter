<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""Gaussian Mixture Model."""</span>

<span class="comment"># Author: Wei Xue &lt;xuewei4d@gmail.com&gt;</span>
<span class="comment"># Modified by Thierry Guillemot &lt;thierry.guillemot.work@gmail.com&gt;</span>
<span class="comment"># License: BSD 3 clause</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>

<span class="keyword">from</span> <span class="identifier">scipy</span> <span class="keyword">import</span> <span class="identifier">linalg</span>

<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">_base</span> <span class="keyword">import</span> <span class="identifier">BaseMixture</span><span class="punctuation">,</span> <span class="identifier">_check_shape</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">check_array</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">extmath</span> <span class="keyword">import</span> <span class="identifier">row_norms</span>


<span class="comment">###############################################################################</span>
<span class="comment"># Gaussian mixture shape checkers used by the GaussianMixture class</span>

<span class="keyword">def</span> <span class="identifier">_check_weights</span><span class="grouping">(</span><span class="identifier">weights</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Check the user provided 'weights'.

    Parameters
    ----------
    weights : array-like of shape (n_components,)
        The proportions of components of each mixture.

    n_components : int
        Number of components.

    Returns
    -------
    weights : array, shape (n_components,)
    """</span>
    <span class="identifier">weights</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_array</span><span class="grouping">(</span><span class="identifier">weights</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float32</span><span class="grouping">]</span><span class="punctuation">,</span>
                          <span class="identifier">ensure_2d</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
    <span class="identifier">_check_shape</span><span class="grouping">(</span><span class="identifier">weights</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">n_components</span><span class="punctuation">,</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">'weights'</span><span class="grouping">)</span>

    <span class="comment"># check range</span>
    <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">any</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">less</span><span class="grouping">(</span><span class="identifier">weights</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">.</span><span class="grouping">)</span><span class="grouping">)</span> <span class="logical-operator">or</span>
            <span class="identifier">any</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">greater</span><span class="grouping">(</span><span class="identifier">weights</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">.</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"The parameter 'weights' should be in the range "</span>
                         <span class="string-literal">"[0, 1], but got max value %.5f, min value %.5f"</span>
                         <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="identifier">weights</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="identifier">weights</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># check normalization</span>
    <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">allclose</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">abs</span><span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">.</span> <span class="arithmetic-operator">-</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">weights</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">.</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"The parameter 'weights' should be normalized, "</span>
                         <span class="string-literal">"but got sum(weights) = %.5f"</span> <span class="arithmetic-operator">%</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">weights</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">weights</span>


<span class="keyword">def</span> <span class="identifier">_check_means</span><span class="grouping">(</span><span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Validate the provided 'means'.

    Parameters
    ----------
    means : array-like of shape (n_components, n_features)
        The centers of the current components.

    n_components : int
        Number of components.

    n_features : int
        Number of features.

    Returns
    -------
    means : array, (n_components, n_features)
    """</span>
    <span class="identifier">means</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_array</span><span class="grouping">(</span><span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float32</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">ensure_2d</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
    <span class="identifier">_check_shape</span><span class="grouping">(</span><span class="identifier">means</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">'means'</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">means</span>


<span class="keyword">def</span> <span class="identifier">_check_precision_positivity</span><span class="grouping">(</span><span class="identifier">precision</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Check a precision vector is positive-definite."""</span>
    <span class="keyword">if</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">any</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">less_equal</span><span class="grouping">(</span><span class="identifier">precision</span><span class="punctuation">,</span> <span class="float-literal">0.0</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"'%s precision' should be "</span>
                         <span class="string-literal">"positive"</span> <span class="arithmetic-operator">%</span> <span class="identifier">covariance_type</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_check_precision_matrix</span><span class="grouping">(</span><span class="identifier">precision</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Check a precision matrix is symmetric and positive-definite."""</span>
    <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">allclose</span><span class="grouping">(</span><span class="identifier">precision</span><span class="punctuation">,</span> <span class="identifier">precision</span><span class="punctuation">.</span><span class="identifier">T</span><span class="grouping">)</span> <span class="logical-operator">and</span>
            <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="identifier">linalg</span><span class="punctuation">.</span><span class="identifier">eigvalsh</span><span class="grouping">(</span><span class="identifier">precision</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">.</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"'%s precision' should be symmetric, "</span>
                         <span class="string-literal">"positive-definite"</span> <span class="arithmetic-operator">%</span> <span class="identifier">covariance_type</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_check_precisions_full</span><span class="grouping">(</span><span class="identifier">precisions</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Check the precision matrices are symmetric and positive-definite."""</span>
    <span class="keyword">for</span> <span class="identifier">prec</span> <span class="relational-operator">in</span> <span class="identifier">precisions</span><span class="punctuation">:</span>
        <span class="identifier">_check_precision_matrix</span><span class="grouping">(</span><span class="identifier">prec</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_check_precisions</span><span class="grouping">(</span><span class="identifier">precisions</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Validate user provided precisions.

    Parameters
    ----------
    precisions : array-like
        'full' : shape of (n_components, n_features, n_features)
        'tied' : shape of (n_features, n_features)
        'diag' : shape of (n_components, n_features)
        'spherical' : shape of (n_components,)

    covariance_type : string

    n_components : int
        Number of components.

    n_features : int
        Number of features.

    Returns
    -------
    precisions : array
    """</span>
    <span class="identifier">precisions</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_array</span><span class="grouping">(</span><span class="identifier">precisions</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float32</span><span class="grouping">]</span><span class="punctuation">,</span>
                             <span class="identifier">ensure_2d</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                             <span class="identifier">allow_nd</span><span class="arithmetic-assignment">=</span><span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'full'</span><span class="grouping">)</span>

    <span class="identifier">precisions_shape</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'full'</span><span class="punctuation">:</span> <span class="grouping">(</span><span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">,</span>
                        <span class="string-literal">'tied'</span><span class="punctuation">:</span> <span class="grouping">(</span><span class="identifier">n_features</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">,</span>
                        <span class="string-literal">'diag'</span><span class="punctuation">:</span> <span class="grouping">(</span><span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">,</span>
                        <span class="string-literal">'spherical'</span><span class="punctuation">:</span> <span class="grouping">(</span><span class="identifier">n_components</span><span class="punctuation">,</span><span class="grouping">)</span><span class="grouping">}</span>
    <span class="identifier">_check_shape</span><span class="grouping">(</span><span class="identifier">precisions</span><span class="punctuation">,</span> <span class="identifier">precisions_shape</span><span class="grouping">[</span><span class="identifier">covariance_type</span><span class="grouping">]</span><span class="punctuation">,</span>
                 <span class="string-literal">'%s precision'</span> <span class="arithmetic-operator">%</span> <span class="identifier">covariance_type</span><span class="grouping">)</span>

    <span class="identifier">_check_precisions</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'full'</span><span class="punctuation">:</span> <span class="identifier">_check_precisions_full</span><span class="punctuation">,</span>
                         <span class="string-literal">'tied'</span><span class="punctuation">:</span> <span class="identifier">_check_precision_matrix</span><span class="punctuation">,</span>
                         <span class="string-literal">'diag'</span><span class="punctuation">:</span> <span class="identifier">_check_precision_positivity</span><span class="punctuation">,</span>
                         <span class="string-literal">'spherical'</span><span class="punctuation">:</span> <span class="identifier">_check_precision_positivity</span><span class="grouping">}</span>
    <span class="identifier">_check_precisions</span><span class="grouping">[</span><span class="identifier">covariance_type</span><span class="grouping">]</span><span class="grouping">(</span><span class="identifier">precisions</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">precisions</span>


<span class="comment">###############################################################################</span>
<span class="comment"># Gaussian mixture parameters estimators (used by the M-Step)</span>

<span class="keyword">def</span> <span class="identifier">_estimate_gaussian_covariances_full</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">nk</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">reg_covar</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Estimate the full covariance matrices.

    Parameters
    ----------
    resp : array-like of shape (n_samples, n_components)

    X : array-like of shape (n_samples, n_features)

    nk : array-like of shape (n_components,)

    means : array-like of shape (n_components, n_features)

    reg_covar : float

    Returns
    -------
    covariances : array, shape (n_components, n_features, n_features)
        The covariance matrix of the current components.
    """</span>
    <span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span> <span class="arithmetic-assignment">=</span> <span class="identifier">means</span><span class="punctuation">.</span><span class="identifier">shape</span>
    <span class="identifier">covariances</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">empty</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">k</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">diff</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span> <span class="arithmetic-operator">-</span> <span class="identifier">means</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span>
        <span class="identifier">covariances</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">resp</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">k</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span> <span class="identifier">diff</span><span class="punctuation">.</span><span class="identifier">T</span><span class="punctuation">,</span> <span class="identifier">diff</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">nk</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span>
        <span class="identifier">covariances</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">flat</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="identifier">n_features</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">reg_covar</span>
    <span class="keyword">return</span> <span class="identifier">covariances</span>


<span class="keyword">def</span> <span class="identifier">_estimate_gaussian_covariances_tied</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">nk</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">reg_covar</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Estimate the tied covariance matrix.

    Parameters
    ----------
    resp : array-like of shape (n_samples, n_components)

    X : array-like of shape (n_samples, n_features)

    nk : array-like of shape (n_components,)

    means : array-like of shape (n_components, n_features)

    reg_covar : float

    Returns
    -------
    covariance : array, shape (n_features, n_features)
        The tied covariance matrix of the components.
    """</span>
    <span class="identifier">avg_X2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">T</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span>
    <span class="identifier">avg_means2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">nk</span> <span class="arithmetic-operator">*</span> <span class="identifier">means</span><span class="punctuation">.</span><span class="identifier">T</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="grouping">)</span>
    <span class="identifier">covariance</span> <span class="arithmetic-assignment">=</span> <span class="identifier">avg_X2</span> <span class="arithmetic-operator">-</span> <span class="identifier">avg_means2</span>
    <span class="identifier">covariance</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">nk</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">covariance</span><span class="punctuation">.</span><span class="identifier">flat</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">covariance</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">reg_covar</span>
    <span class="keyword">return</span> <span class="identifier">covariance</span>


<span class="keyword">def</span> <span class="identifier">_estimate_gaussian_covariances_diag</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">nk</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">reg_covar</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Estimate the diagonal covariance vectors.

    Parameters
    ----------
    responsibilities : array-like of shape (n_samples, n_components)

    X : array-like of shape (n_samples, n_features)

    nk : array-like of shape (n_components,)

    means : array-like of shape (n_components, n_features)

    reg_covar : float

    Returns
    -------
    covariances : array, shape (n_components, n_features)
        The covariance vector of the current components.
    """</span>
    <span class="identifier">avg_X2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">.</span><span class="identifier">T</span><span class="punctuation">,</span> <span class="identifier">X</span> <span class="arithmetic-operator">*</span> <span class="identifier">X</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">nk</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">newaxis</span><span class="grouping">]</span>
    <span class="identifier">avg_means2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">means</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span>
    <span class="identifier">avg_X_means</span> <span class="arithmetic-assignment">=</span> <span class="identifier">means</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">.</span><span class="identifier">T</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">nk</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">newaxis</span><span class="grouping">]</span>
    <span class="keyword">return</span> <span class="identifier">avg_X2</span> <span class="arithmetic-operator">-</span> <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">avg_X_means</span> <span class="arithmetic-operator">+</span> <span class="identifier">avg_means2</span> <span class="arithmetic-operator">+</span> <span class="identifier">reg_covar</span>


<span class="keyword">def</span> <span class="identifier">_estimate_gaussian_covariances_spherical</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">nk</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">reg_covar</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Estimate the spherical variance values.

    Parameters
    ----------
    responsibilities : array-like of shape (n_samples, n_components)

    X : array-like of shape (n_samples, n_features)

    nk : array-like of shape (n_components,)

    means : array-like of shape (n_components, n_features)

    reg_covar : float

    Returns
    -------
    variances : array, shape (n_components,)
        The variance values of each components.
    """</span>
    <span class="keyword">return</span> <span class="identifier">_estimate_gaussian_covariances_diag</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">nk</span><span class="punctuation">,</span>
                                               <span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">reg_covar</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">mean</span><span class="grouping">(</span><span class="int-literal">1</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_estimate_gaussian_parameters</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">resp</span><span class="punctuation">,</span> <span class="identifier">reg_covar</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Estimate the Gaussian distribution parameters.

    Parameters
    ----------
    X : array-like of shape (n_samples, n_features)
        The input data array.

    resp : array-like of shape (n_samples, n_components)
        The responsibilities for each data sample in X.

    reg_covar : float
        The regularization added to the diagonal of the covariance matrices.

    covariance_type : {'full', 'tied', 'diag', 'spherical'}
        The type of precision matrices.

    Returns
    -------
    nk : array-like of shape (n_components,)
        The numbers of data samples in the current components.

    means : array-like of shape (n_components, n_features)
        The centers of the current components.

    covariances : array-like
        The covariance matrix of the current components.
        The shape depends of the covariance_type.
    """</span>
    <span class="identifier">nk</span> <span class="arithmetic-assignment">=</span> <span class="identifier">resp</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="int-literal">10</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">finfo</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">.</span><span class="identifier">dtype</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">eps</span>
    <span class="identifier">means</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">.</span><span class="identifier">T</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">nk</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">newaxis</span><span class="grouping">]</span>
    <span class="identifier">covariances</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">"full"</span><span class="punctuation">:</span> <span class="identifier">_estimate_gaussian_covariances_full</span><span class="punctuation">,</span>
                   <span class="string-literal">"tied"</span><span class="punctuation">:</span> <span class="identifier">_estimate_gaussian_covariances_tied</span><span class="punctuation">,</span>
                   <span class="string-literal">"diag"</span><span class="punctuation">:</span> <span class="identifier">_estimate_gaussian_covariances_diag</span><span class="punctuation">,</span>
                   <span class="string-literal">"spherical"</span><span class="punctuation">:</span> <span class="identifier">_estimate_gaussian_covariances_spherical</span>
                   <span class="grouping">}</span><span class="grouping">[</span><span class="identifier">covariance_type</span><span class="grouping">]</span><span class="grouping">(</span><span class="identifier">resp</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">nk</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">reg_covar</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">nk</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">covariances</span>


<span class="keyword">def</span> <span class="identifier">_compute_precision_cholesky</span><span class="grouping">(</span><span class="identifier">covariances</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Compute the Cholesky decomposition of the precisions.

    Parameters
    ----------
    covariances : array-like
        The covariance matrix of the current components.
        The shape depends of the covariance_type.

    covariance_type : {'full', 'tied', 'diag', 'spherical'}
        The type of precision matrices.

    Returns
    -------
    precisions_cholesky : array-like
        The cholesky decomposition of sample precisions of the current
        components. The shape depends of the covariance_type.
    """</span>
    <span class="identifier">estimate_precision_error_message</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span>
        <span class="string-literal">"Fitting the mixture model failed because some components have "</span>
        <span class="string-literal">"ill-defined empirical covariance (for instance caused by singleton "</span>
        <span class="string-literal">"or collapsed samples). Try to decrease the number of components, "</span>
        <span class="string-literal">"or increase reg_covar."</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'full'</span><span class="punctuation">:</span>
        <span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="punctuation">,</span> <span class="identifier">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">covariances</span><span class="punctuation">.</span><span class="identifier">shape</span>
        <span class="identifier">precisions_chol</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">empty</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">covariance</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">covariances</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">try</span><span class="punctuation">:</span>
                <span class="identifier">cov_chol</span> <span class="arithmetic-assignment">=</span> <span class="identifier">linalg</span><span class="punctuation">.</span><span class="identifier">cholesky</span><span class="grouping">(</span><span class="identifier">covariance</span><span class="punctuation">,</span> <span class="identifier">lower</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
            <span class="keyword">except</span> <span class="identifier">linalg</span><span class="punctuation">.</span><span class="identifier">LinAlgError</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="identifier">estimate_precision_error_message</span><span class="grouping">)</span>
            <span class="identifier">precisions_chol</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">linalg</span><span class="punctuation">.</span><span class="identifier">solve_triangular</span><span class="grouping">(</span><span class="identifier">cov_chol</span><span class="punctuation">,</span>
                                                         <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">eye</span><span class="grouping">(</span><span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">,</span>
                                                         <span class="identifier">lower</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">T</span>
    <span class="keyword">elif</span> <span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'tied'</span><span class="punctuation">:</span>
        <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">n_features</span> <span class="arithmetic-assignment">=</span> <span class="identifier">covariances</span><span class="punctuation">.</span><span class="identifier">shape</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="identifier">cov_chol</span> <span class="arithmetic-assignment">=</span> <span class="identifier">linalg</span><span class="punctuation">.</span><span class="identifier">cholesky</span><span class="grouping">(</span><span class="identifier">covariances</span><span class="punctuation">,</span> <span class="identifier">lower</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">linalg</span><span class="punctuation">.</span><span class="identifier">LinAlgError</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="identifier">estimate_precision_error_message</span><span class="grouping">)</span>
        <span class="identifier">precisions_chol</span> <span class="arithmetic-assignment">=</span> <span class="identifier">linalg</span><span class="punctuation">.</span><span class="identifier">solve_triangular</span><span class="grouping">(</span><span class="identifier">cov_chol</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">eye</span><span class="grouping">(</span><span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">,</span>
                                                  <span class="identifier">lower</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">T</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">any</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">less_equal</span><span class="grouping">(</span><span class="identifier">covariances</span><span class="punctuation">,</span> <span class="float-literal">0.0</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="identifier">estimate_precision_error_message</span><span class="grouping">)</span>
        <span class="identifier">precisions_chol</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span><span class="punctuation">.</span> <span class="arithmetic-operator">/</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sqrt</span><span class="grouping">(</span><span class="identifier">covariances</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">precisions_chol</span>


<span class="comment">###############################################################################</span>
<span class="comment"># Gaussian mixture probability estimators</span>
<span class="keyword">def</span> <span class="identifier">_compute_log_det_cholesky</span><span class="grouping">(</span><span class="identifier">matrix_chol</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Compute the log-det of the cholesky decomposition of matrices.

    Parameters
    ----------
    matrix_chol : array-like
        Cholesky decompositions of the matrices.
        'full' : shape of (n_components, n_features, n_features)
        'tied' : shape of (n_features, n_features)
        'diag' : shape of (n_components, n_features)
        'spherical' : shape of (n_components,)

    covariance_type : {'full', 'tied', 'diag', 'spherical'}

    n_features : int
        Number of features.

    Returns
    -------
    log_det_precision_chol : array-like of shape (n_components,)
        The determinant of the precision matrix for each component.
    """</span>
    <span class="keyword">if</span> <span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'full'</span><span class="punctuation">:</span>
        <span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">matrix_chol</span><span class="punctuation">.</span><span class="identifier">shape</span>
        <span class="identifier">log_det_chol</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span>
            <span class="identifier">matrix_chol</span><span class="punctuation">.</span><span class="identifier">reshape</span><span class="grouping">(</span>
                <span class="identifier">n_components</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="punctuation">:</span><span class="identifier">n_features</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">elif</span> <span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'tied'</span><span class="punctuation">:</span>
        <span class="identifier">log_det_chol</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">diag</span><span class="grouping">(</span><span class="identifier">matrix_chol</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">elif</span> <span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'diag'</span><span class="punctuation">:</span>
        <span class="identifier">log_det_chol</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span><span class="identifier">matrix_chol</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">log_det_chol</span> <span class="arithmetic-assignment">=</span> <span class="identifier">n_features</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span><span class="identifier">matrix_chol</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">return</span> <span class="identifier">log_det_chol</span>


<span class="keyword">def</span> <span class="identifier">_estimate_log_gaussian_prob</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">precisions_chol</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Estimate the log Gaussian probability.

    Parameters
    ----------
    X : array-like of shape (n_samples, n_features)

    means : array-like of shape (n_components, n_features)

    precisions_chol : array-like
        Cholesky decompositions of the precision matrices.
        'full' : shape of (n_components, n_features, n_features)
        'tied' : shape of (n_features, n_features)
        'diag' : shape of (n_components, n_features)
        'spherical' : shape of (n_components,)

    covariance_type : {'full', 'tied', 'diag', 'spherical'}

    Returns
    -------
    log_prob : array, shape (n_samples, n_components)
    """</span>
    <span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">n_features</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span>
    <span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">means</span><span class="punctuation">.</span><span class="identifier">shape</span>
    <span class="comment"># det(precision_chol) is half of det(precision)</span>
    <span class="identifier">log_det</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_compute_log_det_cholesky</span><span class="grouping">(</span>
        <span class="identifier">precisions_chol</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'full'</span><span class="punctuation">:</span>
        <span class="identifier">log_prob</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">empty</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">mu</span><span class="punctuation">,</span> <span class="identifier">prec_chol</span><span class="grouping">)</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">precisions_chol</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">prec_chol</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">mu</span><span class="punctuation">,</span> <span class="identifier">prec_chol</span><span class="grouping">)</span>
            <span class="identifier">log_prob</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">k</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">square</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>

    <span class="keyword">elif</span> <span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'tied'</span><span class="punctuation">:</span>
        <span class="identifier">log_prob</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">empty</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">mu</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">means</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">precisions_chol</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">mu</span><span class="punctuation">,</span> <span class="identifier">precisions_chol</span><span class="grouping">)</span>
            <span class="identifier">log_prob</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">k</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">square</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>

    <span class="keyword">elif</span> <span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'diag'</span><span class="punctuation">:</span>
        <span class="identifier">precisions</span> <span class="arithmetic-assignment">=</span> <span class="identifier">precisions_chol</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span>
        <span class="identifier">log_prob</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">means</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">precisions</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span>
                    <span class="int-literal">2</span><span class="punctuation">.</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">means</span> <span class="arithmetic-operator">*</span> <span class="identifier">precisions</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">T</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span>
                    <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">X</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">precisions</span><span class="punctuation">.</span><span class="identifier">T</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">elif</span> <span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'spherical'</span><span class="punctuation">:</span>
        <span class="identifier">precisions</span> <span class="arithmetic-assignment">=</span> <span class="identifier">precisions_chol</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span>
        <span class="identifier">log_prob</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">means</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">precisions</span> <span class="arithmetic-operator">-</span>
                    <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="punctuation">.</span><span class="identifier">T</span> <span class="arithmetic-operator">*</span> <span class="identifier">precisions</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span>
                    <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">outer</span><span class="grouping">(</span><span class="identifier">row_norms</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">squared</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">precisions</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="float-literal">-.5</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="identifier">n_features</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span><span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">pi</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">log_prob</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">log_det</span>


<span class="keyword">class</span> <span class="identifier">GaussianMixture</span><span class="grouping">(</span><span class="identifier">BaseMixture</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Gaussian Mixture.

    Representation of a Gaussian mixture model probability distribution.
    This class allows to estimate the parameters of a Gaussian mixture
    distribution.

    Read more in the :ref:`User Guide &lt;gmm&gt;`.

    .. versionadded:: 0.18

    Parameters
    ----------
    n_components : int, default=1
        The number of mixture components.

    covariance_type : {'full', 'tied', 'diag', 'spherical'}, default='full'
        String describing the type of covariance parameters to use.
        Must be one of:

        'full'
            each component has its own general covariance matrix
        'tied'
            all components share the same general covariance matrix
        'diag'
            each component has its own diagonal covariance matrix
        'spherical'
            each component has its own single variance

    tol : float, default=1e-3
        The convergence threshold. EM iterations will stop when the
        lower bound average gain is below this threshold.

    reg_covar : float, default=1e-6
        Non-negative regularization added to the diagonal of covariance.
        Allows to assure that the covariance matrices are all positive.

    max_iter : int, default=100
        The number of EM iterations to perform.

    n_init : int, default=1
        The number of initializations to perform. The best results are kept.

    init_params : {'kmeans', 'random'}, default='kmeans'
        The method used to initialize the weights, the means and the
        precisions.
        Must be one of::

            'kmeans' : responsibilities are initialized using kmeans.
            'random' : responsibilities are initialized randomly.

    weights_init : array-like of shape (n_components, ), default=None
        The user-provided initial weights.
        If it is None, weights are initialized using the `init_params` method.

    means_init : array-like of shape (n_components, n_features), default=None
        The user-provided initial means,
        If it is None, means are initialized using the `init_params` method.

    precisions_init : array-like, default=None
        The user-provided initial precisions (inverse of the covariance
        matrices).
        If it is None, precisions are initialized using the 'init_params'
        method.
        The shape depends on 'covariance_type'::

            (n_components,)                        if 'spherical',
            (n_features, n_features)               if 'tied',
            (n_components, n_features)             if 'diag',
            (n_components, n_features, n_features) if 'full'

    random_state : int, RandomState instance or None, default=None
        Controls the random seed given to the method chosen to initialize the
        parameters (see `init_params`).
        In addition, it controls the generation of random samples from the
        fitted distribution (see the method `sample`).
        Pass an int for reproducible output across multiple function calls.
        See :term:`Glossary &lt;random_state&gt;`.

    warm_start : bool, default=False
        If 'warm_start' is True, the solution of the last fitting is used as
        initialization for the next call of fit(). This can speed up
        convergence when fit is called several times on similar problems.
        In that case, 'n_init' is ignored and only a single initialization
        occurs upon the first call.
        See :term:`the Glossary &lt;warm_start&gt;`.

    verbose : int, default=0
        Enable verbose output. If 1 then it prints the current
        initialization and each iteration step. If greater than 1 then
        it prints also the log probability and the time needed
        for each step.

    verbose_interval : int, default=10
        Number of iteration done before the next print.

    Attributes
    ----------
    weights_ : array-like of shape (n_components,)
        The weights of each mixture components.

    means_ : array-like of shape (n_components, n_features)
        The mean of each mixture component.

    covariances_ : array-like
        The covariance of each mixture component.
        The shape depends on `covariance_type`::

            (n_components,)                        if 'spherical',
            (n_features, n_features)               if 'tied',
            (n_components, n_features)             if 'diag',
            (n_components, n_features, n_features) if 'full'

    precisions_ : array-like
        The precision matrices for each component in the mixture. A precision
        matrix is the inverse of a covariance matrix. A covariance matrix is
        symmetric positive definite so the mixture of Gaussian can be
        equivalently parameterized by the precision matrices. Storing the
        precision matrices instead of the covariance matrices makes it more
        efficient to compute the log-likelihood of new samples at test time.
        The shape depends on `covariance_type`::

            (n_components,)                        if 'spherical',
            (n_features, n_features)               if 'tied',
            (n_components, n_features)             if 'diag',
            (n_components, n_features, n_features) if 'full'

    precisions_cholesky_ : array-like
        The cholesky decomposition of the precision matrices of each mixture
        component. A precision matrix is the inverse of a covariance matrix.
        A covariance matrix is symmetric positive definite so the mixture of
        Gaussian can be equivalently parameterized by the precision matrices.
        Storing the precision matrices instead of the covariance matrices makes
        it more efficient to compute the log-likelihood of new samples at test
        time. The shape depends on `covariance_type`::

            (n_components,)                        if 'spherical',
            (n_features, n_features)               if 'tied',
            (n_components, n_features)             if 'diag',
            (n_components, n_features, n_features) if 'full'

    converged_ : bool
        True when convergence was reached in fit(), False otherwise.

    n_iter_ : int
        Number of step used by the best fit of EM to reach the convergence.

    lower_bound_ : float
        Lower bound value on the log-likelihood (of the training data with
        respect to the model) of the best fit of EM.

    n_features_in_ : int
        Number of features seen during :term:`fit`.

        .. versionadded:: 0.24

    Examples
    --------
    &gt;&gt;&gt; import numpy as np
    &gt;&gt;&gt; from sklearn.mixture import GaussianMixture
    &gt;&gt;&gt; X = np.array([[1, 2], [1, 4], [1, 0], [10, 2], [10, 4], [10, 0]])
    &gt;&gt;&gt; gm = GaussianMixture(n_components=2, random_state=0).fit(X)
    &gt;&gt;&gt; gm.means_
    array([[10.,  2.],
           [ 1.,  2.]])
    &gt;&gt;&gt; gm.predict([[0, 0], [12, 3]])
    array([1, 0])

    See Also
    --------
    BayesianGaussianMixture : Gaussian mixture model fit with a variational
        inference.
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="punctuation">,</span> <span class="identifier">covariance_type</span><span class="arithmetic-assignment">=</span><span class="string-literal">'full'</span><span class="punctuation">,</span> <span class="identifier">tol</span><span class="arithmetic-assignment">=</span><span class="float-literal">1e-3</span><span class="punctuation">,</span>
                 <span class="identifier">reg_covar</span><span class="arithmetic-assignment">=</span><span class="float-literal">1e-6</span><span class="punctuation">,</span> <span class="identifier">max_iter</span><span class="arithmetic-assignment">=</span><span class="int-literal">100</span><span class="punctuation">,</span> <span class="identifier">n_init</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">init_params</span><span class="arithmetic-assignment">=</span><span class="string-literal">'kmeans'</span><span class="punctuation">,</span>
                 <span class="identifier">weights_init</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">means_init</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">precisions_init</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
                 <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">warm_start</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                 <span class="identifier">verbose</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">verbose_interval</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span>
            <span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">tol</span><span class="arithmetic-assignment">=</span><span class="identifier">tol</span><span class="punctuation">,</span> <span class="identifier">reg_covar</span><span class="arithmetic-assignment">=</span><span class="identifier">reg_covar</span><span class="punctuation">,</span>
            <span class="identifier">max_iter</span><span class="arithmetic-assignment">=</span><span class="identifier">max_iter</span><span class="punctuation">,</span> <span class="identifier">n_init</span><span class="arithmetic-assignment">=</span><span class="identifier">n_init</span><span class="punctuation">,</span> <span class="identifier">init_params</span><span class="arithmetic-assignment">=</span><span class="identifier">init_params</span><span class="punctuation">,</span>
            <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="punctuation">,</span> <span class="identifier">warm_start</span><span class="arithmetic-assignment">=</span><span class="identifier">warm_start</span><span class="punctuation">,</span>
            <span class="identifier">verbose</span><span class="arithmetic-assignment">=</span><span class="identifier">verbose</span><span class="punctuation">,</span> <span class="identifier">verbose_interval</span><span class="arithmetic-assignment">=</span><span class="identifier">verbose_interval</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">covariance_type</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_init</span> <span class="arithmetic-assignment">=</span> <span class="identifier">weights_init</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_init</span> <span class="arithmetic-assignment">=</span> <span class="identifier">means_init</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_init</span> <span class="arithmetic-assignment">=</span> <span class="identifier">precisions_init</span>

    <span class="keyword">def</span> <span class="identifier">_check_parameters</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Check the Gaussian mixture parameters are well defined."""</span>
        <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">n_features</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">'spherical', 'tied', 'diag', 'full'</span><span class="grouping">]</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Invalid value for 'covariance_type': %s "</span>
                             <span class="string-literal">"'covariance_type' should be in "</span>
                             <span class="string-literal">"['spherical', 'tied', 'diag', 'full']"</span>
                             <span class="arithmetic-operator">%</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_init</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_init</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_check_weights</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_init</span><span class="punctuation">,</span>
                                               <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_components</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_init</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_init</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_check_means</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_init</span><span class="punctuation">,</span>
                                           <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_components</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_init</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_init</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_check_precisions</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_init</span><span class="punctuation">,</span>
                                                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span><span class="punctuation">,</span>
                                                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_components</span><span class="punctuation">,</span>
                                                     <span class="identifier">n_features</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_initialize</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">resp</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Initialization of the Gaussian mixture parameters.

        Parameters
        ----------
        X : array-like of shape (n_samples, n_features)

        resp : array-like of shape (n_samples, n_components)
        """</span>
        <span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span>

        <span class="identifier">weights</span><span class="punctuation">,</span> <span class="identifier">means</span><span class="punctuation">,</span> <span class="identifier">covariances</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_estimate_gaussian_parameters</span><span class="grouping">(</span>
            <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">resp</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">reg_covar</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span><span class="grouping">)</span>
        <span class="identifier">weights</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">n_samples</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">weights</span> <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_init</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
                         <span class="keyword">else</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_init</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">means</span> <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_init</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_init</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_init</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariances_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">covariances</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_compute_precision_cholesky</span><span class="grouping">(</span>
                <span class="identifier">covariances</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'full'</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span>
                <span class="grouping">[</span><span class="identifier">linalg</span><span class="punctuation">.</span><span class="identifier">cholesky</span><span class="grouping">(</span><span class="identifier">prec_init</span><span class="punctuation">,</span> <span class="identifier">lower</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
                 <span class="keyword">for</span> <span class="identifier">prec_init</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_init</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'tied'</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">linalg</span><span class="punctuation">.</span><span class="identifier">cholesky</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_init</span><span class="punctuation">,</span>
                                                        <span class="identifier">lower</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_init</span>

    <span class="keyword">def</span> <span class="identifier">_m_step</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">log_resp</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""M step.

        Parameters
        ----------
        X : array-like of shape (n_samples, n_features)

        log_resp : array-like of shape (n_samples, n_components)
            Logarithm of the posterior probabilities (or responsibilities) of
            the point of each sample in X.
        """</span>
        <span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariances_</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span>
            <span class="identifier">_estimate_gaussian_parameters</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">exp</span><span class="grouping">(</span><span class="identifier">log_resp</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">reg_covar</span><span class="punctuation">,</span>
                                          <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">n_samples</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_compute_precision_cholesky</span><span class="grouping">(</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariances_</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_estimate_log_prob</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">_estimate_log_gaussian_prob</span><span class="grouping">(</span>
            <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_estimate_log_weights</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_compute_lower_bound</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">log_prob_norm</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">log_prob_norm</span>

    <span class="keyword">def</span> <span class="identifier">_get_parameters</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariances_</span><span class="punctuation">,</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_set_parameters</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">params</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">weights_</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariances_</span><span class="punctuation">,</span>
         <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span><span class="grouping">)</span> <span class="arithmetic-assignment">=</span> <span class="identifier">params</span>

        <span class="comment"># Attributes computation</span>
        <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">n_features</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_</span><span class="punctuation">.</span><span class="identifier">shape</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'full'</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">empty</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">prec_chol</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">prec_chol</span><span class="punctuation">,</span> <span class="identifier">prec_chol</span><span class="punctuation">.</span><span class="identifier">T</span><span class="grouping">)</span>

        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'tied'</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">dot</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span><span class="punctuation">,</span>
                                      <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span><span class="punctuation">.</span><span class="identifier">T</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">precisions_cholesky_</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span>

    <span class="keyword">def</span> <span class="identifier">_n_parameters</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Return the number of free parameters in the model."""</span>
        <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">n_features</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">means_</span><span class="punctuation">.</span><span class="identifier">shape</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'full'</span><span class="punctuation">:</span>
            <span class="identifier">cov_params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_components</span> <span class="arithmetic-operator">*</span> <span class="identifier">n_features</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="identifier">n_features</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span><span class="punctuation">.</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'diag'</span><span class="punctuation">:</span>
            <span class="identifier">cov_params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_components</span> <span class="arithmetic-operator">*</span> <span class="identifier">n_features</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'tied'</span><span class="punctuation">:</span>
            <span class="identifier">cov_params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">n_features</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="identifier">n_features</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span><span class="punctuation">.</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">covariance_type</span> <span class="relational-operator">==</span> <span class="string-literal">'spherical'</span><span class="punctuation">:</span>
            <span class="identifier">cov_params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_components</span>
        <span class="identifier">mean_params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">n_features</span> <span class="arithmetic-operator">*</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_components</span>
        <span class="keyword">return</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">cov_params</span> <span class="arithmetic-operator">+</span> <span class="identifier">mean_params</span> <span class="arithmetic-operator">+</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_components</span> <span class="arithmetic-operator">-</span> <span class="int-literal">1</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">bic</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Bayesian information criterion for the current model on the input X.

        Parameters
        ----------
        X : array of shape (n_samples, n_dimensions)

        Returns
        -------
        bic : float
            The lower the better.
        """</span>
        <span class="keyword">return</span> <span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">score</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_n_parameters</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">aic</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Akaike information criterion for the current model on the input X.

        Parameters
        ----------
        X : array of shape (n_samples, n_dimensions)

        Returns
        -------
        aic : float
            The lower the better.
        """</span>
        <span class="keyword">return</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">score</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_n_parameters</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>