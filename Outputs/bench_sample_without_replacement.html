<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
Benchmarks for sampling without replacement of integer.

"""</span>
<span class="keyword">import</span> <span class="identifier">gc</span>
<span class="keyword">import</span> <span class="identifier">sys</span>
<span class="keyword">import</span> <span class="identifier">optparse</span>
<span class="keyword">from</span> <span class="identifier">datetime</span> <span class="keyword">import</span> <span class="identifier">datetime</span>
<span class="keyword">import</span> <span class="identifier">operator</span>

<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">random</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">random</span> <span class="keyword">import</span> <span class="identifier">sample_without_replacement</span>


<span class="keyword">def</span> <span class="identifier">compute_time</span><span class="grouping">(</span><span class="identifier">t_start</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">mu_second</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.0</span> <span class="arithmetic-operator">+</span> <span class="int-literal">10</span> <span class="arithmetic-operator">**</span> <span class="int-literal">6</span>  <span class="comment"># number of microseconds in a second</span>

    <span class="keyword">return</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">seconds</span> <span class="arithmetic-operator">+</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">microseconds</span> <span class="arithmetic-operator">/</span> <span class="identifier">mu_second</span>


<span class="keyword">def</span> <span class="identifier">bench_sample</span><span class="grouping">(</span><span class="identifier">sampling</span><span class="punctuation">,</span> <span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">n_samples</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">gc</span><span class="punctuation">.</span><span class="identifier">collect</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="comment"># start time</span>
    <span class="identifier">t_start</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datetime</span><span class="punctuation">.</span><span class="identifier">now</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">sampling</span><span class="grouping">(</span><span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">n_samples</span><span class="grouping">)</span>
    <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">datetime</span><span class="punctuation">.</span><span class="identifier">now</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t_start</span><span class="grouping">)</span>
    <span class="comment"># stop time</span>
    <span class="identifier">time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">compute_time</span><span class="grouping">(</span><span class="identifier">t_start</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">time</span>

<span class="keyword">if</span> <span class="identifier">__name__</span> <span class="relational-operator">==</span> <span class="string-literal">"__main__"</span><span class="punctuation">:</span>
    <span class="comment">###########################################################################</span>
    <span class="comment"># Option parser</span>
    <span class="comment">###########################################################################</span>
    <span class="identifier">op</span> <span class="arithmetic-assignment">=</span> <span class="identifier">optparse</span><span class="punctuation">.</span><span class="identifier">OptionParser</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--n-times"</span><span class="punctuation">,</span>
                  <span class="identifier">dest</span><span class="arithmetic-assignment">=</span><span class="string-literal">"n_times"</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="punctuation">,</span>
                  <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Benchmark results are average over n_times experiments"</span><span class="grouping">)</span>

    <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--n-population"</span><span class="punctuation">,</span>
                  <span class="identifier">dest</span><span class="arithmetic-assignment">=</span><span class="string-literal">"n_population"</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="int-literal">100000</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="punctuation">,</span>
                  <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Size of the population to sample from."</span><span class="grouping">)</span>

    <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--n-step"</span><span class="punctuation">,</span>
                  <span class="identifier">dest</span><span class="arithmetic-assignment">=</span><span class="string-literal">"n_steps"</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="punctuation">,</span>
                  <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Number of step interval between 0 and n_population."</span><span class="grouping">)</span>

    <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">g</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">i</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">m</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"custom-tracking-selection,custom-auto,"</span> <span class="invalid">\</span>
                         <span class="string-literal">"custom-reservoir-sampling,custom-pool,"</span><span class="invalid">\</span>
                         <span class="string-literal">"python-core-sample,numpy-permutation"</span>

    <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--algorithm"</span><span class="punctuation">,</span>
                  <span class="identifier">dest</span><span class="arithmetic-assignment">=</span><span class="string-literal">"selected_algorithm"</span><span class="punctuation">,</span>
                  <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">g</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">i</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">m</span><span class="invalid">s</span><span class="punctuation">,</span>
                  <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">str</span><span class="punctuation">,</span>
                  <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Comma-separated list of transformer to benchmark. "</span>
                       <span class="string-literal">"Default: %default. \nAvailable: %default"</span><span class="grouping">)</span>

    <span class="comment"># op.add_option("--random-seed",</span>
    <span class="comment">#               dest="random_seed", default=13, type=int,</span>
    <span class="comment">#               help="Seed used by the random number generators.")</span>

    <span class="grouping">(</span><span class="identifier">opts</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="grouping">)</span> <span class="arithmetic-assignment">=</span> <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">parse_args</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">args</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">error</span><span class="grouping">(</span><span class="string-literal">"this script takes no arguments."</span><span class="grouping">)</span>
        <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">exit</span><span class="grouping">(</span><span class="int-literal">1</span><span class="grouping">)</span>

    <span class="identifier">selected_algorithm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">selected_algorithm</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">','</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">key</span> <span class="relational-operator">in</span> <span class="identifier">selected_algorithm</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">key</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">g</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">i</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">m</span><span class="invalid">s</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">','</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Unknown sampling algorithm \"%s\" not in (%s)."</span>
                             <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">key</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">g</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">i</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">m</span><span class="invalid">s</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment">###########################################################################</span>
    <span class="comment"># List sampling algorithm</span>
    <span class="comment">###########################################################################</span>
    <span class="comment"># We assume that sampling algorithm has the following signature:</span>
    <span class="comment">#   sample(n_population, n_sample)</span>
    <span class="comment">#</span>
    <span class="identifier">sampling_algorithm</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="grouping">}</span>

    <span class="comment">###########################################################################</span>
    <span class="comment"># Set Python core input</span>
    <span class="identifier">sampling_algorithm</span><span class="grouping">[</span><span class="string-literal">"python-core-sample"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="invalid">\</span>
        <span class="keyword">lambda</span> <span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">n_sample</span><span class="punctuation">:</span> <span class="invalid">\</span>
        <span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">sample</span><span class="grouping">(</span><span class="identifier">range</span><span class="grouping">(</span><span class="identifier">n_population</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">n_sample</span><span class="grouping">)</span>

    <span class="comment">###########################################################################</span>
    <span class="comment"># Set custom automatic method selection</span>
    <span class="identifier">sampling_algorithm</span><span class="grouping">[</span><span class="string-literal">"custom-auto"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="invalid">\</span>
        <span class="keyword">lambda</span> <span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">:</span> <span class="invalid">\</span>
        <span class="identifier">sample_without_replacement</span><span class="grouping">(</span><span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">"auto"</span><span class="punctuation">,</span>
                                   <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="grouping">)</span>

    <span class="comment">###########################################################################</span>
    <span class="comment"># Set custom tracking based method</span>
    <span class="identifier">sampling_algorithm</span><span class="grouping">[</span><span class="string-literal">"custom-tracking-selection"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="invalid">\</span>
        <span class="keyword">lambda</span> <span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">:</span> <span class="invalid">\</span>
        <span class="identifier">sample_without_replacement</span><span class="grouping">(</span><span class="identifier">n_population</span><span class="punctuation">,</span>
                                   <span class="identifier">n_samples</span><span class="punctuation">,</span>
                                   <span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">"tracking_selection"</span><span class="punctuation">,</span>
                                   <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="grouping">)</span>

    <span class="comment">###########################################################################</span>
    <span class="comment"># Set custom reservoir based method</span>
    <span class="identifier">sampling_algorithm</span><span class="grouping">[</span><span class="string-literal">"custom-reservoir-sampling"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="invalid">\</span>
        <span class="keyword">lambda</span> <span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">:</span> <span class="invalid">\</span>
        <span class="identifier">sample_without_replacement</span><span class="grouping">(</span><span class="identifier">n_population</span><span class="punctuation">,</span>
                                   <span class="identifier">n_samples</span><span class="punctuation">,</span>
                                   <span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">"reservoir_sampling"</span><span class="punctuation">,</span>
                                   <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="grouping">)</span>

    <span class="comment">###########################################################################</span>
    <span class="comment"># Set custom reservoir based method</span>
    <span class="identifier">sampling_algorithm</span><span class="grouping">[</span><span class="string-literal">"custom-pool"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="invalid">\</span>
        <span class="keyword">lambda</span> <span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">:</span> <span class="invalid">\</span>
        <span class="identifier">sample_without_replacement</span><span class="grouping">(</span><span class="identifier">n_population</span><span class="punctuation">,</span>
                                   <span class="identifier">n_samples</span><span class="punctuation">,</span>
                                   <span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">"pool"</span><span class="punctuation">,</span>
                                   <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="grouping">)</span>

    <span class="comment">###########################################################################</span>
    <span class="comment"># Numpy permutation based</span>
    <span class="identifier">sampling_algorithm</span><span class="grouping">[</span><span class="string-literal">"numpy-permutation"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="invalid">\</span>
        <span class="keyword">lambda</span> <span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">n_sample</span><span class="punctuation">:</span> <span class="invalid">\</span>
        <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">permutation</span><span class="grouping">(</span><span class="identifier">n_population</span><span class="grouping">)</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">n_sample</span><span class="grouping">]</span>

    <span class="comment">###########################################################################</span>
    <span class="comment"># Remove unspecified algorithm</span>
    <span class="identifier">sampling_algorithm</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">key</span><span class="punctuation">:</span> <span class="identifier">value</span>
                          <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">value</span> <span class="relational-operator">in</span> <span class="identifier">sampling_algorithm</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span>
                          <span class="keyword">if</span> <span class="identifier">key</span> <span class="relational-operator">in</span> <span class="identifier">selected_algorithm</span><span class="grouping">}</span>

    <span class="comment">###########################################################################</span>
    <span class="comment"># Perform benchmark</span>
    <span class="comment">###########################################################################</span>
    <span class="identifier">time</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="grouping">}</span>
    <span class="identifier">n_samples</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">linspace</span><span class="grouping">(</span><span class="identifier">start</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">stop</span><span class="arithmetic-assignment">=</span><span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_population</span><span class="punctuation">,</span>
                            <span class="identifier">num</span><span class="arithmetic-assignment">=</span><span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_steps</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span>

    <span class="identifier">ratio</span> <span class="arithmetic-assignment">=</span> <span class="identifier">n_samples</span> <span class="arithmetic-operator">/</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_population</span>

    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'Benchmarks'</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"==========================="</span><span class="grouping">)</span>

    <span class="keyword">for</span> <span class="identifier">name</span> <span class="relational-operator">in</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">sampling_algorithm</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Perform benchmarks for %s..." % name, end=""</span><span class="grouping">)</span>
        <span class="identifier">time</span><span class="grouping">[</span><span class="identifier">name</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">shape</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_steps</span><span class="punctuation">,</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_times</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="keyword">for</span> <span class="identifier">step</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_steps</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">for</span> <span class="identifier">it</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_times</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">time</span><span class="grouping">[</span><span class="identifier">name</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">step</span><span class="punctuation">,</span> <span class="identifier">it</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">bench_sample</span><span class="grouping">(</span><span class="identifier">sampling_algorithm</span><span class="grouping">[</span><span class="identifier">name</span><span class="grouping">]</span><span class="punctuation">,</span>
                                                    <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_population</span><span class="punctuation">,</span>
                                                    <span class="identifier">n_samples</span><span class="grouping">[</span><span class="identifier">step</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"done"</span><span class="grouping">)</span>

    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Averaging results...", end=""</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">name</span> <span class="relational-operator">in</span> <span class="identifier">sampling_algorithm</span><span class="punctuation">:</span>
        <span class="identifier">time</span><span class="grouping">[</span><span class="identifier">name</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">mean</span><span class="grouping">(</span><span class="identifier">time</span><span class="grouping">[</span><span class="identifier">name</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"done\n"</span><span class="grouping">)</span>

    <span class="comment"># Print results</span>
    <span class="comment">###########################################################################</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Script arguments"</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"==========================="</span><span class="grouping">)</span>
    <span class="identifier">arguments</span> <span class="arithmetic-assignment">=</span> <span class="identifier">vars</span><span class="grouping">(</span><span class="identifier">opts</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"%s \t | %s " % ("Arguments"</span><span class="punctuation">.</span><span class="identifier">ljust</span><span class="grouping">(</span><span class="int-literal">16</span><span class="grouping">)</span><span class="punctuation">,</span>
                           <span class="string-literal">"Value"</span><span class="punctuation">.</span><span class="identifier">center</span><span class="grouping">(</span><span class="int-literal">12</span><span class="grouping">)</span><span class="punctuation">,</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="int-literal">25</span> <span class="arithmetic-operator">*</span> <span class="string-literal">"-" + ("|" + "-"</span> <span class="arithmetic-operator">*</span> <span class="int-literal">14</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="int-literal">1</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">value</span> <span class="relational-operator">in</span> <span class="identifier">arguments</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"%s \t | %s "</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">key</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">ljust</span><span class="grouping">(</span><span class="int-literal">16</span><span class="grouping">)</span><span class="punctuation">,</span>
                               <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">value</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">strip</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">center</span><span class="grouping">(</span><span class="int-literal">12</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">""</span><span class="grouping">)</span>

    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Sampling algorithm performance:"</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"==============================="</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Results are averaged over %s repetition(s)."</span> <span class="arithmetic-operator">%</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_times</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">""</span><span class="grouping">)</span>

    <span class="identifier">fig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="string-literal">'scikit-learn sample w/o replacement benchmark results'</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="string-literal">"n_population = %s, n_times = %s"</span> <span class="arithmetic-operator">%</span>
              <span class="grouping">(</span><span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_population</span><span class="punctuation">,</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_times</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">add_subplot</span><span class="grouping">(</span><span class="int-literal">111</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">name</span> <span class="relational-operator">in</span> <span class="identifier">sampling_algorithm</span><span class="punctuation">:</span>
        <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">ratio</span><span class="punctuation">,</span> <span class="identifier">time</span><span class="grouping">[</span><span class="identifier">name</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="identifier">name</span><span class="grouping">)</span>

    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xlabel</span><span class="grouping">(</span><span class="string-literal">'ratio of n_sample / n_population'</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="string-literal">'Time (s)'</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="comment"># Sort legend labels</span>
    <span class="identifier">handles</span><span class="punctuation">,</span> <span class="identifier">labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_legend_handles_labels</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">hl</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">handles</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="arithmetic-assignment">=</span><span class="identifier">operator</span><span class="punctuation">.</span><span class="identifier">itemgetter</span><span class="grouping">(</span><span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">handles2</span><span class="punctuation">,</span> <span class="identifier">labels2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">hl</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="identifier">handles2</span><span class="punctuation">,</span> <span class="identifier">labels2</span><span class="punctuation">,</span> <span class="identifier">loc</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>