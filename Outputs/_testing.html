<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""Testing utilities."""</span>

<span class="comment"># Copyright (c) 2011, 2012</span>
<span class="comment"># Authors: Pietro Berkes,</span>
<span class="comment">#          Andreas Muller</span>
<span class="comment">#          Mathieu Blondel</span>
<span class="comment">#          Olivier Grisel</span>
<span class="comment">#          Arnaud Joly</span>
<span class="comment">#          Denis Engemann</span>
<span class="comment">#          Giorgio Patrini</span>
<span class="comment">#          Thierry Guillemot</span>
<span class="comment"># License: BSD 3 clause</span>
<span class="keyword">import</span> <span class="identifier">os</span>
<span class="keyword">import</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="keyword">as</span> <span class="identifier">op</span>
<span class="keyword">import</span> <span class="identifier">inspect</span>
<span class="keyword">import</span> <span class="identifier">warnings</span>
<span class="keyword">import</span> <span class="identifier">sys</span>
<span class="keyword">import</span> <span class="identifier">functools</span>
<span class="keyword">import</span> <span class="identifier">tempfile</span>
<span class="keyword">from</span> <span class="identifier">subprocess</span> <span class="keyword">import</span> <span class="identifier">check_output</span><span class="punctuation">,</span> <span class="identifier">STDOUT</span><span class="punctuation">,</span> <span class="identifier">CalledProcessError</span>
<span class="keyword">from</span> <span class="identifier">subprocess</span> <span class="keyword">import</span> <span class="identifier">TimeoutExpired</span>
<span class="keyword">import</span> <span class="identifier">re</span>
<span class="keyword">import</span> <span class="identifier">contextlib</span>
<span class="keyword">from</span> <span class="identifier">collections</span><span class="punctuation">.</span><span class="identifier">abc</span> <span class="keyword">import</span> <span class="identifier">Iterable</span>

<span class="keyword">import</span> <span class="identifier">scipy</span> <span class="keyword">as</span> <span class="identifier">sp</span>
<span class="keyword">from</span> <span class="identifier">functools</span> <span class="keyword">import</span> <span class="identifier">wraps</span>
<span class="keyword">from</span> <span class="identifier">inspect</span> <span class="keyword">import</span> <span class="identifier">signature</span>

<span class="keyword">import</span> <span class="identifier">shutil</span>
<span class="keyword">import</span> <span class="identifier">atexit</span>
<span class="keyword">import</span> <span class="identifier">unittest</span>
<span class="keyword">from</span> <span class="identifier">unittest</span> <span class="keyword">import</span> <span class="identifier">TestCase</span>

<span class="comment"># WindowsError only exist on Windows</span>
<span class="keyword">try</span><span class="punctuation">:</span>
    <span class="identifier">WindowsError</span>
<span class="keyword">except</span> <span class="identifier">NameError</span><span class="punctuation">:</span>
    <span class="identifier">WindowsError</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>

<span class="keyword">from</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span>
<span class="keyword">from</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">m</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span>
<span class="keyword">from</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">p</span><span class="invalid">p</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">x</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span>
<span class="keyword">from</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span>
<span class="keyword">from</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">m</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span>
<span class="keyword">from</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">testing</span> <span class="keyword">import</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span>
<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">joblib</span>

<span class="keyword">import</span> <span class="identifier">sklearn</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">IS_PYPY</span><span class="punctuation">,</span> <span class="identifier">_IS_32BIT</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">multiclass</span> <span class="keyword">import</span> <span class="identifier">check_classification_targets</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">validation</span> <span class="keyword">import</span> <span class="grouping">(</span>
    <span class="identifier">check_array</span><span class="punctuation">,</span>
    <span class="identifier">check_is_fitted</span><span class="punctuation">,</span>
    <span class="identifier">check_X_y</span><span class="punctuation">,</span>
<span class="grouping">)</span>


<span class="identifier">__all__</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"assert_raises"</span><span class="punctuation">,</span>
           <span class="string-literal">"assert_raises_regexp"</span><span class="punctuation">,</span>
           <span class="string-literal">"assert_array_equal"</span><span class="punctuation">,</span>
           <span class="string-literal">"assert_almost_equal"</span><span class="punctuation">,</span>
           <span class="string-literal">"assert_array_almost_equal", "assert_array_less"</span><span class="punctuation">,</span>
           <span class="string-literal">"assert_approx_equal", "assert_allclose"</span><span class="punctuation">,</span>
           <span class="string-literal">"assert_run_python_script", "SkipTest"</span><span class="grouping">]</span>

<span class="identifier">_dummy</span> <span class="arithmetic-assignment">=</span> <span class="identifier">TestCase</span><span class="grouping">(</span><span class="string-literal">'__init__'</span><span class="grouping">)</span>
<span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_dummy</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">R</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span>
<span class="identifier">SkipTest</span> <span class="arithmetic-assignment">=</span> <span class="identifier">unittest</span><span class="punctuation">.</span><span class="identifier">case</span><span class="punctuation">.</span><span class="identifier">SkipTest</span>
<span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">i</span><span class="invalid">c</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_dummy</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">D</span><span class="invalid">i</span><span class="invalid">c</span><span class="invalid">t</span><span class="invalid">E</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span>

<span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">e</span><span class="invalid">x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_dummy</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">R</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">R</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">e</span><span class="invalid">x</span>
<span class="comment"># assert_raises_regexp is deprecated in Python 3.4 in favor of</span>
<span class="comment"># assert_raises_regex but lets keep the backward compat in scikit-learn with</span>
<span class="comment"># the old name for now</span>
<span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">e</span><span class="invalid">x</span><span class="invalid">p</span> <span class="arithmetic-assignment">=</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">e</span><span class="invalid">x</span>


<span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">warning_class</span><span class="punctuation">,</span> <span class="identifier">func</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kw</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Test that a certain warning occurs.

    Parameters
    ----------
    warning_class : the warning class
        The class to test for, e.g. UserWarning.

    func : callable
        Callable object to trigger warnings.

    *args : the positional arguments to `func`.

    **kw : the keyword arguments to `func`

    Returns
    -------
    result : the return value of `func`

    """</span>
    <span class="keyword">with</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">catch_warnings</span><span class="grouping">(</span><span class="identifier">record</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">w</span><span class="punctuation">:</span>
        <span class="comment"># Cause all warnings to always be triggered.</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">simplefilter</span><span class="grouping">(</span><span class="string-literal">"always"</span><span class="grouping">)</span>
        <span class="comment"># Trigger a warning.</span>
        <span class="identifier">result</span> <span class="arithmetic-assignment">=</span> <span class="identifier">func</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kw</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">,</span> <span class="string-literal">'FutureWarning'</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="comment"># Filter out numpy-specific warnings in numpy &gt;= 1.9</span>
            <span class="identifier">w</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">e</span> <span class="keyword">for</span> <span class="identifier">e</span> <span class="relational-operator">in</span> <span class="identifier">w</span>
                 <span class="keyword">if</span> <span class="identifier">e</span><span class="punctuation">.</span><span class="identifier">category</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">VisibleDeprecationWarning</span><span class="grouping">]</span>

        <span class="comment"># Verify some things</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">w</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"No warning raised when calling %s"</span>
                                 <span class="arithmetic-operator">%</span> <span class="identifier">func</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

        <span class="identifier">found</span> <span class="arithmetic-assignment">=</span> <span class="identifier">any</span><span class="grouping">(</span><span class="identifier">warning</span><span class="punctuation">.</span><span class="identifier">category</span> <span class="relational-operator">is</span> <span class="identifier">warning_class</span> <span class="keyword">for</span> <span class="identifier">warning</span> <span class="relational-operator">in</span> <span class="identifier">w</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">found</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"%s did not give warning: %s( is %s)"</span>
                                 <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">func</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">warning_class</span><span class="punctuation">,</span> <span class="identifier">w</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">result</span>


<span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">warning_class</span><span class="punctuation">,</span> <span class="identifier">message</span><span class="punctuation">,</span> <span class="identifier">func</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kw</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># very important to avoid uncontrolled state propagation</span>
    <span class="comment">"""Test that a certain warning occurs and with a certain message.

    Parameters
    ----------
    warning_class : the warning class
        The class to test for, e.g. UserWarning.

    message : str or callable
        The message or a substring of the message to test for. If callable,
        it takes a string as the argument and will trigger an AssertionError
        if the callable returns `False`.

    func : callable
        Callable object to trigger warnings.

    *args : the positional arguments to `func`.

    **kw : the keyword arguments to `func`.

    Returns
    -------
    result : the return value of `func`

    """</span>
    <span class="keyword">with</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">catch_warnings</span><span class="grouping">(</span><span class="identifier">record</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">w</span><span class="punctuation">:</span>
        <span class="comment"># Cause all warnings to always be triggered.</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">simplefilter</span><span class="grouping">(</span><span class="string-literal">"always"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">,</span> <span class="string-literal">'FutureWarning'</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="comment"># Let's not catch the numpy internal DeprecationWarnings</span>
            <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">simplefilter</span><span class="grouping">(</span><span class="string-literal">'ignore'</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">VisibleDeprecationWarning</span><span class="grouping">)</span>
        <span class="comment"># Trigger a warning.</span>
        <span class="identifier">result</span> <span class="arithmetic-assignment">=</span> <span class="identifier">func</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kw</span><span class="grouping">)</span>
        <span class="comment"># Verify some things</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">w</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"No warning raised when calling %s"</span>
                                 <span class="arithmetic-operator">%</span> <span class="identifier">func</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

        <span class="identifier">found</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">issubclass</span><span class="grouping">(</span><span class="identifier">warning</span><span class="punctuation">.</span><span class="identifier">category</span><span class="punctuation">,</span> <span class="identifier">warning_class</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">warning</span> <span class="relational-operator">in</span> <span class="identifier">w</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">any</span><span class="grouping">(</span><span class="identifier">found</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"No warning raised for %s with class "</span>
                                 <span class="string-literal">"%s"</span>
                                 <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">func</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">warning_class</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="identifier">message_found</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="comment"># Checks the message of all warnings belong to warning_class</span>
        <span class="keyword">for</span> <span class="identifier">index</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="identifier">i</span> <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">x</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">found</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">x</span><span class="grouping">]</span><span class="punctuation">:</span>
            <span class="comment"># substring will match, the entire message with typo won't</span>
            <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="identifier">w</span><span class="grouping">[</span><span class="identifier">index</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">message</span>  <span class="comment"># For Python 3 compatibility</span>
            <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">msg</span><span class="punctuation">.</span><span class="identifier">args</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">msg</span><span class="punctuation">,</span> <span class="string-literal">'args'</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="identifier">msg</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">callable</span><span class="grouping">(</span><span class="identifier">message</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># add support for certain tests</span>
                <span class="identifier">check_in_message</span> <span class="arithmetic-assignment">=</span> <span class="identifier">message</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="keyword">def</span> <span class="identifier">check_in_message</span><span class="grouping">(</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span> <span class="keyword">return</span> <span class="identifier">message</span> <span class="relational-operator">in</span> <span class="identifier">msg</span>

            <span class="keyword">if</span> <span class="identifier">check_in_message</span><span class="grouping">(</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">message_found</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
                <span class="keyword">break</span>

        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">message_found</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"Did not receive the message you expected "</span>
                                 <span class="string-literal">"('%s') for &lt;%s&gt;, got: '%s'"</span>
                                 <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">message</span><span class="punctuation">,</span> <span class="identifier">func</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">msg</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">return</span> <span class="identifier">result</span>


<span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">i</span><span class="invalid">v</span><span class="int-literal">0</span><span class="grouping">(</span><span class="identifier">func</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kw</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Assume that numpy's warning for divide by zero is raised.

    Handles the case of platforms that do not support warning on divide by
    zero.

    Parameters
    ----------
    func
    *args
    **kw
    """</span>

    <span class="keyword">with</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">errstate</span><span class="grouping">(</span><span class="identifier">divide</span><span class="arithmetic-assignment">=</span><span class="string-literal">'warn', invalid='warn'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">RuntimeWarning</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">divide</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">:</span>
            <span class="comment"># This platform does not report numpy divide by zeros</span>
            <span class="keyword">return</span> <span class="identifier">func</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kw</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">RuntimeWarning</span><span class="punctuation">,</span>
                                    <span class="string-literal">'invalid value encountered'</span><span class="punctuation">,</span>
                                    <span class="identifier">func</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kw</span><span class="grouping">)</span>


<span class="comment"># To remove when we support numpy 1.7</span>
<span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">func</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kw</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Parameters
    ----------
    func
    *args
    **kw
    """</span>
    <span class="comment"># very important to avoid uncontrolled state propagation</span>
    <span class="keyword">with</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">catch_warnings</span><span class="grouping">(</span><span class="identifier">record</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">w</span><span class="punctuation">:</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">simplefilter</span><span class="grouping">(</span><span class="string-literal">'always'</span><span class="grouping">)</span>

        <span class="identifier">result</span> <span class="arithmetic-assignment">=</span> <span class="identifier">func</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kw</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">,</span> <span class="string-literal">'FutureWarning'</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="comment"># Filter out numpy-specific warnings in numpy &gt;= 1.9</span>
            <span class="identifier">w</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">e</span> <span class="keyword">for</span> <span class="identifier">e</span> <span class="relational-operator">in</span> <span class="identifier">w</span>
                 <span class="keyword">if</span> <span class="identifier">e</span><span class="punctuation">.</span><span class="identifier">category</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">VisibleDeprecationWarning</span><span class="grouping">]</span>

        <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">w</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"Got warnings when calling %s: [%s]"</span>
                                 <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">func</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span>
                                    <span class="string-literal">', '</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">warning</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">warning</span> <span class="relational-operator">in</span> <span class="identifier">w</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">result</span>


<span class="keyword">def</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">obj</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">Warning</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Context manager and decorator to ignore warnings.

    Note: Using this (in both variants) will clear all warnings
    from all python modules loaded. In case you need to test
    cross-module-warning-logging, this is not your tool of choice.

    Parameters
    ----------
    obj : callable, default=None
        callable where you want to ignore the warnings.
    category : warning class, default=Warning
        The category to filter. If Warning, all categories will be muted.

    Examples
    --------
    &gt;&gt;&gt; with ignore_warnings():
    ...     warnings.warn('buhuhuhu')

    &gt;&gt;&gt; def nasty_warn():
    ...     warnings.warn('buhuhuhu')
    ...     print(42)

    &gt;&gt;&gt; ignore_warnings(nasty_warn)()
    42
    """</span>
    <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">obj</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="identifier">issubclass</span><span class="grouping">(</span><span class="identifier">obj</span><span class="punctuation">,</span> <span class="identifier">Warning</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># Avoid common pitfall of passing category as the first positional</span>
        <span class="comment"># argument which result in the test not being run</span>
        <span class="identifier">warning_name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">obj</span><span class="punctuation">.</span><span class="identifier">__name__</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span>
            <span class="string-literal">"'obj' should be a callable where you want to ignore warnings. "</span>
            <span class="string-literal">"You passed a warning class instead: 'obj={warning_name}'. "</span>
            <span class="string-literal">"If you want to pass a warning class to ignore_warnings, "</span>
            <span class="string-literal">"you should use 'category={warning_name}'"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span>
                <span class="identifier">warning_name</span><span class="arithmetic-assignment">=</span><span class="identifier">warning_name</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">callable</span><span class="grouping">(</span><span class="identifier">obj</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">_IgnoreWarnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">category</span><span class="grouping">)</span><span class="grouping">(</span><span class="identifier">obj</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">_IgnoreWarnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">category</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_IgnoreWarnings</span><span class="punctuation">:</span>
    <span class="comment">"""Improved and simplified Python warnings context manager and decorator.

    This class allows the user to ignore the warnings raised by a function.
    Copied from Python 2.7.5 and modified as required.

    Parameters
    ----------
    category : tuple of warning class, default=Warning
        The category to filter. By default, all the categories will be muted.

    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">category</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_record</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_module</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">modules</span><span class="grouping">[</span><span class="string-literal">'warnings'</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_entered</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">log</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">category</span> <span class="arithmetic-assignment">=</span> <span class="identifier">category</span>

    <span class="keyword">def</span> <span class="identifier">__call__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">fn</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Decorator to catch and hide warnings without visual nesting."""</span>
        <span class="punctuation">@</span><span class="identifier">wraps</span><span class="grouping">(</span><span class="identifier">fn</span><span class="grouping">)</span>
        <span class="keyword">def</span> <span class="identifier">wrapper</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">with</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">catch_warnings</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">simplefilter</span><span class="grouping">(</span><span class="string-literal">"ignore"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">category</span><span class="grouping">)</span>
                <span class="keyword">return</span> <span class="identifier">fn</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>

        <span class="keyword">return</span> <span class="identifier">wrapper</span>

    <span class="keyword">def</span> <span class="identifier">__repr__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">args</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_record</span><span class="punctuation">:</span>
            <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">"record=True"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_module</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">modules</span><span class="grouping">[</span><span class="string-literal">'warnings'</span><span class="grouping">]</span><span class="punctuation">:</span>
            <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">"module=%r"</span> <span class="arithmetic-operator">%</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_module</span><span class="grouping">)</span>
        <span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">type</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__name__</span>
        <span class="keyword">return</span> <span class="string-literal">"%s(%s)" % (name, ", "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">args</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">__enter__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_entered</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">RuntimeError</span><span class="grouping">(</span><span class="string-literal">"Cannot enter %r twice"</span> <span class="arithmetic-operator">%</span> <span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_entered</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filters</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_module</span><span class="punctuation">.</span><span class="identifier">filters</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_module</span><span class="punctuation">.</span><span class="identifier">filters</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filters</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_showwarning</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_module</span><span class="punctuation">.</span><span class="identifier">showwarning</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">simplefilter</span><span class="grouping">(</span><span class="string-literal">"ignore"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">category</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">__exit__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">exc_info</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_entered</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">RuntimeError</span><span class="grouping">(</span><span class="string-literal">"Cannot exit %r without entering first"</span> <span class="arithmetic-operator">%</span> <span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_module</span><span class="punctuation">.</span><span class="identifier">filters</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_filters</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_module</span><span class="punctuation">.</span><span class="identifier">showwarning</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_showwarning</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">log</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>


<span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="grouping">(</span><span class="invalid">e</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">message</span><span class="punctuation">,</span> <span class="identifier">function</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Helper function to test the message raised in an exception.

    Given an exception, a callable to raise the exception, and
    a message string, tests that the correct exception is raised and
    that the message is a substring of the error thrown. Used to test
    that the specific message thrown during an exception is correct.

    Parameters
    ----------
    exceptions : exception or tuple of exception
        An Exception object.

    message : str
        The error message or a substring of the error message.

    function : callable
        Callable object to raise error.

    *args : the positional arguments to `function`.

    **kwargs : the keyword arguments to `function`.
    """</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="identifier">function</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>
    <span class="keyword">except</span> <span class="invalid">e</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">s</span> <span class="keyword">as</span> <span class="identifier">e</span><span class="punctuation">:</span>
        <span class="identifier">error_message</span> <span class="arithmetic-assignment">=</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">e</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">message</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">error_message</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"Error message does not include the expected"</span>
                                 <span class="string-literal">" string: %r. Observed error message: %r"</span> <span class="arithmetic-operator">%</span>
                                 <span class="grouping">(</span><span class="identifier">message</span><span class="punctuation">,</span> <span class="identifier">error_message</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="comment"># concatenate exception names</span>
        <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="invalid">e</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">tuple</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">names</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">" or "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">e</span><span class="punctuation">.</span><span class="identifier">__name__</span> <span class="keyword">for</span> <span class="identifier">e</span> <span class="relational-operator">in</span> <span class="invalid">e</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">names</span> <span class="arithmetic-assignment">=</span> <span class="invalid">e</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">s</span><span class="punctuation">.</span><span class="identifier">__name__</span>

        <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"%s not raised by %s"</span> <span class="arithmetic-operator">%</span>
                             <span class="grouping">(</span><span class="identifier">names</span><span class="punctuation">,</span> <span class="identifier">function</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">n</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">p</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">x</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">rtol</span><span class="arithmetic-assignment">=</span><span class="float-literal">1e-07</span><span class="punctuation">,</span> <span class="identifier">atol</span><span class="arithmetic-assignment">=</span><span class="float-literal">1e-9</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="arithmetic-assignment">=</span><span class="string-literal">''</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Assert allclose for sparse and dense data.

    Both x and y need to be either sparse or dense, they
    can't be mixed.

    Parameters
    ----------
    x : {array-like, sparse matrix}
        First array to compare.

    y : {array-like, sparse matrix}
        Second array to compare.

    rtol : float, default=1e-07
        relative tolerance; see numpy.allclose.

    atol : float, default=1e-9
        absolute tolerance; see numpy.allclose. Note that the default here is
        more tolerant than the default for numpy.testing.assert_allclose, where
        atol=0.

    err_msg : str, default=''
        Error message to raise.
    """</span>
    <span class="keyword">if</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">issparse</span><span class="grouping">(</span><span class="identifier">x</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">issparse</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">x</span><span class="punctuation">.</span><span class="identifier">tocsr</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">y</span><span class="punctuation">.</span><span class="identifier">tocsr</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">x</span><span class="punctuation">.</span><span class="identifier">sum_duplicates</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">y</span><span class="punctuation">.</span><span class="identifier">sum_duplicates</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">x</span><span class="punctuation">.</span><span class="identifier">indices</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">.</span><span class="identifier">indices</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">x</span><span class="punctuation">.</span><span class="identifier">indptr</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">.</span><span class="identifier">indptr</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">x</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">rtol</span><span class="arithmetic-assignment">=</span><span class="identifier">rtol</span><span class="punctuation">,</span> <span class="identifier">atol</span><span class="arithmetic-assignment">=</span><span class="identifier">atol</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="logical-operator">not</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">issparse</span><span class="grouping">(</span><span class="identifier">x</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="logical-operator">not</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">issparse</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># both dense</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">x</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">rtol</span><span class="arithmetic-assignment">=</span><span class="identifier">rtol</span><span class="punctuation">,</span> <span class="identifier">atol</span><span class="arithmetic-assignment">=</span><span class="identifier">atol</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Can only compare two sparse matrices,"</span>
                         <span class="string-literal">" not a sparse matrix and an array."</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">set_random_state</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Set random state of an estimator if it has the `random_state` param.

    Parameters
    ----------
    estimator : object
        The estimator.
    random_state : int, RandomState instance or None, default=0
        Pseudo random number generator state.
        Pass an int for reproducible results across multiple function calls.
        See :term:`Glossary &lt;random_state&gt;`.
    """</span>
    <span class="keyword">if</span> <span class="string-literal">"random_state"</span> <span class="relational-operator">in</span> <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">get_params</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">set_params</span><span class="grouping">(</span><span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="grouping">)</span>


<span class="keyword">try</span><span class="punctuation">:</span>
    <span class="keyword">import</span> <span class="identifier">pytest</span>

    <span class="identifier">skip_if_32bit</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">skipif</span><span class="grouping">(</span><span class="identifier">_IS_32BIT</span><span class="punctuation">,</span>
                                       <span class="identifier">reason</span><span class="arithmetic-assignment">=</span><span class="string-literal">'skipped on 32bit platforms'</span><span class="grouping">)</span>
    <span class="identifier">skip_travis</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">skipif</span><span class="grouping">(</span><span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">environ</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">'TRAVIS') == 'true'</span><span class="punctuation">,</span>
                                     <span class="identifier">reason</span><span class="arithmetic-assignment">=</span><span class="string-literal">'skip on travis'</span><span class="grouping">)</span>
    <span class="identifier">fails_if_pypy</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">xfail</span><span class="grouping">(</span><span class="identifier">IS_PYPY</span><span class="punctuation">,</span>
                                      <span class="identifier">reason</span><span class="arithmetic-assignment">=</span><span class="string-literal">'not compatible with PyPy'</span><span class="grouping">)</span>
    <span class="identifier">skip_if_no_parallel</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">skipif</span><span class="grouping">(</span><span class="logical-operator">not</span> <span class="identifier">joblib</span><span class="punctuation">.</span><span class="identifier">parallel</span><span class="punctuation">.</span><span class="identifier">mp</span><span class="punctuation">,</span>
                                             <span class="identifier">reason</span><span class="arithmetic-assignment">=</span><span class="string-literal">"joblib is in serial mode"</span><span class="grouping">)</span>

    <span class="comment">#  Decorator for tests involving both BLAS calls and multiprocessing.</span>
    <span class="comment">#</span>
    <span class="comment">#  Under POSIX (e.g. Linux or OSX), using multiprocessing in conjunction</span>
    <span class="comment">#  with some implementation of BLAS (or other libraries that manage an</span>
    <span class="comment">#  internal posix thread pool) can cause a crash or a freeze of the Python</span>
    <span class="comment">#  process.</span>
    <span class="comment">#</span>
    <span class="comment">#  In practice all known packaged distributions (from Linux distros or</span>
    <span class="comment">#  Anaconda) of BLAS under Linux seems to be safe. So we this problem seems</span>
    <span class="comment">#  to only impact OSX users.</span>
    <span class="comment">#</span>
    <span class="comment">#  This wrapper makes it possible to skip tests that can possibly cause</span>
    <span class="comment">#  this crash under OS X with.</span>
    <span class="comment">#</span>
    <span class="comment">#  Under Python 3.4+ it is possible to use the `forkserver` start method</span>
    <span class="comment">#  for multiprocessing to avoid this issue. However it can cause pickling</span>
    <span class="comment">#  errors on interactively defined functions. It therefore not enabled by</span>
    <span class="comment">#  default.</span>

    <span class="invalid">i</span><span class="invalid">f</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">f</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">p</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">i</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">_</span><span class="invalid">b</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">skipif</span><span class="grouping">(</span>
            <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">platform</span> <span class="relational-operator">==</span> <span class="string-literal">'darwin'</span><span class="punctuation">,</span>
            <span class="identifier">reason</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Possible multi-process bug with some BLAS"</span><span class="grouping">)</span>
<span class="keyword">except</span> <span class="invalid">I</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">:</span>
    <span class="keyword">pass</span>


<span class="keyword">def</span> <span class="identifier">check_skip_network</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">if</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">environ</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">'SKLEARN_SKIP_NETWORK_TESTS'</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">SkipTest</span><span class="grouping">(</span><span class="string-literal">"Text tutorial requires large dataset download"</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_delete_folder</span><span class="grouping">(</span><span class="identifier">folder_path</span><span class="punctuation">,</span> <span class="identifier">warn</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Utility function to cleanup a temporary folder if still existing.

    Copy from joblib.pool (for independence).
    """</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">folder_path</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="comment"># This can fail under windows,</span>
            <span class="comment">#  but will succeed when called by atexit</span>
            <span class="identifier">shutil</span><span class="punctuation">.</span><span class="identifier">rmtree</span><span class="grouping">(</span><span class="identifier">folder_path</span><span class="grouping">)</span>
    <span class="keyword">except</span> <span class="identifier">WindowsError</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">warn</span><span class="punctuation">:</span>
            <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span><span class="string-literal">"Could not delete temporary folder %s"</span> <span class="arithmetic-operator">%</span> <span class="identifier">folder_path</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">TempMemmap</span><span class="punctuation">:</span>
    <span class="comment">"""
    Parameters
    ----------
    data
    mmap_mode : str, default='r'
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">mmap_mode</span><span class="arithmetic-assignment">=</span><span class="string-literal">'r'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">mmap_mode</span> <span class="arithmetic-assignment">=</span> <span class="identifier">mmap_mode</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span>

    <span class="keyword">def</span> <span class="identifier">__enter__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">data_read_only</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">temp_folder</span> <span class="arithmetic-assignment">=</span> <span class="identifier">create_memmap_backed_data</span><span class="grouping">(</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">mmap_mode</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">mmap_mode</span><span class="punctuation">,</span> <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">l</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">r</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">data_read_only</span>

    <span class="keyword">def</span> <span class="identifier">__exit__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">exc_type</span><span class="punctuation">,</span> <span class="identifier">exc_val</span><span class="punctuation">,</span> <span class="identifier">exc_tb</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">_delete_folder</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">temp_folder</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">create_memmap_backed_data</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">mmap_mode</span><span class="arithmetic-assignment">=</span><span class="string-literal">'r'</span><span class="punctuation">,</span> <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">l</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">r</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Parameters
    ----------
    data
    mmap_mode : str, default='r'
    return_folder :  bool, default=False
    """</span>
    <span class="identifier">temp_folder</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tempfile</span><span class="punctuation">.</span><span class="identifier">mkdtemp</span><span class="grouping">(</span><span class="identifier">prefix</span><span class="arithmetic-assignment">=</span><span class="string-literal">'sklearn_testing_'</span><span class="grouping">)</span>
    <span class="identifier">atexit</span><span class="punctuation">.</span><span class="identifier">register</span><span class="grouping">(</span><span class="identifier">functools</span><span class="punctuation">.</span><span class="identifier">partial</span><span class="grouping">(</span><span class="identifier">_delete_folder</span><span class="punctuation">,</span> <span class="identifier">temp_folder</span><span class="punctuation">,</span> <span class="identifier">warn</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">temp_folder</span><span class="punctuation">,</span> <span class="string-literal">'data.pkl'</span><span class="grouping">)</span>
    <span class="identifier">joblib</span><span class="punctuation">.</span><span class="identifier">dump</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
    <span class="identifier">memmap_backed_data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">joblib</span><span class="punctuation">.</span><span class="identifier">load</span><span class="grouping">(</span><span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">mmap_mode</span><span class="arithmetic-assignment">=</span><span class="identifier">mmap_mode</span><span class="grouping">)</span>
    <span class="identifier">result</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">memmap_backed_data</span> <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">l</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">r</span>
              <span class="keyword">else</span> <span class="grouping">(</span><span class="identifier">memmap_backed_data</span><span class="punctuation">,</span> <span class="identifier">temp_folder</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">result</span>


<span class="comment"># Utils to test docstrings</span>


<span class="keyword">def</span> <span class="identifier">_get_args</span><span class="grouping">(</span><span class="identifier">function</span><span class="punctuation">,</span> <span class="identifier">varargs</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Helper to get function arguments."""</span>

    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="identifier">params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">signature</span><span class="grouping">(</span><span class="identifier">function</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">parameters</span>
    <span class="keyword">except</span> <span class="identifier">ValueError</span><span class="punctuation">:</span>
        <span class="comment"># Error on builtin C function</span>
        <span class="keyword">return</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="identifier">args</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">key</span> <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">param</span> <span class="relational-operator">in</span> <span class="identifier">params</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">param</span><span class="punctuation">.</span><span class="identifier">kind</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="identifier">param</span><span class="punctuation">.</span><span class="identifier">VAR_POSITIONAL</span><span class="punctuation">,</span> <span class="identifier">param</span><span class="punctuation">.</span><span class="identifier">VAR_KEYWORD</span><span class="grouping">)</span><span class="grouping">]</span>
    <span class="keyword">if</span> <span class="identifier">varargs</span><span class="punctuation">:</span>
        <span class="identifier">varargs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">param</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="keyword">for</span> <span class="identifier">param</span> <span class="relational-operator">in</span> <span class="identifier">params</span><span class="punctuation">.</span><span class="identifier">values</span><span class="grouping">(</span><span class="grouping">)</span>
                   <span class="keyword">if</span> <span class="identifier">param</span><span class="punctuation">.</span><span class="identifier">kind</span> <span class="relational-operator">==</span> <span class="identifier">param</span><span class="punctuation">.</span><span class="identifier">VAR_POSITIONAL</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">varargs</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="identifier">varargs</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="keyword">return</span> <span class="identifier">args</span><span class="punctuation">,</span> <span class="identifier">varargs</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">args</span>


<span class="keyword">def</span> <span class="identifier">_get_func_name</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Get function full name.

    Parameters
    ----------
    func : callable
        The function object.

    Returns
    -------
    name : str
        The function name.
    """</span>
    <span class="identifier">parts</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="identifier">module</span> <span class="arithmetic-assignment">=</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">getmodule</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">module</span><span class="punctuation">:</span>
        <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">module</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="identifier">qualname</span> <span class="arithmetic-assignment">=</span> <span class="identifier">func</span><span class="punctuation">.</span><span class="identifier">__qualname__</span>
    <span class="keyword">if</span> <span class="identifier">qualname</span> <span class="relational-operator">!=</span> <span class="identifier">func</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">:</span>
        <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">qualname</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">qualname</span><span class="punctuation">.</span><span class="identifier">find</span><span class="grouping">(</span><span class="string-literal">'.'</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="identifier">parts</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">func</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="string-literal">'.'</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">parts</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span><span class="identifier">func</span><span class="punctuation">,</span> <span class="identifier">doc</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">ignore</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Helper to check docstring.

    Parameters
    ----------
    func : callable
        The function object to test.
    doc : str, default=None
        Docstring if it is passed manually to the test.
    ignore : list, default=None
        Parameters to ignore.

    Returns
    -------
    incorrect : list
        A list of string describing the incorrect results.
    """</span>
    <span class="keyword">from</span> <span class="identifier">numpydoc</span> <span class="keyword">import</span> <span class="identifier">docscrape</span>
    <span class="identifier">incorrect</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="identifier">ignore</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">ignore</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">else</span> <span class="identifier">ignore</span>

    <span class="identifier">func_name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_get_func_name</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="grouping">(</span><span class="logical-operator">not</span> <span class="identifier">func_name</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">'sklearn.'</span><span class="grouping">)</span> <span class="logical-operator">or</span>
            <span class="identifier">func_name</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">'sklearn.externals'</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">incorrect</span>
    <span class="comment"># Don't check docstring for property-functions</span>
    <span class="keyword">if</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">isdatadescriptor</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">incorrect</span>
    <span class="comment"># Don't check docstring for setup / teardown pytest functions</span>
    <span class="keyword">if</span> <span class="identifier">func_name</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">'.')[-1] in ('setup_module', 'teardown_module'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">incorrect</span>
    <span class="comment"># Dont check estimator_checks module</span>
    <span class="keyword">if</span> <span class="identifier">func_name</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">'.')[2] == 'estimator_checks'</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">incorrect</span>
    <span class="comment"># Get the arguments from the function signature</span>
    <span class="identifier">param_signature</span> <span class="arithmetic-assignment">=</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">filter</span><span class="grouping">(</span><span class="keyword">lambda</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="identifier">x</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">ignore</span><span class="punctuation">,</span> <span class="identifier">_get_args</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="comment"># drop self</span>
    <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">param_signature</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span> <span class="logical-operator">and</span> <span class="identifier">param_signature</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="string-literal">'self'</span><span class="punctuation">:</span>
        <span class="identifier">param_signature</span><span class="punctuation">.</span><span class="identifier">remove</span><span class="grouping">(</span><span class="string-literal">'self'</span><span class="grouping">)</span>

    <span class="comment"># Analyze function's docstring</span>
    <span class="keyword">if</span> <span class="identifier">doc</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">catch_warnings</span><span class="grouping">(</span><span class="identifier">record</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">w</span><span class="punctuation">:</span>
            <span class="keyword">try</span><span class="punctuation">:</span>
                <span class="identifier">doc</span> <span class="arithmetic-assignment">=</span> <span class="identifier">docscrape</span><span class="punctuation">.</span><span class="identifier">FunctionDoc</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span>
            <span class="keyword">except</span> <span class="invalid">E</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span> <span class="keyword">as</span> <span class="identifier">exp</span><span class="punctuation">:</span>
                <span class="identifier">incorrect</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="identifier">func_name</span> <span class="arithmetic-operator">+</span> <span class="string-literal">' parsing error: '</span> <span class="arithmetic-operator">+</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">exp</span><span class="grouping">)</span><span class="grouping">]</span>
                <span class="keyword">return</span> <span class="identifier">incorrect</span>
        <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">w</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">RuntimeError</span><span class="grouping">(</span><span class="string-literal">'Error for %s:\n%s'</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">func_name</span><span class="punctuation">,</span> <span class="identifier">w</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="identifier">param_docs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="keyword">for</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">type_definition</span><span class="punctuation">,</span> <span class="identifier">param_doc</span> <span class="relational-operator">in</span> <span class="identifier">doc</span><span class="grouping">[</span><span class="string-literal">'Parameters'</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="comment"># Type hints are empty only if parameter name ended with :</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">type_definition</span><span class="punctuation">.</span><span class="identifier">strip</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="string-literal">':' in name and name[:name.index(':'</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">:</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">strip</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">incorrect</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="identifier">func_name</span> <span class="arithmetic-operator">+</span>
                              <span class="string-literal">' There was no space between the param name and '</span>
                              <span class="string-literal">'colon (%r)'</span> <span class="arithmetic-operator">%</span> <span class="identifier">name</span><span class="grouping">]</span>
            <span class="keyword">elif</span> <span class="identifier">name</span><span class="punctuation">.</span><span class="identifier">rstrip</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">endswith</span><span class="grouping">(</span><span class="string-literal">':'</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">incorrect</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="identifier">func_name</span> <span class="arithmetic-operator">+</span>
                              <span class="string-literal">' Parameter %r has an empty type spec. '</span>
                              <span class="string-literal">'Remove the colon'</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">.</span><span class="identifier">lstrip</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">]</span>

        <span class="comment"># Create a list of parameters to compare with the parameters gotten</span>
        <span class="comment"># from the func signature</span>
        <span class="keyword">if</span> <span class="string-literal">'*'</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">name</span><span class="punctuation">:</span>
            <span class="identifier">param_docs</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">':')[0].strip('` '</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># If one of the docstring's parameters had an error then return that</span>
    <span class="comment"># incorrect message</span>
    <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">incorrect</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">incorrect</span>

    <span class="comment"># Remove the parameters that should be ignored from list</span>
    <span class="identifier">param_docs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">filter</span><span class="grouping">(</span><span class="keyword">lambda</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="identifier">x</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">ignore</span><span class="punctuation">,</span> <span class="identifier">param_docs</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># The following is derived from pytest, Copyright (c) 2004-2017 Holger</span>
    <span class="comment"># Krekel and others, Licensed under MIT License. See</span>
    <span class="comment"># https://github.com/pytest-dev/pytest</span>

    <span class="identifier">message</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">min</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">param_docs</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">param_signature</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">param_signature</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="relational-operator">!=</span> <span class="identifier">param_docs</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="punctuation">:</span>
            <span class="identifier">message</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="string-literal">"There's a parameter name mismatch in function"</span>
                        <span class="string-literal">" docstring w.r.t. function signature, at index %s"</span>
                        <span class="string-literal">" diff: %r != %r"</span> <span class="arithmetic-operator">%</span>
                        <span class="grouping">(</span><span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">param_signature</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">param_docs</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">]</span>
            <span class="keyword">break</span>
    <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">param_signature</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">param_docs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">message</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="string-literal">"Parameters in function docstring have less items w.r.t."</span>
                    <span class="string-literal">" function signature, first missing item: %s"</span> <span class="arithmetic-operator">%</span>
                    <span class="identifier">param_signature</span><span class="grouping">[</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">param_docs</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">]</span>

    <span class="keyword">elif</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">param_signature</span><span class="grouping">)</span> <span class="relational-operator">&lt;</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">param_docs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">message</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="string-literal">"Parameters in function docstring have more items w.r.t."</span>
                    <span class="string-literal">" function signature, first extra item: %s"</span> <span class="arithmetic-operator">%</span>
                    <span class="identifier">param_docs</span><span class="grouping">[</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">param_signature</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">]</span>

    <span class="comment"># If there wasn't any difference in the parameters themselves between</span>
    <span class="comment"># docstring and signature including having the same length then return</span>
    <span class="comment"># empty list</span>
    <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">message</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="grouping">[</span><span class="grouping">]</span>

    <span class="keyword">import</span> <span class="identifier">difflib</span>
    <span class="keyword">import</span> <span class="identifier">pprint</span>

    <span class="identifier">param_docs_formatted</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">pformat</span><span class="grouping">(</span><span class="identifier">param_docs</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">splitlines</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">param_signature_formatted</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">pformat</span><span class="grouping">(</span><span class="identifier">param_signature</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">splitlines</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="identifier">message</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="string-literal">"Full diff:"</span><span class="grouping">]</span>

    <span class="identifier">message</span><span class="punctuation">.</span><span class="identifier">extend</span><span class="grouping">(</span>
        <span class="identifier">line</span><span class="punctuation">.</span><span class="identifier">strip</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">line</span> <span class="relational-operator">in</span> <span class="identifier">difflib</span><span class="punctuation">.</span><span class="identifier">ndiff</span><span class="grouping">(</span><span class="identifier">param_signature_formatted</span><span class="punctuation">,</span>
                                               <span class="identifier">param_docs_formatted</span><span class="grouping">)</span>
    <span class="grouping">)</span>

    <span class="identifier">incorrect</span><span class="punctuation">.</span><span class="identifier">extend</span><span class="grouping">(</span><span class="identifier">message</span><span class="grouping">)</span>

    <span class="comment"># Prepend function name</span>
    <span class="identifier">incorrect</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'In function: '</span> <span class="arithmetic-operator">+</span> <span class="identifier">func_name</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="identifier">incorrect</span>

    <span class="keyword">return</span> <span class="identifier">incorrect</span>


<span class="keyword">def</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">u</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">p</span><span class="invalid">y</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">c</span><span class="invalid">r</span><span class="invalid">i</span><span class="invalid">p</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">source_code</span><span class="punctuation">,</span> <span class="identifier">timeout</span><span class="arithmetic-assignment">=</span><span class="int-literal">60</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Utility to check assertions in an independent Python subprocess.

    The script provided in the source code should return 0 and not print
    anything on stderr or stdout.

    This is a port from cloudpickle https://github.com/cloudpipe/cloudpickle

    Parameters
    ----------
    source_code : str
        The Python source code to execute.
    timeout : int, default=60
        Time in seconds before timeout.
    """</span>
    <span class="identifier">fd</span><span class="punctuation">,</span> <span class="identifier">source_file</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tempfile</span><span class="punctuation">.</span><span class="identifier">mkstemp</span><span class="grouping">(</span><span class="identifier">suffix</span><span class="arithmetic-assignment">=</span><span class="string-literal">'_src_test_sklearn.py'</span><span class="grouping">)</span>
    <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">close</span><span class="grouping">(</span><span class="identifier">fd</span><span class="grouping">)</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">open</span><span class="grouping">(</span><span class="identifier">source_file</span><span class="punctuation">,</span> <span class="string-literal">'wb'</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">f</span><span class="punctuation">:</span>
            <span class="identifier">f</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="identifier">source_code</span><span class="punctuation">.</span><span class="identifier">encode</span><span class="grouping">(</span><span class="string-literal">'utf-8'</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">cmd</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">executable</span><span class="punctuation">,</span> <span class="identifier">source_file</span><span class="grouping">]</span>
        <span class="identifier">cwd</span> <span class="arithmetic-assignment">=</span> <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">normpath</span><span class="grouping">(</span><span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">__file__</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">'..'</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">env</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">environ</span><span class="punctuation">.</span><span class="identifier">copy</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="identifier">env</span><span class="grouping">[</span><span class="string-literal">"PYTHONPATH"] = os.pathsep.join([cwd, env["PYTHONPATH"</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">KeyError</span><span class="punctuation">:</span>
            <span class="identifier">env</span><span class="grouping">[</span><span class="string-literal">"PYTHONPATH"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cwd</span>
        <span class="identifier">kwargs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span>
            <span class="string-literal">'cwd'</span><span class="punctuation">:</span> <span class="identifier">cwd</span><span class="punctuation">,</span>
            <span class="string-literal">'stderr'</span><span class="punctuation">:</span> <span class="identifier">STDOUT</span><span class="punctuation">,</span>
            <span class="string-literal">'env'</span><span class="punctuation">:</span> <span class="identifier">env</span>
        <span class="grouping">}</span>
        <span class="comment"># If coverage is running, pass the config file to the subprocess</span>
        <span class="identifier">coverage_rc</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">environ</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">"COVERAGE_PROCESS_START"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">coverage_rc</span><span class="punctuation">:</span>
            <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">'env']['COVERAGE_PROCESS_START'</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">coverage_rc</span>

        <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">'timeout'</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">timeout</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="keyword">try</span><span class="punctuation">:</span>
                <span class="identifier">out</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_output</span><span class="grouping">(</span><span class="identifier">cmd</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>
            <span class="keyword">except</span> <span class="identifier">CalledProcessError</span> <span class="keyword">as</span> <span class="identifier">e</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">RuntimeError</span><span class="grouping">(</span><span class="identifier">u</span><span class="string-literal">"script errored with output:\n%s"</span>
                                   <span class="arithmetic-operator">%</span> <span class="identifier">e</span><span class="punctuation">.</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">decode</span><span class="grouping">(</span><span class="string-literal">'utf-8'</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">out</span> <span class="relational-operator">!=</span> <span class="identifier">b</span><span class="string-literal">""</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">out</span><span class="punctuation">.</span><span class="identifier">decode</span><span class="grouping">(</span><span class="string-literal">'utf-8'</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">TimeoutExpired</span> <span class="keyword">as</span> <span class="identifier">e</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">RuntimeError</span><span class="grouping">(</span><span class="identifier">u</span><span class="string-literal">"script timeout, output so far:\n%s"</span>
                               <span class="arithmetic-operator">%</span> <span class="identifier">e</span><span class="punctuation">.</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">decode</span><span class="grouping">(</span><span class="string-literal">'utf-8'</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">finally</span><span class="punctuation">:</span>
        <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">unlink</span><span class="grouping">(</span><span class="identifier">source_file</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_convert_container</span><span class="grouping">(</span>
    <span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">constructor_name</span><span class="punctuation">,</span> <span class="identifier">columns_name</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span>
<span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Convert a given container to a specific array-like with a dtype.

    Parameters
    ----------
    container : array-like
        The container to convert.
    constructor_name : {"list", "tuple", "array", "sparse", "dataframe", \
            "series", "index", "slice", "sparse_csr", "sparse_csc"}
        The type of the returned container.
    columns_name : index or array-like, default=None
        For pandas container supporting `columns_names`, it will affect
        specific names.
    dtype : dtype, default=None
        Force the dtype of the container. Does not apply to `"slice"`
        container.

    Returns
    -------
    converted_container
    """</span>
    <span class="keyword">if</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'list'</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">dtype</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">container</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tolist</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'tuple'</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">dtype</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">tuple</span><span class="grouping">(</span><span class="identifier">container</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">tuple</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tolist</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'array'</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'sparse'</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">csr_matrix</span><span class="grouping">(</span><span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'dataframe'</span><span class="punctuation">:</span>
        <span class="identifier">pd</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">i</span><span class="invalid">p</span><span class="grouping">(</span><span class="string-literal">'pandas'</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">pd</span><span class="punctuation">.</span><span class="identifier">DataFrame</span><span class="grouping">(</span><span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">columns</span><span class="arithmetic-assignment">=</span><span class="identifier">columns_name</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'series'</span><span class="punctuation">:</span>
        <span class="identifier">pd</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">i</span><span class="invalid">p</span><span class="grouping">(</span><span class="string-literal">'pandas'</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">pd</span><span class="punctuation">.</span><span class="identifier">Series</span><span class="grouping">(</span><span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'index'</span><span class="punctuation">:</span>
        <span class="identifier">pd</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">i</span><span class="invalid">p</span><span class="grouping">(</span><span class="string-literal">'pandas'</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">pd</span><span class="punctuation">.</span><span class="identifier">Index</span><span class="grouping">(</span><span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'slice'</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">slice</span><span class="grouping">(</span><span class="identifier">container</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">container</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'sparse_csr'</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">csr_matrix</span><span class="grouping">(</span><span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">constructor_name</span> <span class="relational-operator">==</span> <span class="string-literal">'sparse_csc'</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">csc_matrix</span><span class="grouping">(</span><span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">expected_exc_type</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">may_pass</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Context manager to ensure exceptions are raised within a code block.

    This is similar to and inspired from pytest.raises, but supports a few
    other cases.

    This is only intended to be used in estimator_checks.py where we don't
    want to use pytest. In the rest of the code base, just use pytest.raises
    instead.

    Parameters
    ----------
    excepted_exc_type : Exception or list of Exception
        The exception that should be raised by the block. If a list, the block
        should raise one of the exceptions.
    match : str or list of str, default=None
        A regex that the exception message should match. If a list, one of
        the entries must match. If None, match isn't enforced.
    may_pass : bool, default=False
        If True, the block is allowed to not raise an exception. Useful in
        cases where some estimators may support a feature but others must
        fail with an appropriate error message. By default, the context
        manager will raise an exception if the block does not raise an
        exception.
    err_msg : str, default=None
        If the context manager fails (e.g. the block fails to raise the
        proper exception, or fails to match), then an AssertionError is
        raised with this message. By default, an AssertionError is raised
        with a default error message (depends on the kind of failure). Use
        this to indicate how users should fix their estimators to pass the
        checks.

    Attributes
    ----------
    raised_and_matched : bool
        True if an exception was raised and a match was found, False otherwise.
    """</span>
    <span class="keyword">return</span> <span class="identifier">_Raises</span><span class="grouping">(</span><span class="identifier">expected_exc_type</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="punctuation">,</span> <span class="identifier">may_pass</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_Raises</span><span class="grouping">(</span><span class="identifier">contextlib</span><span class="punctuation">.</span><span class="identifier">AbstractContextManager</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># see raises() for parameters</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">expected_exc_type</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="punctuation">,</span> <span class="identifier">may_pass</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">expected_exc_types</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span>
            <span class="identifier">expected_exc_type</span>
            <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">expected_exc_type</span><span class="punctuation">,</span> <span class="identifier">Iterable</span><span class="grouping">)</span>
            <span class="keyword">else</span> <span class="grouping">[</span><span class="identifier">expected_exc_type</span><span class="grouping">]</span>
        <span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">matches</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">match</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">match</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="identifier">match</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">may_pass</span> <span class="arithmetic-assignment">=</span> <span class="identifier">may_pass</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">err_msg</span> <span class="arithmetic-assignment">=</span> <span class="identifier">err_msg</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>

    <span class="keyword">def</span> <span class="identifier">__exit__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">exc_type</span><span class="punctuation">,</span> <span class="identifier">exc_value</span><span class="punctuation">,</span> <span class="identifier">_</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># see</span>
        <span class="comment"># https://docs.python.org/2.5/whatsnew/pep-343.html#SECTION000910000000000000000</span>

        <span class="keyword">if</span> <span class="identifier">exc_type</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>  <span class="comment"># No exception was raised in the block</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">may_pass</span><span class="punctuation">:</span>
                <span class="keyword">return</span> <span class="bool-literal">True</span>  <span class="comment"># CM is happy</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">err_msg</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span>
                    <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">err_msg</span> <span class="logical-operator">or</span> <span class="identifier">f</span><span class="string-literal">"Did not raise: {self.expected_exc_types}"</span>
                <span class="grouping">)</span>
                <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">err_msg</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">any</span><span class="grouping">(</span>
            <span class="identifier">issubclass</span><span class="grouping">(</span><span class="identifier">exc_type</span><span class="punctuation">,</span> <span class="identifier">expected_type</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">expected_type</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">expected_exc_types</span>
        <span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">err_msg</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">err_msg</span><span class="grouping">)</span> <span class="keyword">from</span> <span class="identifier">exc_value</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="keyword">return</span> <span class="bool-literal">False</span>  <span class="comment"># will re-raise the original exception</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">matches</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">err_msg</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">err_msg</span> <span class="logical-operator">or</span> <span class="grouping">(</span>
                <span class="string-literal">"The error message should contain one of the following "</span>
                <span class="string-literal">"patterns:\n{}\nGot {}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span>
                    <span class="string-literal">"\n"</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">matches</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">exc_value</span><span class="grouping">)</span>
                <span class="grouping">)</span>
            <span class="grouping">)</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">any</span><span class="grouping">(</span><span class="identifier">re</span><span class="punctuation">.</span><span class="identifier">search</span><span class="grouping">(</span><span class="identifier">match</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">exc_value</span><span class="grouping">)</span><span class="grouping">)</span>
                       <span class="keyword">for</span> <span class="identifier">match</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">matches</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">err_msg</span><span class="grouping">)</span> <span class="keyword">from</span> <span class="identifier">exc_value</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>

        <span class="keyword">return</span> <span class="bool-literal">True</span>


<span class="keyword">class</span> <span class="identifier">MinimalClassifier</span><span class="punctuation">:</span>
    <span class="comment">"""Minimal classifier implementation with inheriting from BaseEstimator.

    This estimator should be tested with:

    * `check_estimator` in `test_estimator_checks.py`;
    * within a `Pipeline` in `test_pipeline.py`;
    * within a `SearchCV` in `test_search.py`.
    """</span>
    <span class="identifier">_estimator_type</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"classifier"</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">param</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">param</span> <span class="arithmetic-assignment">=</span> <span class="identifier">param</span>

    <span class="keyword">def</span> <span class="identifier">get_params</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">deep</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="grouping">{</span><span class="string-literal">"param"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">param</span><span class="grouping">}</span>

    <span class="keyword">def</span> <span class="identifier">set_params</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">params</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">value</span> <span class="relational-operator">in</span> <span class="identifier">params</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">setattr</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">value</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">self</span>

    <span class="keyword">def</span> <span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_X_y</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
        <span class="identifier">check_classification_targets</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="punctuation">,</span> <span class="identifier">counts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">unique</span><span class="grouping">(</span><span class="identifier">y</span><span class="punctuation">,</span> <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">c</span><span class="invalid">o</span><span class="invalid">u</span><span class="invalid">n</span><span class="invalid">t</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_most_frequent_class_idx</span> <span class="arithmetic-assignment">=</span> <span class="identifier">counts</span><span class="punctuation">.</span><span class="identifier">argmax</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">self</span>

    <span class="keyword">def</span> <span class="identifier">predict_proba</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">check_is_fitted</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_array</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
        <span class="identifier">proba_shape</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="punctuation">.</span><span class="identifier">size</span><span class="grouping">)</span>
        <span class="identifier">y_proba</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">shape</span><span class="arithmetic-assignment">=</span><span class="identifier">proba_shape</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="grouping">)</span>
        <span class="identifier">y_proba</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_most_frequent_class_idx</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">1.0</span>
        <span class="keyword">return</span> <span class="identifier">y_proba</span>

    <span class="keyword">def</span> <span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">y_proba</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">predict_proba</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
        <span class="identifier">y_pred</span> <span class="arithmetic-assignment">=</span> <span class="identifier">y_proba</span><span class="punctuation">.</span><span class="identifier">argmax</span><span class="grouping">(</span><span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="grouping">[</span><span class="identifier">y_pred</span><span class="grouping">]</span>

    <span class="keyword">def</span> <span class="identifier">score</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="identifier">accuracy_score</span>
        <span class="keyword">return</span> <span class="identifier">accuracy_score</span><span class="grouping">(</span><span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">MinimalRegressor</span><span class="punctuation">:</span>
    <span class="comment">"""Minimal regressor implementation with inheriting from BaseEstimator.

    This estimator should be tested with:

    * `check_estimator` in `test_estimator_checks.py`;
    * within a `Pipeline` in `test_pipeline.py`;
    * within a `SearchCV` in `test_search.py`.
    """</span>
    <span class="identifier">_estimator_type</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"regressor"</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">param</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">param</span> <span class="arithmetic-assignment">=</span> <span class="identifier">param</span>

    <span class="keyword">def</span> <span class="identifier">get_params</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">deep</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="grouping">{</span><span class="string-literal">"param"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">param</span><span class="grouping">}</span>

    <span class="keyword">def</span> <span class="identifier">set_params</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">params</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">value</span> <span class="relational-operator">in</span> <span class="identifier">params</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">setattr</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">value</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">self</span>

    <span class="keyword">def</span> <span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_X_y</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">is_fitted_</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_mean</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">mean</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">self</span>

    <span class="keyword">def</span> <span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">check_is_fitted</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_array</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="identifier">shape</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span><span class="grouping">)</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_mean</span>

    <span class="keyword">def</span> <span class="identifier">score</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="identifier">r2_score</span>
        <span class="keyword">return</span> <span class="identifier">r2_score</span><span class="grouping">(</span><span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">MinimalTransformer</span><span class="punctuation">:</span>
    <span class="comment">"""Minimal transformer implementation with inheriting from
    BaseEstimator.

    This estimator should be tested with:

    * `check_estimator` in `test_estimator_checks.py`;
    * within a `Pipeline` in `test_pipeline.py`;
    * within a `SearchCV` in `test_search.py`.
    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">param</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">param</span> <span class="arithmetic-assignment">=</span> <span class="identifier">param</span>

    <span class="keyword">def</span> <span class="identifier">get_params</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">deep</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="grouping">{</span><span class="string-literal">"param"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">param</span><span class="grouping">}</span>

    <span class="keyword">def</span> <span class="identifier">set_params</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">params</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">value</span> <span class="relational-operator">in</span> <span class="identifier">params</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">setattr</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">value</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">self</span>

    <span class="keyword">def</span> <span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_array</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">is_fitted_</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="keyword">return</span> <span class="identifier">self</span>

    <span class="keyword">def</span> <span class="identifier">transform</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">check_is_fitted</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_array</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">X</span>

    <span class="keyword">def</span> <span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    </pre>
  </body>
</html>