<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""Common tests for metaestimators"""</span>
<span class="keyword">import</span> <span class="identifier">functools</span>
<span class="keyword">from</span> <span class="identifier">inspect</span> <span class="keyword">import</span> <span class="identifier">signature</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">pytest</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">base</span> <span class="keyword">import</span> <span class="identifier">BaseEstimator</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">base</span> <span class="keyword">import</span> <span class="identifier">is_regressor</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">make_classification</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">all_estimators</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">estimator_checks</span> <span class="keyword">import</span> <span class="identifier">_enforce_estimator_tags_x</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">estimator_checks</span> <span class="keyword">import</span> <span class="identifier">_enforce_estimator_tags_y</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">validation</span> <span class="keyword">import</span> <span class="identifier">check_is_fitted</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="identifier">set_random_state</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">pipeline</span> <span class="keyword">import</span> <span class="identifier">Pipeline</span><span class="punctuation">,</span> <span class="identifier">make_pipeline</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">model_selection</span> <span class="keyword">import</span> <span class="identifier">GridSearchCV</span><span class="punctuation">,</span> <span class="identifier">RandomizedSearchCV</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">feature_extraction</span><span class="punctuation">.</span><span class="identifier">text</span> <span class="keyword">import</span> <span class="identifier">TfidfVectorizer</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">feature_selection</span> <span class="keyword">import</span> <span class="identifier">RFE</span><span class="punctuation">,</span> <span class="identifier">RFECV</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">BaggingClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="invalid">e</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">s</span> <span class="keyword">import</span> <span class="identifier">NotFittedError</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">semi_supervised</span> <span class="keyword">import</span> <span class="identifier">SelfTrainingClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">Ridge</span><span class="punctuation">,</span> <span class="identifier">LogisticRegression</span>


<span class="keyword">class</span> <span class="invalid">D</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">D</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">construct</span><span class="punctuation">,</span> <span class="identifier">skip_methods</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
                 <span class="identifier">fit_args</span><span class="arithmetic-assignment">=</span><span class="identifier">make_classification</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">name</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">construct</span> <span class="arithmetic-assignment">=</span> <span class="identifier">construct</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fit_args</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fit_args</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">skip_methods</span> <span class="arithmetic-assignment">=</span> <span class="identifier">skip_methods</span>


<span class="invalid">D</span><span class="invalid">E</span><span class="invalid">L</span><span class="invalid">E</span><span class="invalid">G</span><span class="invalid">A</span><span class="invalid">T</span><span class="invalid">I</span><span class="invalid">N</span><span class="invalid">G</span><span class="invalid">_</span><span class="invalid">M</span><span class="invalid">E</span><span class="invalid">T</span><span class="invalid">A</span><span class="invalid">E</span><span class="invalid">S</span><span class="invalid">T</span><span class="invalid">I</span><span class="invalid">M</span><span class="invalid">A</span><span class="invalid">T</span><span class="invalid">O</span><span class="invalid">R</span><span class="invalid">S</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
    <span class="invalid">D</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">D</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="grouping">(</span><span class="string-literal">'Pipeline', lambda est: Pipeline([('est'</span><span class="punctuation">,</span> <span class="identifier">est</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="invalid">D</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">D</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="grouping">(</span><span class="string-literal">'GridSearchCV'</span><span class="punctuation">,</span>
                  <span class="keyword">lambda</span> <span class="identifier">est</span><span class="punctuation">:</span> <span class="identifier">GridSearchCV</span><span class="grouping">(</span>
                      <span class="identifier">est</span><span class="punctuation">,</span> <span class="identifier">param_grid</span><span class="arithmetic-assignment">=</span><span class="grouping">{</span><span class="string-literal">'param'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span> <span class="identifier">cv</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span>
                  <span class="identifier">skip_methods</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'score'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="invalid">D</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">D</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="grouping">(</span><span class="string-literal">'RandomizedSearchCV'</span><span class="punctuation">,</span>
                  <span class="keyword">lambda</span> <span class="identifier">est</span><span class="punctuation">:</span> <span class="identifier">RandomizedSearchCV</span><span class="grouping">(</span>
                      <span class="identifier">est</span><span class="punctuation">,</span> <span class="identifier">param_distributions</span><span class="arithmetic-assignment">=</span><span class="grouping">{</span><span class="string-literal">'param'</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">}</span><span class="punctuation">,</span> <span class="identifier">cv</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">n_iter</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">,</span>
                  <span class="identifier">skip_methods</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'score'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="invalid">D</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">D</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="grouping">(</span><span class="string-literal">'RFE'</span><span class="punctuation">,</span> <span class="identifier">RFE</span><span class="punctuation">,</span>
                  <span class="identifier">skip_methods</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'transform', 'inverse_transform'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="invalid">D</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">D</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="grouping">(</span><span class="string-literal">'RFECV'</span><span class="punctuation">,</span> <span class="identifier">RFECV</span><span class="punctuation">,</span>
                  <span class="identifier">skip_methods</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'transform', 'inverse_transform'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="invalid">D</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">D</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="grouping">(</span><span class="string-literal">'BaggingClassifier'</span><span class="punctuation">,</span> <span class="identifier">BaggingClassifier</span><span class="punctuation">,</span>
                  <span class="identifier">skip_methods</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'transform', 'inverse_transform', 'score'</span><span class="punctuation">,</span>
                                <span class="string-literal">'predict_proba', 'predict_log_proba'</span><span class="punctuation">,</span>
                                <span class="string-literal">'predict'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="invalid">D</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">D</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="grouping">(</span><span class="string-literal">'SelfTrainingClassifier'</span><span class="punctuation">,</span>
                  <span class="keyword">lambda</span> <span class="identifier">est</span><span class="punctuation">:</span> <span class="identifier">SelfTrainingClassifier</span><span class="grouping">(</span><span class="identifier">est</span><span class="grouping">)</span><span class="punctuation">,</span>
                  <span class="identifier">skip_methods</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'transform', 'inverse_transform'</span><span class="punctuation">,</span>
                                <span class="string-literal">'predict_proba'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
<span class="grouping">]</span>


<span class="keyword">def</span> <span class="identifier">test_metaestimator_delegation</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Ensures specified metaestimators have methods iff subestimator does</span>
    <span class="keyword">def</span> <span class="identifier">hides</span><span class="grouping">(</span><span class="identifier">method</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="punctuation">@</span><span class="identifier">property</span>
        <span class="keyword">def</span> <span class="identifier">wrapper</span><span class="grouping">(</span><span class="identifier">obj</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">obj</span><span class="punctuation">.</span><span class="identifier">hidden_method</span> <span class="relational-operator">==</span> <span class="identifier">method</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">AttributeError</span><span class="grouping">(</span><span class="string-literal">'%r is hidden'</span> <span class="arithmetic-operator">%</span> <span class="identifier">obj</span><span class="punctuation">.</span><span class="identifier">hidden_method</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">functools</span><span class="punctuation">.</span><span class="identifier">partial</span><span class="grouping">(</span><span class="identifier">method</span><span class="punctuation">,</span> <span class="identifier">obj</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">wrapper</span>

    <span class="keyword">class</span> <span class="identifier">SubEstimator</span><span class="grouping">(</span><span class="identifier">BaseEstimator</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">param</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">hidden_method</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">param</span> <span class="arithmetic-assignment">=</span> <span class="identifier">param</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">hidden_method</span> <span class="arithmetic-assignment">=</span> <span class="identifier">hidden_method</span>

        <span class="keyword">def</span> <span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">coef_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
            <span class="keyword">return</span> <span class="bool-literal">True</span>

        <span class="keyword">def</span> <span class="identifier">_check_fit</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">check_is_fitted</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>

        <span class="punctuation">@</span><span class="identifier">hides</span>
        <span class="keyword">def</span> <span class="identifier">inverse_transform</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_check_fit</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">X</span>

        <span class="punctuation">@</span><span class="identifier">hides</span>
        <span class="keyword">def</span> <span class="identifier">transform</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_check_fit</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">X</span>

        <span class="punctuation">@</span><span class="identifier">hides</span>
        <span class="keyword">def</span> <span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_check_fit</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="punctuation">@</span><span class="identifier">hides</span>
        <span class="keyword">def</span> <span class="identifier">predict_proba</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_check_fit</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="punctuation">@</span><span class="identifier">hides</span>
        <span class="keyword">def</span> <span class="identifier">predict_log_proba</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_check_fit</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="punctuation">@</span><span class="identifier">hides</span>
        <span class="keyword">def</span> <span class="identifier">decision_function</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_check_fit</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="punctuation">@</span><span class="identifier">hides</span>
        <span class="keyword">def</span> <span class="identifier">score</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_check_fit</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="float-literal">1.0</span>

    <span class="identifier">methods</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">k</span> <span class="keyword">for</span> <span class="identifier">k</span> <span class="relational-operator">in</span> <span class="identifier">SubEstimator</span><span class="punctuation">.</span><span class="identifier">__dict__</span><span class="punctuation">.</span><span class="identifier">keys</span><span class="grouping">(</span><span class="grouping">)</span>
               <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">k</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">'_') and not k.startswith('fit'</span><span class="grouping">)</span><span class="grouping">]</span>
    <span class="identifier">methods</span><span class="punctuation">.</span><span class="identifier">sort</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">for</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span> <span class="relational-operator">in</span> <span class="invalid">D</span><span class="invalid">E</span><span class="invalid">L</span><span class="invalid">E</span><span class="invalid">G</span><span class="invalid">A</span><span class="invalid">T</span><span class="invalid">I</span><span class="invalid">N</span><span class="invalid">G</span><span class="invalid">_</span><span class="invalid">M</span><span class="invalid">E</span><span class="invalid">T</span><span class="invalid">A</span><span class="invalid">E</span><span class="invalid">S</span><span class="invalid">T</span><span class="invalid">I</span><span class="invalid">M</span><span class="invalid">A</span><span class="invalid">T</span><span class="invalid">O</span><span class="invalid">R</span><span class="invalid">S</span><span class="punctuation">:</span>
        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span> <span class="arithmetic-assignment">=</span> <span class="identifier">SubEstimator</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span> <span class="arithmetic-assignment">=</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">construct</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">method</span> <span class="relational-operator">in</span> <span class="identifier">methods</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">method</span> <span class="relational-operator">in</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">skip_methods</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="keyword">assert</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span>
            <span class="keyword">assert</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span>
                    <span class="string-literal">"%s does not have method %r when its delegate does"</span>
                    <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="comment"># delegation before fit raises a NotFittedError</span>
            <span class="keyword">if</span> <span class="identifier">method</span> <span class="relational-operator">==</span> <span class="string-literal">'score'</span><span class="punctuation">:</span>
                <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">NotFittedError</span><span class="grouping">)</span><span class="punctuation">:</span>
                    <span class="identifier">getattr</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">fit_args</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span>
                                               <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">fit_args</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">NotFittedError</span><span class="grouping">)</span><span class="punctuation">:</span>
                    <span class="identifier">getattr</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">fit_args</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">fit_args</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">method</span> <span class="relational-operator">in</span> <span class="identifier">methods</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">method</span> <span class="relational-operator">in</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">skip_methods</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="comment"># smoke test delegation</span>
            <span class="keyword">if</span> <span class="identifier">method</span> <span class="relational-operator">==</span> <span class="string-literal">'score'</span><span class="punctuation">:</span>
                <span class="identifier">getattr</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">fit_args</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span>
                                           <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">fit_args</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">getattr</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">fit_args</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="keyword">for</span> <span class="identifier">method</span> <span class="relational-operator">in</span> <span class="identifier">methods</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">method</span> <span class="relational-operator">in</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">skip_methods</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span> <span class="arithmetic-assignment">=</span> <span class="identifier">SubEstimator</span><span class="grouping">(</span><span class="identifier">hidden_method</span><span class="arithmetic-assignment">=</span><span class="identifier">method</span><span class="grouping">)</span>
            <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span> <span class="arithmetic-assignment">=</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">construct</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="grouping">)</span>
            <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span>
            <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span>
                    <span class="string-literal">"%s has method %r when its delegate does not"</span>
                    <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">method</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_generate_meta_estimator_instances_with_pipeline</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Generate instances of meta-estimators fed with a pipeline

    Are considered meta-estimators all estimators accepting one of "estimator",
    "base_estimator" or "estimators".
    """</span>
    <span class="keyword">for</span> <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">Estimator</span> <span class="relational-operator">in</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">all_estimators</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">sig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">set</span><span class="grouping">(</span><span class="identifier">signature</span><span class="grouping">(</span><span class="identifier">Estimator</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">parameters</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="string-literal">"estimator" in sig or "base_estimator"</span> <span class="relational-operator">in</span> <span class="identifier">sig</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">is_regressor</span><span class="grouping">(</span><span class="identifier">Estimator</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">estimator</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span><span class="identifier">TfidfVectorizer</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">Ridge</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
                <span class="identifier">param_grid</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">"ridge__alpha"</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="float-literal">1.0</span><span class="grouping">]</span><span class="grouping">}</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">estimator</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span><span class="identifier">TfidfVectorizer</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
                                          <span class="identifier">LogisticRegression</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
                <span class="identifier">param_grid</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">"logisticregression__C"</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="float-literal">1.0</span><span class="grouping">]</span><span class="grouping">}</span>

            <span class="keyword">if</span> <span class="string-literal">"param_grid" in sig or "param_distributions"</span> <span class="relational-operator">in</span> <span class="identifier">sig</span><span class="punctuation">:</span>
                <span class="comment"># SearchCV estimators</span>
                <span class="identifier">extra_params</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">"n_iter": 2} if "n_iter"</span> <span class="relational-operator">in</span> <span class="identifier">sig</span> <span class="keyword">else</span> <span class="grouping">{</span><span class="grouping">}</span>
                <span class="keyword">yield</span> <span class="identifier">Estimator</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="punctuation">,</span> <span class="identifier">param_grid</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">extra_params</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="keyword">yield</span> <span class="identifier">Estimator</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span>

        <span class="keyword">elif</span> <span class="string-literal">"estimators"</span> <span class="relational-operator">in</span> <span class="identifier">sig</span><span class="punctuation">:</span>
            <span class="comment"># stacking, voting</span>
            <span class="keyword">if</span> <span class="identifier">is_regressor</span><span class="grouping">(</span><span class="identifier">Estimator</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">estimator</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
                    <span class="grouping">(</span><span class="string-literal">"est1"</span><span class="punctuation">,</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span><span class="identifier">TfidfVectorizer</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
                                           <span class="identifier">Ridge</span><span class="grouping">(</span><span class="identifier">alpha</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.1</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
                    <span class="grouping">(</span><span class="string-literal">"est2"</span><span class="punctuation">,</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span><span class="identifier">TfidfVectorizer</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
                                           <span class="identifier">Ridge</span><span class="grouping">(</span><span class="identifier">alpha</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="grouping">]</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">estimator</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
                    <span class="grouping">(</span><span class="string-literal">"est1"</span><span class="punctuation">,</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span><span class="identifier">TfidfVectorizer</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
                                           <span class="identifier">LogisticRegression</span><span class="grouping">(</span><span class="identifier">C</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.1</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
                    <span class="grouping">(</span><span class="string-literal">"est2"</span><span class="punctuation">,</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span><span class="identifier">TfidfVectorizer</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
                                           <span class="identifier">LogisticRegression</span><span class="grouping">(</span><span class="identifier">C</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="grouping">]</span>
            <span class="keyword">yield</span> <span class="identifier">Estimator</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span>

        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">continue</span>


<span class="comment"># TODO: remove data validation for the following estimators</span>
<span class="comment"># They should be able to work on any data and delegate data validation to</span>
<span class="comment"># their inner estimator(s).</span>
<span class="identifier">DATA_VALIDATION_META_ESTIMATORS_TO_IGNORE</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
        <span class="string-literal">"AdaBoostClassifier"</span><span class="punctuation">,</span>
        <span class="string-literal">"AdaBoostRegressor"</span><span class="punctuation">,</span>
        <span class="string-literal">"BaggingClassifier"</span><span class="punctuation">,</span>
        <span class="string-literal">"BaggingRegressor"</span><span class="punctuation">,</span>
        <span class="string-literal">"ClassifierChain"</span><span class="punctuation">,</span>
        <span class="string-literal">"IterativeImputer"</span><span class="punctuation">,</span>
        <span class="string-literal">"MultiOutputClassifier"</span><span class="punctuation">,</span>
        <span class="string-literal">"MultiOutputRegressor"</span><span class="punctuation">,</span>
        <span class="string-literal">"OneVsOneClassifier"</span><span class="punctuation">,</span>
        <span class="string-literal">"OutputCodeClassifier"</span><span class="punctuation">,</span>
        <span class="string-literal">"RANSACRegressor"</span><span class="punctuation">,</span>
        <span class="string-literal">"RFE"</span><span class="punctuation">,</span>
        <span class="string-literal">"RFECV"</span><span class="punctuation">,</span>
        <span class="string-literal">"RegressorChain"</span><span class="punctuation">,</span>
        <span class="string-literal">"SelfTrainingClassifier"</span><span class="punctuation">,</span>
        <span class="string-literal">"SequentialFeatureSelector"</span>  <span class="comment"># not applicable (2D data mandatory)</span>
<span class="grouping">]</span>

<span class="identifier">DATA_VALIDATION_META_ESTIMATORS</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
    <span class="identifier">est</span> <span class="keyword">for</span> <span class="identifier">est</span> <span class="relational-operator">in</span> <span class="identifier">_generate_meta_estimator_instances_with_pipeline</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">if</span>
    <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">DATA_VALIDATION_META_ESTIMATORS_TO_IGNORE</span>
<span class="grouping">]</span>


<span class="keyword">def</span> <span class="identifier">_get_meta_estimator_id</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">return</span> <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="string-literal">"estimator"</span><span class="punctuation">,</span> <span class="identifier">DATA_VALIDATION_META_ESTIMATORS</span><span class="punctuation">,</span> <span class="identifier">ids</span><span class="arithmetic-assignment">=</span><span class="identifier">_get_meta_estimator_id</span>
<span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_meta_estimators_delegate_data_validation</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Check that meta-estimators delegate data validation to the inner</span>
    <span class="comment"># estimator(s).</span>
    <span class="identifier">rng</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">RandomState</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">set_random_state</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span>

    <span class="identifier">n_samples</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">30</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">choice</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="string-literal">"aa", "bb", "cc"</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">object</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="identifier">n_samples</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">is_regressor</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">normal</span><span class="grouping">(</span><span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="identifier">n_samples</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rng</span><span class="punctuation">.</span><span class="identifier">randint</span><span class="grouping">(</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="identifier">n_samples</span><span class="grouping">)</span>

    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_enforce_estimator_tags_x</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span>
    <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_enforce_estimator_tags_y</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="comment"># Calling fit should not raise any data validation exception since X is a</span>
    <span class="comment"># valid input datastructure for the first step of the pipeline passed as</span>
    <span class="comment"># base estimator to the meta estimator.</span>
    <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="comment"># n_features_in_ should not be defined since data is not tabular data.</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="punctuation">,</span> <span class="string-literal">"n_features_in_"</span><span class="grouping">)</span>

    </pre>
  </body>
</html>