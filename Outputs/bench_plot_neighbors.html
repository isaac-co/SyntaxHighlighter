<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
Plot the scaling of the nearest neighbors algorithms with k, D, and N
"""</span>
<span class="keyword">from</span> <span class="identifier">time</span> <span class="keyword">import</span> <span class="identifier">time</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
<span class="keyword">from</span> <span class="identifier">matplotlib</span> <span class="keyword">import</span> <span class="identifier">ticker</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span> <span class="keyword">import</span> <span class="identifier">neighbors</span><span class="punctuation">,</span> <span class="identifier">datasets</span>


<span class="keyword">def</span> <span class="identifier">get_data</span><span class="grouping">(</span><span class="identifier">N</span><span class="punctuation">,</span> <span class="identifier">D</span><span class="punctuation">,</span> <span class="identifier">dataset</span><span class="arithmetic-assignment">=</span><span class="string-literal">'dense'</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">if</span> <span class="identifier">dataset</span> <span class="relational-operator">==</span> <span class="string-literal">'dense'</span><span class="punctuation">:</span>
        <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">seed</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">random</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">N</span><span class="punctuation">,</span> <span class="identifier">D</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">dataset</span> <span class="relational-operator">==</span> <span class="string-literal">'digits'</span><span class="punctuation">:</span>
        <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">load_digits</span><span class="grouping">(</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">X</span><span class="invalid">_</span><span class="invalid">y</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">i</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">argsort</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">i</span><span class="grouping">]</span>
        <span class="keyword">return</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">N</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="identifier">D</span><span class="grouping">]</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"invalid dataset: %s"</span> <span class="arithmetic-operator">%</span> <span class="identifier">dataset</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">barplot_neighbors</span><span class="grouping">(</span><span class="identifier">Nrange</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span> <span class="arithmetic-operator">**</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">11</span><span class="grouping">)</span><span class="punctuation">,</span>
                      <span class="identifier">Drange</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span> <span class="arithmetic-operator">**</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="int-literal">7</span><span class="grouping">)</span><span class="punctuation">,</span>
                      <span class="identifier">krange</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span> <span class="arithmetic-operator">**</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="int-literal">10</span><span class="grouping">)</span><span class="punctuation">,</span>
                      <span class="identifier">N</span><span class="arithmetic-assignment">=</span><span class="int-literal">1000</span><span class="punctuation">,</span>
                      <span class="identifier">D</span><span class="arithmetic-assignment">=</span><span class="int-literal">64</span><span class="punctuation">,</span>
                      <span class="identifier">k</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span>
                      <span class="identifier">leaf_size</span><span class="arithmetic-assignment">=</span><span class="int-literal">30</span><span class="punctuation">,</span>
                      <span class="identifier">dataset</span><span class="arithmetic-assignment">=</span><span class="string-literal">'digits'</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">algorithms</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">'kd_tree', 'brute', 'ball_tree'</span><span class="grouping">)</span>
    <span class="identifier">fiducial_values</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'N'</span><span class="punctuation">:</span> <span class="identifier">N</span><span class="punctuation">,</span>
                       <span class="string-literal">'D'</span><span class="punctuation">:</span> <span class="identifier">D</span><span class="punctuation">,</span>
                       <span class="string-literal">'k'</span><span class="punctuation">:</span> <span class="identifier">k</span><span class="grouping">}</span>

    <span class="comment">#------------------------------------------------------------</span>
    <span class="comment"># varying N</span>
    <span class="identifier">N_results_build</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">alg</span><span class="punctuation">:</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">Nrange</span><span class="grouping">)</span><span class="grouping">)</span>
                       <span class="keyword">for</span> <span class="identifier">alg</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="grouping">}</span>
    <span class="identifier">N_results_query</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">alg</span><span class="punctuation">:</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">Nrange</span><span class="grouping">)</span><span class="grouping">)</span>
                       <span class="keyword">for</span> <span class="identifier">alg</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="grouping">}</span>

    <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">NN</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">Nrange</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"N = %i (%i out of %i)"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">NN</span><span class="punctuation">,</span> <span class="identifier">i</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">Nrange</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_data</span><span class="grouping">(</span><span class="identifier">NN</span><span class="punctuation">,</span> <span class="identifier">D</span><span class="punctuation">,</span> <span class="identifier">dataset</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">algorithm</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="punctuation">:</span>
            <span class="identifier">nbrs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">neighbors</span><span class="punctuation">.</span><span class="identifier">NearestNeighbors</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="identifier">min</span><span class="grouping">(</span><span class="identifier">NN</span><span class="punctuation">,</span> <span class="identifier">k</span><span class="grouping">)</span><span class="punctuation">,</span>
                                              <span class="identifier">algorithm</span><span class="arithmetic-assignment">=</span><span class="identifier">algorithm</span><span class="punctuation">,</span>
                                              <span class="identifier">leaf_size</span><span class="arithmetic-assignment">=</span><span class="identifier">leaf_size</span><span class="grouping">)</span>
            <span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">nbrs</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
            <span class="identifier">t1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">nbrs</span><span class="punctuation">.</span><span class="identifier">kneighbors</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
            <span class="identifier">t2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>

            <span class="identifier">N_results_build</span><span class="grouping">[</span><span class="identifier">algorithm</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">t1</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span>
            <span class="identifier">N_results_query</span><span class="grouping">[</span><span class="identifier">algorithm</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">t2</span> <span class="arithmetic-operator">-</span> <span class="identifier">t1</span><span class="grouping">)</span>

    <span class="comment">#------------------------------------------------------------</span>
    <span class="comment"># varying D</span>
    <span class="identifier">D_results_build</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">alg</span><span class="punctuation">:</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">Drange</span><span class="grouping">)</span><span class="grouping">)</span>
                       <span class="keyword">for</span> <span class="identifier">alg</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="grouping">}</span>
    <span class="identifier">D_results_query</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">alg</span><span class="punctuation">:</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">Drange</span><span class="grouping">)</span><span class="grouping">)</span>
                       <span class="keyword">for</span> <span class="identifier">alg</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="grouping">}</span>

    <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">DD</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">Drange</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"D = %i (%i out of %i)"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">DD</span><span class="punctuation">,</span> <span class="identifier">i</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">Drange</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_data</span><span class="grouping">(</span><span class="identifier">N</span><span class="punctuation">,</span> <span class="identifier">DD</span><span class="punctuation">,</span> <span class="identifier">dataset</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">algorithm</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="punctuation">:</span>
            <span class="identifier">nbrs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">neighbors</span><span class="punctuation">.</span><span class="identifier">NearestNeighbors</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="identifier">k</span><span class="punctuation">,</span>
                                              <span class="identifier">algorithm</span><span class="arithmetic-assignment">=</span><span class="identifier">algorithm</span><span class="punctuation">,</span>
                                              <span class="identifier">leaf_size</span><span class="arithmetic-assignment">=</span><span class="identifier">leaf_size</span><span class="grouping">)</span>
            <span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">nbrs</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
            <span class="identifier">t1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">nbrs</span><span class="punctuation">.</span><span class="identifier">kneighbors</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
            <span class="identifier">t2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>

            <span class="identifier">D_results_build</span><span class="grouping">[</span><span class="identifier">algorithm</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">t1</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span>
            <span class="identifier">D_results_query</span><span class="grouping">[</span><span class="identifier">algorithm</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">t2</span> <span class="arithmetic-operator">-</span> <span class="identifier">t1</span><span class="grouping">)</span>

    <span class="comment">#------------------------------------------------------------</span>
    <span class="comment"># varying k</span>
    <span class="identifier">k_results_build</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">alg</span><span class="punctuation">:</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">krange</span><span class="grouping">)</span><span class="grouping">)</span>
                       <span class="keyword">for</span> <span class="identifier">alg</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="grouping">}</span>
    <span class="identifier">k_results_query</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">alg</span><span class="punctuation">:</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">krange</span><span class="grouping">)</span><span class="grouping">)</span>
                       <span class="keyword">for</span> <span class="identifier">alg</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="grouping">}</span>

    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_data</span><span class="grouping">(</span><span class="identifier">N</span><span class="punctuation">,</span> <span class="identifier">DD</span><span class="punctuation">,</span> <span class="identifier">dataset</span><span class="grouping">)</span>

    <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">kk</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">krange</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"k = %i (%i out of %i)"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">kk</span><span class="punctuation">,</span> <span class="identifier">i</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">krange</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">algorithm</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="punctuation">:</span>
            <span class="identifier">nbrs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">neighbors</span><span class="punctuation">.</span><span class="identifier">NearestNeighbors</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="identifier">kk</span><span class="punctuation">,</span>
                                              <span class="identifier">algorithm</span><span class="arithmetic-assignment">=</span><span class="identifier">algorithm</span><span class="punctuation">,</span>
                                              <span class="identifier">leaf_size</span><span class="arithmetic-assignment">=</span><span class="identifier">leaf_size</span><span class="grouping">)</span>
            <span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">nbrs</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
            <span class="identifier">t1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">nbrs</span><span class="punctuation">.</span><span class="identifier">kneighbors</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
            <span class="identifier">t2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>

            <span class="identifier">k_results_build</span><span class="grouping">[</span><span class="identifier">algorithm</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">t1</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span>
            <span class="identifier">k_results_query</span><span class="grouping">[</span><span class="identifier">algorithm</span><span class="grouping">]</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">t2</span> <span class="arithmetic-operator">-</span> <span class="identifier">t1</span><span class="grouping">)</span>

    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="identifier">figsize</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">8</span><span class="punctuation">,</span> <span class="int-literal">11</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">for</span> <span class="grouping">(</span><span class="identifier">sbplt</span><span class="punctuation">,</span> <span class="identifier">vals</span><span class="punctuation">,</span> <span class="identifier">quantity</span><span class="punctuation">,</span>
         <span class="identifier">build_time</span><span class="punctuation">,</span> <span class="identifier">query_time</span><span class="grouping">)</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="grouping">(</span><span class="int-literal">311</span><span class="punctuation">,</span> <span class="identifier">Nrange</span><span class="punctuation">,</span> <span class="string-literal">'N'</span><span class="punctuation">,</span>
                                      <span class="identifier">N_results_build</span><span class="punctuation">,</span>
                                      <span class="identifier">N_results_query</span><span class="grouping">)</span><span class="punctuation">,</span>
                                     <span class="grouping">(</span><span class="int-literal">312</span><span class="punctuation">,</span> <span class="identifier">Drange</span><span class="punctuation">,</span> <span class="string-literal">'D'</span><span class="punctuation">,</span>
                                      <span class="identifier">D_results_build</span><span class="punctuation">,</span>
                                      <span class="identifier">D_results_query</span><span class="grouping">)</span><span class="punctuation">,</span>
                                     <span class="grouping">(</span><span class="int-literal">313</span><span class="punctuation">,</span> <span class="identifier">krange</span><span class="punctuation">,</span> <span class="string-literal">'k'</span><span class="punctuation">,</span>
                                      <span class="identifier">k_results_build</span><span class="punctuation">,</span>
                                      <span class="identifier">k_results_query</span><span class="grouping">)</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplot</span><span class="grouping">(</span><span class="identifier">sbplt</span><span class="punctuation">,</span> <span class="identifier">yscale</span><span class="arithmetic-assignment">=</span><span class="string-literal">'log'</span><span class="grouping">)</span>
        <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">grid</span><span class="grouping">(</span><span class="bool-literal">True</span><span class="grouping">)</span>

        <span class="identifier">tick_vals</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="identifier">tick_labels</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>

        <span class="identifier">bottom</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">10</span> <span class="arithmetic-operator">**</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">min</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">floor</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">log10</span><span class="grouping">(</span><span class="identifier">build_time</span><span class="grouping">[</span><span class="identifier">alg</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
                               <span class="keyword">for</span> <span class="identifier">alg</span> <span class="relational-operator">in</span> <span class="identifier">algorithms</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">alg</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">algorithms</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">xvals</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.1</span> <span class="arithmetic-operator">+</span> <span class="identifier">i</span> <span class="arithmetic-operator">*</span> <span class="grouping">(</span><span class="int-literal">1</span> <span class="arithmetic-operator">+</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">vals</span><span class="grouping">)</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">vals</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.8</span>

            <span class="identifier">c_bar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">xvals</span><span class="punctuation">,</span> <span class="identifier">build_time</span><span class="grouping">[</span><span class="identifier">alg</span><span class="grouping">]</span> <span class="arithmetic-operator">-</span> <span class="identifier">bottom</span><span class="punctuation">,</span>
                            <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">bottom</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'r'</span><span class="grouping">)</span>
            <span class="identifier">q_bar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">xvals</span><span class="punctuation">,</span> <span class="identifier">query_time</span><span class="grouping">[</span><span class="identifier">alg</span><span class="grouping">]</span><span class="punctuation">,</span>
                            <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">build_time</span><span class="grouping">[</span><span class="identifier">alg</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'b'</span><span class="grouping">)</span>

            <span class="identifier">tick_vals</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">xvals</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.5</span> <span class="arithmetic-operator">*</span> <span class="identifier">width</span><span class="grouping">)</span>
            <span class="identifier">tick_labels</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">[</span><span class="string-literal">'%i'</span> <span class="arithmetic-operator">%</span> <span class="identifier">val</span> <span class="keyword">for</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">vals</span><span class="grouping">]</span>

            <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">text</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">i</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.02</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">algorithms</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="float-literal">0.98</span><span class="punctuation">,</span> <span class="identifier">alg</span><span class="punctuation">,</span>
                     <span class="identifier">transform</span><span class="arithmetic-assignment">=</span><span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">transAxes</span><span class="punctuation">,</span>
                     <span class="identifier">ha</span><span class="arithmetic-assignment">=</span><span class="string-literal">'left'</span><span class="punctuation">,</span>
                     <span class="identifier">va</span><span class="arithmetic-assignment">=</span><span class="string-literal">'top'</span><span class="punctuation">,</span>
                     <span class="identifier">bbox</span><span class="arithmetic-assignment">=</span><span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">facecolor</span><span class="arithmetic-assignment">=</span><span class="string-literal">'w', edgecolor='w'</span><span class="punctuation">,</span> <span class="identifier">alpha</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.5</span><span class="grouping">)</span><span class="grouping">)</span>

            <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">ylabel</span><span class="grouping">(</span><span class="string-literal">'Time (s)'</span><span class="grouping">)</span>

        <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">xaxis</span><span class="punctuation">.</span><span class="identifier">set_major_locator</span><span class="grouping">(</span><span class="identifier">ticker</span><span class="punctuation">.</span><span class="identifier">FixedLocator</span><span class="grouping">(</span><span class="identifier">tick_vals</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">xaxis</span><span class="punctuation">.</span><span class="identifier">set_major_formatter</span><span class="grouping">(</span><span class="identifier">ticker</span><span class="punctuation">.</span><span class="identifier">FixedFormatter</span><span class="grouping">(</span><span class="identifier">tick_labels</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="keyword">for</span> <span class="identifier">label</span> <span class="relational-operator">in</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xticklabels</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">label</span><span class="punctuation">.</span><span class="identifier">set_rotation</span><span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="int-literal">90</span><span class="grouping">)</span>
            <span class="identifier">label</span><span class="punctuation">.</span><span class="identifier">set_fontsize</span><span class="grouping">(</span><span class="int-literal">10</span><span class="grouping">)</span>

        <span class="identifier">title_string</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'Varying %s'</span> <span class="arithmetic-operator">%</span> <span class="identifier">quantity</span>

        <span class="identifier">descr_string</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">''</span>

        <span class="keyword">for</span> <span class="identifier">s</span> <span class="relational-operator">in</span> <span class="string-literal">'NDk'</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">s</span> <span class="relational-operator">==</span> <span class="identifier">quantity</span><span class="punctuation">:</span>
                <span class="keyword">pass</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">descr_string</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'%s = %i, '</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">s</span><span class="punctuation">,</span> <span class="identifier">fiducial_values</span><span class="grouping">[</span><span class="identifier">s</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="identifier">descr_string</span> <span class="arithmetic-assignment">=</span> <span class="identifier">descr_string</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span>

        <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">text</span><span class="grouping">(</span><span class="float-literal">1.01</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="punctuation">,</span> <span class="identifier">title_string</span><span class="punctuation">,</span>
                 <span class="identifier">transform</span><span class="arithmetic-assignment">=</span><span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">transAxes</span><span class="punctuation">,</span> <span class="identifier">rotation</span><span class="arithmetic-assignment">=</span><span class="arithmetic-operator">-</span><span class="int-literal">90</span><span class="punctuation">,</span>
                 <span class="identifier">ha</span><span class="arithmetic-assignment">=</span><span class="string-literal">'left', va='center'</span><span class="punctuation">,</span> <span class="identifier">fontsize</span><span class="arithmetic-assignment">=</span><span class="int-literal">20</span><span class="grouping">)</span>

        <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">text</span><span class="grouping">(</span><span class="float-literal">0.99</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="punctuation">,</span> <span class="identifier">descr_string</span><span class="punctuation">,</span>
                 <span class="identifier">transform</span><span class="arithmetic-assignment">=</span><span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">transAxes</span><span class="punctuation">,</span> <span class="identifier">rotation</span><span class="arithmetic-assignment">=</span><span class="arithmetic-operator">-</span><span class="int-literal">90</span><span class="punctuation">,</span>
                 <span class="identifier">ha</span><span class="arithmetic-assignment">=</span><span class="string-literal">'right', va='center'</span><span class="grouping">)</span>

        <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">gcf</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">suptitle</span><span class="grouping">(</span><span class="string-literal">"%s data set"</span> <span class="arithmetic-operator">%</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">capitalize</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">fontsize</span><span class="arithmetic-assignment">=</span><span class="int-literal">16</span><span class="grouping">)</span>

    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figlegend</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">c_bar</span><span class="punctuation">,</span> <span class="identifier">q_bar</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="string-literal">'construction', 'N-point query'</span><span class="grouping">)</span><span class="punctuation">,</span>
                  <span class="string-literal">'upper right'</span><span class="grouping">)</span>

<span class="keyword">if</span> <span class="identifier">__name__</span> <span class="relational-operator">==</span> <span class="string-literal">'__main__'</span><span class="punctuation">:</span>
    <span class="identifier">barplot_neighbors</span><span class="grouping">(</span><span class="identifier">dataset</span><span class="arithmetic-assignment">=</span><span class="string-literal">'digits'</span><span class="grouping">)</span>
    <span class="identifier">barplot_neighbors</span><span class="grouping">(</span><span class="identifier">dataset</span><span class="arithmetic-assignment">=</span><span class="string-literal">'dense'</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>