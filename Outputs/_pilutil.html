<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
A collection of image utilities using the Python Imaging Library (PIL).

This is a local version of utility functions from scipy that are wrapping PIL
functionality. These functions are deprecated in scipy 1.0.0 and will be
removed in scipy 1.2.0. Therefore, the functionality used in sklearn is copied
here. This file is taken from scipy/misc/pilutil.py in scipy
1.0.0. Modifications include: making this module importable if pillow is not
installed, removal of DeprecationWarning, removal of functions scikit-learn
does not need.

Copyright (c) 2001, 2002 Enthought, Inc.
All rights reserved.

Copyright (c) 2003-2017 SciPy Developers.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

  a. Redistributions of source code must retain the above copyright notice,
     this list of conditions and the following disclaimer.
  b. Redistributions in binary form must reproduce the above copyright
     notice, this list of conditions and the following disclaimer in the
     documentation and/or other materials provided with the distribution.
  c. Neither the name of Enthought nor the names of the SciPy Developers
     may be used to endorse or promote products derived from this software
     without specific prior written permission.


THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDERS OR CONTRIBUTORS
BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
THE POSSIBILITY OF SUCH DAMAGE.
"""</span>
<span class="keyword">from</span> <span class="identifier">__future__</span> <span class="keyword">import</span> <span class="identifier">division</span><span class="punctuation">,</span> <span class="identifier">print_function</span><span class="punctuation">,</span> <span class="identifier">absolute_import</span>


<span class="keyword">import</span> <span class="identifier">numpy</span>

<span class="keyword">from</span> <span class="identifier">numpy</span> <span class="keyword">import</span> <span class="grouping">(</span><span class="identifier">amin</span><span class="punctuation">,</span> <span class="identifier">amax</span><span class="punctuation">,</span> <span class="identifier">ravel</span><span class="punctuation">,</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="punctuation">,</span> <span class="identifier">arange</span><span class="punctuation">,</span> <span class="identifier">ones</span><span class="punctuation">,</span> <span class="identifier">newaxis</span><span class="punctuation">,</span>
                   <span class="identifier">transpose</span><span class="punctuation">,</span> <span class="identifier">iscomplexobj</span><span class="punctuation">,</span> <span class="identifier">uint8</span><span class="punctuation">,</span> <span class="identifier">issubdtype</span><span class="punctuation">,</span> <span class="identifier">array</span><span class="grouping">)</span>

<span class="comment"># Modification of original scipy pilutil.py to make this module importable if</span>
<span class="comment"># pillow is not installed. If pillow is not installed, functions will raise</span>
<span class="comment"># ImportError when called.</span>
<span class="keyword">try</span><span class="punctuation">:</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="keyword">from</span> <span class="identifier">PIL</span> <span class="keyword">import</span> <span class="identifier">Image</span>
    <span class="keyword">except</span> <span class="invalid">I</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">:</span>
        <span class="keyword">import</span> <span class="identifier">Image</span>
    <span class="identifier">pillow_installed</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
    <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">Image</span><span class="punctuation">,</span> <span class="string-literal">'frombytes'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">Image</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">b</span><span class="invalid">y</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Image</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">r</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span>
<span class="keyword">except</span> <span class="invalid">I</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">:</span>
    <span class="identifier">pillow_installed</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>

<span class="identifier">__all__</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'bytescale', 'imread', 'imsave', 'fromimage', 'toimage', 'imresize'</span><span class="grouping">]</span>


<span class="identifier">PILLOW_ERROR_MESSAGE</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span>
    <span class="string-literal">"The Python Imaging Library (PIL) is required to load data "</span>
    <span class="string-literal">"from jpeg files. Please refer to "</span>
    <span class="string-literal">"https://pillow.readthedocs.io/en/stable/installation.html "</span>
    <span class="string-literal">"for installing PIL."</span>
<span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">bytescale</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">cmin</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">cmax</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">high</span><span class="arithmetic-assignment">=</span><span class="int-literal">255</span><span class="punctuation">,</span> <span class="identifier">low</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Byte scales an array (image).

    Byte scaling means converting the input image to uint8 dtype and scaling
    the range to ``(low, high)`` (default 0-255).
    If the input image already has dtype uint8, no scaling is done.

    This function is only available if Python Imaging Library (PIL) is installed.

    Parameters
    ----------
    data : ndarray
        PIL image data array.
    cmin : scalar, default=None
        Bias scaling of small values. Default is ``data.min()``.
    cmax : scalar, default=None
        Bias scaling of large values. Default is ``data.max()``.
    high : scalar, default=None
        Scale max value to `high`.  Default is 255.
    low : scalar, default=None
        Scale min value to `low`.  Default is 0.

    Returns
    -------
    img_array : uint8 ndarray
        The byte-scaled array.

    Examples
    --------
    &gt;&gt;&gt; import numpy as np
    &gt;&gt;&gt; from scipy.misc import bytescale
    &gt;&gt;&gt; img = np.array([[ 91.06794177,   3.39058326,  84.4221549 ],
    ...                 [ 73.88003259,  80.91433048,   4.88878881],
    ...                 [ 51.53875334,  34.45808177,  27.5873488 ]])
    &gt;&gt;&gt; bytescale(img)
    array([[255,   0, 236],
           [205, 225,   4],
           [140,  90,  70]], dtype=uint8)
    &gt;&gt;&gt; bytescale(img, high=200, low=100)
    array([[200, 100, 192],
           [180, 188, 102],
           [155, 135, 128]], dtype=uint8)
    &gt;&gt;&gt; bytescale(img, cmin=0, cmax=255)
    array([[91,  3, 84],
           [74, 81,  5],
           [52, 34, 28]], dtype=uint8)

    """</span>
    <span class="keyword">if</span> <span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">dtype</span> <span class="relational-operator">==</span> <span class="identifier">uint8</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">data</span>

    <span class="keyword">if</span> <span class="identifier">high</span> <span class="relational-operator">&gt;</span> <span class="int-literal">255</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"`high` should be less than or equal to 255."</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">low</span> <span class="relational-operator">&lt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"`low` should be greater than or equal to 0."</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">high</span> <span class="relational-operator">&lt;</span> <span class="identifier">low</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"`high` should be greater than or equal to `low`."</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">cmin</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">cmin</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">cmax</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">cmax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="identifier">cscale</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cmax</span> <span class="arithmetic-operator">-</span> <span class="identifier">cmin</span>
    <span class="keyword">if</span> <span class="identifier">cscale</span> <span class="relational-operator">&lt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"`cmax` should be larger than `cmin`."</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">cscale</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="identifier">cscale</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span>

    <span class="identifier">scale</span> <span class="arithmetic-assignment">=</span> <span class="identifier">float</span><span class="grouping">(</span><span class="identifier">high</span> <span class="arithmetic-operator">-</span> <span class="identifier">low</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">cscale</span>
    <span class="identifier">bytedata</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">data</span> <span class="arithmetic-operator">-</span> <span class="identifier">cmin</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="identifier">scale</span> <span class="arithmetic-operator">+</span> <span class="identifier">low</span>
    <span class="keyword">return</span> <span class="grouping">(</span><span class="identifier">bytedata</span><span class="punctuation">.</span><span class="identifier">clip</span><span class="grouping">(</span><span class="identifier">low</span><span class="punctuation">,</span> <span class="identifier">high</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.5</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">uint8</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">imread</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">flatten</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Read an image from a file as an array.

    This function is only available if Python Imaging Library (PIL) is installed.

    Parameters
    ----------
    name : str or file object
        The file name or file object to be read.
    flatten : bool, default=False
        If True, flattens the color layers into a single gray-scale layer.
    mode : str, default=None
        Mode to convert image to, e.g. ``'RGB'``.  See the Notes for more
        details.

    Returns
    -------
    imread : ndarray
        The array obtained by reading the image.

    Notes
    -----
    `imread` uses the Python Imaging Library (PIL) to read an image.
    The following notes are from the PIL documentation.

    `mode` can be one of the following strings:

    * 'L' (8-bit pixels, black and white)
    * 'P' (8-bit pixels, mapped to any other mode using a color palette)
    * 'RGB' (3x8-bit pixels, true color)
    * 'RGBA' (4x8-bit pixels, true color with transparency mask)
    * 'CMYK' (4x8-bit pixels, color separation)
    * 'YCbCr' (3x8-bit pixels, color video format)
    * 'I' (32-bit signed integer pixels)
    * 'F' (32-bit floating point pixels)

    PIL also provides limited support for a few special modes, including
    'LA' ('L' with alpha), 'RGBX' (true color with padding) and 'RGBa'
    (true color with premultiplied alpha).

    When translating a color image to black and white (mode 'L', 'I' or
    'F'), the library uses the ITU-R 601-2 luma transform::

        L = R * 299/1000 + G * 587/1000 + B * 114/1000

    When `flatten` is True, the image is converted using mode 'F'.
    When `mode` is not None and `flatten` is True, the image is first
    converted according to `mode`, and the result is then flattened using
    mode 'F'.

    """</span>
    <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">pillow_installed</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="invalid">I</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">PILLOW_ERROR_MESSAGE</span><span class="grouping">)</span>

    <span class="identifier">im</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Image</span><span class="punctuation">.</span><span class="identifier">open</span><span class="grouping">(</span><span class="identifier">name</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">im</span><span class="punctuation">,</span> <span class="identifier">flatten</span><span class="arithmetic-assignment">=</span><span class="identifier">flatten</span><span class="punctuation">,</span> <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="identifier">mode</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">imsave</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">arr</span><span class="punctuation">,</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Save an array as an image.

    This function is only available if Python Imaging Library (PIL) is installed.

    .. warning::

        This function uses `bytescale` under the hood to rescale images to use
        the full (0, 255) range if ``mode`` is one of ``None, 'L', 'P', 'l'``.
        It will also cast data for 2-D images to ``uint32`` for ``mode=None``
        (which is the default).

    Parameters
    ----------
    name : str or file object
        Output file name or file object.
    arr : ndarray, MxN or MxNx3 or MxNx4
        Array containing image values.  If the shape is ``MxN``, the array
        represents a grey-level image.  Shape ``MxNx3`` stores the red, green
        and blue bands along the last dimension.  An alpha layer may be
        included, specified as the last colour band of an ``MxNx4`` array.
    format : str, default=None
        Image format. If omitted, the format to use is determined from the
        file name extension. If a file object was used instead of a file name,
        this parameter should always be used.

    Examples
    --------
    Construct an array of gradient intensity values and save to file:

    &gt;&gt;&gt; import numpy as np
    &gt;&gt;&gt; from scipy.misc import imsave
    &gt;&gt;&gt; x = np.zeros((255, 255))
    &gt;&gt;&gt; x = np.zeros((255, 255), dtype=np.uint8)
    &gt;&gt;&gt; x[:] = np.arange(255)
    &gt;&gt;&gt; imsave('gradient.png', x)

    Construct an array with three colour bands (R, G, B) and store to file:

    &gt;&gt;&gt; rgb = np.zeros((255, 255, 3), dtype=np.uint8)
    &gt;&gt;&gt; rgb[..., 0] = np.arange(255)
    &gt;&gt;&gt; rgb[..., 1] = 55
    &gt;&gt;&gt; rgb[..., 2] = 1 - np.arange(255)
    &gt;&gt;&gt; imsave('rgb_gradient.png', rgb)

    """</span>
    <span class="identifier">im</span> <span class="arithmetic-assignment">=</span> <span class="identifier">toimage</span><span class="grouping">(</span><span class="identifier">arr</span><span class="punctuation">,</span> <span class="identifier">channel_axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">(</span><span class="identifier">name</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">save</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">)</span>
    <span class="keyword">return</span>


<span class="keyword">def</span> <span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">im</span><span class="punctuation">,</span> <span class="identifier">flatten</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Return a copy of a PIL image as a numpy array.

    This function is only available if Python Imaging Library (PIL) is installed.

    Parameters
    ----------
    im : PIL image
        Input image.
    flatten : bool, default=False
        If true, convert the output to grey-scale.
    mode : str, default=None
        Mode to convert image to, e.g. ``'RGB'``.  See the Notes of the
        `imread` docstring for more details.

    Returns
    -------
    fromimage : ndarray
        The different colour bands/channels are stored in the
        third dimension, such that a grey-image is MxN, an
        RGB-image MxNx3 and an RGBA-image MxNx4.

    """</span>
    <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">pillow_installed</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="invalid">I</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">PILLOW_ERROR_MESSAGE</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">Image</span><span class="punctuation">.</span><span class="identifier">isImageType</span><span class="grouping">(</span><span class="identifier">im</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">TypeError</span><span class="grouping">(</span><span class="string-literal">"Input is not a PIL image."</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">!=</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">mode</span><span class="punctuation">:</span>
            <span class="identifier">im</span> <span class="arithmetic-assignment">=</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">convert</span><span class="grouping">(</span><span class="identifier">mode</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">mode</span> <span class="relational-operator">==</span> <span class="string-literal">'P'</span><span class="punctuation">:</span>
        <span class="comment"># Mode 'P' means there is an indexed "palette".  If we leave the mode</span>
        <span class="comment"># as 'P', then when we do `a = array(im)` below, `a` will be a 2-D</span>
        <span class="comment"># containing the indices into the palette, and not a 3-D array</span>
        <span class="comment"># containing the RGB or RGBA values.</span>
        <span class="keyword">if</span> <span class="string-literal">'transparency'</span> <span class="relational-operator">in</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">info</span><span class="punctuation">:</span>
            <span class="identifier">im</span> <span class="arithmetic-assignment">=</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">convert</span><span class="grouping">(</span><span class="string-literal">'RGBA'</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">im</span> <span class="arithmetic-assignment">=</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">convert</span><span class="grouping">(</span><span class="string-literal">'RGB'</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">flatten</span><span class="punctuation">:</span>
        <span class="identifier">im</span> <span class="arithmetic-assignment">=</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">convert</span><span class="grouping">(</span><span class="string-literal">'F'</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">mode</span> <span class="relational-operator">==</span> <span class="string-literal">'1'</span><span class="punctuation">:</span>
        <span class="comment"># Workaround for crash in PIL. When im is 1-bit, the call array(im)</span>
        <span class="comment"># can cause a seg. fault, or generate garbage. See</span>
        <span class="comment"># https://github.com/scipy/scipy/issues/2138 and</span>
        <span class="comment"># https://github.com/python-pillow/Pillow/issues/350.</span>
        <span class="comment">#</span>
        <span class="comment"># This converts im from a 1-bit image to an 8-bit image.</span>
        <span class="identifier">im</span> <span class="arithmetic-assignment">=</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">convert</span><span class="grouping">(</span><span class="string-literal">'L'</span><span class="grouping">)</span>

    <span class="identifier">a</span> <span class="arithmetic-assignment">=</span> <span class="identifier">array</span><span class="grouping">(</span><span class="identifier">im</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">a</span>

<span class="identifier">_errstr</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"Mode is unknown or incompatible with input array shape."</span>


<span class="keyword">def</span> <span class="identifier">toimage</span><span class="grouping">(</span><span class="identifier">arr</span><span class="punctuation">,</span> <span class="identifier">high</span><span class="arithmetic-assignment">=</span><span class="int-literal">255</span><span class="punctuation">,</span> <span class="identifier">low</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">cmin</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">cmax</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">pal</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
            <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">channel_axis</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Takes a numpy array and returns a PIL image.

    This function is only available if Python Imaging Library (PIL) is installed.

    The mode of the PIL image depends on the array shape and the `pal` and
    `mode` keywords.

    For 2-D arrays, if `pal` is a valid (N,3) byte-array giving the RGB values
    (from 0 to 255) then ``mode='P'``, otherwise ``mode='L'``, unless mode
    is given as 'F' or 'I' in which case a float and/or integer array is made.

    .. warning::

        This function uses `bytescale` under the hood to rescale images to use
        the full (0, 255) range if ``mode`` is one of ``None, 'L', 'P', 'l'``.
        It will also cast data for 2-D images to ``uint32`` for ``mode=None``
        (which is the default).

    Notes
    -----
    For 3-D arrays, the `channel_axis` argument tells which dimension of the
    array holds the channel data.

    For 3-D arrays if one of the dimensions is 3, the mode is 'RGB'
    by default or 'YCbCr' if selected.

    The numpy array must be either 2 dimensional or 3 dimensional.

    """</span>
    <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">pillow_installed</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="invalid">I</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">PILLOW_ERROR_MESSAGE</span><span class="grouping">)</span>

    <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">arr</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">iscomplexobj</span><span class="grouping">(</span><span class="identifier">data</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Cannot convert a complex-valued array."</span><span class="grouping">)</span>
    <span class="identifier">shape</span> <span class="arithmetic-assignment">=</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">)</span>
    <span class="identifier">valid</span> <span class="arithmetic-assignment">=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">shape</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span> <span class="logical-operator">or</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">shape</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">3</span><span class="grouping">)</span> <span class="logical-operator">and</span>
                                <span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">3</span> <span class="relational-operator">in</span> <span class="identifier">shape</span><span class="grouping">)</span> <span class="logical-operator">or</span> <span class="grouping">(</span><span class="int-literal">4</span> <span class="relational-operator">in</span> <span class="identifier">shape</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">valid</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"'arr' does not have a suitable array shape for "</span>
                         <span class="string-literal">"any mode."</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">shape</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span><span class="punctuation">:</span>
        <span class="identifier">shape</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>  <span class="comment"># columns show up first</span>
        <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">==</span> <span class="string-literal">'F'</span><span class="punctuation">:</span>
            <span class="identifier">data32</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">float32</span><span class="grouping">)</span>
            <span class="identifier">image</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Image</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">b</span><span class="invalid">y</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">mode</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="punctuation">,</span> <span class="identifier">data32</span><span class="punctuation">.</span><span class="identifier">tobytes</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">image</span>
        <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="string-literal">'L', 'P'</span><span class="grouping">]</span><span class="punctuation">:</span>
            <span class="identifier">bytedata</span> <span class="arithmetic-assignment">=</span> <span class="identifier">bytescale</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">high</span><span class="arithmetic-assignment">=</span><span class="identifier">high</span><span class="punctuation">,</span> <span class="identifier">low</span><span class="arithmetic-assignment">=</span><span class="identifier">low</span><span class="punctuation">,</span>
                                 <span class="identifier">cmin</span><span class="arithmetic-assignment">=</span><span class="identifier">cmin</span><span class="punctuation">,</span> <span class="identifier">cmax</span><span class="arithmetic-assignment">=</span><span class="identifier">cmax</span><span class="grouping">)</span>
            <span class="identifier">image</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Image</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">b</span><span class="invalid">y</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="string-literal">'L'</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="punctuation">,</span> <span class="identifier">bytedata</span><span class="punctuation">.</span><span class="identifier">tobytes</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">pal</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
                <span class="identifier">image</span><span class="punctuation">.</span><span class="identifier">putpalette</span><span class="grouping">(</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">pal</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">uint8</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tobytes</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
                <span class="comment"># Becomes a mode='P' automagically.</span>
            <span class="keyword">elif</span> <span class="identifier">mode</span> <span class="relational-operator">==</span> <span class="string-literal">'P'</span><span class="punctuation">:</span>  <span class="comment"># default gray-scale</span>
                <span class="identifier">pal</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">arange</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">256</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">uint8</span><span class="grouping">)</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="identifier">newaxis</span><span class="grouping">]</span> <span class="arithmetic-operator">*</span>
                       <span class="identifier">ones</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">3</span><span class="punctuation">,</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">uint8</span><span class="grouping">)</span><span class="grouping">[</span><span class="identifier">newaxis</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span><span class="grouping">)</span>
                <span class="identifier">image</span><span class="punctuation">.</span><span class="identifier">putpalette</span><span class="grouping">(</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">pal</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">uint8</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tobytes</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">image</span>
        <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">==</span> <span class="string-literal">'1'</span><span class="punctuation">:</span>  <span class="comment"># high input gives threshold for 1</span>
            <span class="identifier">bytedata</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">data</span> <span class="relational-operator">&gt;</span> <span class="identifier">high</span><span class="grouping">)</span>
            <span class="identifier">image</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Image</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">b</span><span class="invalid">y</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="string-literal">'1'</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="punctuation">,</span> <span class="identifier">bytedata</span><span class="punctuation">.</span><span class="identifier">tobytes</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">image</span>
        <span class="keyword">if</span> <span class="identifier">cmin</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">cmin</span> <span class="arithmetic-assignment">=</span> <span class="identifier">amin</span><span class="grouping">(</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="identifier">data</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">cmax</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">cmax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">amax</span><span class="grouping">(</span><span class="identifier">ravel</span><span class="grouping">(</span><span class="identifier">data</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">data</span><span class="arithmetic-operator">*</span><span class="float-literal">1.0</span> <span class="arithmetic-operator">-</span> <span class="identifier">cmin</span><span class="grouping">)</span><span class="arithmetic-operator">*</span><span class="grouping">(</span><span class="identifier">high</span> <span class="arithmetic-operator">-</span> <span class="identifier">low</span><span class="grouping">)</span><span class="arithmetic-operator">/</span><span class="grouping">(</span><span class="identifier">cmax</span> <span class="arithmetic-operator">-</span> <span class="identifier">cmin</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">low</span>
        <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">==</span> <span class="string-literal">'I'</span><span class="punctuation">:</span>
            <span class="identifier">data32</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">uint32</span><span class="grouping">)</span>
            <span class="identifier">image</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Image</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">b</span><span class="invalid">y</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">mode</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="punctuation">,</span> <span class="identifier">data32</span><span class="punctuation">.</span><span class="identifier">tobytes</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="identifier">_errstr</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">image</span>

    <span class="comment"># if here then 3-d array with a 3 or a 4 in the shape length.</span>
    <span class="comment"># Check for 3 in datacube shape --- 'RGB' or 'YCbCr'</span>
    <span class="keyword">if</span> <span class="identifier">channel_axis</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="grouping">(</span><span class="int-literal">3</span> <span class="relational-operator">in</span> <span class="identifier">shape</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">ca</span> <span class="arithmetic-assignment">=</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">flatnonzero</span><span class="grouping">(</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">shape</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">3</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">ca</span> <span class="arithmetic-assignment">=</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">flatnonzero</span><span class="grouping">(</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">shape</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">4</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">ca</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">ca</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ca</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Could not find channel dimension."</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">ca</span> <span class="arithmetic-assignment">=</span> <span class="identifier">channel_axis</span>

    <span class="identifier">numch</span> <span class="arithmetic-assignment">=</span> <span class="identifier">shape</span><span class="grouping">[</span><span class="identifier">ca</span><span class="grouping">]</span>
    <span class="keyword">if</span> <span class="identifier">numch</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Channel axis dimension is not valid."</span><span class="grouping">)</span>

    <span class="identifier">bytedata</span> <span class="arithmetic-assignment">=</span> <span class="identifier">bytescale</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">high</span><span class="arithmetic-assignment">=</span><span class="identifier">high</span><span class="punctuation">,</span> <span class="identifier">low</span><span class="arithmetic-assignment">=</span><span class="identifier">low</span><span class="punctuation">,</span> <span class="identifier">cmin</span><span class="arithmetic-assignment">=</span><span class="identifier">cmin</span><span class="punctuation">,</span> <span class="identifier">cmax</span><span class="arithmetic-assignment">=</span><span class="identifier">cmax</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">ca</span> <span class="relational-operator">==</span> <span class="int-literal">2</span><span class="punctuation">:</span>
        <span class="identifier">strdata</span> <span class="arithmetic-assignment">=</span> <span class="identifier">bytedata</span><span class="punctuation">.</span><span class="identifier">tobytes</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">shape</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">ca</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
        <span class="identifier">strdata</span> <span class="arithmetic-assignment">=</span> <span class="identifier">transpose</span><span class="grouping">(</span><span class="identifier">bytedata</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tobytes</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">shape</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">ca</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="identifier">strdata</span> <span class="arithmetic-assignment">=</span> <span class="identifier">transpose</span><span class="grouping">(</span><span class="identifier">bytedata</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tobytes</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">shape</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">numch</span> <span class="relational-operator">==</span> <span class="int-literal">3</span><span class="punctuation">:</span>
            <span class="identifier">mode</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'RGB'</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">mode</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'RGBA'</span>

    <span class="keyword">if</span> <span class="identifier">mode</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">'RGB', 'RGBA', 'YCbCr', 'CMYK'</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="identifier">_errstr</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">'RGB', 'YCbCr'</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">numch</span> <span class="relational-operator">!=</span> <span class="int-literal">3</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Invalid array shape for mode."</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">'RGBA', 'CMYK'</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">numch</span> <span class="relational-operator">!=</span> <span class="int-literal">4</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"Invalid array shape for mode."</span><span class="grouping">)</span>

    <span class="comment"># Here we know data and mode is correct</span>
    <span class="identifier">image</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Image</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">b</span><span class="invalid">y</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">mode</span><span class="punctuation">,</span> <span class="identifier">shape</span><span class="punctuation">,</span> <span class="identifier">strdata</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">image</span>


<span class="keyword">def</span> <span class="identifier">imresize</span><span class="grouping">(</span><span class="identifier">arr</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="punctuation">,</span> <span class="identifier">interp</span><span class="arithmetic-assignment">=</span><span class="string-literal">'bilinear'</span><span class="punctuation">,</span> <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Resize an image.

    This function is only available if Python Imaging Library (PIL) is installed.

    .. warning::

        This function uses `bytescale` under the hood to rescale images to use
        the full (0, 255) range if ``mode`` is one of ``None, 'L', 'P', 'l'``.
        It will also cast data for 2-D images to ``uint32`` for ``mode=None``
        (which is the default).

    Parameters
    ----------
    arr : ndarray
        The array of image to be resized.
    size : int, float or tuple
        * int   - Percentage of current size.
        * float - Fraction of current size.
        * tuple - Size of the output image (height, width).

    interp : str, default='bilinear'
        Interpolation to use for re-sizing ('nearest', 'lanczos', 'bilinear',
        'bicubic' or 'cubic').
    mode : str, default=None
        The PIL image mode ('P', 'L', etc.) to convert `arr` before resizing.
        If ``mode=None`` (the default), 2-D images will be treated like
        ``mode='L'``, i.e. casting to long integer.  For 3-D and 4-D arrays,
        `mode` will be set to ``'RGB'`` and ``'RGBA'`` respectively.

    Returns
    -------
    imresize : ndarray
        The resized array of image.

    See Also
    --------
    toimage : Implicitly used to convert `arr` according to `mode`.
    scipy.ndimage.zoom : More generic implementation that does not use PIL.

    """</span>
    <span class="identifier">im</span> <span class="arithmetic-assignment">=</span> <span class="identifier">toimage</span><span class="grouping">(</span><span class="identifier">arr</span><span class="punctuation">,</span> <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="identifier">mode</span><span class="grouping">)</span>
    <span class="identifier">ts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">type</span><span class="grouping">(</span><span class="identifier">size</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">issubdtype</span><span class="grouping">(</span><span class="identifier">ts</span><span class="punctuation">,</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">signedinteger</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">percent</span> <span class="arithmetic-assignment">=</span> <span class="identifier">size</span> <span class="arithmetic-operator">/</span> <span class="float-literal">100.0</span>
        <span class="identifier">size</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tuple</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">size</span><span class="grouping">)</span><span class="arithmetic-operator">*</span><span class="identifier">percent</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">issubdtype</span><span class="grouping">(</span><span class="identifier">type</span><span class="grouping">(</span><span class="identifier">size</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">floating</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">size</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tuple</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">size</span><span class="grouping">)</span><span class="arithmetic-operator">*</span><span class="identifier">size</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">size</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">size</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="identifier">func</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'nearest': 0, 'lanczos': 1, 'bilinear': 2, 'bicubic': 3, 'cubic'</span><span class="punctuation">:</span> <span class="int-literal">3</span><span class="grouping">}</span>
    <span class="identifier">imnew</span> <span class="arithmetic-assignment">=</span> <span class="identifier">im</span><span class="punctuation">.</span><span class="identifier">resize</span><span class="grouping">(</span><span class="identifier">size</span><span class="punctuation">,</span> <span class="identifier">resample</span><span class="arithmetic-assignment">=</span><span class="identifier">func</span><span class="grouping">[</span><span class="identifier">interp</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="invalid">f</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">imnew</span><span class="grouping">)</span>

    </pre>
  </body>
</html>