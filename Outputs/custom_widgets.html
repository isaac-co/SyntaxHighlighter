<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">#!/usr/bin/env python3</span>
<span class="comment">""" Custom widgets for Faceswap GUI """</span>

<span class="keyword">import</span> <span class="identifier">logging</span>
<span class="keyword">import</span> <span class="identifier">platform</span>
<span class="keyword">import</span> <span class="identifier">re</span>
<span class="keyword">import</span> <span class="identifier">sys</span>
<span class="keyword">import</span> <span class="identifier">tkinter</span> <span class="keyword">as</span> <span class="identifier">tk</span>
<span class="keyword">from</span> <span class="identifier">tkinter</span> <span class="keyword">import</span> <span class="identifier">ttk</span><span class="punctuation">,</span> <span class="identifier">TclError</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>

<span class="keyword">from</span> <span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">get_config</span>

<span class="identifier">logger</span> <span class="arithmetic-assignment">=</span> <span class="identifier">logging</span><span class="punctuation">.</span><span class="identifier">getLogger</span><span class="grouping">(</span><span class="identifier">__name__</span><span class="grouping">)</span>  <span class="comment"># pylint: disable=invalid-name</span>


<span class="keyword">class</span> <span class="identifier">ContextMenu</span><span class="grouping">(</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Menu</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint: disable=too-many-ancestors</span>
    <span class="comment">""" A Pop up menu to be triggered when right clicking on widgets that this menu has been
    applied to.

    This widget provides a simple right click pop up menu to the widget passed in with `Cut`,
    `Copy`, `Paste` and `Select all` menu items.

    Parameters
    ----------
    widget: tkinter object
        The widget to apply the :class:`ContextMenu` to

    Example
    -------
    &gt;&gt;&gt; text_box = ttk.Entry(parent)
    &gt;&gt;&gt; text_box.pack()
    &gt;&gt;&gt; right_click_menu = ContextMenu(text_box)
    &gt;&gt;&gt; right_click_menu.cm_bind()
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">widget</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing %s: (widget_class: '%s')"</span><span class="punctuation">,</span>
                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">winfo_class</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">tearoff</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span> <span class="arithmetic-assignment">=</span> <span class="identifier">widget</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_standard_actions</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_standard_actions</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Standard menu actions """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">add_command</span><span class="grouping">(</span><span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Cut", command=lambda: self._widget.event_generate("&lt;&lt;Cut&gt;&gt;"</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">add_command</span><span class="grouping">(</span><span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Copy", command=lambda: self._widget.event_generate("&lt;&lt;Copy&gt;&gt;"</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">add_command</span><span class="grouping">(</span><span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Paste", command=lambda: self._widget.event_generate("&lt;&lt;Paste&gt;&gt;"</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">add_separator</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">add_command</span><span class="grouping">(</span><span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Select all"</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_select_all</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">cm_bind</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Bind the menu to the given widgets Right Click event

        After associating a widget with this :class:`ContextMenu` this function should be called
        to bind it to the right click button
        """</span>
        <span class="identifier">button</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"&lt;Button-2&gt;" if platform.system() == "Darwin" else "&lt;Button-3&gt;"</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Binding '%s' to '%s'"</span><span class="punctuation">,</span> <span class="identifier">button</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">winfo_class</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">bind</span><span class="grouping">(</span><span class="identifier">button</span><span class="punctuation">,</span> <span class="keyword">lambda</span> <span class="identifier">event</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk_popup</span><span class="grouping">(</span><span class="identifier">event</span><span class="punctuation">.</span><span class="identifier">x_root</span><span class="punctuation">,</span> <span class="identifier">event</span><span class="punctuation">.</span><span class="identifier">y_root</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_select_all</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Select all for Text or Entry widgets """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Selecting all for '%s'"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">winfo_class</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">winfo_class</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"Text"</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">focus_force</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">tag_add</span><span class="grouping">(</span><span class="string-literal">"sel", "1.0", "end"</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">focus_force</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">select_range</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">END</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">RightClickMenu</span><span class="grouping">(</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Menu</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint: disable=too-many-ancestors</span>
    <span class="comment">""" A Pop up menu that can be bound to a right click mouse event to bring up a context menu

    Parameters
    ----------
    labels: list
        A list of label titles that will appear in the right click menu
    actions: list
        A list of python functions that are called when the corresponding label is clicked on
    hotkeys: list, optional
        The hotkeys corresponding to the labels. If using hotkeys, then there must be an entry in
        the list for every label even if they don't all use hotkeys. Labels without a hotkey can be
        an empty string or ``None``. Passing ``None`` instead of a list means that no actions will
        be given hotkeys. NB: The hotkey is not bound by this class, that needs to be done in code.
        Giving hotkeys here means that they will be displayed in the menu though. Default: ``None``
    """</span>
    <span class="comment"># TODO This should probably be merged with Context Menu</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="punctuation">,</span> <span class="identifier">actions</span><span class="punctuation">,</span> <span class="identifier">hotkeys</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing %s: (labels: %s, actions: %s)"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">labels</span><span class="punctuation">,</span>
                     <span class="identifier">actions</span><span class="grouping">)</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">tearoff</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_labels</span> <span class="arithmetic-assignment">=</span> <span class="identifier">labels</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions</span> <span class="arithmetic-assignment">=</span> <span class="identifier">actions</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_hotkeys</span> <span class="arithmetic-assignment">=</span> <span class="identifier">hotkeys</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_create_menu</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_create_menu</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Create the menu based on :attr:`_labels` and :attr:`_actions`. """</span>
        <span class="keyword">for</span> <span class="identifier">idx</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">label</span><span class="punctuation">,</span> <span class="identifier">action</span><span class="grouping">)</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_labels</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">kwargs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dict</span><span class="grouping">(</span><span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="identifier">label</span><span class="punctuation">,</span> <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="identifier">action</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_hotkeys</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">list</span><span class="punctuation">,</span> <span class="identifier">tuple</span><span class="grouping">)</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_hotkeys</span><span class="grouping">[</span><span class="identifier">idx</span><span class="grouping">]</span><span class="punctuation">:</span>
                <span class="identifier">kwargs</span><span class="grouping">[</span><span class="string-literal">"accelerator"</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_hotkeys</span><span class="grouping">[</span><span class="identifier">idx</span><span class="grouping">]</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">add_command</span><span class="grouping">(</span><span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">popup</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">event</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Pop up the right click menu.

        Parameters
        ----------
        event: class:`tkinter.Event`
            The tkinter mouse event calling this popup
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk_popup</span><span class="grouping">(</span><span class="identifier">event</span><span class="punctuation">.</span><span class="identifier">x_root</span><span class="punctuation">,</span> <span class="identifier">event</span><span class="punctuation">.</span><span class="identifier">y_root</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">ConsoleOut</span><span class="grouping">(</span><span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint: disable=too-many-ancestors</span>
    <span class="comment">""" The Console out section of the GUI.

    A Read only text box for displaying the output from stdout/stderr.

    All handling is internal to this method. To clear the console, the stored tkinter variable in
    :attr:`~lib.gui.Config.tk_vars` ``console_clear`` should be triggered.

    Parameters
    ----------
    parent: tkinter object
        The Console's parent widget
    debug: bool
        ``True`` if console output should not be directed to this widget otherwise ``False``
    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">debug</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing %s: (parent: %s, debug: %s)"</span><span class="punctuation">,</span>
                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">debug</span><span class="grouping">)</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">relief</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">SOLID</span><span class="punctuation">,</span> <span class="identifier">padding</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">style</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Console.TFrame"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">user_theme</span><span class="grouping">[</span><span class="string-literal">"console"</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_ReadOnlyText</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">relief</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">FLAT</span><span class="grouping">)</span>
        <span class="identifier">rc_menu</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ContextMenu</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="grouping">)</span>
        <span class="identifier">rc_menu</span><span class="punctuation">.</span><span class="identifier">cm_bind</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console_clear</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tk_vars</span><span class="grouping">[</span><span class="string-literal">'console_clear'</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_console_clear_var_trace</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_debug</span> <span class="arithmetic-assignment">=</span> <span class="identifier">debug</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_build_console</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_add_tags</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="punctuation">,</span> <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">W</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">,</span>
                  <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTH</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_set_console_clear_var_trace</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set a trace on the console clear tkinter variable to trigger :func:`_clear` """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Set clear trace"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console_clear</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"w"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_clear</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_build_console</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Build and place the console  and add stdout/stderr redirection """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Build console"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">config</span><span class="grouping">(</span><span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">100</span><span class="punctuation">,</span>
                             <span class="identifier">height</span><span class="arithmetic-assignment">=</span><span class="int-literal">6</span><span class="punctuation">,</span>
                             <span class="identifier">bg</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span><span class="grouping">[</span><span class="string-literal">"background_color"</span><span class="grouping">]</span><span class="punctuation">,</span>
                             <span class="identifier">fg</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span><span class="grouping">[</span><span class="string-literal">"stdout_color"</span><span class="grouping">]</span><span class="grouping">)</span>

        <span class="identifier">scrollbar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Scrollbar</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span>
                                  <span class="identifier">command</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">yview</span><span class="punctuation">,</span>
                                  <span class="identifier">style</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Console.Vertical.TScrollbar"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">configure</span><span class="grouping">(</span><span class="identifier">yscrollcommand</span><span class="arithmetic-assignment">=</span><span class="identifier">scrollbar</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">)</span>

        <span class="identifier">scrollbar</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="string-literal">"y"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span> <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">N</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTH</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_redirect_console</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Built console"</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_add_tags</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Add tags to text widget to color based on output """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Adding text color tags"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">tag_config</span><span class="grouping">(</span><span class="string-literal">"default", foreground=self._theme["stdout_color"</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">tag_config</span><span class="grouping">(</span><span class="string-literal">"stderr", foreground=self._theme["stderr_color"</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">tag_config</span><span class="grouping">(</span><span class="string-literal">"info", foreground=self._theme["info_color"</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">tag_config</span><span class="grouping">(</span><span class="string-literal">"verbose", foreground=self._theme["verbose_color"</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">tag_config</span><span class="grouping">(</span><span class="string-literal">"warning", foreground=self._theme["warning_color"</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">tag_config</span><span class="grouping">(</span><span class="string-literal">"critical", foreground=self._theme["critical_color"</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">tag_config</span><span class="grouping">(</span><span class="string-literal">"error", foreground=self._theme["error_color"</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_redirect_console</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Redirect stdout/stderr to console Text Box """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Redirect console"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_debug</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"Console debug activated. Outputting to main terminal"</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">stdout</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_SysOutRouter</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">,</span> <span class="string-literal">"stdout"</span><span class="grouping">)</span>
            <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">stderr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_SysOutRouter</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">,</span> <span class="string-literal">"stderr"</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Redirected console"</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_clear</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint: disable=unused-argument</span>
        <span class="comment">""" Clear the console output screen """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Clear console"</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console_clear</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Console not set for clearing. Skipping"</span><span class="grouping">)</span>
            <span class="keyword">return</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">e</span><span class="grouping">(</span><span class="float-literal">1.0</span><span class="punctuation">,</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">END</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console_clear</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="bool-literal">False</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Cleared console"</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_ReadOnlyText</span><span class="grouping">(</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Text</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint: disable=too-many-ancestors</span>
    <span class="comment">""" A read only text widget.

    Standard tkinter Text widgets are read/write by default. As we want to make the console
    display writable by the Faceswap process but not the user, we need to redirect its insert and
    delete attributes.

    Source: https://stackoverflow.com/questions/3842155
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">redirector</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_WidgetRedirector</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">insert</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">redirector</span><span class="punctuation">.</span><span class="identifier">register</span><span class="grouping">(</span><span class="string-literal">"insert", lambda *args, **kw: "break"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">e</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">redirector</span><span class="punctuation">.</span><span class="identifier">register</span><span class="grouping">(</span><span class="string-literal">"delete", lambda *args, **kw: "break"</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_SysOutRouter</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">""" Route stdout/stderr to the given text box.

    Parameters
    ----------
    console: tkinter Object
        The widget that will receive the output from stderr/stdout
    out_type: ['stdout', 'stderr']
        The output type to redirect
    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">console</span><span class="punctuation">,</span> <span class="identifier">out_type</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing %s: (console: %s, out_type: '%s')"</span><span class="punctuation">,</span>
                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">console</span><span class="punctuation">,</span> <span class="identifier">out_type</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span> <span class="arithmetic-assignment">=</span> <span class="identifier">console</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_out_type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">out_type</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_recolor</span> <span class="arithmetic-assignment">=</span> <span class="identifier">re</span><span class="punctuation">.</span><span class="identifier">compile</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">".+?(\s\d+:\d+:\d+\s)(?P&lt;lvl&gt;[A-Z]+)\s"</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_get_tag</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">string</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the tag based on regex of log output """</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_out_type</span> <span class="relational-operator">==</span> <span class="string-literal">"stderr"</span><span class="punctuation">:</span>
            <span class="comment"># Output all stderr in red</span>
            <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_out_type</span>

        <span class="identifier">output</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_recolor</span><span class="punctuation">.</span><span class="identifier">match</span><span class="grouping">(</span><span class="identifier">string</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">output</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="string-literal">"default"</span>
        <span class="identifier">tag</span> <span class="arithmetic-assignment">=</span> <span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">groupdict</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">[</span><span class="string-literal">"lvl"</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">strip</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">tag</span>

    <span class="keyword">def</span> <span class="identifier">write</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">string</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Capture stdout/stderr """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">insert</span><span class="grouping">(</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">END</span><span class="punctuation">,</span> <span class="identifier">string</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_get_tag</span><span class="grouping">(</span><span class="identifier">string</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_console</span><span class="punctuation">.</span><span class="identifier">see</span><span class="grouping">(</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">END</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">flush</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" If flush is forced, send it to normal terminal """</span>
        <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">__stdout__</span><span class="punctuation">.</span><span class="identifier">flush</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">_WidgetRedirector</span><span class="punctuation">:</span>
    <span class="comment">"""Support for redirecting arbitrary widget sub-commands.

    Some Tk operations don't normally pass through tkinter.  For example, if a
    character is inserted into a Text widget by pressing a key, a default Tk
    binding to the widget's 'insert' operation is activated, and the Tk library
    processes the insert without calling back into tkinter.

    Although a binding to &lt;Key&gt; could be made via tkinter, what we really want
    to do is to hook the Tk 'insert' operation itself.  For one thing, we want
    a text.insert call in idle code to have the same effect as a key press.

    When a widget is instantiated, a Tcl command is created whose name is the
    same as the path name widget._w.  This command is used to invoke the various
    widget operations, e.g. insert (for a Text widget). We are going to hook
    this command and provide a facility ('register') to intercept the widget
    operation.  We will also intercept method calls on the tkinter class
    instance that represents the tk widget.

    In IDLE, WidgetRedirector is used in Percolator to intercept Text
    commands.  The function being registered provides access to the top
    of a Percolator chain.  At the bottom of the chain is a call to the
    original Tk widget operation.

    Attributes
    -----------
    _operations: dict
        Dictionary mapping operation name to new function. widget: the widget whose tcl command
        is to be intercepted.
    tk: widget.tk
        A convenience attribute, probably not needed.
    orig: str
        new name of the original tcl command.

    Notes
    -----
    Since renaming to orig fails with TclError when orig already exists, only one
    WidgetDirector can exist for a given widget.
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">widget</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_operations</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="grouping">}</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">widget</span> <span class="arithmetic-assignment">=</span> <span class="identifier">widget</span>                                <span class="comment"># widget instance</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">tk</span>                          <span class="comment"># widget's root</span>
        <span class="identifier">wgt</span> <span class="arithmetic-assignment">=</span> <span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">_w</span>  <span class="comment"># pylint:disable=protected-access  # widget's (full) Tk pathname</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">orig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">wgt</span> <span class="arithmetic-operator">+</span> <span class="string-literal">"_orig"</span>
        <span class="comment"># Rename the Tcl command within Tcl:</span>
        <span class="identifier">tk_</span><span class="punctuation">.</span><span class="identifier">call</span><span class="grouping">(</span><span class="string-literal">"rename"</span><span class="punctuation">,</span> <span class="identifier">wgt</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">orig</span><span class="grouping">)</span>
        <span class="comment"># Create a new Tcl command whose name is the widget's path name, and</span>
        <span class="comment"># whose action is to dispatch on the operation passed to the widget:</span>
        <span class="identifier">tk_</span><span class="punctuation">.</span><span class="identifier">createcommand</span><span class="grouping">(</span><span class="identifier">wgt</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dispatch</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">__repr__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="string-literal">"%s(%s&lt;%s&gt;)"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span>
                               <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span>
                               <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">_w</span><span class="grouping">)</span>  <span class="comment"># pylint:disable=protected-access</span>

    <span class="keyword">def</span> <span class="identifier">close</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="string-literal">"de-register operations and revert redirection created by .__init__."</span>
        <span class="keyword">for</span> <span class="identifier">operation</span> <span class="relational-operator">in</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_operations</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">unregister</span><span class="grouping">(</span><span class="identifier">operation</span><span class="grouping">)</span>
        <span class="identifier">widget</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">widget</span>
        <span class="identifier">tk_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">tk</span>
        <span class="identifier">wgt</span> <span class="arithmetic-assignment">=</span> <span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">_w</span>  <span class="comment"># pylint:disable=protected-access</span>
        <span class="comment"># Restore the original widget Tcl command.</span>
        <span class="identifier">tk_</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">c</span><span class="invalid">o</span><span class="invalid">m</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="grouping">(</span><span class="identifier">wgt</span><span class="grouping">)</span>
        <span class="identifier">tk_</span><span class="punctuation">.</span><span class="identifier">call</span><span class="grouping">(</span><span class="string-literal">"rename"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">orig</span><span class="punctuation">,</span> <span class="identifier">wgt</span><span class="grouping">)</span>
        <span class="keyword">del</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">widget</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk_</span>  <span class="comment"># Should not be needed</span>
        <span class="comment"># if instance is deleted after close, as in Percolator.</span>

    <span class="keyword">def</span> <span class="identifier">register</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">operation</span><span class="punctuation">,</span> <span class="identifier">function</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Return _OriginalCommand(operation) after registering function.

        Registration adds an operation: function pair to ._operations.
        It also adds a widget function attribute that masks the tkinter
        class instance method.  Method masking operates independently
        from command dispatch.

        If a second function is registered for the same operation, the
        first function is replaced in both places.
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_operations</span><span class="grouping">[</span><span class="identifier">operation</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">function</span>
        <span class="identifier">setattr</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">widget</span><span class="punctuation">,</span> <span class="identifier">operation</span><span class="punctuation">,</span> <span class="identifier">function</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">_OriginalCommand</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">operation</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">unregister</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">operation</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Return the function for the operation, or None.

        Deleting the instance attribute unmasks the class attribute.
        """</span>
        <span class="keyword">if</span> <span class="identifier">operation</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_operations</span><span class="punctuation">:</span>
            <span class="identifier">function</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_operations</span><span class="grouping">[</span><span class="identifier">operation</span><span class="grouping">]</span>
            <span class="keyword">del</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_operations</span><span class="grouping">[</span><span class="identifier">operation</span><span class="grouping">]</span>
            <span class="keyword">try</span><span class="punctuation">:</span>
                <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">t</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">widget</span><span class="punctuation">,</span> <span class="identifier">operation</span><span class="grouping">)</span>
            <span class="keyword">except</span> <span class="identifier">AttributeError</span><span class="punctuation">:</span>
                <span class="keyword">pass</span>
            <span class="keyword">return</span> <span class="identifier">function</span>
        <span class="keyword">return</span> <span class="none-literal">None</span>

    <span class="keyword">def</span> <span class="identifier">dispatch</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">operation</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Callback from Tcl which runs when the widget is referenced.

        If an operation has been registered in self._operations, apply the
        associated function to the args passed into Tcl. Otherwise, pass the
        operation through to Tk via the original Tcl function.

        Note that if a registered function is called, the operation is not
        passed through to Tk.  Apply the function returned by self.register()
        to *args to accomplish that.

        """</span>
        <span class="identifier">op_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_operations</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="identifier">operation</span><span class="grouping">)</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">op_</span><span class="punctuation">:</span>
                <span class="keyword">return</span> <span class="identifier">op_</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk_</span><span class="punctuation">.</span><span class="identifier">call</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">orig</span><span class="punctuation">,</span> <span class="identifier">operation</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">args</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">TclError</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="string-literal">""</span>


<span class="keyword">class</span> <span class="identifier">_OriginalCommand</span><span class="punctuation">:</span>
    <span class="comment">"""Callable for original tk command that has been redirected.

    Returned by .register; can be used in the function registered.
    redirect = WidgetRedirector(text)
    def my_insert(*args):
        print("insert", args)
        original_insert(*args)
    original_insert = redirect.register("insert", my_insert)
    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">redirect</span><span class="punctuation">,</span> <span class="identifier">operation</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Create .tk_call and .orig_and_operation for .__call__ method.

        .redirect and .operation store the input args for __repr__.
        .tk and .orig copy attributes of .redirect (probably not needed).
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">redirect</span> <span class="arithmetic-assignment">=</span> <span class="identifier">redirect</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">operation</span> <span class="arithmetic-assignment">=</span> <span class="identifier">operation</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">redirect</span><span class="punctuation">.</span><span class="identifier">tk_</span>  <span class="comment"># redundant with self.redirect</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">orig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">redirect</span><span class="punctuation">.</span><span class="identifier">orig</span>  <span class="comment"># redundant with self.redirect</span>
        <span class="comment"># These two could be deleted after checking recipient code.</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk_call</span> <span class="arithmetic-assignment">=</span> <span class="identifier">redirect</span><span class="punctuation">.</span><span class="identifier">tk_</span><span class="punctuation">.</span><span class="identifier">call</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">orig_and_operation</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">redirect</span><span class="punctuation">.</span><span class="identifier">orig</span><span class="punctuation">,</span> <span class="identifier">operation</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">__repr__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="string-literal">"%s(%r, %r)"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span>
                               <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">redirect</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">operation</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">__call__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk_call</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">orig_and_operation</span> <span class="arithmetic-operator">+</span> <span class="identifier">args</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">StatusBar</span><span class="grouping">(</span><span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint: disable=too-many-ancestors</span>
    <span class="comment">""" Status Bar for displaying the Status Message and  Progress Bar at the bottom of the GUI.

    Parameters
    ----------
    parent: tkinter object
        The parent tkinter widget that will hold the status bar
    hide_status: bool, optional
        ``True`` to hide the status message that appears at the far left hand side of the status
        frame otherwise ``False``. Default: ``False``
    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">hide_status</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">parent</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_message</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">StringVar</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar_message</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">StringVar</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar_position</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">IntVar</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_message</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="string-literal">"Ready"</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_status</span><span class="grouping">(</span><span class="identifier">hide_status</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_progress_bar</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTTOM</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">message</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""":class:`tkinter.StringVar`: The variable to hold the status bar message on the left
        hand side of the status bar. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_message</span>

    <span class="keyword">def</span> <span class="identifier">_status</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">hide_status</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Place Status label into left of the status bar.

        Parameters
        ----------
        hide_status: bool, optional
            ``True`` to hide the status message that appears at the far left hand side of the
            status frame otherwise ``False``
        """</span>
        <span class="keyword">if</span> <span class="identifier">hide_status</span><span class="punctuation">:</span>
            <span class="keyword">return</span>

        <span class="identifier">statusframe</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_frame</span><span class="grouping">)</span>
        <span class="identifier">statusframe</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span> <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">W</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>

        <span class="identifier">lbltitle</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">statusframe</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Status:"</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">6</span><span class="punctuation">,</span> <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">W</span><span class="grouping">)</span>
        <span class="identifier">lbltitle</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>

        <span class="identifier">lblstatus</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">statusframe</span><span class="punctuation">,</span>
                              <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">40</span><span class="punctuation">,</span>
                              <span class="identifier">textvariable</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_message</span><span class="punctuation">,</span>
                              <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">W</span><span class="grouping">)</span>
        <span class="identifier">lblstatus</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span> <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">W</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_progress_bar</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Place progress bar into right of the status bar. """</span>
        <span class="identifier">progressframe</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_frame</span><span class="grouping">)</span>
        <span class="identifier">progressframe</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="punctuation">,</span> <span class="identifier">anchor</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">E</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="grouping">)</span>

        <span class="identifier">lblmessage</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">progressframe</span><span class="punctuation">,</span> <span class="identifier">textvariable</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar_message</span><span class="grouping">)</span>
        <span class="identifier">lblmessage</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

        <span class="identifier">pbar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Progressbar</span><span class="grouping">(</span><span class="identifier">progressframe</span><span class="punctuation">,</span>
                               <span class="identifier">length</span><span class="arithmetic-assignment">=</span><span class="int-literal">200</span><span class="punctuation">,</span>
                               <span class="identifier">variable</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar_position</span><span class="punctuation">,</span>
                               <span class="identifier">maximum</span><span class="arithmetic-assignment">=</span><span class="int-literal">100</span><span class="punctuation">,</span>
                               <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="string-literal">"determinate"</span><span class="grouping">)</span>
        <span class="identifier">pbar</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">pbar</span><span class="punctuation">.</span><span class="identifier">pack_forget</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">pbar</span>

    <span class="keyword">def</span> <span class="identifier">start</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">mode</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set progress bar mode and display,

        Parameters
        ----------
        mode: ["indeterminate", "determinate"]
            The mode that the progress bar should be executed in
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_mode</span><span class="grouping">(</span><span class="identifier">mode</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">stop</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Reset progress bar and hide """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar_message</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="string-literal">""</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar_position</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_mode</span><span class="grouping">(</span><span class="string-literal">"determinate"</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar</span><span class="punctuation">.</span><span class="identifier">pack_forget</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_set_mode</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">mode</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the progress bar mode """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar</span><span class="punctuation">.</span><span class="identifier">config</span><span class="grouping">(</span><span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="identifier">mode</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">mode</span> <span class="relational-operator">==</span> <span class="string-literal">"indeterminate"</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar</span><span class="punctuation">.</span><span class="identifier">config</span><span class="grouping">(</span><span class="identifier">maximum</span><span class="arithmetic-assignment">=</span><span class="int-literal">100</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar</span><span class="punctuation">.</span><span class="identifier">start</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar</span><span class="punctuation">.</span><span class="identifier">stop</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar</span><span class="punctuation">.</span><span class="identifier">config</span><span class="grouping">(</span><span class="identifier">maximum</span><span class="arithmetic-assignment">=</span><span class="int-literal">100</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">progress_update</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">message</span><span class="punctuation">,</span> <span class="identifier">position</span><span class="punctuation">,</span> <span class="identifier">update_position</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Update the GUIs progress bar and position.

        Parameters
        ----------
        message: str
            The message to display next to the progress bar
        position: int
            The position that the progress bar should be set to
        update_position: bool, optional
            If ``True`` then the progress bar will be updated to the position given in
            :attr:`position`. If ``False`` the progress bar will not be updates. Default: ``True``
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar_message</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">message</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">update_position</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pbar_position</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">position</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">Tooltip</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=too-few-public-methods</span>
    <span class="comment">""" Create a tooltip for a given widget as the mouse goes on it.

    Parameters
    ----------
    widget: tkinter object
        The widget to apply the tool-tip to
    pad: tuple, optional
        (left, top, right, bottom) padding for the tool-tip. Default: (5, 3, 5, 3)
    text: str, optional
        The text to be displayed in the tool-tip. Default: 'widget info'
    text_variable: :class:`tkinter.strVar`, optional
        The text variable to use for dynamic help text. Appended after the contents of :attr:`text`
        if provided. Default: ``None``
    wait_time: int, optional
        The time in milliseconds to wait before showing the tool-tip. Default: 400
    wrap_length: int, optional
        The text length for each line before wrapping. Default: 250

    Example
    -------
    &gt;&gt;&gt; button = ttk.Button(parent, text="Exit")
    &gt;&gt;&gt; Tooltip(button, text="Click to exit")
    &gt;&gt;&gt; button.pack()

    Notes
    -----
    Adapted from StackOverflow: http://stackoverflow.com/questions/3221956 and
    http://www.daniweb.com/programming/software-development/code/484591/a-tooltip-class-for-tkinter
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">widget</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="punctuation">,</span> <span class="identifier">pad</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="string-literal">"widget info"</span><span class="punctuation">,</span>
                 <span class="identifier">text_variable</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">wait_time</span><span class="arithmetic-assignment">=</span><span class="int-literal">400</span><span class="punctuation">,</span> <span class="identifier">wrap_length</span><span class="arithmetic-assignment">=</span><span class="int-literal">250</span><span class="grouping">)</span><span class="punctuation">:</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_waittime</span> <span class="arithmetic-assignment">=</span> <span class="identifier">wait_time</span>  <span class="comment"># in milliseconds, originally 500</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">wrap_length</span> <span class="arithmetic-assignment">=</span> <span class="identifier">wrap_length</span>  <span class="comment"># in pixels, originally 180</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span> <span class="arithmetic-assignment">=</span> <span class="identifier">widget</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">text</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_text_variable</span> <span class="arithmetic-assignment">=</span> <span class="identifier">text_variable</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">bind</span><span class="grouping">(</span><span class="string-literal">"&lt;Enter&gt;"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_on_enter</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">bind</span><span class="grouping">(</span><span class="string-literal">"&lt;Leave&gt;"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_on_leave</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">bind</span><span class="grouping">(</span><span class="string-literal">"&lt;ButtonPress&gt;"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_on_leave</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">user_theme</span><span class="grouping">[</span><span class="string-literal">"tooltip"</span><span class="grouping">]</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pad</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pad</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_ident</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_topwidget</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>

    <span class="keyword">def</span> <span class="identifier">_on_enter</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">event</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" Schedule on an enter event """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_schedule</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_on_leave</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">event</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" remove schedule on a leave event """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_unschedule</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_hide</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_schedule</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Show the tooltip after wait period """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_unschedule</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_ident</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">after</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_waittime</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_show</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_unschedule</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Hide the tooltip """</span>
        <span class="identifier">id_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_ident</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_ident</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="keyword">if</span> <span class="identifier">id_</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span><span class="punctuation">.</span><span class="identifier">after_cancel</span><span class="grouping">(</span><span class="identifier">id_</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_show</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Show the tooltip """</span>
        <span class="keyword">def</span> <span class="identifier">tip_pos_calculator</span><span class="grouping">(</span><span class="identifier">widget</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="punctuation">,</span>
                               <span class="arithmetic-operator">*</span><span class="punctuation">,</span>
                               <span class="identifier">tip_delta</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">pad</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="comment">""" Calculate the tooltip position """</span>

            <span class="identifier">s_width</span><span class="punctuation">,</span> <span class="identifier">s_height</span> <span class="arithmetic-assignment">=</span> <span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">winfo_screenwidth</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">winfo_screenheight</span><span class="grouping">(</span><span class="grouping">)</span>

            <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">height</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">pad</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="identifier">label</span><span class="punctuation">.</span><span class="identifier">winfo_reqwidth</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">pad</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span>
                             <span class="identifier">pad</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="identifier">label</span><span class="punctuation">.</span><span class="identifier">winfo_reqheight</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">pad</span><span class="grouping">[</span><span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">)</span>

            <span class="identifier">mouse_x</span><span class="punctuation">,</span> <span class="identifier">mouse_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">widget</span><span class="punctuation">.</span><span class="identifier">winfo_pointerxy</span><span class="grouping">(</span><span class="grouping">)</span>

            <span class="identifier">x_1</span><span class="punctuation">,</span> <span class="identifier">y_1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">mouse_x</span> <span class="arithmetic-operator">+</span> <span class="identifier">tip_delta</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">mouse_y</span> <span class="arithmetic-operator">+</span> <span class="identifier">tip_delta</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>
            <span class="identifier">x_2</span><span class="punctuation">,</span> <span class="identifier">y_2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">x_1</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">y_1</span> <span class="arithmetic-operator">+</span> <span class="identifier">height</span>

            <span class="identifier">x_delta</span> <span class="arithmetic-assignment">=</span> <span class="identifier">x_2</span> <span class="arithmetic-operator">-</span> <span class="identifier">s_width</span>
            <span class="keyword">if</span> <span class="identifier">x_delta</span> <span class="relational-operator">&lt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
                <span class="identifier">x_delta</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
            <span class="identifier">y_delta</span> <span class="arithmetic-assignment">=</span> <span class="identifier">y_2</span> <span class="arithmetic-operator">-</span> <span class="identifier">s_height</span>
            <span class="keyword">if</span> <span class="identifier">y_delta</span> <span class="relational-operator">&lt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
                <span class="identifier">y_delta</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>

            <span class="identifier">offscreen</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">x_delta</span><span class="punctuation">,</span> <span class="identifier">y_delta</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span>

            <span class="keyword">if</span> <span class="identifier">offscreen</span><span class="punctuation">:</span>

                <span class="keyword">if</span> <span class="identifier">x_delta</span><span class="punctuation">:</span>
                    <span class="identifier">x_1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">mouse_x</span> <span class="arithmetic-operator">-</span> <span class="identifier">tip_delta</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-operator">-</span> <span class="identifier">width</span>

                <span class="keyword">if</span> <span class="identifier">y_delta</span><span class="punctuation">:</span>
                    <span class="identifier">y_1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">mouse_y</span> <span class="arithmetic-operator">-</span> <span class="identifier">tip_delta</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">-</span> <span class="identifier">height</span>

            <span class="identifier">offscreen_again</span> <span class="arithmetic-assignment">=</span> <span class="identifier">y_1</span> <span class="relational-operator">&lt;</span> <span class="int-literal">0</span>  <span class="comment"># out on the top</span>

            <span class="keyword">if</span> <span class="identifier">offscreen_again</span><span class="punctuation">:</span>
                <span class="comment"># No further checks will be done.</span>
                <span class="comment"># TIP:</span>
                <span class="comment"># A further mod might auto-magically augment the wrap length when the tooltip is</span>
                <span class="comment"># too high to be kept inside the screen.</span>
                <span class="identifier">y_1</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>

            <span class="keyword">return</span> <span class="identifier">x_1</span><span class="punctuation">,</span> <span class="identifier">y_1</span>

        <span class="identifier">pad</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_pad</span>
        <span class="identifier">widget</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_widget</span>

        <span class="comment"># Creates a top level window</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_topwidget</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Toplevel</span><span class="grouping">(</span><span class="identifier">widget</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">platform</span><span class="punctuation">.</span><span class="identifier">system</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"Darwin"</span><span class="punctuation">:</span>
            <span class="comment"># For Mac OS</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_topwidget</span><span class="punctuation">.</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">call</span><span class="grouping">(</span><span class="string-literal">"::tk::unsupported::MacWindowStyle"</span><span class="punctuation">,</span>
                                    <span class="string-literal">"style"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_topwidget</span><span class="punctuation">.</span><span class="identifier">_w</span><span class="punctuation">,</span>  <span class="comment"># pylint:disable=protected-access</span>
                                    <span class="string-literal">"help", "none"</span><span class="grouping">)</span>

        <span class="comment"># Leaves only the label and removes the app window</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_topwidget</span><span class="punctuation">.</span><span class="identifier">wm_overrideredirect</span><span class="grouping">(</span><span class="bool-literal">True</span><span class="grouping">)</span>

        <span class="identifier">win</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_topwidget</span><span class="punctuation">,</span>
                       <span class="identifier">background</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span><span class="grouping">[</span><span class="string-literal">"background_color"</span><span class="grouping">]</span><span class="punctuation">,</span>
                       <span class="identifier">highlightbackground</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span><span class="grouping">[</span><span class="string-literal">"border_color"</span><span class="grouping">]</span><span class="punctuation">,</span>
                       <span class="identifier">highlightcolor</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span><span class="grouping">[</span><span class="string-literal">"border_color"</span><span class="grouping">]</span><span class="punctuation">,</span>
                       <span class="identifier">highlightthickness</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span>
                       <span class="identifier">borderwidth</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>

        <span class="identifier">text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_text</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_text_variable</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_text_variable</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">text</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">"\n\nCurrent value: '{}'"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_text_variable</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">label</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">win</span><span class="punctuation">,</span>
                         <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">text</span><span class="punctuation">,</span>
                         <span class="identifier">justify</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span>
                         <span class="identifier">background</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span><span class="grouping">[</span><span class="string-literal">"background_color"</span><span class="grouping">]</span><span class="punctuation">,</span>
                         <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">u</span><span class="invalid">n</span><span class="invalid">d</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_theme</span><span class="grouping">[</span><span class="string-literal">"font_color"</span><span class="grouping">]</span><span class="punctuation">,</span>
                         <span class="identifier">relief</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">SOLID</span><span class="punctuation">,</span>
                         <span class="identifier">borderwidth</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span>
                         <span class="identifier">wraplength</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">wrap_length</span><span class="grouping">)</span>

        <span class="identifier">label</span><span class="punctuation">.</span><span class="identifier">grid</span><span class="grouping">(</span><span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="identifier">pad</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">pad</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
                   <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="identifier">pad</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">pad</span><span class="grouping">[</span><span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
                   <span class="identifier">sticky</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">NSEW</span><span class="grouping">)</span>
        <span class="identifier">win</span><span class="punctuation">.</span><span class="identifier">grid</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">xpos</span><span class="punctuation">,</span> <span class="identifier">ypos</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tip_pos_calculator</span><span class="grouping">(</span><span class="identifier">widget</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_topwidget</span><span class="punctuation">.</span><span class="identifier">wm_geometry</span><span class="grouping">(</span><span class="string-literal">"+%d+%d"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">xpos</span><span class="punctuation">,</span> <span class="identifier">ypos</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_hide</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Hide the tooltip """</span>
        <span class="identifier">topwidget</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_topwidget</span>
        <span class="keyword">if</span> <span class="identifier">topwidget</span><span class="punctuation">:</span>
            <span class="identifier">topwidget</span><span class="punctuation">.</span><span class="identifier">destroy</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_topwidget</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>


<span class="keyword">class</span> <span class="identifier">MultiOption</span><span class="grouping">(</span><span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Checkbutton</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint: disable=too-many-ancestors</span>
    <span class="comment">""" Similar to the standard :class:`ttk.Radio` widget, but with the ability to select
    multiple pre-defined options. Selected options are generated as `nargs` for the argument
    parser to consume.

    Parameters
    ----------
    parent: :class:`ttk.Frame`
        The tkinter parent widget for the check button
    value: str
        The raw option value for this check button
    variable: :class:`tkinter.StingVar`
        The master variable for the group of check buttons that this check button will belong to.
        The output of this variable will be a string containing a space separated list of the
        selected check button options
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">value</span><span class="punctuation">,</span> <span class="identifier">variable</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_var</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BooleanVar</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_var</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">value</span> <span class="relational-operator">in</span> <span class="identifier">variable</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">variable</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_var</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_value</span> <span class="arithmetic-assignment">=</span> <span class="identifier">value</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_variable</span> <span class="arithmetic-assignment">=</span> <span class="identifier">variable</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_var</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"w"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_on_update</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_variable</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"w"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_on_master_update</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_master_list</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" list: The contents of the check box group's :attr:`_master_variable` in list form.
        Selected check boxes will appear in this list. """</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_variable</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">_master_needs_update</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" bool: ``True`` if :attr:`_master_variable` requires updating otherwise ``False``. """</span>
        <span class="identifier">active</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_var</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">active</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_value</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_list</span><span class="grouping">)</span> <span class="logical-operator">or</span>
                  <span class="grouping">(</span><span class="logical-operator">not</span> <span class="identifier">active</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_value</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_list</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="keyword">def</span> <span class="identifier">_on_update</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint: disable=unused-argument</span>
        <span class="comment">""" Update the master variable on a check button change.

        The value for this checked option is added or removed from the :attr:`_master_variable`
        on a ``True``, ``False`` change for this check button.

        Parameters
        ----------
        args: tuple
            Required for variable callback, but unused
        """</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_needs_update</span><span class="punctuation">:</span>
            <span class="keyword">return</span>
        <span class="identifier">new_vals</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_list</span> <span class="arithmetic-operator">+</span> <span class="grouping">[</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_value</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_var</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="grouping">[</span>
            <span class="identifier">val</span>
            <span class="keyword">for</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_list</span>
            <span class="keyword">if</span> <span class="identifier">val</span> <span class="relational-operator">!=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_value</span><span class="grouping">]</span>
        <span class="identifier">val</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">" "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">new_vals</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"Setting master variable to: %s"</span><span class="punctuation">,</span> <span class="identifier">val</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_variable</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">val</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_on_master_update</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint: disable=unused-argument</span>
        <span class="comment">""" Update the check button on a master variable change (e.g. load .fsw file in the GUI).

        The value for this option is set to ``True`` or ``False`` depending on it's existence in
        the :attr:`_master_variable`

        Parameters
        ----------
        args: tuple
            Required for variable callback, but unused
        """</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_needs_update</span><span class="punctuation">:</span>
            <span class="keyword">return</span>
        <span class="identifier">state</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_value</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_master_list</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"Setting '%s' to %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_value</span><span class="punctuation">,</span> <span class="identifier">state</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_tk_var</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="identifier">state</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">PopupProgress</span><span class="grouping">(</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">Toplevel</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">""" A simple pop up progress bar that appears of the center of the root window.

    When this is called, the root will be disabled until the :func:`close` method is called.

    Parameters
    ----------
    title: str
        The title to appear above the progress bar
    total: int or float
        The total count of items for the progress bar

    Example
    -------
    &gt;&gt;&gt; total = 100
    &gt;&gt;&gt; progress = PopupProgress("My title...", total)
    &gt;&gt;&gt; for i in range(total):
    &gt;&gt;&gt;     progress.update(1)
    &gt;&gt;&gt; progress.close()
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">title</span><span class="punctuation">,</span> <span class="identifier">total</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_total</span> <span class="arithmetic-assignment">=</span> <span class="identifier">total</span>
        <span class="keyword">if</span> <span class="identifier">platform</span><span class="punctuation">.</span><span class="identifier">system</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"Darwin"</span><span class="punctuation">:</span>  <span class="comment"># For Mac OS</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">call</span><span class="grouping">(</span><span class="string-literal">"::tk::unsupported::MacWindowStyle"</span><span class="punctuation">,</span>
                         <span class="string-literal">"style"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_w</span><span class="punctuation">,</span>  <span class="comment"># pylint:disable=protected-access</span>
                         <span class="string-literal">"help", "none"</span><span class="grouping">)</span>
        <span class="comment"># Leaves only the label and removes the app window</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">wm_overrideredirect</span><span class="grouping">(</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">attributes</span><span class="grouping">(</span><span class="string-literal">'-topmost', 'true'</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">transient</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_lbl_title</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_set_title</span><span class="grouping">(</span><span class="identifier">title</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_progress_bar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_get_progress_bar</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">offset</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">master</span><span class="punctuation">.</span><span class="identifier">winfo_rootx</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">master</span><span class="punctuation">.</span><span class="identifier">winfo_rooty</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="comment"># TODO find way to get dimensions of the pop up without it flicking onto the screen</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">update_idletasks</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">center</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">(</span>
            <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">master</span><span class="punctuation">.</span><span class="identifier">winfo_width</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">//</span> <span class="int-literal">2</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">winfo_width</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">//</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">,</span>
            <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">master</span><span class="punctuation">.</span><span class="identifier">winfo_height</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">//</span> <span class="int-literal">2</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">winfo_height</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">//</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">offset</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">wm_geometry</span><span class="grouping">(</span><span class="string-literal">"+{}+{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="arithmetic-operator">*</span><span class="identifier">center</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">set_cursor_busy</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">grab_set</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">progress_bar</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" :class:`tkinter.ttk.Progressbar`: The progress bar object within the pop up window. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_progress_bar</span>

    <span class="keyword">def</span> <span class="identifier">_set_title</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">title</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the initial title of the pop up progress bar.

        Parameters
        ----------
        title: str
            The title to appear above the progress bar

        Returns
        -------
        :class:`tkinter.ttk.Label`
            The heading label for the progress bar
        """</span>
        <span class="identifier">frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="grouping">)</span>
        <span class="identifier">lbl</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">frame</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">title</span><span class="grouping">)</span>
        <span class="identifier">lbl</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">TOP</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">lbl</span>

    <span class="keyword">def</span> <span class="identifier">_get_progress_bar</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set up the progress bar with the supplied total.

        Returns
        -------
        :class:`tkinter.ttk.Progressbar`
            The configured progress bar for the pop up window
        """</span>
        <span class="identifier">frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span>
        <span class="identifier">frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BOTTOM</span><span class="punctuation">,</span> <span class="identifier">padx</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">pady</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">pbar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Progressbar</span><span class="grouping">(</span><span class="identifier">frame</span><span class="punctuation">,</span>
                               <span class="identifier">length</span><span class="arithmetic-assignment">=</span><span class="int-literal">400</span><span class="punctuation">,</span>
                               <span class="identifier">maximum</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_total</span><span class="punctuation">,</span>
                               <span class="identifier">mode</span><span class="arithmetic-assignment">=</span><span class="string-literal">"determinate"</span><span class="grouping">)</span>
        <span class="identifier">pbar</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">pbar</span>

    <span class="keyword">def</span> <span class="identifier">step</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">amount</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Increment the progress bar.

        Parameters
        ----------
        amount: int or float
            The amount to increment the progress bar by
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_progress_bar</span><span class="punctuation">.</span><span class="identifier">step</span><span class="grouping">(</span><span class="identifier">amount</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_progress_bar</span><span class="punctuation">.</span><span class="identifier">update_idletasks</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">stop</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Stop the progress bar, re-enable the root window and destroy the pop up window. """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_progress_bar</span><span class="punctuation">.</span><span class="identifier">stop</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">set_cursor_default</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">grab_release</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">destroy</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">update_title</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">title</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Update the title that displays above the progress bar.

        Parameters
        ----------
        title: str
            The title to appear above the progress bar
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_lbl_title</span><span class="punctuation">.</span><span class="identifier">config</span><span class="grouping">(</span><span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">title</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_lbl_title</span><span class="punctuation">.</span><span class="identifier">update_idletasks</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">ToggledFrame</span><span class="grouping">(</span><span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=too-many-ancestors</span>
    <span class="comment">""" A collapsible and expandable frame.

    The frame contains a header given in the text argument, and adds an expand contract button.
    Clicking on the header will expand and contract the sub-frame below

    Parameters
    ----------
    text: str
        The text to appear in the Toggle Frame header
    theme: str, optional
        The theme to use for the panel header. Default: `"CPanel"`
    subframe_style: str, optional
        The name of the ttk Style to use for the sub frame. Default: ``None``
    toggle_var: :class:`tk.BooleanVar`, optional
        If provided, this variable will control the expanded (``True``) and minimized (``False``)
        state of the widget. Set to None to create the variable internally. Default: ``None``
    """</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="string-literal">"", theme="CPanel"</span><span class="punctuation">,</span> <span class="identifier">toggle_var</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing %s: (parent: %s, text: %s, theme: %s, toggle_var: %s)"</span><span class="punctuation">,</span>
                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">parent</span><span class="punctuation">,</span> <span class="identifier">text</span><span class="punctuation">,</span> <span class="identifier">theme</span><span class="punctuation">,</span> <span class="identifier">toggle_var</span><span class="grouping">)</span>

        <span class="identifier">theme</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"CPanel"</span> <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">theme</span> <span class="keyword">else</span> <span class="identifier">theme</span>
        <span class="identifier">theme</span> <span class="arithmetic-assignment">=</span> <span class="identifier">theme</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">theme</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="string-literal">"."</span> <span class="keyword">else</span> <span class="identifier">theme</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">parent</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="identifier">style</span><span class="arithmetic-assignment">=</span><span class="identifier">f</span><span class="string-literal">"{theme}.Group.TFrame"</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_text</span> <span class="arithmetic-assignment">=</span> <span class="identifier">text</span>

        <span class="keyword">if</span> <span class="identifier">toggle_var</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_toggle_var</span> <span class="arithmetic-assignment">=</span> <span class="identifier">toggle_var</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_toggle_var</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">BooleanVar</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_toggle_var</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="int-literal">1</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_icon_var</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">StringVar</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_icon_var</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="string-literal">"-" if self.is_expanded else "+"</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_build_header</span><span class="grouping">(</span><span class="identifier">theme</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">sub_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">style</span><span class="arithmetic-assignment">=</span><span class="identifier">f</span><span class="string-literal">"{theme}.Subframe.Group.TFrame"</span><span class="punctuation">,</span> <span class="identifier">padding</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">is_expanded</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">sub_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">is_expanded</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" bool: ``True`` if the Toggle Frame is expanded. ``False`` if it is minimized. """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_toggle_var</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_build_header</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">theme</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" The Header row. Contains the title text and is made clickable to expand and contract
        the sub-frame.

        Parameters
        theme: str
            The theme to use for the panel header
        """</span>
        <span class="identifier">header_frame</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Frame</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="arithmetic-assignment">=</span><span class="string-literal">"toggledframe_header"</span><span class="grouping">)</span>

        <span class="identifier">text_label</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">header_frame</span><span class="punctuation">,</span>
                               <span class="identifier">name</span><span class="arithmetic-assignment">=</span><span class="string-literal">"toggledframe_headerlbl"</span><span class="punctuation">,</span>
                               <span class="identifier">text</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_text</span><span class="punctuation">,</span>
                               <span class="identifier">style</span><span class="arithmetic-assignment">=</span><span class="identifier">f</span><span class="string-literal">"{theme}.Groupheader.TLabel"</span><span class="punctuation">,</span>
                               <span class="identifier">cursor</span><span class="arithmetic-assignment">=</span><span class="string-literal">"hand2"</span><span class="grouping">)</span>
        <span class="identifier">toggle_button</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ttk</span><span class="punctuation">.</span><span class="identifier">Label</span><span class="grouping">(</span><span class="identifier">header_frame</span><span class="punctuation">,</span>
                                  <span class="identifier">name</span><span class="arithmetic-assignment">=</span><span class="string-literal">"toggledframe_headerbtn"</span><span class="punctuation">,</span>
                                  <span class="identifier">textvariable</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_icon_var</span><span class="punctuation">,</span>
                                  <span class="identifier">style</span><span class="arithmetic-assignment">=</span><span class="identifier">f</span><span class="string-literal">"{theme}.Groupheader.TLabel"</span><span class="punctuation">,</span>
                                  <span class="identifier">cursor</span><span class="arithmetic-assignment">=</span><span class="string-literal">"hand2"</span><span class="punctuation">,</span>
                                  <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
        <span class="identifier">text_label</span><span class="punctuation">.</span><span class="identifier">bind</span><span class="grouping">(</span><span class="string-literal">"&lt;Button-1&gt;"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_toggle</span><span class="grouping">)</span>
        <span class="identifier">toggle_button</span><span class="punctuation">.</span><span class="identifier">bind</span><span class="grouping">(</span><span class="string-literal">"&lt;Button-1&gt;"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_toggle</span><span class="grouping">)</span>

        <span class="identifier">text_label</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">LEFT</span><span class="punctuation">,</span> <span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">toggle_button</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">side</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">RIGHT</span><span class="grouping">)</span>
        <span class="identifier">header_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_toggle</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">event</span><span class="grouping">)</span><span class="punctuation">:</span>  <span class="comment"># pylint:disable=unused-argument</span>
        <span class="comment">""" Toggle the sub-frame between contracted or expanded, and update the toggle icon
        appropriately.

        Parameters
        ----------
        event: tkinter event
            Required but unused
         """</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">is_expanded</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">sub_frame</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">g</span><span class="invalid">e</span><span class="invalid">t</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_icon_var</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="string-literal">"+"</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_toggle_var</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">sub_frame</span><span class="punctuation">.</span><span class="identifier">pack</span><span class="grouping">(</span><span class="identifier">fill</span><span class="arithmetic-assignment">=</span><span class="identifier">tk</span><span class="punctuation">.</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">expand</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_icon_var</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="string-literal">"-"</span><span class="grouping">)</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_toggle_var</span><span class="punctuation">.</span><span class="identifier">set</span><span class="grouping">(</span><span class="int-literal">1</span><span class="grouping">)</span>

    </pre>
  </body>
</html>