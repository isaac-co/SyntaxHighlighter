<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">#!/usr/bin/env python3</span>
<span class="comment"># vim: set fileencoding=utf-8 :</span>
<span class="comment">"""
Created on 2018-03-16 15:14

@author: Lev Velykoivanenko (velykoivanenko.lev@gmail.com)
"""</span>
<span class="keyword">import</span> <span class="identifier">logging</span>
<span class="keyword">import</span> <span class="identifier">os</span>
<span class="keyword">import</span> <span class="identifier">subprocess</span>
<span class="keyword">import</span> <span class="identifier">sys</span>
<span class="keyword">import</span> <span class="identifier">datetime</span>
<span class="keyword">from</span> <span class="identifier">collections</span> <span class="keyword">import</span> <span class="identifier">OrderedDict</span>

<span class="keyword">import</span> <span class="identifier">imageio</span>
<span class="keyword">import</span> <span class="identifier">imageio_ffmpeg</span> <span class="keyword">as</span> <span class="identifier">im_ffm</span>
<span class="keyword">from</span> <span class="identifier">ffmpy</span> <span class="keyword">import</span> <span class="identifier">FFmpeg</span><span class="punctuation">,</span> <span class="identifier">FFRuntimeError</span>

<span class="comment"># faceswap imports</span>
<span class="keyword">from</span> <span class="identifier">lib</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">_image_extensions</span><span class="punctuation">,</span> <span class="identifier">_video_extensions</span>

<span class="identifier">logger</span> <span class="arithmetic-assignment">=</span> <span class="identifier">logging</span><span class="punctuation">.</span><span class="identifier">getLogger</span><span class="grouping">(</span><span class="identifier">__name__</span><span class="grouping">)</span>  <span class="comment"># pylint: disable=invalid-name</span>


<span class="keyword">class</span> <span class="identifier">DataItem</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    A simple class used for storing the media data items and directories that
    Effmpeg uses for 'input', 'output' and 'ref_vid'.
    """</span>
    <span class="identifier">vid_ext</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_video_extensions</span>
    <span class="comment"># future option in effmpeg to use audio file for muxing</span>
    <span class="identifier">audio_ext</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'.aiff', '.flac', '.mp3', '.wav'</span><span class="grouping">]</span>
    <span class="identifier">img_ext</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_image_extensions</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">path</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">item_type</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">ext</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
                 <span class="identifier">fps</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing %s: (path: '%s', name: '%s', item_type: '%s', ext: '%s')"</span><span class="punctuation">,</span>
                     <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">path</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">item_type</span><span class="punctuation">,</span> <span class="identifier">ext</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">path</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">name</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">item_type</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ext</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ext</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fps</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dirname</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">set_type_ext</span><span class="grouping">(</span><span class="identifier">path</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">set_dirname</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">set_name</span><span class="grouping">(</span><span class="identifier">name</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">is_type</span><span class="grouping">(</span><span class="string-literal">"vid"</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">set_fps</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">set_name</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the name """</span>
        <span class="keyword">if</span> <span class="identifier">name</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">basename</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">name</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">basename</span><span class="grouping">(</span><span class="identifier">name</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">name</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">basename</span><span class="grouping">(</span><span class="identifier">name</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">name</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">set_type_ext</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">path</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the extension """</span>
        <span class="keyword">if</span> <span class="identifier">path</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">path</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">item_ext</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">splitext</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">item_ext</span> <span class="relational-operator">in</span> <span class="identifier">DataItem</span><span class="punctuation">.</span><span class="identifier">vid_ext</span><span class="punctuation">:</span>
                <span class="identifier">item_type</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'vid'</span>
            <span class="keyword">elif</span> <span class="identifier">item_ext</span> <span class="relational-operator">in</span> <span class="identifier">DataItem</span><span class="punctuation">.</span><span class="identifier">audio_ext</span><span class="punctuation">:</span>
                <span class="identifier">item_type</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'audio'</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">item_type</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'dir'</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">item_type</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ext</span> <span class="arithmetic-assignment">=</span> <span class="identifier">item_ext</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"path: '%s', type: '%s', ext: '%s'"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">type</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ext</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">return</span>

    <span class="keyword">def</span> <span class="identifier">set_dirname</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">path</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the folder name """</span>
        <span class="keyword">if</span> <span class="identifier">path</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dirname</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">path</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dirname</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">path</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">path</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dirname</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">path</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dirname</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"path: '%s', dirname: '%s'"</span><span class="punctuation">,</span> <span class="identifier">path</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">is_type</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">item_type</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Get the type """</span>
        <span class="keyword">if</span> <span class="identifier">item_type</span> <span class="relational-operator">==</span> <span class="string-literal">"media"</span><span class="punctuation">:</span>
            <span class="identifier">chk_type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">type</span> <span class="relational-operator">in</span> <span class="string-literal">"vid audio"</span>
        <span class="keyword">elif</span> <span class="identifier">item_type</span> <span class="relational-operator">==</span> <span class="string-literal">"dir"</span><span class="punctuation">:</span>
            <span class="identifier">chk_type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">type</span> <span class="relational-operator">==</span> <span class="string-literal">"dir"</span>
        <span class="keyword">elif</span> <span class="identifier">item_type</span> <span class="relational-operator">==</span> <span class="string-literal">"vid"</span><span class="punctuation">:</span>
            <span class="identifier">chk_type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">type</span> <span class="relational-operator">==</span> <span class="string-literal">"vid"</span>
        <span class="keyword">elif</span> <span class="identifier">item_type</span> <span class="relational-operator">==</span> <span class="string-literal">"audio"</span><span class="punctuation">:</span>
            <span class="identifier">chk_type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">type</span> <span class="relational-operator">==</span> <span class="string-literal">"audio"</span>
        <span class="keyword">elif</span> <span class="identifier">item_type</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"none"</span><span class="punctuation">:</span>
            <span class="identifier">chk_type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">type</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">chk_type</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"item_type: '%s', chk_type: '%s'"</span><span class="punctuation">,</span> <span class="identifier">item_type</span><span class="punctuation">,</span> <span class="identifier">chk_type</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">chk_type</span>

    <span class="keyword">def</span> <span class="identifier">set_fps</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set the Frames Per Second """</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">get_fps</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">FFRuntimeError</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">fps</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">Effmpeg</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Class that allows for "easy" ffmpeg use. It provides a nice cli interface
    for common video operations.
    """</span>

    <span class="identifier">_actions_req_fps</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"extract", "gen_vid"</span><span class="grouping">]</span>
    <span class="identifier">_actions_req_ref_video</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"mux_audio"</span><span class="grouping">]</span>
    <span class="identifier">_actions_can_use_ref_video</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"gen_vid"</span><span class="grouping">]</span>
    <span class="identifier">_actions_have_dir_output</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"extract"</span><span class="grouping">]</span>
    <span class="identifier">_actions_have_vid_output</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"gen_vid", "mux_audio", "rescale", "rotate"</span><span class="punctuation">,</span>
                                <span class="string-literal">"slice"</span><span class="grouping">]</span>
    <span class="identifier">_actions_have_print_output</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"get_fps", "get_info"</span><span class="grouping">]</span>
    <span class="identifier">_actions_have_dir_input</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"gen_vid"</span><span class="grouping">]</span>
    <span class="identifier">_actions_have_vid_input</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">"extract", "get_fps", "get_info", "rescale"</span><span class="punctuation">,</span>
                               <span class="string-literal">"rotate", "slice"</span><span class="grouping">]</span>

    <span class="comment"># Class variable that stores the target executable (ffmpeg or ffplay)</span>
    <span class="identifier">_executable</span> <span class="arithmetic-assignment">=</span> <span class="identifier">im_ffm</span><span class="punctuation">.</span><span class="identifier">get_ffmpeg_exe</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="comment"># Class variable that stores the common ffmpeg arguments based on verbosity</span>
    <span class="identifier">__common_ffmpeg_args_dict</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">"normal": "-hide_banner "</span><span class="punctuation">,</span>
                                 <span class="string-literal">"quiet": "-loglevel panic -hide_banner "</span><span class="punctuation">,</span>
                                 <span class="string-literal">"verbose"</span><span class="punctuation">:</span> <span class="string-literal">''</span><span class="grouping">}</span>

    <span class="comment"># _common_ffmpeg_args is the class variable that will get used by various</span>
    <span class="comment"># actions and it will be set by the process_arguments() method based on</span>
    <span class="comment"># passed verbosity</span>
    <span class="identifier">_common_ffmpeg_args</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">''</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">arguments</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initializing %s: (arguments: %s)"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">,</span> <span class="identifier">arguments</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span> <span class="arithmetic-assignment">=</span> <span class="identifier">arguments</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">exe</span> <span class="arithmetic-assignment">=</span> <span class="identifier">im_ffm</span><span class="punctuation">.</span><span class="identifier">get_ffmpeg_exe</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DataItem</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DataItem</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ref_vid</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DataItem</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">start</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">""</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">end</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">""</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">duration</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">""</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">print_</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Initialized %s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">process</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" EFFMPEG Process """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Running Effmpeg"</span><span class="grouping">)</span>
        <span class="comment"># Format action to match the method name</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">'-', '_'</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"action: '%s"</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span><span class="grouping">)</span>

        <span class="comment"># Instantiate input DataItem object</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DataItem</span><span class="grouping">(</span><span class="identifier">path</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">input</span><span class="grouping">)</span>

        <span class="comment"># Instantiate output DataItem object</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_have_dir_output</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DataItem</span><span class="grouping">(</span><span class="identifier">path</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__get_default_output</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_have_vid_output</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__check_have_fps</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">fps</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DataItem</span><span class="grouping">(</span><span class="identifier">path</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__get_default_output</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
                                       <span class="identifier">fps</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">fps</span><span class="grouping">)</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DataItem</span><span class="grouping">(</span><span class="identifier">path</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__get_default_output</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">ref_vid</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="invalid">\</span>
                <span class="logical-operator">or</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">ref_vid</span> <span class="relational-operator">==</span> <span class="string-literal">''</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">ref_vid</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>

        <span class="comment"># Instantiate ref_vid DataItem object</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ref_vid</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DataItem</span><span class="grouping">(</span><span class="identifier">path</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">ref_vid</span><span class="grouping">)</span>

        <span class="comment"># Check that correct input and output arguments were provided</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_have_dir_input</span> <span class="logical-operator">and</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">is_type</span><span class="grouping">(</span><span class="string-literal">"dir"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"The chosen action requires a directory as its "</span>
                             <span class="string-literal">"input, but you entered: "</span>
                             <span class="string-literal">"{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_have_vid_input</span> <span class="logical-operator">and</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">is_type</span><span class="grouping">(</span><span class="string-literal">"vid"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"The chosen action requires a video as its "</span>
                             <span class="string-literal">"input, but you entered: "</span>
                             <span class="string-literal">"{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_have_dir_output</span> <span class="logical-operator">and</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">is_type</span><span class="grouping">(</span><span class="string-literal">"dir"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"The chosen action requires a directory as its "</span>
                             <span class="string-literal">"output, but you entered: "</span>
                             <span class="string-literal">"{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_have_vid_output</span> <span class="logical-operator">and</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">is_type</span><span class="grouping">(</span><span class="string-literal">"vid"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"The chosen action requires a video as its "</span>
                             <span class="string-literal">"output, but you entered: "</span>
                             <span class="string-literal">"{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="comment"># Check that ref_vid is a video when it needs to be</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_req_ref_video</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ref_vid</span><span class="punctuation">.</span><span class="identifier">is_type</span><span class="grouping">(</span><span class="string-literal">"none"</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"The file chosen as the reference video is "</span>
                                 <span class="string-literal">"not a video, either leave the field blank "</span>
                                 <span class="string-literal">"or type 'None': "</span>
                                 <span class="string-literal">"{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ref_vid</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_can_use_ref_video</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ref_vid</span><span class="punctuation">.</span><span class="identifier">is_type</span><span class="grouping">(</span><span class="string-literal">"none"</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">warning</span><span class="grouping">(</span><span class="string-literal">"Warning: no reference video was supplied, even though "</span>
                               <span class="string-literal">"one may be used with the chosen action. If this is "</span>
                               <span class="string-literal">"intentional then ignore this warning."</span><span class="grouping">)</span>

        <span class="comment"># Process start and duration arguments</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">start</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">parse_time</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">start</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">end</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">parse_time</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">end</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__check_equals_time</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">end</span><span class="punctuation">,</span> <span class="string-literal">"00:00:00"</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">duration</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__get_duration</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">start</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">end</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">duration</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">parse_time</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">duration</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="comment"># If fps was left blank in gui, set it to default -1.0 value</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="relational-operator">==</span> <span class="string-literal">''</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">str</span><span class="grouping">(</span><span class="float-literal">-1.0</span><span class="grouping">)</span>

        <span class="comment"># Try to set fps automatically if needed and not supplied by user</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_req_fps</span> <span class="invalid">\</span>
                <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__convert_fps</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">fps</span><span class="grouping">)</span> <span class="relational-operator">&lt;=</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__check_have_fps</span><span class="grouping">(</span><span class="grouping">[</span><span class="string-literal">'r', 'i'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">_error_str</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"No fps, input or reference video was supplied, "</span>
                <span class="identifier">_error_str</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">"hence it's not possible to "</span>
                <span class="identifier">_error_str</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">"'{}'."</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span><span class="grouping">)</span>
                <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="identifier">_error_str</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__check_have_fps</span><span class="grouping">(</span><span class="grouping">[</span><span class="string-literal">'r', 'i'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">fps</span>
            <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ref_vid</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__check_have_fps</span><span class="grouping">(</span><span class="grouping">[</span><span class="string-literal">'i'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ref_vid</span><span class="punctuation">.</span><span class="identifier">fps</span>
            <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__check_have_fps</span><span class="grouping">(</span><span class="grouping">[</span><span class="string-literal">'r'</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">fps</span>

        <span class="comment"># Processing transpose</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">transpose</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">or</span> <span class="invalid">\</span>
                <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">transpose</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"none"</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">transpose</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">transpose</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">transpose</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>

        <span class="comment"># Processing degrees</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">degrees</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="invalid">\</span>
                <span class="logical-operator">or</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">degrees</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"none"</span> <span class="invalid">\</span>
                <span class="logical-operator">or</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">degrees</span> <span class="relational-operator">==</span> <span class="string-literal">''</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">degrees</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">transpose</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="keyword">try</span><span class="punctuation">:</span>
                <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">degrees</span><span class="grouping">)</span>
            <span class="keyword">except</span> <span class="identifier">ValueError</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">error</span><span class="grouping">(</span><span class="string-literal">"You have entered an invalid value for degrees: %s"</span><span class="punctuation">,</span>
                             <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">degrees</span><span class="grouping">)</span>
                <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">exit</span><span class="grouping">(</span><span class="int-literal">1</span><span class="grouping">)</span>

        <span class="comment"># Set verbosity of output</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">__set_verbosity</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">quiet</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">verbose</span><span class="grouping">)</span>

        <span class="comment"># Set self.print_ to True if output needs to be printed to stdout</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_have_print_output</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">print_</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">effmpeg_process</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Finished Effmpeg process"</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">effmpeg_process</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" The effmpeg process """</span>
        <span class="identifier">kwargs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">"input_"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">,</span>
                  <span class="string-literal">"output"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">output</span><span class="punctuation">,</span>
                  <span class="string-literal">"ref_vid"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">ref_vid</span><span class="punctuation">,</span>
                  <span class="string-literal">"fps"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">fps</span><span class="punctuation">,</span>
                  <span class="string-literal">"extract_ext"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">extract_ext</span><span class="punctuation">,</span>
                  <span class="string-literal">"start"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">start</span><span class="punctuation">,</span>
                  <span class="string-literal">"duration"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">duration</span><span class="punctuation">,</span>
                  <span class="string-literal">"mux_audio"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">mux_audio</span><span class="punctuation">,</span>
                  <span class="string-literal">"degrees"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">degrees</span><span class="punctuation">,</span>
                  <span class="string-literal">"transpose"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">transpose</span><span class="punctuation">,</span>
                  <span class="string-literal">"scale"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">scale</span><span class="punctuation">,</span>
                  <span class="string-literal">"print_"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">print_</span><span class="punctuation">,</span>
                  <span class="string-literal">"exe"</span><span class="punctuation">:</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">exe</span><span class="grouping">}</span>
        <span class="identifier">action</span> <span class="arithmetic-assignment">=</span> <span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span><span class="grouping">)</span>
        <span class="identifier">action</span><span class="grouping">(</span><span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">extract</span><span class="grouping">(</span><span class="identifier">input_</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">output</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">fps</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>  <span class="comment"># pylint:disable=unused-argument</span>
                <span class="identifier">extract_ext</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">start</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">duration</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Extract video to image frames """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"input_: %s, output: %s, fps: %s, extract_ext: '%s', start: %s, duration: %s"</span><span class="punctuation">,</span>
                     <span class="identifier">input_</span><span class="punctuation">,</span> <span class="identifier">output</span><span class="punctuation">,</span> <span class="identifier">fps</span><span class="punctuation">,</span> <span class="identifier">extract_ext</span><span class="punctuation">,</span> <span class="identifier">start</span><span class="punctuation">,</span> <span class="identifier">duration</span><span class="grouping">)</span>
        <span class="identifier">_input_opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">_common_ffmpeg_args</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">start</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">duration</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">_input_opts</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'-ss {} -t {}'</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">start</span><span class="punctuation">,</span> <span class="identifier">duration</span><span class="grouping">)</span>
        <span class="identifier">_input</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">input_</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">:</span> <span class="identifier">_input_opts</span><span class="grouping">}</span>
        <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'-y -vf fps="' + str(fps) + '" -q:v 1'</span>
        <span class="identifier">_output_path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">path</span> <span class="arithmetic-operator">+</span> <span class="string-literal">"/" + input_.name + "_%05d"</span> <span class="arithmetic-operator">+</span> <span class="identifier">extract_ext</span>
        <span class="identifier">_output</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">_output_path</span><span class="punctuation">:</span> <span class="identifier">_output_opts</span><span class="grouping">}</span>
        <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">makedirs</span><span class="grouping">(</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">,</span> <span class="identifier">exist_ok</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"_input: %s, _output: %s"</span><span class="punctuation">,</span> <span class="identifier">_input</span><span class="punctuation">,</span> <span class="identifier">_output</span><span class="grouping">)</span>
        <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">__run_ffmpeg</span><span class="grouping">(</span><span class="identifier">inputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_input</span><span class="punctuation">,</span> <span class="identifier">outputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_output</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">gen_vid</span><span class="grouping">(</span><span class="identifier">input_</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">output</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">fps</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>  <span class="comment"># pylint:disable=unused-argument</span>
                <span class="identifier">mux_audio</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">ref_vid</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Generate Video """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"input: %s, output: %s, fps: %s, mux_audio: %s, ref_vid: '%s'exe: '%s'"</span><span class="punctuation">,</span>
                     <span class="identifier">input</span><span class="punctuation">,</span> <span class="identifier">output</span><span class="punctuation">,</span> <span class="identifier">fps</span><span class="punctuation">,</span> <span class="identifier">mux_audio</span><span class="punctuation">,</span> <span class="identifier">ref_vid</span><span class="punctuation">,</span> <span class="identifier">exe</span><span class="grouping">)</span>
        <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">__get_extracted_filename</span><span class="grouping">(</span><span class="identifier">input_</span><span class="punctuation">.</span><span class="identifier">path</span><span class="grouping">)</span>
        <span class="identifier">_input_opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">_common_ffmpeg_args</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">_input_path</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">input_</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
        <span class="identifier">_fps_arg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'-r ' + str(fps) + ' '</span>
        <span class="identifier">_input_opts</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">_fps_arg</span> <span class="arithmetic-operator">+</span> <span class="string-literal">"-f image2 "</span>
        <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'-y ' + _fps_arg + ' -c:v libx264'</span>
        <span class="keyword">if</span> <span class="identifier">mux_audio</span><span class="punctuation">:</span>
            <span class="identifier">_ref_vid_opts</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'-c copy -map 0:0 -map 1:1'</span>
            <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_ref_vid_opts</span> <span class="arithmetic-operator">+</span> <span class="string-literal">' '</span> <span class="arithmetic-operator">+</span> <span class="identifier">_output_opts</span>
            <span class="identifier">_inputs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OrderedDict</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">(</span><span class="identifier">_input_path</span><span class="punctuation">,</span> <span class="identifier">_input_opts</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">ref_vid</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">_inputs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">_input_path</span><span class="punctuation">:</span> <span class="identifier">_input_opts</span><span class="grouping">}</span>
        <span class="identifier">_outputs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">:</span> <span class="identifier">_output_opts</span><span class="grouping">}</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"_inputs: %s, _outputs: %s"</span><span class="punctuation">,</span> <span class="identifier">_inputs</span><span class="punctuation">,</span> <span class="identifier">_outputs</span><span class="grouping">)</span>
        <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">__run_ffmpeg</span><span class="grouping">(</span><span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="identifier">exe</span><span class="punctuation">,</span> <span class="identifier">inputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_inputs</span><span class="punctuation">,</span> <span class="identifier">outputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_outputs</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">get_fps</span><span class="grouping">(</span><span class="identifier">input_</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">print_</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Get Frames per Second """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"input_: %s, print_: %s, kwargs: %s"</span><span class="punctuation">,</span> <span class="identifier">input_</span><span class="punctuation">,</span> <span class="identifier">print_</span><span class="punctuation">,</span> <span class="identifier">kwargs</span><span class="grouping">)</span>
        <span class="identifier">input_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">input_</span> <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">input_</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="identifier">input_</span><span class="punctuation">.</span><span class="identifier">path</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"input: %s"</span><span class="punctuation">,</span> <span class="identifier">input_</span><span class="grouping">)</span>
        <span class="identifier">reader</span> <span class="arithmetic-assignment">=</span> <span class="identifier">imageio</span><span class="punctuation">.</span><span class="identifier">get_reader</span><span class="grouping">(</span><span class="identifier">input_</span><span class="punctuation">,</span> <span class="string-literal">"ffmpeg"</span><span class="grouping">)</span>
        <span class="identifier">_fps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">reader</span><span class="punctuation">.</span><span class="identifier">get_meta_data</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">[</span><span class="string-literal">"fps"</span><span class="grouping">]</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">_fps</span><span class="grouping">)</span>
        <span class="identifier">reader</span><span class="punctuation">.</span><span class="identifier">close</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">print_</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"Video fps: %s"</span><span class="punctuation">,</span> <span class="identifier">_fps</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">_fps</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">get_info</span><span class="grouping">(</span><span class="identifier">input_</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">print_</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Get video Info """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"input_: %s, print_: %s, kwargs: %s"</span><span class="punctuation">,</span> <span class="identifier">input_</span><span class="punctuation">,</span> <span class="identifier">print_</span><span class="punctuation">,</span> <span class="identifier">kwargs</span><span class="grouping">)</span>
        <span class="identifier">input_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">input_</span> <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">input_</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="identifier">input_</span><span class="punctuation">.</span><span class="identifier">path</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"input: %s"</span><span class="punctuation">,</span> <span class="identifier">input_</span><span class="grouping">)</span>
        <span class="identifier">reader</span> <span class="arithmetic-assignment">=</span> <span class="identifier">imageio</span><span class="punctuation">.</span><span class="identifier">get_reader</span><span class="grouping">(</span><span class="identifier">input_</span><span class="punctuation">,</span> <span class="string-literal">"ffmpeg"</span><span class="grouping">)</span>
        <span class="identifier">out</span> <span class="arithmetic-assignment">=</span> <span class="identifier">reader</span><span class="punctuation">.</span><span class="identifier">get_meta_data</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">out</span><span class="grouping">)</span>
        <span class="identifier">reader</span><span class="punctuation">.</span><span class="identifier">close</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">print_</span><span class="punctuation">:</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"======== Video Info ========"</span><span class="punctuation">,</span><span class="grouping">)</span>
            <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"path: %s"</span><span class="punctuation">,</span> <span class="identifier">input_</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">val</span> <span class="relational-operator">in</span> <span class="identifier">out</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">info</span><span class="grouping">(</span><span class="string-literal">"%s: %s"</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="punctuation">,</span> <span class="identifier">val</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">out</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">rescale</span><span class="grouping">(</span><span class="identifier">input_</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">output</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">scale</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>  <span class="comment"># pylint:disable=unused-argument</span>
                <span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Rescale Video """</span>
        <span class="identifier">_input_opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">_common_ffmpeg_args</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'-y -vf scale="' + str(scale) + '"'</span>
        <span class="identifier">_inputs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">input_</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">:</span> <span class="identifier">_input_opts</span><span class="grouping">}</span>
        <span class="identifier">_outputs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">:</span> <span class="identifier">_output_opts</span><span class="grouping">}</span>
        <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">__run_ffmpeg</span><span class="grouping">(</span><span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="identifier">exe</span><span class="punctuation">,</span> <span class="identifier">inputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_inputs</span><span class="punctuation">,</span> <span class="identifier">outputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_outputs</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">rotate</span><span class="grouping">(</span><span class="identifier">input_</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">output</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">degrees</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>  <span class="comment"># pylint:disable=unused-argument</span>
               <span class="identifier">transpose</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Rotate Video """</span>
        <span class="keyword">if</span> <span class="identifier">transpose</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="logical-operator">and</span> <span class="identifier">degrees</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"You have not supplied a valid transpose or "</span>
                             <span class="string-literal">"degrees value:\ntranspose: {}\ndegrees: "</span>
                             <span class="string-literal">"{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">transpose</span><span class="punctuation">,</span> <span class="identifier">degrees</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="identifier">_input_opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">_common_ffmpeg_args</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'-y -c:a copy -vf '</span>
        <span class="identifier">_bilinear</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">''</span>
        <span class="keyword">if</span> <span class="identifier">transpose</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'transpose="' + str(transpose) + '"'</span>
        <span class="keyword">elif</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">degrees</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="int-literal">0</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">degrees</span><span class="grouping">)</span> <span class="arithmetic-operator">%</span> <span class="int-literal">90</span> <span class="relational-operator">==</span> <span class="int-literal">0</span> <span class="logical-operator">and</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">degrees</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="int-literal">0</span><span class="punctuation">:</span>
                <span class="identifier">_bilinear</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">":bilinear=0"</span>
            <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">'rotate="' + str(degrees) + '*(PI/180)'</span>
            <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">_bilinear</span> <span class="arithmetic-operator">+</span> <span class="string-literal">'" '</span>

        <span class="identifier">_inputs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">input_</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">:</span> <span class="identifier">_input_opts</span><span class="grouping">}</span>
        <span class="identifier">_outputs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">:</span> <span class="identifier">_output_opts</span><span class="grouping">}</span>
        <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">__run_ffmpeg</span><span class="grouping">(</span><span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="identifier">exe</span><span class="punctuation">,</span> <span class="identifier">inputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_inputs</span><span class="punctuation">,</span> <span class="identifier">outputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_outputs</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">mux_audio</span><span class="grouping">(</span><span class="identifier">input_</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">output</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">ref_vid</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>  <span class="comment"># pylint:disable=unused-argument</span>
                  <span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Mux Audio """</span>
        <span class="identifier">_input_opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">_common_ffmpeg_args</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">_ref_vid_opts</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
        <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'-y -c copy -map 0:0 -map 1:1 -shortest'</span>
        <span class="identifier">_inputs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OrderedDict</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">(</span><span class="identifier">input_</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">,</span> <span class="identifier">_input_opts</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">ref_vid</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">,</span> <span class="identifier">_ref_vid_opts</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">_outputs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">:</span> <span class="identifier">_output_opts</span><span class="grouping">}</span>
        <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">__run_ffmpeg</span><span class="grouping">(</span><span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="identifier">exe</span><span class="punctuation">,</span> <span class="identifier">inputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_inputs</span><span class="punctuation">,</span> <span class="identifier">outputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_outputs</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">slice</span><span class="grouping">(</span><span class="identifier">input_</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">output</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">start</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>  <span class="comment"># pylint:disable=unused-argument</span>
              <span class="identifier">duration</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">kwargs</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Slice Video """</span>
        <span class="identifier">_input_opts</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">_common_ffmpeg_args</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">_input_opts</span> <span class="arithmetic-assignment">+=</span> <span class="string-literal">"-ss "</span> <span class="arithmetic-operator">+</span> <span class="identifier">start</span>
        <span class="identifier">_output_opts</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"-t " + duration + " "</span>
        <span class="identifier">_inputs</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">input_</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">:</span> <span class="identifier">_input_opts</span><span class="grouping">}</span>
        <span class="identifier">_output</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">output</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">:</span> <span class="identifier">_output_opts</span><span class="grouping">}</span>
        <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">__run_ffmpeg</span><span class="grouping">(</span><span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="identifier">exe</span><span class="punctuation">,</span> <span class="identifier">inputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_inputs</span><span class="punctuation">,</span> <span class="identifier">outputs</span><span class="arithmetic-assignment">=</span><span class="identifier">_output</span><span class="grouping">)</span>

    <span class="comment"># Various helper methods</span>
    <span class="punctuation">@</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">o</span><span class="invalid">d</span>
    <span class="keyword">def</span> <span class="identifier">__set_verbosity</span><span class="grouping">(</span><span class="identifier">cls</span><span class="punctuation">,</span> <span class="identifier">quiet</span><span class="punctuation">,</span> <span class="identifier">verbose</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">verbose</span><span class="punctuation">:</span>
            <span class="identifier">cls</span><span class="punctuation">.</span><span class="identifier">_common_ffmpeg_args</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cls</span><span class="punctuation">.</span><span class="identifier">__common_ffmpeg_args_dict</span><span class="grouping">[</span><span class="string-literal">"verbose"</span><span class="grouping">]</span>
        <span class="keyword">elif</span> <span class="identifier">quiet</span><span class="punctuation">:</span>
            <span class="identifier">cls</span><span class="punctuation">.</span><span class="identifier">_common_ffmpeg_args</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cls</span><span class="punctuation">.</span><span class="identifier">__common_ffmpeg_args_dict</span><span class="grouping">[</span><span class="string-literal">"quiet"</span><span class="grouping">]</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">cls</span><span class="punctuation">.</span><span class="identifier">_common_ffmpeg_args</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cls</span><span class="punctuation">.</span><span class="identifier">__common_ffmpeg_args_dict</span><span class="grouping">[</span><span class="string-literal">"normal"</span><span class="grouping">]</span>

    <span class="keyword">def</span> <span class="identifier">__get_default_output</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Set output to the same directory as input
            if the user didn't specify it. """</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">output</span> <span class="relational-operator">==</span> <span class="string-literal">""</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_have_dir_output</span><span class="punctuation">:</span>
                <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="punctuation">,</span> <span class="string-literal">'out'</span><span class="grouping">)</span>
            <span class="keyword">elif</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">action</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_actions_have_vid_output</span><span class="punctuation">:</span>
                <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">is_type</span><span class="grouping">(</span><span class="string-literal">"media"</span><span class="grouping">)</span><span class="punctuation">:</span>
                    <span class="comment"># Using the same extension as input leads to very poor</span>
                    <span class="comment"># output quality, hence the default is mkv for now</span>
                    <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="punctuation">,</span> <span class="string-literal">"out.mkv"</span><span class="grouping">)</span>  <span class="comment"># + self.input.ext)</span>
                <span class="keyword">else</span><span class="punctuation">:</span>  <span class="comment"># case if input was a directory</span>
                    <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">input</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="punctuation">,</span> <span class="string-literal">'out.mkv'</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">output</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="keyword">def</span> <span class="identifier">__check_have_fps</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">items</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">items_to_check</span> <span class="arithmetic-assignment">=</span> <span class="identifier">list</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">items</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">i</span> <span class="relational-operator">==</span> <span class="string-literal">'r'</span><span class="punctuation">:</span>
                <span class="identifier">items_to_check</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">'ref_vid'</span><span class="grouping">)</span>
            <span class="keyword">elif</span> <span class="identifier">i</span> <span class="relational-operator">==</span> <span class="string-literal">'i'</span><span class="punctuation">:</span>
                <span class="identifier">items_to_check</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">'input'</span><span class="grouping">)</span>
            <span class="keyword">elif</span> <span class="identifier">i</span> <span class="relational-operator">==</span> <span class="string-literal">'o'</span><span class="punctuation">:</span>
                <span class="identifier">items_to_check</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">'output'</span><span class="grouping">)</span>

        <span class="keyword">return</span> <span class="identifier">all</span><span class="grouping">(</span><span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">i</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fps</span> <span class="relational-operator">is</span> <span class="none-literal">None</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">items_to_check</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">__run_ffmpeg</span><span class="grouping">(</span><span class="identifier">exe</span><span class="arithmetic-assignment">=</span><span class="identifier">im_ffm</span><span class="punctuation">.</span><span class="identifier">get_ffmpeg_exe</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">inputs</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">outputs</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Run ffmpeg """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"Running ffmpeg: (exe: '%s', inputs: %s, outputs: %s"</span><span class="punctuation">,</span> <span class="identifier">exe</span><span class="punctuation">,</span> <span class="identifier">inputs</span><span class="punctuation">,</span> <span class="identifier">outputs</span><span class="grouping">)</span>
        <span class="identifier">ffm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">FFmpeg</span><span class="grouping">(</span><span class="identifier">executable</span><span class="arithmetic-assignment">=</span><span class="identifier">exe</span><span class="punctuation">,</span> <span class="identifier">inputs</span><span class="arithmetic-assignment">=</span><span class="identifier">inputs</span><span class="punctuation">,</span> <span class="identifier">outputs</span><span class="arithmetic-assignment">=</span><span class="identifier">outputs</span><span class="grouping">)</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="identifier">ffm</span><span class="punctuation">.</span><span class="identifier">run</span><span class="grouping">(</span><span class="identifier">stderr</span><span class="arithmetic-assignment">=</span><span class="identifier">subprocess</span><span class="punctuation">.</span><span class="identifier">STDOUT</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">FFRuntimeError</span> <span class="keyword">as</span> <span class="identifier">ffe</span><span class="punctuation">:</span>
            <span class="comment"># After receiving SIGINT ffmpeg has a 255 exit code</span>
            <span class="keyword">if</span> <span class="identifier">ffe</span><span class="punctuation">.</span><span class="identifier">exit_code</span> <span class="relational-operator">==</span> <span class="int-literal">255</span><span class="punctuation">:</span>
                <span class="keyword">pass</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"An unexpected FFRuntimeError occurred: "</span>
                                 <span class="string-literal">"{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">ffe</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">KeyboardInterrupt</span><span class="punctuation">:</span>
            <span class="keyword">pass</span>  <span class="comment"># Do nothing if voluntary interruption</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"ffmpeg finished"</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">__convert_fps</span><span class="grouping">(</span><span class="identifier">fps</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Convert to Frames per Second """</span>
        <span class="keyword">if</span> <span class="string-literal">'/'</span> <span class="relational-operator">in</span> <span class="identifier">fps</span><span class="punctuation">:</span>
            <span class="identifier">_fps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fps</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">'/'</span><span class="grouping">)</span>
            <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">float</span><span class="grouping">(</span><span class="identifier">_fps</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">float</span><span class="grouping">(</span><span class="identifier">_fps</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">float</span><span class="grouping">(</span><span class="identifier">fps</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">__get_duration</span><span class="grouping">(</span><span class="identifier">start_time</span><span class="punctuation">,</span> <span class="identifier">end_time</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Get the duration """</span>
        <span class="identifier">start</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">i</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">start_time</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">':'</span><span class="grouping">)</span><span class="grouping">]</span>
        <span class="identifier">end</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">i</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">end_time</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">':'</span><span class="grouping">)</span><span class="grouping">]</span>
        <span class="identifier">start</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datetime</span><span class="punctuation">.</span><span class="identifier">timedelta</span><span class="grouping">(</span><span class="identifier">hours</span><span class="arithmetic-assignment">=</span><span class="identifier">start</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">minutes</span><span class="arithmetic-assignment">=</span><span class="identifier">start</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">seconds</span><span class="arithmetic-assignment">=</span><span class="identifier">start</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">end</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datetime</span><span class="punctuation">.</span><span class="identifier">timedelta</span><span class="grouping">(</span><span class="identifier">hours</span><span class="arithmetic-assignment">=</span><span class="identifier">end</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">minutes</span><span class="arithmetic-assignment">=</span><span class="identifier">end</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">seconds</span><span class="arithmetic-assignment">=</span><span class="identifier">end</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span> <span class="arithmetic-assignment">=</span> <span class="identifier">end</span> <span class="arithmetic-operator">-</span> <span class="identifier">start</span>
        <span class="identifier">secs</span> <span class="arithmetic-assignment">=</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="punctuation">.</span><span class="identifier">total_seconds</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'{:02}:{:02}:{:02}'</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">secs</span> <span class="arithmetic-operator">//</span> <span class="int-literal">3600</span><span class="grouping">)</span><span class="punctuation">,</span>
                                            <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">secs</span> <span class="arithmetic-operator">%</span> <span class="int-literal">3600</span> <span class="arithmetic-operator">//</span> <span class="int-literal">60</span><span class="grouping">)</span><span class="punctuation">,</span>
                                            <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">secs</span> <span class="arithmetic-operator">%</span> <span class="int-literal">60</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">__get_extracted_filename</span><span class="grouping">(</span><span class="identifier">path</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Get the extracted filename """</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"path: '%s'"</span><span class="punctuation">,</span> <span class="identifier">path</span><span class="grouping">)</span>
        <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">''</span>
        <span class="keyword">for</span> <span class="identifier">file</span> <span class="relational-operator">in</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">listdir</span><span class="grouping">(</span><span class="identifier">path</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">any</span><span class="grouping">(</span><span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">file</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">DataItem</span><span class="punctuation">.</span><span class="identifier">img_ext</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">filename</span> <span class="arithmetic-assignment">=</span> <span class="identifier">file</span>
                <span class="keyword">break</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"sample filename: '%s'"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="grouping">)</span>
        <span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">img_ext</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">splitext</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span>
        <span class="identifier">zero_pad</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Effmpeg</span><span class="punctuation">.</span><span class="identifier">__get_zero_pad</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span>
        <span class="identifier">name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">filename</span><span class="grouping">[</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="identifier">zero_pad</span><span class="grouping">]</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"{}%{}d{}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">zero_pad</span><span class="punctuation">,</span> <span class="identifier">img_ext</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"filename: %s, img_ext: '%s', zero_pad: %s, name: '%s'"</span><span class="punctuation">,</span>
                     <span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">img_ext</span><span class="punctuation">,</span> <span class="identifier">zero_pad</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">__get_zero_pad</span><span class="grouping">(</span><span class="identifier">filename</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Return the starting position of zero padding from a filename """</span>
        <span class="identifier">chkstring</span> <span class="arithmetic-assignment">=</span> <span class="identifier">filename</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">trace</span><span class="grouping">(</span><span class="string-literal">"filename: %s, chkstring: %s"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">chkstring</span><span class="grouping">)</span>
        <span class="identifier">pos</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
        <span class="keyword">for</span> <span class="identifier">pos</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">chkstring</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">chkstring</span><span class="grouping">[</span><span class="identifier">pos</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">isdigit</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">break</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"filename: '%s', pos: %s"</span><span class="punctuation">,</span> <span class="identifier">filename</span><span class="punctuation">,</span> <span class="identifier">pos</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">pos</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">__check_is_valid_time</span><span class="grouping">(</span><span class="identifier">value</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Check valid time """</span>
        <span class="identifier">val</span> <span class="arithmetic-assignment">=</span> <span class="identifier">value</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">':', ''</span><span class="grouping">)</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">val</span><span class="punctuation">.</span><span class="identifier">isdigit</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"value: '%s', retval: %s"</span><span class="punctuation">,</span> <span class="identifier">value</span><span class="punctuation">,</span> <span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">__check_equals_time</span><span class="grouping">(</span><span class="identifier">value</span><span class="punctuation">,</span> <span class="identifier">time</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Check equals time """</span>
        <span class="identifier">val</span> <span class="arithmetic-assignment">=</span> <span class="identifier">value</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">':', ''</span><span class="grouping">)</span>
        <span class="identifier">tme</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">':', ''</span><span class="grouping">)</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">val</span><span class="punctuation">.</span><span class="identifier">zfill</span><span class="grouping">(</span><span class="int-literal">6</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">tme</span><span class="punctuation">.</span><span class="identifier">zfill</span><span class="grouping">(</span><span class="int-literal">6</span><span class="grouping">)</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"value: '%s', time: %s, retval: %s"</span><span class="punctuation">,</span> <span class="identifier">value</span><span class="punctuation">,</span> <span class="identifier">time</span><span class="punctuation">,</span> <span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    <span class="punctuation">@</span><span class="identifier">staticmethod</span>
    <span class="keyword">def</span> <span class="identifier">parse_time</span><span class="grouping">(</span><span class="identifier">txt</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">""" Parse Time """</span>
        <span class="identifier">clean_txt</span> <span class="arithmetic-assignment">=</span> <span class="identifier">txt</span><span class="punctuation">.</span><span class="identifier">replace</span><span class="grouping">(</span><span class="string-literal">':', ''</span><span class="grouping">)</span>
        <span class="identifier">hours</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clean_txt</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">:</span><span class="int-literal">2</span><span class="grouping">]</span>
        <span class="identifier">minutes</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clean_txt</span><span class="grouping">[</span><span class="int-literal">2</span><span class="punctuation">:</span><span class="int-literal">4</span><span class="grouping">]</span>
        <span class="identifier">seconds</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clean_txt</span><span class="grouping">[</span><span class="int-literal">4</span><span class="punctuation">:</span><span class="int-literal">6</span><span class="grouping">]</span>
        <span class="identifier">retval</span> <span class="arithmetic-assignment">=</span> <span class="identifier">hours</span> <span class="arithmetic-operator">+</span> <span class="string-literal">':' + minutes + ':'</span> <span class="arithmetic-operator">+</span> <span class="identifier">seconds</span>
        <span class="identifier">logger</span><span class="punctuation">.</span><span class="identifier">debug</span><span class="grouping">(</span><span class="string-literal">"txt: '%s', retval: %s"</span><span class="punctuation">,</span> <span class="identifier">txt</span><span class="punctuation">,</span> <span class="identifier">retval</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">retval</span>

    </pre>
  </body>
</html>