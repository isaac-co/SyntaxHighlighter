<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment"># Authors: Alexandre Gramfort &lt;alexandre.gramfort@inria.fr&gt;</span>
<span class="comment">#          Raghav RV &lt;rvraghav93@gmail.com&gt;</span>
<span class="comment"># License: BSD 3 clause</span>

<span class="keyword">import</span> <span class="identifier">inspect</span>
<span class="keyword">import</span> <span class="identifier">warnings</span>
<span class="keyword">import</span> <span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">b</span>

<span class="keyword">from</span> <span class="identifier">pkgutil</span> <span class="keyword">import</span> <span class="identifier">walk_packages</span>
<span class="keyword">from</span> <span class="identifier">inspect</span> <span class="keyword">import</span> <span class="identifier">signature</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>

<span class="keyword">import</span> <span class="identifier">sklearn</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">IS_PYPY</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="identifier">check_docstring_parameters</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="identifier">_get_func_name</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="identifier">ignore_warnings</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">all_estimators</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">estimator_checks</span> <span class="keyword">import</span> <span class="identifier">_enforce_estimator_tags_y</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">estimator_checks</span> <span class="keyword">import</span> <span class="identifier">_enforce_estimator_tags_x</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">estimator_checks</span> <span class="keyword">import</span> <span class="identifier">_construct_instance</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">deprecation</span> <span class="keyword">import</span> <span class="identifier">_is_deprecated</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">externals</span><span class="punctuation">.</span><span class="identifier">_pep562</span> <span class="keyword">import</span> <span class="identifier">Pep562</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">make_classification</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">LogisticRegression</span>

<span class="keyword">import</span> <span class="identifier">pytest</span>


<span class="comment"># walk_packages() ignores DeprecationWarnings, now we need to ignore</span>
<span class="comment"># FutureWarnings</span>
<span class="keyword">with</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">catch_warnings</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">simplefilter</span><span class="grouping">(</span><span class="string-literal">'ignore'</span><span class="punctuation">,</span> <span class="identifier">FutureWarning</span><span class="grouping">)</span>
    <span class="identifier">PUBLIC_MODULES</span> <span class="arithmetic-assignment">=</span> <span class="identifier">set</span><span class="grouping">(</span><span class="grouping">[</span>
        <span class="identifier">pckg</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">pckg</span> <span class="relational-operator">in</span> <span class="identifier">walk_packages</span><span class="grouping">(</span>
            <span class="identifier">prefix</span><span class="arithmetic-assignment">=</span><span class="string-literal">'sklearn.'</span><span class="punctuation">,</span>
            <span class="comment"># mypy error: Module has no attribute "__path__"</span>
            <span class="identifier">path</span><span class="arithmetic-assignment">=</span><span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">__path__</span><span class="grouping">)</span>  <span class="comment"># type: ignore  # mypy issue #1422</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="grouping">(</span><span class="string-literal">"._" in pckg[1] or ".tests."</span> <span class="relational-operator">in</span> <span class="identifier">pckg</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="grouping">]</span><span class="grouping">)</span>

<span class="comment"># functions to ignore args / docstring of</span>
<span class="identifier">_DOCSTRING_IGNORES</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
    <span class="string-literal">'sklearn.utils.deprecation.load_mlcomp'</span><span class="punctuation">,</span>
    <span class="string-literal">'sklearn.pipeline.make_pipeline'</span><span class="punctuation">,</span>
    <span class="string-literal">'sklearn.pipeline.make_union'</span><span class="punctuation">,</span>
    <span class="string-literal">'sklearn.utils.extmath.safe_sparse_dot'</span><span class="punctuation">,</span>
    <span class="string-literal">'sklearn.utils._joblib'</span>
<span class="grouping">]</span>

<span class="comment"># Methods where y param should be ignored if y=None by default</span>
<span class="identifier">_METHODS_IGNORE_NONE_Y</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
    <span class="string-literal">'fit'</span><span class="punctuation">,</span>
    <span class="string-literal">'score'</span><span class="punctuation">,</span>
    <span class="string-literal">'fit_predict'</span><span class="punctuation">,</span>
    <span class="string-literal">'fit_transform'</span><span class="punctuation">,</span>
    <span class="string-literal">'partial_fit'</span><span class="punctuation">,</span>
    <span class="string-literal">'predict'</span>
<span class="grouping">]</span>


<span class="comment"># numpydoc 0.8.0's docscrape tool raises because of collections.abc under</span>
<span class="comment"># Python 3.7</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">'ignore::FutureWarning'</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">filterwarnings</span><span class="grouping">(</span><span class="string-literal">'ignore::DeprecationWarning'</span><span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">skipif</span><span class="grouping">(</span><span class="identifier">IS_PYPY</span><span class="punctuation">,</span> <span class="identifier">reason</span><span class="arithmetic-assignment">=</span><span class="string-literal">'test segfaults on PyPy'</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_docstring_parameters</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Test module docstring formatting</span>

    <span class="comment"># Skip test if numpydoc is not found</span>
    <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">i</span><span class="invalid">p</span><span class="grouping">(</span><span class="string-literal">'numpydoc'</span><span class="punctuation">,</span>
                        <span class="identifier">reason</span><span class="arithmetic-assignment">=</span><span class="string-literal">"numpydoc is required to test the docstrings"</span><span class="grouping">)</span>

    <span class="comment"># XXX unreached code as of v0.22</span>
    <span class="keyword">from</span> <span class="identifier">numpydoc</span> <span class="keyword">import</span> <span class="identifier">docscrape</span>

    <span class="identifier">incorrect</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="keyword">for</span> <span class="identifier">name</span> <span class="relational-operator">in</span> <span class="identifier">PUBLIC_MODULES</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">name</span> <span class="relational-operator">==</span> <span class="string-literal">'sklearn.utils.fixes'</span><span class="punctuation">:</span>
            <span class="comment"># We cannot always control these docstrings</span>
            <span class="keyword">continue</span>
        <span class="keyword">with</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">catch_warnings</span><span class="grouping">(</span><span class="identifier">record</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">module</span> <span class="arithmetic-assignment">=</span> <span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">b</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">o</span><span class="invalid">d</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">name</span><span class="grouping">)</span>
        <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">getmembers</span><span class="grouping">(</span><span class="identifier">module</span><span class="punctuation">,</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">isclass</span><span class="grouping">)</span>
        <span class="comment"># Exclude non-scikit-learn classes</span>
        <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">cls</span> <span class="keyword">for</span> <span class="identifier">cls</span> <span class="relational-operator">in</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span>
                   <span class="keyword">if</span> <span class="identifier">cls</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">__module__</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">'sklearn'</span><span class="grouping">)</span><span class="grouping">]</span>
        <span class="keyword">for</span> <span class="identifier">cname</span><span class="punctuation">,</span> <span class="identifier">cls</span> <span class="relational-operator">in</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="punctuation">:</span>
            <span class="identifier">this_incorrect</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
            <span class="keyword">if</span> <span class="identifier">cname</span> <span class="relational-operator">in</span> <span class="identifier">_DOCSTRING_IGNORES</span> <span class="logical-operator">or</span> <span class="identifier">cname</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">'_'</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="keyword">if</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">isabstract</span><span class="grouping">(</span><span class="identifier">cls</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="keyword">with</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">catch_warnings</span><span class="grouping">(</span><span class="identifier">record</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">w</span><span class="punctuation">:</span>
                <span class="identifier">cdoc</span> <span class="arithmetic-assignment">=</span> <span class="identifier">docscrape</span><span class="punctuation">.</span><span class="invalid">C</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">D</span><span class="invalid">o</span><span class="invalid">c</span><span class="grouping">(</span><span class="identifier">cls</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">w</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">raise</span> <span class="identifier">RuntimeError</span><span class="grouping">(</span><span class="string-literal">'Error for __init__ of %s in %s:\n%s'</span>
                                   <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">cls</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">w</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span>

            <span class="identifier">cls_init</span> <span class="arithmetic-assignment">=</span> <span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">cls</span><span class="punctuation">,</span> <span class="string-literal">'__init__'</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span>

            <span class="keyword">if</span> <span class="identifier">_is_deprecated</span><span class="grouping">(</span><span class="identifier">cls_init</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="keyword">elif</span> <span class="identifier">cls_init</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
                <span class="identifier">this_incorrect</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span>
                    <span class="identifier">cls</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="punctuation">,</span> <span class="identifier">cdoc</span><span class="grouping">)</span>

            <span class="keyword">for</span> <span class="identifier">method_name</span> <span class="relational-operator">in</span> <span class="identifier">cdoc</span><span class="punctuation">.</span><span class="identifier">methods</span><span class="punctuation">:</span>
                <span class="identifier">method</span> <span class="arithmetic-assignment">=</span> <span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">cls</span><span class="punctuation">,</span> <span class="identifier">method_name</span><span class="grouping">)</span>
                <span class="keyword">if</span> <span class="identifier">_is_deprecated</span><span class="grouping">(</span><span class="identifier">method</span><span class="grouping">)</span><span class="punctuation">:</span>
                    <span class="keyword">continue</span>
                <span class="identifier">param_ignore</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
                <span class="comment"># Now skip docstring test for y when y is None</span>
                <span class="comment"># by default for API reason</span>
                <span class="keyword">if</span> <span class="identifier">method_name</span> <span class="relational-operator">in</span> <span class="identifier">_METHODS_IGNORE_NONE_Y</span><span class="punctuation">:</span>
                    <span class="identifier">sig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">signature</span><span class="grouping">(</span><span class="identifier">method</span><span class="grouping">)</span>
                    <span class="keyword">if</span> <span class="grouping">(</span><span class="string-literal">'y'</span> <span class="relational-operator">in</span> <span class="identifier">sig</span><span class="punctuation">.</span><span class="identifier">parameters</span> <span class="logical-operator">and</span>
                            <span class="identifier">sig</span><span class="punctuation">.</span><span class="identifier">parameters</span><span class="grouping">[</span><span class="string-literal">'y'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
                        <span class="identifier">param_ignore</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'y'</span><span class="grouping">]</span>  <span class="comment"># ignore y for fit and score</span>
                <span class="identifier">result</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span>
                    <span class="identifier">method</span><span class="punctuation">,</span> <span class="identifier">ignore</span><span class="arithmetic-assignment">=</span><span class="identifier">param_ignore</span><span class="grouping">)</span>
                <span class="identifier">this_incorrect</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">result</span>

            <span class="identifier">incorrect</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">this_incorrect</span>

        <span class="identifier">functions</span> <span class="arithmetic-assignment">=</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">getmembers</span><span class="grouping">(</span><span class="identifier">module</span><span class="punctuation">,</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">isfunction</span><span class="grouping">)</span>
        <span class="comment"># Exclude imported functions</span>
        <span class="identifier">functions</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">fn</span> <span class="keyword">for</span> <span class="identifier">fn</span> <span class="relational-operator">in</span> <span class="identifier">functions</span> <span class="keyword">if</span> <span class="identifier">fn</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">__module__</span> <span class="relational-operator">==</span> <span class="identifier">name</span><span class="grouping">]</span>
        <span class="keyword">for</span> <span class="identifier">fname</span><span class="punctuation">,</span> <span class="identifier">func</span> <span class="relational-operator">in</span> <span class="identifier">functions</span><span class="punctuation">:</span>
            <span class="comment"># Don't test private methods / functions</span>
            <span class="keyword">if</span> <span class="identifier">fname</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">'_'</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="keyword">if</span> <span class="identifier">fname</span> <span class="relational-operator">==</span> <span class="string-literal">"configuration" and name.endswith("setup"</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="identifier">name_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_get_func_name</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="grouping">(</span><span class="logical-operator">not</span> <span class="identifier">any</span><span class="grouping">(</span><span class="identifier">d</span> <span class="relational-operator">in</span> <span class="identifier">name_</span> <span class="keyword">for</span> <span class="identifier">d</span> <span class="relational-operator">in</span> <span class="identifier">_DOCSTRING_IGNORES</span><span class="grouping">)</span> <span class="logical-operator">and</span>
                    <span class="logical-operator">not</span> <span class="identifier">_is_deprecated</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">incorrect</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span><span class="identifier">func</span><span class="grouping">)</span>

    <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'\n'</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">incorrect</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">incorrect</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"Docstring Error:\n"</span> <span class="arithmetic-operator">+</span> <span class="identifier">msg</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">FutureWarning</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_tabs</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Test that there are no tabs in our source files</span>
    <span class="keyword">for</span> <span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">modname</span><span class="punctuation">,</span> <span class="identifier">ispkg</span> <span class="relational-operator">in</span> <span class="identifier">walk_packages</span><span class="grouping">(</span><span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">__path__</span><span class="punctuation">,</span>
                                                  <span class="identifier">prefix</span><span class="arithmetic-assignment">=</span><span class="string-literal">'sklearn.'</span><span class="grouping">)</span><span class="punctuation">:</span>

        <span class="keyword">if</span> <span class="identifier">IS_PYPY</span> <span class="logical-operator">and</span> <span class="grouping">(</span><span class="string-literal">'_svmlight_format_io'</span> <span class="relational-operator">in</span> <span class="identifier">modname</span> <span class="logical-operator">or</span>
                        <span class="string-literal">'feature_extraction._hashing_fast'</span> <span class="relational-operator">in</span> <span class="identifier">modname</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">continue</span>

        <span class="comment"># because we don't import</span>
        <span class="identifier">mod</span> <span class="arithmetic-assignment">=</span> <span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">b</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">o</span><span class="invalid">d</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">modname</span><span class="grouping">)</span>

        <span class="comment"># TODO: Remove when minimum python version is 3.7</span>
        <span class="comment"># unwrap to get module because Pep562 backport wraps the original</span>
        <span class="comment"># module</span>
        <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">mod</span><span class="punctuation">,</span> <span class="identifier">Pep562</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">mod</span> <span class="arithmetic-assignment">=</span> <span class="identifier">mod</span><span class="punctuation">.</span><span class="identifier">_module</span>

        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="identifier">source</span> <span class="arithmetic-assignment">=</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">getsource</span><span class="grouping">(</span><span class="identifier">mod</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">IOError</span><span class="punctuation">:</span>  <span class="comment"># user probably should have run "make clean"</span>
            <span class="keyword">continue</span>
        <span class="keyword">assert</span> <span class="string-literal">'\t' not in source, ('"%s" has tabs, please remove them '</span><span class="punctuation">,</span>
                                    <span class="string-literal">'or add it to the ignore list'</span>
                                    <span class="arithmetic-operator">%</span> <span class="identifier">modname</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_construct_searchcv_instance</span><span class="grouping">(</span><span class="identifier">SearchCV</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">return</span> <span class="identifier">SearchCV</span><span class="grouping">(</span><span class="identifier">LogisticRegression</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">{</span><span class="string-literal">"C"</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">}</span><span class="grouping">)</span>


<span class="identifier">N_FEATURES_MODULES_TO_IGNORE</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span>
    <span class="string-literal">'cluster'</span><span class="punctuation">,</span>
    <span class="string-literal">'compose'</span><span class="punctuation">,</span>
    <span class="string-literal">'covariance'</span><span class="punctuation">,</span>
    <span class="string-literal">'decomposition'</span><span class="punctuation">,</span>
    <span class="string-literal">'discriminant_analysis'</span><span class="punctuation">,</span>
    <span class="string-literal">'dummy'</span><span class="punctuation">,</span>
    <span class="string-literal">'ensemble'</span><span class="punctuation">,</span>
    <span class="string-literal">'feature_selection'</span><span class="punctuation">,</span>
    <span class="string-literal">'gaussian_process'</span><span class="punctuation">,</span>
    <span class="string-literal">'impute'</span><span class="punctuation">,</span>
    <span class="string-literal">'isotonic'</span><span class="punctuation">,</span>
    <span class="string-literal">'kernel_approximation'</span><span class="punctuation">,</span>
    <span class="string-literal">'kernel_ridge'</span><span class="punctuation">,</span>
    <span class="string-literal">'linear_model'</span><span class="punctuation">,</span>
    <span class="string-literal">'manifold'</span><span class="punctuation">,</span>
    <span class="string-literal">'model_selection'</span><span class="punctuation">,</span>
    <span class="string-literal">'multiclass'</span><span class="punctuation">,</span>
    <span class="string-literal">'multioutput'</span><span class="punctuation">,</span>
    <span class="string-literal">'naive_bayes'</span><span class="punctuation">,</span>
    <span class="string-literal">'neighbors'</span><span class="punctuation">,</span>
    <span class="string-literal">'neural_network'</span><span class="punctuation">,</span>
    <span class="string-literal">'pipeline'</span><span class="punctuation">,</span>
    <span class="string-literal">'preprocessing'</span><span class="punctuation">,</span>
    <span class="string-literal">'random_projection'</span><span class="punctuation">,</span>
    <span class="string-literal">'semi_supervised'</span><span class="punctuation">,</span>
    <span class="string-literal">'svm'</span><span class="punctuation">,</span>
    <span class="string-literal">'tree'</span>
<span class="grouping">}</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">'name, Estimator'</span><span class="punctuation">,</span>
                         <span class="identifier">all_estimators</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_fit_docstring_attributes</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">Estimator</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">i</span><span class="invalid">p</span><span class="grouping">(</span><span class="string-literal">'numpydoc'</span><span class="grouping">)</span>
    <span class="keyword">from</span> <span class="identifier">numpydoc</span> <span class="keyword">import</span> <span class="identifier">docscrape</span>

    <span class="identifier">doc</span> <span class="arithmetic-assignment">=</span> <span class="identifier">docscrape</span><span class="punctuation">.</span><span class="invalid">C</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">D</span><span class="invalid">o</span><span class="invalid">c</span><span class="grouping">(</span><span class="identifier">Estimator</span><span class="grouping">)</span>
    <span class="identifier">attributes</span> <span class="arithmetic-assignment">=</span> <span class="identifier">doc</span><span class="grouping">[</span><span class="string-literal">'Attributes'</span><span class="grouping">]</span>

    <span class="identifier">IGNORED</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'ClassifierChain', 'ColumnTransformer'</span><span class="punctuation">,</span>
               <span class="string-literal">'CountVectorizer', 'DictVectorizer', 'FeatureUnion'</span><span class="punctuation">,</span>
               <span class="string-literal">'GaussianRandomProjection'</span><span class="punctuation">,</span>
               <span class="string-literal">'MultiOutputClassifier', 'MultiOutputRegressor'</span><span class="punctuation">,</span>
               <span class="string-literal">'NoSampleWeightWrapper', 'OneVsOneClassifier'</span><span class="punctuation">,</span>
               <span class="string-literal">'OutputCodeClassifier', 'Pipeline', 'RFE', 'RFECV'</span><span class="punctuation">,</span>
               <span class="string-literal">'RegressorChain', 'SelectFromModel'</span><span class="punctuation">,</span>
               <span class="string-literal">'SparseCoder', 'SparseRandomProjection'</span><span class="punctuation">,</span>
               <span class="string-literal">'SpectralBiclustering', 'StackingClassifier'</span><span class="punctuation">,</span>
               <span class="string-literal">'StackingRegressor', 'TfidfVectorizer', 'VotingClassifier'</span><span class="punctuation">,</span>
               <span class="string-literal">'VotingRegressor', 'SequentialFeatureSelector'</span><span class="punctuation">,</span>
               <span class="string-literal">'HalvingGridSearchCV', 'HalvingRandomSearchCV'</span><span class="grouping">}</span>
    <span class="keyword">if</span> <span class="identifier">Estimator</span><span class="punctuation">.</span><span class="identifier">__name__</span> <span class="relational-operator">in</span> <span class="identifier">IGNORED</span> <span class="logical-operator">or</span> <span class="identifier">Estimator</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">'_'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">skip</span><span class="grouping">(</span><span class="string-literal">"Estimator cannot be fit easily to test fit attributes"</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">Estimator</span><span class="punctuation">.</span><span class="identifier">__name__</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="string-literal">"RandomizedSearchCV", "GridSearchCV"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">est</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_construct_searchcv_instance</span><span class="grouping">(</span><span class="identifier">Estimator</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">est</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_construct_instance</span><span class="grouping">(</span><span class="identifier">Estimator</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">Estimator</span><span class="punctuation">.</span><span class="identifier">__name__</span> <span class="relational-operator">==</span> <span class="string-literal">'SelectKBest'</span><span class="punctuation">:</span>
        <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">k</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">2</span>

    <span class="keyword">if</span> <span class="identifier">Estimator</span><span class="punctuation">.</span><span class="identifier">__name__</span> <span class="relational-operator">==</span> <span class="string-literal">'DummyClassifier'</span><span class="punctuation">:</span>
        <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">strategy</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"stratified"</span>

    <span class="keyword">if</span> <span class="string-literal">'PLS' in Estimator.__name__ or 'CCA'</span> <span class="relational-operator">in</span> <span class="identifier">Estimator</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="punctuation">:</span>
        <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">n_components</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span>  <span class="comment"># default = 2 is invalid for single target.</span>

    <span class="comment"># FIXME: TO BE REMOVED for 1.1 (avoid FutureWarning)</span>
    <span class="keyword">if</span> <span class="identifier">Estimator</span><span class="punctuation">.</span><span class="identifier">__name__</span> <span class="relational-operator">==</span> <span class="string-literal">'NMF'</span><span class="punctuation">:</span>
        <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">init</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'nndsvda'</span>

    <span class="comment"># FIXME: TO BE REMOVED for 1.2 (avoid FutureWarning)</span>
    <span class="keyword">if</span> <span class="identifier">Estimator</span><span class="punctuation">.</span><span class="identifier">__name__</span> <span class="relational-operator">==</span> <span class="string-literal">'TSNE'</span><span class="punctuation">:</span>
        <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">learning_rate</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">200.0</span>
        <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">init</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'random'</span>

    <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_classification</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">20</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                               <span class="identifier">n_redundant</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">n_classes</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                               <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>

    <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_enforce_estimator_tags_y</span><span class="grouping">(</span><span class="identifier">est</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_enforce_estimator_tags_x</span><span class="grouping">(</span><span class="identifier">est</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="string-literal">'1dlabels' in est._get_tags()['X_types'</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="string-literal">'2dlabels' in est._get_tags()['X_types'</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">c_</span><span class="grouping">[</span><span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="identifier">skipped_attributes</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'x_scores_'</span><span class="punctuation">,</span>  <span class="comment"># For PLS, TODO remove in 1.1</span>
                          <span class="string-literal">'y_scores_'</span><span class="grouping">}</span>  <span class="comment"># For PLS, TODO remove in 1.1</span>

    <span class="identifier">module</span> <span class="arithmetic-assignment">=</span> <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">__module__</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">"."</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>
    <span class="keyword">if</span> <span class="identifier">module</span> <span class="relational-operator">in</span> <span class="identifier">N_FEATURES_MODULES_TO_IGNORE</span><span class="punctuation">:</span>
        <span class="identifier">skipped_attributes</span><span class="punctuation">.</span><span class="identifier">add</span><span class="grouping">(</span><span class="string-literal">"n_features_in_"</span><span class="grouping">)</span>

    <span class="keyword">for</span> <span class="identifier">attr</span> <span class="relational-operator">in</span> <span class="identifier">attributes</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">attr</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="relational-operator">in</span> <span class="identifier">skipped_attributes</span><span class="punctuation">:</span>
            <span class="keyword">continue</span>
        <span class="identifier">desc</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">' '</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">attr</span><span class="punctuation">.</span><span class="identifier">desc</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lower</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="comment"># As certain attributes are present "only" if a certain parameter is</span>
        <span class="comment"># provided, this checks if the word "only" is present in the attribute</span>
        <span class="comment"># description, and if not the attribute is required to be present.</span>
        <span class="keyword">if</span> <span class="string-literal">'only '</span> <span class="relational-operator">in</span> <span class="identifier">desc</span><span class="punctuation">:</span>
            <span class="keyword">continue</span>
        <span class="comment"># ignore deprecation warnings</span>
        <span class="keyword">with</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">FutureWarning</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">assert</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">est</span><span class="punctuation">,</span> <span class="identifier">attr</span><span class="punctuation">.</span><span class="identifier">name</span><span class="grouping">)</span>

    <span class="identifier">fit_attr</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">k</span> <span class="keyword">for</span> <span class="identifier">k</span> <span class="relational-operator">in</span> <span class="identifier">est</span><span class="punctuation">.</span><span class="identifier">__dict__</span><span class="punctuation">.</span><span class="identifier">keys</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">k</span><span class="punctuation">.</span><span class="identifier">endswith</span><span class="grouping">(</span><span class="string-literal">'_'</span><span class="grouping">)</span>
                <span class="logical-operator">and</span> <span class="logical-operator">not</span> <span class="identifier">k</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">'_'</span><span class="grouping">)</span><span class="grouping">]</span>
    <span class="identifier">fit_attr_names</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">attr</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="keyword">for</span> <span class="identifier">attr</span> <span class="relational-operator">in</span> <span class="identifier">attributes</span><span class="grouping">]</span>
    <span class="identifier">undocumented_attrs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">set</span><span class="grouping">(</span><span class="identifier">fit_attr</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">difference</span><span class="grouping">(</span><span class="identifier">fit_attr_names</span><span class="grouping">)</span>
    <span class="identifier">undocumented_attrs</span> <span class="arithmetic-assignment">=</span> <span class="identifier">set</span><span class="grouping">(</span><span class="identifier">undocumented_attrs</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">difference</span><span class="grouping">(</span><span class="identifier">skipped_attributes</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">undocumented_attrs</span><span class="punctuation">,</span><span class="invalid">\</span>
        <span class="string-literal">"Undocumented attributes: {}"</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">undocumented_attrs</span><span class="grouping">)</span>

    </pre>
  </body>
</html>