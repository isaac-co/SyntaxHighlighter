<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
Testing for export functions of decision trees (sklearn.tree.export).
"""</span>
<span class="keyword">from</span> <span class="identifier">re</span> <span class="keyword">import</span> <span class="identifier">finditer</span><span class="punctuation">,</span> <span class="identifier">search</span>
<span class="keyword">from</span> <span class="identifier">textwrap</span> <span class="keyword">import</span> <span class="identifier">dedent</span>

<span class="keyword">from</span> <span class="identifier">numpy</span><span class="punctuation">.</span><span class="identifier">random</span> <span class="keyword">import</span> <span class="identifier">RandomState</span>
<span class="keyword">import</span> <span class="identifier">pytest</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">base</span> <span class="keyword">import</span> <span class="identifier">is_classifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">tree</span> <span class="keyword">import</span> <span class="identifier">DecisionTreeClassifier</span><span class="punctuation">,</span> <span class="identifier">DecisionTreeRegressor</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">GradientBoostingClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">tree</span> <span class="keyword">import</span> <span class="identifier">export_graphviz</span><span class="punctuation">,</span> <span class="identifier">plot_tree</span><span class="punctuation">,</span> <span class="identifier">export_text</span>
<span class="keyword">from</span> <span class="identifier">io</span> <span class="keyword">import</span> <span class="identifier">StringIO</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="invalid">e</span><span class="invalid">x</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">s</span> <span class="keyword">import</span> <span class="identifier">NotFittedError</span>

<span class="comment"># toy sample</span>
<span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>
<span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>
<span class="identifier">y2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="grouping">]</span>
<span class="identifier">w</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="float-literal">.5</span><span class="punctuation">,</span> <span class="float-literal">.5</span><span class="punctuation">,</span> <span class="float-literal">.5</span><span class="grouping">]</span>
<span class="identifier">y_degraded</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>


<span class="keyword">def</span> <span class="identifier">test_graphviz_toy</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Check correctness of export_graphviz</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                                 <span class="identifier">min_samples_split</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                 <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">"gini"</span><span class="punctuation">,</span>
                                 <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="comment"># Test export code</span>
    <span class="identifier">contents1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span>
    <span class="identifier">contents2</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'digraph Tree {\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'node [shape=box, fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'edge [fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 [label="X[0] &lt;= 0.0\\ngini = 0.5\\nsamples = 6\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'value = [3, 3]"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'1 [label="gini = 0.0\\nsamples = 3\\nvalue = [3, 0]"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 1 [labeldistance=2.5, labelangle=45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="True"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'2 [label="gini = 0.0\\nsamples = 3\\nvalue = [0, 3]"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 2 [labeldistance=2.5, labelangle=-45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="False"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'}'</span>

    <span class="keyword">assert</span> <span class="identifier">contents1</span> <span class="relational-operator">==</span> <span class="identifier">contents2</span>

    <span class="comment"># Test with feature_names</span>
    <span class="identifier">contents1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">"feature0", "feature1"</span><span class="grouping">]</span><span class="punctuation">,</span>
                                <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span>
    <span class="identifier">contents2</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'digraph Tree {\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'node [shape=box, fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'edge [fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 [label="feature0 &lt;= 0.0\\ngini = 0.5\\nsamples = 6\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'value = [3, 3]"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'1 [label="gini = 0.0\\nsamples = 3\\nvalue = [3, 0]"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 1 [labeldistance=2.5, labelangle=45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="True"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'2 [label="gini = 0.0\\nsamples = 3\\nvalue = [0, 3]"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 2 [labeldistance=2.5, labelangle=-45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="False"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'}'</span>

    <span class="keyword">assert</span> <span class="identifier">contents1</span> <span class="relational-operator">==</span> <span class="identifier">contents2</span>

    <span class="comment"># Test with class_names</span>
    <span class="identifier">contents1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">"yes", "no"</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span>
    <span class="identifier">contents2</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'digraph Tree {\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'node [shape=box, fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'edge [fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 [label="X[0] &lt;= 0.0\\ngini = 0.5\\nsamples = 6\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'value = [3, 3]\\nclass = yes"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'1 [label="gini = 0.0\\nsamples = 3\\nvalue = [3, 0]\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'class = yes"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 1 [labeldistance=2.5, labelangle=45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="True"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'2 [label="gini = 0.0\\nsamples = 3\\nvalue = [0, 3]\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'class = no"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 2 [labeldistance=2.5, labelangle=-45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="False"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'}'</span>

    <span class="keyword">assert</span> <span class="identifier">contents1</span> <span class="relational-operator">==</span> <span class="identifier">contents2</span>

    <span class="comment"># Test plot_options</span>
    <span class="identifier">contents1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                                <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">special_characters</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
                                <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">fontname</span><span class="arithmetic-assignment">=</span><span class="string-literal">"sans"</span><span class="grouping">)</span>
    <span class="identifier">contents2</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'digraph Tree {\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'node [shape=box, style="filled, rounded", color="black", '</span> <span class="invalid">\</span>
                <span class="string-literal">'fontname="sans"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'edge [fontname="sans"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 [label=&lt;X&lt;SUB&gt;0&lt;/SUB&gt; &le; 0.0&lt;br/&gt;samples = 100.0%&lt;br/&gt;'</span> <span class="invalid">\</span>
                <span class="string-literal">'value = [0.5, 0.5]&gt;, fillcolor="#ffffff"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'1 [label=&lt;samples = 50.0%&lt;br/&gt;value = [1.0, 0.0]&gt;, '</span> <span class="invalid">\</span>
                <span class="string-literal">'fillcolor="#e58139"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 1 [labeldistance=2.5, labelangle=45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="True"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'2 [label=&lt;samples = 50.0%&lt;br/&gt;value = [0.0, 1.0]&gt;, '</span> <span class="invalid">\</span>
                <span class="string-literal">'fillcolor="#399de5"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 2 [labeldistance=2.5, labelangle=-45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="False"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'}'</span>

    <span class="keyword">assert</span> <span class="identifier">contents1</span> <span class="relational-operator">==</span> <span class="identifier">contents2</span>

    <span class="comment"># Test max_depth</span>
    <span class="identifier">contents1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span>
                                <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span>
    <span class="identifier">contents2</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'digraph Tree {\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'node [shape=box, fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'edge [fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 [label="X[0] &lt;= 0.0\\ngini = 0.5\\nsamples = 6\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'value = [3, 3]\\nclass = y[0]"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'1 [label="(...)"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 1 ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'2 [label="(...)"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 2 ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'}'</span>

    <span class="keyword">assert</span> <span class="identifier">contents1</span> <span class="relational-operator">==</span> <span class="identifier">contents2</span>

    <span class="comment"># Test max_depth with plot_options</span>
    <span class="identifier">contents1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
                                <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">node_ids</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
    <span class="identifier">contents2</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'digraph Tree {\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'node [shape=box, style="filled", color="black", '</span><span class="invalid">\</span>
                <span class="string-literal">'fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'edge [fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 [label="node #0\\nX[0] &lt;= 0.0\\ngini = 0.5\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'samples = 6\\nvalue = [3, 3]", fillcolor="#ffffff"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'1 [label="(...)", fillcolor="#C0C0C0"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 1 ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'2 [label="(...)", fillcolor="#C0C0C0"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 2 ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'}'</span>

    <span class="keyword">assert</span> <span class="identifier">contents1</span> <span class="relational-operator">==</span> <span class="identifier">contents2</span>

    <span class="comment"># Test multi-output with weighted samples</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                 <span class="identifier">min_samples_split</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                 <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">"gini"</span><span class="punctuation">,</span>
                                 <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y2</span><span class="punctuation">,</span> <span class="identifier">sample_weight</span><span class="arithmetic-assignment">=</span><span class="identifier">w</span><span class="grouping">)</span>

    <span class="identifier">contents1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
                                <span class="identifier">impurity</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span>
    <span class="identifier">contents2</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'digraph Tree {\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'node [shape=box, style="filled", color="black", '</span> <span class="invalid">\</span>
                <span class="string-literal">'fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'edge [fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 [label="X[0] &lt;= 0.0\\nsamples = 6\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'value = [[3.0, 1.5, 0.0]\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'[3.0, 1.0, 0.5]]", fillcolor="#ffffff"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'1 [label="samples = 3\\nvalue = [[3, 0, 0]\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'[3, 0, 0]]", fillcolor="#e58139"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 1 [labeldistance=2.5, labelangle=45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="True"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'2 [label="X[0] &lt;= 1.5\\nsamples = 3\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'value = [[0.0, 1.5, 0.0]\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'[0.0, 1.0, 0.5]]", fillcolor="#f1bd97"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 -&gt; 2 [labeldistance=2.5, labelangle=-45, '</span> <span class="invalid">\</span>
                <span class="string-literal">'headlabel="False"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'3 [label="samples = 2\\nvalue = [[0, 1, 0]\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'[0, 1, 0]]", fillcolor="#e58139"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'2 -&gt; 3 ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'4 [label="samples = 1\\nvalue = [[0.0, 0.5, 0.0]\\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'[0.0, 0.0, 0.5]]", fillcolor="#e58139"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'2 -&gt; 4 ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'}'</span>

    <span class="keyword">assert</span> <span class="identifier">contents1</span> <span class="relational-operator">==</span> <span class="identifier">contents2</span>

    <span class="comment"># Test regression output with plot_options</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeRegressor</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                                <span class="identifier">min_samples_split</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">"squared_error"</span><span class="punctuation">,</span>
                                <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="identifier">contents1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">leaves_parallel</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
                                <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">rotate</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">rounded</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
                                <span class="identifier">fontname</span><span class="arithmetic-assignment">=</span><span class="string-literal">"sans"</span><span class="grouping">)</span>
    <span class="identifier">contents2</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">'digraph Tree {\n'</span>
                 <span class="string-literal">'node [shape=box, style="filled, rounded", color="black", '</span>
                 <span class="string-literal">'fontname="sans"] ;\n'</span>
                 <span class="string-literal">'graph [ranksep=equally, splines=polyline] ;\n'</span>
                 <span class="string-literal">'edge [fontname="sans"] ;\n'</span>
                 <span class="string-literal">'rankdir=LR ;\n'</span>
                 <span class="string-literal">'0 [label="X[0] &lt;= 0.0\\nsquared_error = 1.0\\nsamples = 6\\n'</span>
                 <span class="string-literal">'value = 0.0", fillcolor="#f2c09c"] ;\n'</span>
                 <span class="string-literal">'1 [label="squared_error = 0.0\\nsamples = 3\\'</span>
                 <span class="string-literal">'nvalue = -1.0", '</span>
                 <span class="string-literal">'fillcolor="#ffffff"] ;\n'</span>
                 <span class="string-literal">'0 -&gt; 1 [labeldistance=2.5, labelangle=-45, '</span>
                 <span class="string-literal">'headlabel="True"] ;\n'</span>
                 <span class="string-literal">'2 [label="squared_error = 0.0\\nsamples = 3\\nvalue = 1.0", '</span>
                 <span class="string-literal">'fillcolor="#e58139"] ;\n'</span>
                 <span class="string-literal">'0 -&gt; 2 [labeldistance=2.5, labelangle=45, '</span>
                 <span class="string-literal">'headlabel="False"] ;\n'</span>
                 <span class="string-literal">'{rank=same ; 0} ;\n'</span>
                 <span class="string-literal">'{rank=same ; 1; 2} ;\n'</span>
                 <span class="string-literal">'}'</span>
                 <span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">contents1</span> <span class="relational-operator">==</span> <span class="identifier">contents2</span>

    <span class="comment"># Test classifier with degraded learning set</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y_degraded</span><span class="grouping">)</span>

    <span class="identifier">contents1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">filled</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span>
    <span class="identifier">contents2</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'digraph Tree {\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'node [shape=box, style="filled", color="black", '</span><span class="invalid">\</span>
                <span class="string-literal">'fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'edge [fontname="helvetica"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'0 [label="gini = 0.0\\nsamples = 6\\nvalue = 6.0", '</span> <span class="invalid">\</span>
                <span class="string-literal">'fillcolor="#ffffff"] ;\n'</span> <span class="invalid">\</span>
                <span class="string-literal">'}'</span>


<span class="keyword">def</span> <span class="identifier">test_graphviz_errors</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Check for errors of export_graphviz</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="identifier">min_samples_split</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>

    <span class="comment"># Check not-fitted decision tree error</span>
    <span class="identifier">out</span> <span class="arithmetic-assignment">=</span> <span class="identifier">StringIO</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">NotFittedError</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">out</span><span class="grouping">)</span>

    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="comment"># Check if it errors when length of feature_names</span>
    <span class="comment"># mismatches with number of features</span>
    <span class="identifier">message</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">"Length of feature_names, "</span>
               <span class="string-literal">"1 does not match number of features, 2"</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">message</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">"a"</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="identifier">message</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">"Length of feature_names, "</span>
               <span class="string-literal">"3 does not match number of features, 2"</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">message</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">"a", "b", "c"</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="comment"># Check error when argument is not an estimator</span>
    <span class="identifier">message</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"is not an estimator instance"</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">message</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tree_</span><span class="grouping">)</span>

    <span class="comment"># Check class_names error</span>
    <span class="identifier">out</span> <span class="arithmetic-assignment">=</span> <span class="identifier">StringIO</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">IndexError</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">out</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">a</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="grouping">]</span><span class="grouping">)</span>

    <span class="comment"># Check precision error</span>
    <span class="identifier">out</span> <span class="arithmetic-assignment">=</span> <span class="identifier">StringIO</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"should be greater or equal"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">out</span><span class="punctuation">,</span> <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"should be an integer"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">out</span><span class="punctuation">,</span> <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="string-literal">"1"</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_friedman_mse_in_graphviz</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeRegressor</span><span class="grouping">(</span><span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">"friedman_mse"</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
    <span class="identifier">dot_data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">StringIO</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="identifier">dot_data</span><span class="grouping">)</span>

    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">GradientBoostingClassifier</span><span class="grouping">(</span><span class="identifier">n_estimators</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">estimator</span> <span class="relational-operator">in</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">estimators_</span><span class="punctuation">:</span>
        <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="identifier">dot_data</span><span class="grouping">)</span>

    <span class="keyword">for</span> <span class="identifier">finding</span> <span class="relational-operator">in</span> <span class="identifier">finditer</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">"\[.*?samples.*?\]"</span><span class="punctuation">,</span> <span class="identifier">dot_data</span><span class="punctuation">.</span><span class="identifier">getvalue</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="string-literal">"friedman_mse"</span> <span class="relational-operator">in</span> <span class="identifier">finding</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_precision</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>

    <span class="identifier">rng_reg</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RandomState</span><span class="grouping">(</span><span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">rng_clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RandomState</span><span class="grouping">(</span><span class="int-literal">8</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">clf</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span>
            <span class="grouping">(</span><span class="identifier">rng_reg</span><span class="punctuation">.</span><span class="identifier">random_sample</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
             <span class="identifier">rng_clf</span><span class="punctuation">.</span><span class="identifier">random_sample</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">1000</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
            <span class="grouping">(</span><span class="identifier">rng_reg</span><span class="punctuation">.</span><span class="identifier">random_sample</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
             <span class="identifier">rng_clf</span><span class="punctuation">.</span><span class="identifier">randint</span><span class="grouping">(</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">1000</span><span class="punctuation">,</span> <span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
            <span class="grouping">(</span><span class="identifier">DecisionTreeRegressor</span><span class="grouping">(</span><span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">"friedman_mse"</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span>
                                   <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span><span class="punctuation">,</span>
             <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>

        <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">precision</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">dot_data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">export_graphviz</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">out_file</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">precision</span><span class="arithmetic-assignment">=</span><span class="identifier">precision</span><span class="punctuation">,</span>
                                       <span class="identifier">proportion</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

            <span class="comment"># With the current random state, the impurity and the threshold</span>
            <span class="comment"># will have the number of precision set in the export_graphviz</span>
            <span class="comment"># function. We will check the number of precision with a strict</span>
            <span class="comment"># equality. The value reported will have only 2 precision and</span>
            <span class="comment"># therefore, only a less equal comparison will be done.</span>

            <span class="comment"># check value</span>
            <span class="keyword">for</span> <span class="identifier">finding</span> <span class="relational-operator">in</span> <span class="identifier">finditer</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">"value = \d+\.\d+"</span><span class="punctuation">,</span> <span class="identifier">dot_data</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">assert</span> <span class="grouping">(</span>
                    <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">search</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">"\.\d+"</span><span class="punctuation">,</span> <span class="identifier">finding</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span> <span class="relational-operator">&lt;=</span>
                    <span class="identifier">precision</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span>
            <span class="comment"># check impurity</span>
            <span class="keyword">if</span> <span class="identifier">is_classifier</span><span class="grouping">(</span><span class="identifier">clf</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">pattern</span> <span class="arithmetic-assignment">=</span> <span class="identifier">r</span><span class="string-literal">"gini = \d+\.\d+"</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="identifier">pattern</span> <span class="arithmetic-assignment">=</span> <span class="identifier">r</span><span class="string-literal">"friedman_mse = \d+\.\d+"</span>

            <span class="comment"># check impurity</span>
            <span class="keyword">for</span> <span class="identifier">finding</span> <span class="relational-operator">in</span> <span class="identifier">finditer</span><span class="grouping">(</span><span class="identifier">pattern</span><span class="punctuation">,</span> <span class="identifier">dot_data</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">assert</span> <span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">search</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">"\.\d+"</span><span class="punctuation">,</span> <span class="identifier">finding</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span> <span class="relational-operator">==</span>
                        <span class="identifier">precision</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span>
            <span class="comment"># check threshold</span>
            <span class="keyword">for</span> <span class="identifier">finding</span> <span class="relational-operator">in</span> <span class="identifier">finditer</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">"&lt;= \d+\.\d+"</span><span class="punctuation">,</span> <span class="identifier">dot_data</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="keyword">assert</span> <span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">search</span><span class="grouping">(</span><span class="identifier">r</span><span class="string-literal">"\.\d+"</span><span class="punctuation">,</span> <span class="identifier">finding</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">group</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span> <span class="relational-operator">==</span>
                        <span class="identifier">precision</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_export_text_errors</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="identifier">err_msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"max_depth bust be &gt;= 0, given -1"</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">)</span>
    <span class="identifier">err_msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"feature_names must contain 2 elements, got 1"</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'a'</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="identifier">err_msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"decimals must be &gt;= 0, given -1"</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">decimals</span><span class="arithmetic-assignment">=</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">)</span>
    <span class="identifier">err_msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"spacing must be &gt; 0, given 0"</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">err_msg</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">spacing</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_export_text</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="identifier">expected_report</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dedent</span><span class="grouping">(</span><span class="comment">"""
    |--- feature_1 &lt;= 0.00
    |   |--- class: -1
    |--- feature_1 &gt;  0.00
    |   |--- class: 1
    """</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lstrip</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>
    <span class="comment"># testing that leaves at level 1 are not truncated</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>
    <span class="comment"># testing that the rest of the tree is truncated</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>

    <span class="identifier">expected_report</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dedent</span><span class="grouping">(</span><span class="comment">"""
    |--- b &lt;= 0.00
    |   |--- class: -1
    |--- b &gt;  0.00
    |   |--- class: 1
    """</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lstrip</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'a', 'b'</span><span class="grouping">]</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>

    <span class="identifier">expected_report</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dedent</span><span class="grouping">(</span><span class="comment">"""
    |--- feature_1 &lt;= 0.00
    |   |--- weights: [3.00, 0.00] class: -1
    |--- feature_1 &gt;  0.00
    |   |--- weights: [0.00, 3.00] class: 1
    """</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lstrip</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">show_weights</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>

    <span class="identifier">expected_report</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dedent</span><span class="grouping">(</span><span class="comment">"""
    |- feature_1 &lt;= 0.00
    | |- class: -1
    |- feature_1 &gt;  0.00
    | |- class: 1
    """</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lstrip</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">spacing</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>

    <span class="identifier">X_l</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">y_l</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_l</span><span class="punctuation">,</span> <span class="identifier">y_l</span><span class="grouping">)</span>
    <span class="identifier">expected_report</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dedent</span><span class="grouping">(</span><span class="comment">"""
    |--- feature_1 &lt;= 0.00
    |   |--- class: -1
    |--- feature_1 &gt;  0.00
    |   |--- truncated branch of depth 2
    """</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lstrip</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>

    <span class="identifier">X_mo</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">y_mo</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span>

    <span class="identifier">reg</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeRegressor</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">reg</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_mo</span><span class="punctuation">,</span> <span class="identifier">y_mo</span><span class="grouping">)</span>

    <span class="identifier">expected_report</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dedent</span><span class="grouping">(</span><span class="comment">"""
    |--- feature_1 &lt;= 0.0
    |   |--- value: [-1.0, -1.0]
    |--- feature_1 &gt;  0.0
    |   |--- value: [1.0, 1.0]
    """</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lstrip</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">reg</span><span class="punctuation">,</span> <span class="identifier">decimals</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">reg</span><span class="punctuation">,</span> <span class="identifier">decimals</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">show_weights</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>

    <span class="identifier">X_single</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="grouping">]</span>
    <span class="identifier">reg</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeRegressor</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">reg</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_single</span><span class="punctuation">,</span> <span class="identifier">y_mo</span><span class="grouping">)</span>

    <span class="identifier">expected_report</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dedent</span><span class="grouping">(</span><span class="comment">"""
    |--- first &lt;= 0.0
    |   |--- value: [-1.0, -1.0]
    |--- first &gt;  0.0
    |   |--- value: [1.0, 1.0]
    """</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">lstrip</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">reg</span><span class="punctuation">,</span> <span class="identifier">decimals</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span>
                       <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'first'</span><span class="grouping">]</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>
    <span class="keyword">assert</span> <span class="identifier">export_text</span><span class="grouping">(</span><span class="identifier">reg</span><span class="punctuation">,</span> <span class="identifier">decimals</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">show_weights</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
                       <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'first'</span><span class="grouping">]</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">expected_report</span>


<span class="keyword">def</span> <span class="identifier">test_plot_tree_entropy</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># mostly smoke tests</span>
    <span class="comment"># Check correctness of export_graphviz for criterion = entropy</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                                 <span class="identifier">min_samples_split</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                 <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">"entropy"</span><span class="punctuation">,</span>
                                 <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="comment"># Test export code</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'first feat', 'sepal_width'</span><span class="grouping">]</span>
    <span class="identifier">nodes</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_tree</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">nodes</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">3</span>
    <span class="keyword">assert</span> <span class="identifier">nodes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_text</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="string-literal">"first feat &lt;= 0.0\nentropy = 1.0\n"</span>
                                   <span class="string-literal">"samples = 6\nvalue = [3, 3]"</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">nodes</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_text</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"entropy = 0.0\nsamples = 3\nvalue = [3, 0]"</span>
    <span class="keyword">assert</span> <span class="identifier">nodes</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_text</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"entropy = 0.0\nsamples = 3\nvalue = [0, 3]"</span>


<span class="keyword">def</span> <span class="identifier">test_plot_tree_gini</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># mostly smoke tests</span>
    <span class="comment"># Check correctness of export_graphviz for criterion = gini</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="punctuation">,</span>
                                 <span class="identifier">min_samples_split</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                 <span class="identifier">criterion</span><span class="arithmetic-assignment">=</span><span class="string-literal">"gini"</span><span class="punctuation">,</span>
                                 <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="comment"># Test export code</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'first feat', 'sepal_width'</span><span class="grouping">]</span>
    <span class="identifier">nodes</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plot_tree</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">feature_names</span><span class="arithmetic-assignment">=</span><span class="identifier">feature_names</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">nodes</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">3</span>
    <span class="keyword">assert</span> <span class="identifier">nodes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_text</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="string-literal">"first feat &lt;= 0.0\ngini = 0.5\n"</span>
                                   <span class="string-literal">"samples = 6\nvalue = [3, 3]"</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">nodes</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_text</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"gini = 0.0\nsamples = 3\nvalue = [3, 0]"</span>
    <span class="keyword">assert</span> <span class="identifier">nodes</span><span class="grouping">[</span><span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">get_text</span><span class="grouping">(</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="string-literal">"gini = 0.0\nsamples = 3\nvalue = [0, 3]"</span>


<span class="keyword">def</span> <span class="identifier">test_not_fitted_tree</span><span class="grouping">(</span><span class="identifier">pyplot</span><span class="grouping">)</span><span class="punctuation">:</span>

    <span class="comment"># Testing if not fitted tree throws the correct error</span>
    <span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeRegressor</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">NotFittedError</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">plot_tree</span><span class="grouping">(</span><span class="identifier">clf</span><span class="grouping">)</span>

    </pre>
  </body>
</html>