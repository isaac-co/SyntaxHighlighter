<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
In physics and astronomy, a gravitational N-body simulation is a simulation of a
dynamical system of particles under the influence of gravity. The system
consists of a number of bodies, each of which exerts a gravitational force on all
other bodies. These forces are calculated using Newton's law of universal
gravitation. The Euler method is used at each time-step to calculate the change in
velocity and position brought about by these forces. Softening is used to prevent
numerical divergences when a particle comes too close to another (and the force
goes to infinity).
(Description adapted from https://en.wikipedia.org/wiki/N-body_simulation )
(See also http://www.shodor.org/refdesk/Resources/Algorithms/EulersMethod/ )
"""</span>


<span class="keyword">from</span> <span class="identifier">__future__</span> <span class="keyword">import</span> <span class="identifier">annotations</span>

<span class="keyword">import</span> <span class="identifier">random</span>

<span class="keyword">from</span> <span class="identifier">matplotlib</span> <span class="keyword">import</span> <span class="identifier">animation</span>
<span class="keyword">from</span> <span class="identifier">matplotlib</span> <span class="keyword">import</span> <span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>


<span class="keyword">class</span> <span class="identifier">Body</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span>
        <span class="identifier">self</span><span class="punctuation">,</span>
        <span class="identifier">position_x</span><span class="punctuation">:</span> <span class="identifier">float</span><span class="punctuation">,</span>
        <span class="identifier">position_y</span><span class="punctuation">:</span> <span class="identifier">float</span><span class="punctuation">,</span>
        <span class="identifier">velocity_x</span><span class="punctuation">:</span> <span class="identifier">float</span><span class="punctuation">,</span>
        <span class="identifier">velocity_y</span><span class="punctuation">:</span> <span class="identifier">float</span><span class="punctuation">,</span>
        <span class="identifier">mass</span><span class="punctuation">:</span> <span class="identifier">float</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">1.0</span><span class="punctuation">,</span>
        <span class="identifier">size</span><span class="punctuation">:</span> <span class="identifier">float</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">1.0</span><span class="punctuation">,</span>
        <span class="identifier">color</span><span class="punctuation">:</span> <span class="identifier">str</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"blue"</span><span class="punctuation">,</span>
    <span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="comment">"""
        The parameters "size" & "color" are not relevant for the simulation itself,
        they are only used for plotting.
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">position_x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">position_x</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">position_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">position_y</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">velocity_x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">velocity_x</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">velocity_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">velocity_y</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">mass</span> <span class="arithmetic-assignment">=</span> <span class="identifier">mass</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">size</span> <span class="arithmetic-assignment">=</span> <span class="identifier">size</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">color</span> <span class="arithmetic-assignment">=</span> <span class="identifier">color</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">position</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">tuple</span><span class="grouping">[</span><span class="identifier">float</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">position_x</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">position_y</span>

    <span class="punctuation">@</span><span class="identifier">property</span>
    <span class="keyword">def</span> <span class="identifier">velocity</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">tuple</span><span class="grouping">[</span><span class="identifier">float</span><span class="punctuation">,</span> <span class="identifier">float</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">velocity_x</span><span class="punctuation">,</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">velocity_y</span>

    <span class="keyword">def</span> <span class="identifier">update_velocity</span><span class="grouping">(</span>
        <span class="identifier">self</span><span class="punctuation">,</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">x</span><span class="punctuation">:</span> <span class="identifier">float</span><span class="punctuation">,</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">y</span><span class="punctuation">:</span> <span class="identifier">float</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span><span class="punctuation">:</span> <span class="identifier">float</span>
    <span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="comment">"""
        Euler algorithm for velocity

        &gt;&gt;&gt; body_1 = Body(0.,0.,0.,0.)
        &gt;&gt;&gt; body_1.update_velocity(1.,0.,1.)
        &gt;&gt;&gt; body_1.velocity
        (1.0, 0.0)

        &gt;&gt;&gt; body_1.update_velocity(1.,0.,1.)
        &gt;&gt;&gt; body_1.velocity
        (2.0, 0.0)

        &gt;&gt;&gt; body_2 = Body(0.,0.,5.,0.)
        &gt;&gt;&gt; body_2.update_velocity(0.,-10.,10.)
        &gt;&gt;&gt; body_2.velocity
        (5.0, -100.0)

        &gt;&gt;&gt; body_2.update_velocity(0.,-10.,10.)
        &gt;&gt;&gt; body_2.velocity
        (5.0, -200.0)
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">velocity_x</span> <span class="arithmetic-assignment">+=</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">x</span> <span class="arithmetic-operator">*</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">velocity_y</span> <span class="arithmetic-assignment">+=</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">y</span> <span class="arithmetic-operator">*</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span>

    <span class="keyword">def</span> <span class="identifier">update_position</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span><span class="punctuation">:</span> <span class="identifier">float</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="comment">"""
        Euler algorithm for position

        &gt;&gt;&gt; body_1 = Body(0.,0.,1.,0.)
        &gt;&gt;&gt; body_1.update_position(1.)
        &gt;&gt;&gt; body_1.position
        (1.0, 0.0)

        &gt;&gt;&gt; body_1.update_position(1.)
        &gt;&gt;&gt; body_1.position
        (2.0, 0.0)

        &gt;&gt;&gt; body_2 = Body(10.,10.,0.,-2.)
        &gt;&gt;&gt; body_2.update_position(1.)
        &gt;&gt;&gt; body_2.position
        (10.0, 8.0)

        &gt;&gt;&gt; body_2.update_position(1.)
        &gt;&gt;&gt; body_2.position
        (10.0, 6.0)
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">position_x</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">velocity_x</span> <span class="arithmetic-operator">*</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">position_y</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">velocity_y</span> <span class="arithmetic-operator">*</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span>


<span class="keyword">class</span> <span class="identifier">BodySystem</span><span class="punctuation">:</span>
    <span class="comment">"""
    This class is used to hold the bodies, the gravitation constant, the time
    factor and the softening factor. The time factor is used to control the speed
    of the simulation. The softening factor is used for softening, a numerical
    trick for N-body simulations to prevent numerical divergences when two bodies
    get too close to each other.
    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span>
        <span class="identifier">self</span><span class="punctuation">,</span>
        <span class="identifier">bodies</span><span class="punctuation">:</span> <span class="identifier">list</span><span class="grouping">[</span><span class="identifier">Body</span><span class="grouping">]</span><span class="punctuation">,</span>
        <span class="identifier">gravitation_constant</span><span class="punctuation">:</span> <span class="identifier">float</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">1.0</span><span class="punctuation">,</span>
        <span class="identifier">time_factor</span><span class="punctuation">:</span> <span class="identifier">float</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">1.0</span><span class="punctuation">,</span>
        <span class="identifier">softening_factor</span><span class="punctuation">:</span> <span class="identifier">float</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.0</span><span class="punctuation">,</span>
    <span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">bodies</span> <span class="arithmetic-assignment">=</span> <span class="identifier">bodies</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">gravitation_constant</span> <span class="arithmetic-assignment">=</span> <span class="identifier">gravitation_constant</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">time_factor</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time_factor</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">softening_factor</span> <span class="arithmetic-assignment">=</span> <span class="identifier">softening_factor</span>

    <span class="keyword">def</span> <span class="identifier">__len__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">int</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">bodies</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">update_system</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span><span class="punctuation">:</span> <span class="identifier">float</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="comment">"""
        For each body, loop through all other bodies to calculate the total
        force they exert on it. Use that force to update the body's velocity.

        &gt;&gt;&gt; body_system_1 = BodySystem([Body(0,0,0,0), Body(10,0,0,0)])
        &gt;&gt;&gt; len(body_system_1)
        2
        &gt;&gt;&gt; body_system_1.update_system(1)
        &gt;&gt;&gt; body_system_1.bodies[0].position
        (0.01, 0.0)
        &gt;&gt;&gt; body_system_1.bodies[0].velocity
        (0.01, 0.0)

        &gt;&gt;&gt; body_system_2 = BodySystem([Body(-10,0,0,0), Body(10,0,0,0, mass=4)], 1, 10)
        &gt;&gt;&gt; body_system_2.update_system(1)
        &gt;&gt;&gt; body_system_2.bodies[0].position
        (-9.0, 0.0)
        &gt;&gt;&gt; body_system_2.bodies[0].velocity
        (0.1, 0.0)
        """</span>
        <span class="keyword">for</span> <span class="identifier">body1</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">bodies</span><span class="punctuation">:</span>
            <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">x</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.0</span>
            <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">y</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.0</span>
            <span class="keyword">for</span> <span class="identifier">body2</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">bodies</span><span class="punctuation">:</span>
                <span class="keyword">if</span> <span class="identifier">body1</span> <span class="relational-operator">!=</span> <span class="identifier">body2</span><span class="punctuation">:</span>
                    <span class="identifier">dif_x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">body2</span><span class="punctuation">.</span><span class="identifier">position_x</span> <span class="arithmetic-operator">-</span> <span class="identifier">body1</span><span class="punctuation">.</span><span class="identifier">position_x</span>
                    <span class="identifier">dif_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">body2</span><span class="punctuation">.</span><span class="identifier">position_y</span> <span class="arithmetic-operator">-</span> <span class="identifier">body1</span><span class="punctuation">.</span><span class="identifier">position_y</span>

                    <span class="comment"># Calculation of the distance using Pythagoras's theorem</span>
                    <span class="comment"># Extra factor due to the softening technique</span>
                    <span class="identifier">distance</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">dif_x</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span> <span class="arithmetic-operator">+</span> <span class="identifier">dif_y</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span> <span class="arithmetic-operator">+</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">softening_factor</span><span class="grouping">)</span> <span class="arithmetic-operator">**</span> <span class="grouping">(</span>
                        <span class="int-literal">1</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span>
                    <span class="grouping">)</span>

                    <span class="comment"># Newton's law of universal gravitation.</span>
                    <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">x</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">(</span>
                        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">gravitation_constant</span> <span class="arithmetic-operator">*</span> <span class="identifier">body2</span><span class="punctuation">.</span><span class="identifier">mass</span> <span class="arithmetic-operator">*</span> <span class="identifier">dif_x</span> <span class="arithmetic-operator">/</span> <span class="identifier">distance</span> <span class="arithmetic-operator">**</span> <span class="int-literal">3</span>
                    <span class="grouping">)</span>
                    <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">y</span> <span class="arithmetic-assignment">+=</span> <span class="grouping">(</span>
                        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">gravitation_constant</span> <span class="arithmetic-operator">*</span> <span class="identifier">body2</span><span class="punctuation">.</span><span class="identifier">mass</span> <span class="arithmetic-operator">*</span> <span class="identifier">dif_y</span> <span class="arithmetic-operator">/</span> <span class="identifier">distance</span> <span class="arithmetic-operator">**</span> <span class="int-literal">3</span>
                    <span class="grouping">)</span>

            <span class="comment"># Update the body's velocity once all the force components have been added</span>
            <span class="identifier">body1</span><span class="punctuation">.</span><span class="identifier">update_velocity</span><span class="grouping">(</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">x</span><span class="punctuation">,</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">c</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">y</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span> <span class="arithmetic-operator">*</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">time_factor</span><span class="grouping">)</span>

        <span class="comment"># Update the positions only after all the velocities have been updated</span>
        <span class="keyword">for</span> <span class="identifier">body</span> <span class="relational-operator">in</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">bodies</span><span class="punctuation">:</span>
            <span class="identifier">body</span><span class="punctuation">.</span><span class="identifier">update_position</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span> <span class="arithmetic-operator">*</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">time_factor</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">update_step</span><span class="grouping">(</span>
    <span class="identifier">body_system</span><span class="punctuation">:</span> <span class="identifier">BodySystem</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span><span class="punctuation">:</span> <span class="identifier">float</span><span class="punctuation">,</span> <span class="identifier">patches</span><span class="punctuation">:</span> <span class="identifier">list</span><span class="grouping">[</span><span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">Circle</span><span class="grouping">]</span>
<span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
    <span class="comment">"""
    Updates the body-system and applies the change to the patch-list used for plotting

    &gt;&gt;&gt; body_system_1 = BodySystem([Body(0,0,0,0), Body(10,0,0,0)])
    &gt;&gt;&gt; patches_1 = [plt.Circle((body.position_x, body.position_y), body.size,
    ... fc=body.color)for body in body_system_1.bodies] #doctest: +ELLIPSIS
    &gt;&gt;&gt; update_step(body_system_1, 1, patches_1)
    &gt;&gt;&gt; patches_1[0].center
    (0.01, 0.0)

    &gt;&gt;&gt; body_system_2 = BodySystem([Body(-10,0,0,0), Body(10,0,0,0, mass=4)], 1, 10)
    &gt;&gt;&gt; patches_2 = [plt.Circle((body.position_x, body.position_y), body.size,
    ... fc=body.color)for body in body_system_2.bodies] #doctest: +ELLIPSIS
    &gt;&gt;&gt; update_step(body_system_2, 1, patches_2)
    &gt;&gt;&gt; patches_2[0].center
    (-9.0, 0.0)
    """</span>
    <span class="comment"># Update the positions of the bodies</span>
    <span class="identifier">body_system</span><span class="punctuation">.</span><span class="identifier">update_system</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">a</span><span class="invalid">_</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">e</span><span class="grouping">)</span>

    <span class="comment"># Update the positions of the patches</span>
    <span class="keyword">for</span> <span class="identifier">patch</span><span class="punctuation">,</span> <span class="identifier">body</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">patches</span><span class="punctuation">,</span> <span class="identifier">body_system</span><span class="punctuation">.</span><span class="identifier">bodies</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">patch</span><span class="punctuation">.</span><span class="identifier">center</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">body</span><span class="punctuation">.</span><span class="identifier">position_x</span><span class="punctuation">,</span> <span class="identifier">body</span><span class="punctuation">.</span><span class="identifier">position_y</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">plot</span><span class="grouping">(</span>
    <span class="identifier">title</span><span class="punctuation">:</span> <span class="identifier">str</span><span class="punctuation">,</span>
    <span class="identifier">body_system</span><span class="punctuation">:</span> <span class="identifier">BodySystem</span><span class="punctuation">,</span>
    <span class="identifier">x_start</span><span class="punctuation">:</span> <span class="identifier">float</span> <span class="arithmetic-assignment">=</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span>
    <span class="identifier">x_end</span><span class="punctuation">:</span> <span class="identifier">float</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span><span class="punctuation">,</span>
    <span class="identifier">y_start</span><span class="punctuation">:</span> <span class="identifier">float</span> <span class="arithmetic-assignment">=</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span>
    <span class="identifier">y_end</span><span class="punctuation">:</span> <span class="identifier">float</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span><span class="punctuation">,</span>
<span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="none-literal">None</span><span class="punctuation">:</span>
    <span class="comment">"""
    Utility function to plot how the given body-system evolves over time.
    No doctest provided since this function does not have a return value.
    """</span>

    <span class="identifier">INTERVAL</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">20</span>  <span class="comment"># Frame rate of the animation</span>
    <span class="invalid">D</span><span class="invalid">E</span><span class="invalid">L</span><span class="invalid">T</span><span class="invalid">A</span><span class="invalid">_</span><span class="invalid">T</span><span class="invalid">I</span><span class="invalid">M</span><span class="invalid">E</span> <span class="arithmetic-assignment">=</span> <span class="identifier">INTERVAL</span> <span class="arithmetic-operator">/</span> <span class="int-literal">1000</span>  <span class="comment"># Time between time steps in seconds</span>

    <span class="identifier">fig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">canvas</span><span class="punctuation">.</span><span class="identifier">set_window_title</span><span class="grouping">(</span><span class="identifier">title</span><span class="grouping">)</span>
    <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axes</span><span class="grouping">(</span>
        <span class="identifier">xlim</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="identifier">x_start</span><span class="punctuation">,</span> <span class="identifier">x_end</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">ylim</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="identifier">y_start</span><span class="punctuation">,</span> <span class="identifier">y_end</span><span class="grouping">)</span>
    <span class="grouping">)</span>  <span class="comment"># Set section to be plotted</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">gca</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">set_aspect</span><span class="grouping">(</span><span class="string-literal">"equal"</span><span class="grouping">)</span>  <span class="comment"># Fix aspect ratio</span>

    <span class="comment"># Each body is drawn as a patch by the plt-function</span>
    <span class="identifier">patches</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
        <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">Circle</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">body</span><span class="punctuation">.</span><span class="identifier">position_x</span><span class="punctuation">,</span> <span class="identifier">body</span><span class="punctuation">.</span><span class="identifier">position_y</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">body</span><span class="punctuation">.</span><span class="identifier">size</span><span class="punctuation">,</span> <span class="identifier">fc</span><span class="arithmetic-assignment">=</span><span class="identifier">body</span><span class="punctuation">.</span><span class="identifier">color</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">body</span> <span class="relational-operator">in</span> <span class="identifier">body_system</span><span class="punctuation">.</span><span class="identifier">bodies</span>
    <span class="grouping">]</span>

    <span class="keyword">for</span> <span class="identifier">patch</span> <span class="relational-operator">in</span> <span class="identifier">patches</span><span class="punctuation">:</span>
        <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">add_patch</span><span class="grouping">(</span><span class="identifier">patch</span><span class="grouping">)</span>

    <span class="comment"># Function called at each step of the animation</span>
    <span class="keyword">def</span> <span class="identifier">update</span><span class="grouping">(</span><span class="identifier">frame</span><span class="punctuation">:</span> <span class="identifier">int</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">list</span><span class="grouping">[</span><span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">Circle</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">update_step</span><span class="grouping">(</span><span class="identifier">body_system</span><span class="punctuation">,</span> <span class="invalid">D</span><span class="invalid">E</span><span class="invalid">L</span><span class="invalid">T</span><span class="invalid">A</span><span class="invalid">_</span><span class="invalid">T</span><span class="invalid">I</span><span class="invalid">M</span><span class="invalid">E</span><span class="punctuation">,</span> <span class="identifier">patches</span><span class="grouping">)</span>
        <span class="keyword">return</span> <span class="identifier">patches</span>

    <span class="identifier">anim</span> <span class="arithmetic-assignment">=</span> <span class="identifier">animation</span><span class="punctuation">.</span><span class="identifier">FuncAnimation</span><span class="grouping">(</span>  <span class="comment"># noqa: F841</span>
        <span class="identifier">fig</span><span class="punctuation">,</span> <span class="identifier">update</span><span class="punctuation">,</span> <span class="identifier">interval</span><span class="arithmetic-assignment">=</span><span class="identifier">INTERVAL</span><span class="punctuation">,</span> <span class="identifier">blit</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span>
    <span class="grouping">)</span>

    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">example_1</span><span class="grouping">(</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">BodySystem</span><span class="punctuation">:</span>
    <span class="comment">"""
    Example 1: figure-8 solution to the 3-body-problem
    This example can be seen as a test of the implementation: given the right
    initial conditions, the bodies should move in a figure-8.
    (initial conditions taken from http://www.artcompsci.org/vol_1/v1_web/node56.html)
    &gt;&gt;&gt; body_system = example_1()
    &gt;&gt;&gt; len(body_system)
    3
    """</span>

    <span class="identifier">position_x</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.9700436</span>
    <span class="identifier">position_y</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">-0.24308753</span>
    <span class="identifier">velocity_x</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.466203685</span>
    <span class="identifier">velocity_y</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.43236573</span>

    <span class="identifier">bodies1</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
        <span class="identifier">Body</span><span class="grouping">(</span><span class="identifier">position_x</span><span class="punctuation">,</span> <span class="identifier">position_y</span><span class="punctuation">,</span> <span class="identifier">velocity_x</span><span class="punctuation">,</span> <span class="identifier">velocity_y</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.2</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">"red"</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="identifier">Body</span><span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="identifier">position_x</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="identifier">position_y</span><span class="punctuation">,</span> <span class="identifier">velocity_x</span><span class="punctuation">,</span> <span class="identifier">velocity_y</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.2</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">"green"</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="identifier">Body</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">velocity_x</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">velocity_y</span><span class="punctuation">,</span> <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.2</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">"blue"</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">]</span>
    <span class="keyword">return</span> <span class="identifier">BodySystem</span><span class="grouping">(</span><span class="identifier">bodies1</span><span class="punctuation">,</span> <span class="identifier">time_factor</span><span class="arithmetic-assignment">=</span><span class="int-literal">3</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">example_2</span><span class="grouping">(</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">BodySystem</span><span class="punctuation">:</span>
    <span class="comment">"""
    Example 2: Moon's orbit around the earth
    This example can be seen as a test of the implementation: given the right
    initial conditions, the moon should orbit around the earth as it actually does.
    (mass, velocity and distance taken from https://en.wikipedia.org/wiki/Earth
    and https://en.wikipedia.org/wiki/Moon)
    No doctest provided since this function does not have a return value.
    """</span>

    <span class="identifier">moon_mass</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">7.3476e22</span>
    <span class="identifier">earth_mass</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">5.972e24</span>
    <span class="identifier">velocity_dif</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1022</span>
    <span class="identifier">earth_moon_distance</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">384399000</span>
    <span class="identifier">gravitation_constant</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">6.674e-11</span>

    <span class="comment"># Calculation of the respective velocities so that total impulse is zero,</span>
    <span class="comment"># i.e. the two bodies together don't move</span>
    <span class="identifier">moon_velocity</span> <span class="arithmetic-assignment">=</span> <span class="identifier">earth_mass</span> <span class="arithmetic-operator">*</span> <span class="identifier">velocity_dif</span> <span class="arithmetic-operator">/</span> <span class="grouping">(</span><span class="identifier">earth_mass</span> <span class="arithmetic-operator">+</span> <span class="identifier">moon_mass</span><span class="grouping">)</span>
    <span class="identifier">earth_velocity</span> <span class="arithmetic-assignment">=</span> <span class="identifier">moon_velocity</span> <span class="arithmetic-operator">-</span> <span class="identifier">velocity_dif</span>

    <span class="identifier">moon</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Body</span><span class="grouping">(</span><span class="arithmetic-operator">-</span><span class="identifier">earth_moon_distance</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">moon_velocity</span><span class="punctuation">,</span> <span class="identifier">moon_mass</span><span class="punctuation">,</span> <span class="int-literal">10000000</span><span class="punctuation">,</span> <span class="string-literal">"grey"</span><span class="grouping">)</span>
    <span class="identifier">earth</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Body</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">earth_velocity</span><span class="punctuation">,</span> <span class="identifier">earth_mass</span><span class="punctuation">,</span> <span class="int-literal">50000000</span><span class="punctuation">,</span> <span class="string-literal">"blue"</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">BodySystem</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">earth</span><span class="punctuation">,</span> <span class="identifier">moon</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">gravitation_constant</span><span class="punctuation">,</span> <span class="identifier">time_factor</span><span class="arithmetic-assignment">=</span><span class="int-literal">1000000</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">example_3</span><span class="grouping">(</span><span class="grouping">)</span> <span class="misc">-&gt;</span> <span class="identifier">BodySystem</span><span class="punctuation">:</span>
    <span class="comment">"""
    Example 3: Random system with many bodies.
    No doctest provided since this function does not have a return value.
    """</span>

    <span class="identifier">bodies</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="int-literal">10</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">velocity_x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">uniform</span><span class="grouping">(</span><span class="float-literal">-0.5</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="grouping">)</span>
        <span class="identifier">velocity_y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">uniform</span><span class="grouping">(</span><span class="float-literal">-0.5</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="grouping">)</span>

        <span class="comment"># Bodies are created pairwise with opposite velocities so that the</span>
        <span class="comment"># total impulse remains zero</span>
        <span class="identifier">bodies</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span>
            <span class="identifier">Body</span><span class="grouping">(</span>
                <span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">uniform</span><span class="grouping">(</span><span class="float-literal">-0.5</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">uniform</span><span class="grouping">(</span><span class="float-literal">-0.5</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="identifier">velocity_x</span><span class="punctuation">,</span>
                <span class="identifier">velocity_y</span><span class="punctuation">,</span>
                <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.05</span><span class="punctuation">,</span>
            <span class="grouping">)</span>
        <span class="grouping">)</span>
        <span class="identifier">bodies</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span>
            <span class="identifier">Body</span><span class="grouping">(</span>
                <span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">uniform</span><span class="grouping">(</span><span class="float-literal">-0.5</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="identifier">random</span><span class="punctuation">.</span><span class="identifier">uniform</span><span class="grouping">(</span><span class="float-literal">-0.5</span><span class="punctuation">,</span> <span class="float-literal">0.5</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="arithmetic-operator">-</span><span class="identifier">velocity_x</span><span class="punctuation">,</span>
                <span class="arithmetic-operator">-</span><span class="identifier">velocity_y</span><span class="punctuation">,</span>
                <span class="identifier">size</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.05</span><span class="punctuation">,</span>
            <span class="grouping">)</span>
        <span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">BodySystem</span><span class="grouping">(</span><span class="identifier">bodies</span><span class="punctuation">,</span> <span class="float-literal">0.01</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="float-literal">0.1</span><span class="grouping">)</span>


<span class="keyword">if</span> <span class="identifier">__name__</span> <span class="relational-operator">==</span> <span class="string-literal">"__main__"</span><span class="punctuation">:</span>
    <span class="identifier">plot</span><span class="grouping">(</span><span class="string-literal">"Figure-8 solution to the 3-body-problem"</span><span class="punctuation">,</span> <span class="identifier">example_1</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">)</span>
    <span class="identifier">plot</span><span class="grouping">(</span>
        <span class="string-literal">"Moon's orbit around the earth"</span><span class="punctuation">,</span>
        <span class="identifier">example_2</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="arithmetic-operator">-</span><span class="int-literal">430000000</span><span class="punctuation">,</span>
        <span class="int-literal">430000000</span><span class="punctuation">,</span>
        <span class="arithmetic-operator">-</span><span class="int-literal">430000000</span><span class="punctuation">,</span>
        <span class="int-literal">430000000</span><span class="punctuation">,</span>
    <span class="grouping">)</span>
    <span class="identifier">plot</span><span class="grouping">(</span><span class="string-literal">"Random system with many bodies"</span><span class="punctuation">,</span> <span class="identifier">example_3</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="float-literal">-1.5</span><span class="punctuation">,</span> <span class="float-literal">1.5</span><span class="punctuation">,</span> <span class="float-literal">-1.5</span><span class="punctuation">,</span> <span class="float-literal">1.5</span><span class="grouping">)</span>

    </pre>
  </body>
</html>