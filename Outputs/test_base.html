<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="keyword">import</span> <span class="identifier">os</span>
<span class="keyword">import</span> <span class="identifier">shutil</span>
<span class="keyword">import</span> <span class="identifier">tempfile</span>
<span class="keyword">import</span> <span class="identifier">warnings</span>
<span class="keyword">from</span> <span class="identifier">pickle</span> <span class="keyword">import</span> <span class="identifier">loads</span>
<span class="keyword">from</span> <span class="identifier">pickle</span> <span class="keyword">import</span> <span class="identifier">dumps</span>
<span class="keyword">from</span> <span class="identifier">functools</span> <span class="keyword">import</span> <span class="identifier">partial</span>

<span class="keyword">import</span> <span class="identifier">pytest</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">get_data_home</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">clear_data_home</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_files</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_sample_images</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_sample_image</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_digits</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_diabetes</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_linnerud</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_iris</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_breast_cancer</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_boston</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">load_wine</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">Bunch</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">tests</span><span class="punctuation">.</span><span class="identifier">test_common</span> <span class="keyword">import</span> <span class="identifier">check_as_frame</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">externals</span><span class="punctuation">.</span><span class="identifier">_pilutil</span> <span class="keyword">import</span> <span class="identifier">pillow_installed</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">IS_PYPY</span>


<span class="keyword">def</span> <span class="identifier">_remove_dir</span><span class="grouping">(</span><span class="identifier">path</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">if</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">isdir</span><span class="grouping">(</span><span class="identifier">path</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">shutil</span><span class="punctuation">.</span><span class="identifier">rmtree</span><span class="grouping">(</span><span class="identifier">path</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">fixture</span><span class="grouping">(</span><span class="identifier">scope</span><span class="arithmetic-assignment">=</span><span class="string-literal">"module"</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">data_home</span><span class="grouping">(</span><span class="identifier">tmpdir_factory</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">tmp_file</span> <span class="arithmetic-assignment">=</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">tmpdir_factory</span><span class="punctuation">.</span><span class="identifier">mktemp</span><span class="grouping">(</span><span class="string-literal">"scikit_learn_data_home_test"</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">yield</span> <span class="identifier">tmp_file</span>
    <span class="identifier">_remove_dir</span><span class="grouping">(</span><span class="identifier">tmp_file</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">fixture</span><span class="grouping">(</span><span class="identifier">scope</span><span class="arithmetic-assignment">=</span><span class="string-literal">"module"</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">load_files_root</span><span class="grouping">(</span><span class="identifier">tmpdir_factory</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">tmp_file</span> <span class="arithmetic-assignment">=</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">tmpdir_factory</span><span class="punctuation">.</span><span class="identifier">mktemp</span><span class="grouping">(</span><span class="string-literal">"scikit_learn_load_files_test"</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">yield</span> <span class="identifier">tmp_file</span>
    <span class="identifier">_remove_dir</span><span class="grouping">(</span><span class="identifier">tmp_file</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">fixture</span>
<span class="keyword">def</span> <span class="identifier">test_category_dir_1</span><span class="grouping">(</span><span class="identifier">load_files_root</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">test_category_dir1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tempfile</span><span class="punctuation">.</span><span class="identifier">mkdtemp</span><span class="grouping">(</span><span class="identifier">dir</span><span class="arithmetic-assignment">=</span><span class="identifier">load_files_root</span><span class="grouping">)</span>
    <span class="identifier">sample_file</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tempfile</span><span class="punctuation">.</span><span class="identifier">NamedTemporaryFile</span><span class="grouping">(</span><span class="identifier">dir</span><span class="arithmetic-assignment">=</span><span class="identifier">test_category_dir1</span><span class="punctuation">,</span>
                                              <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">e</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
    <span class="identifier">sample_file</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="identifier">b</span><span class="string-literal">"Hello World!\n"</span><span class="grouping">)</span>
    <span class="identifier">sample_file</span><span class="punctuation">.</span><span class="identifier">close</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">yield</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">test_category_dir1</span><span class="grouping">)</span>
    <span class="identifier">_remove_dir</span><span class="grouping">(</span><span class="identifier">test_category_dir1</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">fixture</span>
<span class="keyword">def</span> <span class="identifier">test_category_dir_2</span><span class="grouping">(</span><span class="identifier">load_files_root</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">test_category_dir2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tempfile</span><span class="punctuation">.</span><span class="identifier">mkdtemp</span><span class="grouping">(</span><span class="identifier">dir</span><span class="arithmetic-assignment">=</span><span class="identifier">load_files_root</span><span class="grouping">)</span>
    <span class="keyword">yield</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">test_category_dir2</span><span class="grouping">)</span>
    <span class="identifier">_remove_dir</span><span class="grouping">(</span><span class="identifier">test_category_dir2</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_data_home</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># get_data_home will point to a pre-existing folder</span>
    <span class="identifier">data_home</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_data_home</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="arithmetic-assignment">=</span><span class="identifier">data_home</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">data_home</span> <span class="relational-operator">==</span> <span class="identifier">data_home</span>
    <span class="keyword">assert</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="grouping">)</span>

    <span class="comment"># clear_data_home will delete both the content and the folder it-self</span>
    <span class="identifier">clear_data_home</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="arithmetic-assignment">=</span><span class="identifier">data_home</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="grouping">)</span>

    <span class="comment"># if the folder is missing it will be created again</span>
    <span class="identifier">data_home</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_data_home</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="arithmetic-assignment">=</span><span class="identifier">data_home</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">data_home</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_default_empty_load_files</span><span class="grouping">(</span><span class="identifier">load_files_root</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">res</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_files</span><span class="grouping">(</span><span class="identifier">load_files_root</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">filenames</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">target_names</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">0</span>
    <span class="keyword">assert</span> <span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">DESCR</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>


<span class="keyword">def</span> <span class="identifier">test_default_load_files</span><span class="grouping">(</span><span class="identifier">test_category_dir_1</span><span class="punctuation">,</span> <span class="identifier">test_category_dir_2</span><span class="punctuation">,</span>
                            <span class="identifier">load_files_root</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">if</span> <span class="identifier">IS_PYPY</span><span class="punctuation">:</span>
        <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">xfail</span><span class="grouping">(</span><span class="string-literal">'[PyPy] fails due to string containing NUL characters'</span><span class="grouping">)</span>
    <span class="identifier">res</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_files</span><span class="grouping">(</span><span class="identifier">load_files_root</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">filenames</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">target_names</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span>
    <span class="keyword">assert</span> <span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">DESCR</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">data</span> <span class="relational-operator">==</span> <span class="grouping">[</span><span class="identifier">b</span><span class="string-literal">"Hello World!\n"</span><span class="grouping">]</span>


<span class="keyword">def</span> <span class="identifier">test_load_files_w_categories_desc_and_encoding</span><span class="grouping">(</span>
        <span class="identifier">test_category_dir_1</span><span class="punctuation">,</span> <span class="identifier">test_category_dir_2</span><span class="punctuation">,</span> <span class="identifier">load_files_root</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">if</span> <span class="identifier">IS_PYPY</span><span class="punctuation">:</span>
        <span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">xfail</span><span class="grouping">(</span><span class="string-literal">'[PyPy] fails due to string containing NUL characters'</span><span class="grouping">)</span>
    <span class="identifier">category</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">abspath</span><span class="grouping">(</span><span class="identifier">test_category_dir_1</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">'/'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">pop</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">res</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_files</span><span class="grouping">(</span><span class="identifier">load_files_root</span><span class="punctuation">,</span> <span class="identifier">description</span><span class="arithmetic-assignment">=</span><span class="string-literal">"test"</span><span class="punctuation">,</span>
                     <span class="identifier">categories</span><span class="arithmetic-assignment">=</span><span class="identifier">category</span><span class="punctuation">,</span> <span class="identifier">encoding</span><span class="arithmetic-assignment">=</span><span class="string-literal">"utf-8"</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">filenames</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">target_names</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>
    <span class="keyword">assert</span> <span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">DESCR</span> <span class="relational-operator">==</span> <span class="string-literal">"test"</span>
    <span class="keyword">assert</span> <span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">data</span> <span class="relational-operator">==</span> <span class="grouping">[</span><span class="string-literal">"Hello World!\n"</span><span class="grouping">]</span>


<span class="keyword">def</span> <span class="identifier">test_load_files_wo_load_content</span><span class="grouping">(</span>
        <span class="identifier">test_category_dir_1</span><span class="punctuation">,</span> <span class="identifier">test_category_dir_2</span><span class="punctuation">,</span> <span class="identifier">load_files_root</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">res</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_files</span><span class="grouping">(</span><span class="identifier">load_files_root</span><span class="punctuation">,</span> <span class="identifier">load_content</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">filenames</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>
    <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">target_names</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span>
    <span class="keyword">assert</span> <span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">DESCR</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>
    <span class="keyword">assert</span> <span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="string-literal">'data'</span><span class="grouping">)</span> <span class="relational-operator">is</span> <span class="none-literal">None</span>


<span class="keyword">def</span> <span class="identifier">test_load_sample_images</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="identifier">res</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_sample_images</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">images</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span>
        <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">filenames</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">2</span>
        <span class="identifier">images</span> <span class="arithmetic-assignment">=</span> <span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">images</span>

        <span class="comment"># assert is china image</span>
        <span class="keyword">assert</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="identifier">images</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span> <span class="relational-operator">==</span>
                      <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="int-literal">174</span><span class="punctuation">,</span> <span class="int-literal">201</span><span class="punctuation">,</span> <span class="int-literal">231</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">uint8</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="comment"># assert is flower image</span>
        <span class="keyword">assert</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="identifier">images</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span> <span class="relational-operator">==</span>
                      <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">19</span><span class="punctuation">,</span> <span class="int-literal">13</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">uint8</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="identifier">res</span><span class="punctuation">.</span><span class="identifier">DESCR</span>
    <span class="keyword">except</span> <span class="invalid">I</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">:</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span><span class="string-literal">"Could not load sample images, PIL is not available."</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_load_sample_image</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="identifier">china</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_sample_image</span><span class="grouping">(</span><span class="string-literal">'china.jpg'</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="identifier">china</span><span class="punctuation">.</span><span class="identifier">dtype</span> <span class="relational-operator">==</span> <span class="string-literal">'uint8'</span>
        <span class="keyword">assert</span> <span class="identifier">china</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="grouping">(</span><span class="int-literal">427</span><span class="punctuation">,</span> <span class="int-literal">640</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>
    <span class="keyword">except</span> <span class="invalid">I</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">:</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span><span class="string-literal">"Could not load sample images, PIL is not available."</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_load_missing_sample_image_error</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">if</span> <span class="identifier">pillow_installed</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">AttributeError</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">load_sample_image</span><span class="grouping">(</span><span class="string-literal">'blop.jpg'</span><span class="grouping">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span><span class="string-literal">"Could not load sample images, PIL is not available."</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="string-literal">"loader_func, data_shape, target_shape, n_target, has_descr, filenames"</span><span class="punctuation">,</span>
    <span class="grouping">[</span><span class="grouping">(</span><span class="identifier">load_breast_cancer</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">569</span><span class="punctuation">,</span> <span class="int-literal">30</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">569</span><span class="punctuation">,</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="string-literal">"filename"</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">load_wine</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">178</span><span class="punctuation">,</span> <span class="int-literal">13</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">178</span><span class="punctuation">,</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">load_iris</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">150</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">150</span><span class="punctuation">,</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="string-literal">"filename"</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">load_linnerud</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">20</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">20</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span>
      <span class="grouping">[</span><span class="string-literal">"data_filename", "target_filename"</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">load_diabetes</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">442</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">442</span><span class="punctuation">,</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">load_digits</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1797</span><span class="punctuation">,</span> <span class="int-literal">64</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1797</span><span class="punctuation">,</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">partial</span><span class="grouping">(</span><span class="identifier">load_digits</span><span class="punctuation">,</span> <span class="identifier">n_class</span><span class="arithmetic-assignment">=</span><span class="int-literal">9</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1617</span><span class="punctuation">,</span> <span class="int-literal">64</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">1617</span><span class="punctuation">,</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
     <span class="grouping">(</span><span class="identifier">load_boston</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">506</span><span class="punctuation">,</span> <span class="int-literal">13</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="int-literal">506</span><span class="punctuation">,</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="string-literal">"filename"</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">]</span>
<span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_loader</span><span class="grouping">(</span><span class="identifier">loader_func</span><span class="punctuation">,</span> <span class="identifier">data_shape</span><span class="punctuation">,</span> <span class="identifier">target_shape</span><span class="punctuation">,</span> <span class="identifier">n_target</span><span class="punctuation">,</span> <span class="identifier">has_descr</span><span class="punctuation">,</span>
                <span class="identifier">filenames</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">bunch</span> <span class="arithmetic-assignment">=</span> <span class="identifier">loader_func</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">assert</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">bunch</span><span class="punctuation">,</span> <span class="identifier">Bunch</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">bunch</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="identifier">data_shape</span>
    <span class="keyword">assert</span> <span class="identifier">bunch</span><span class="punctuation">.</span><span class="identifier">target</span><span class="punctuation">.</span><span class="identifier">shape</span> <span class="relational-operator">==</span> <span class="identifier">target_shape</span>
    <span class="keyword">if</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">bunch</span><span class="punctuation">,</span> <span class="string-literal">"feature_names"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">bunch</span><span class="punctuation">.</span><span class="identifier">feature_names</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">data_shape</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span>
    <span class="keyword">if</span> <span class="identifier">n_target</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">bunch</span><span class="punctuation">.</span><span class="identifier">target_names</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="identifier">n_target</span>
    <span class="keyword">if</span> <span class="identifier">has_descr</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="identifier">bunch</span><span class="punctuation">.</span><span class="identifier">DESCR</span>
    <span class="keyword">if</span> <span class="identifier">filenames</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="identifier">all</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">bunch</span><span class="punctuation">.</span><span class="identifier">get</span><span class="grouping">(</span><span class="identifier">f</span><span class="punctuation">,</span> <span class="bool-literal">False</span><span class="grouping">)</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">f</span> <span class="relational-operator">in</span> <span class="identifier">filenames</span><span class="grouping">]</span><span class="grouping">)</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span><span class="string-literal">"loader_func, data_dtype, target_dtype"</span><span class="punctuation">,</span> <span class="grouping">[</span>
    <span class="grouping">(</span><span class="identifier">load_breast_cancer</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="identifier">load_diabetes</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="identifier">load_digits</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="identifier">load_iris</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="identifier">load_linnerud</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="identifier">load_wine</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">)</span><span class="punctuation">,</span>
<span class="grouping">]</span><span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_toy_dataset_frame_dtype</span><span class="grouping">(</span><span class="identifier">loader_func</span><span class="punctuation">,</span> <span class="identifier">data_dtype</span><span class="punctuation">,</span> <span class="identifier">target_dtype</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span> <span class="arithmetic-assignment">=</span> <span class="identifier">loader_func</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">check_as_frame</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="punctuation">,</span> <span class="identifier">loader_func</span><span class="punctuation">,</span>
                   <span class="identifier">expected_data_dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">data_dtype</span><span class="punctuation">,</span>
                   <span class="identifier">expected_target_dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">target_dtype</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_loads_dumps_bunch</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">bunch</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Bunch</span><span class="grouping">(</span><span class="identifier">x</span><span class="arithmetic-assignment">=</span><span class="string-literal">"x"</span><span class="grouping">)</span>
    <span class="identifier">bunch_from_pkl</span> <span class="arithmetic-assignment">=</span> <span class="identifier">loads</span><span class="grouping">(</span><span class="identifier">dumps</span><span class="grouping">(</span><span class="identifier">bunch</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">bunch_from_pkl</span><span class="punctuation">.</span><span class="identifier">x</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"y"</span>
    <span class="keyword">assert</span> <span class="identifier">bunch_from_pkl</span><span class="grouping">[</span><span class="string-literal">'x'</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="identifier">bunch_from_pkl</span><span class="punctuation">.</span><span class="identifier">x</span>


<span class="keyword">def</span> <span class="identifier">test_bunch_pickle_generated_with_0_16_and_read_with_0_17</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">bunch</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Bunch</span><span class="grouping">(</span><span class="identifier">key</span><span class="arithmetic-assignment">=</span><span class="string-literal">'original'</span><span class="grouping">)</span>
    <span class="comment"># This reproduces a problem when Bunch pickles have been created</span>
    <span class="comment"># with scikit-learn 0.16 and are read with 0.17. Basically there</span>
    <span class="comment"># is a surprising behaviour because reading bunch.key uses</span>
    <span class="comment"># bunch.__dict__ (which is non empty for 0.16 Bunch objects)</span>
    <span class="comment"># whereas assigning into bunch.key uses bunch.__setattr__. See</span>
    <span class="comment"># https://github.com/scikit-learn/scikit-learn/issues/6196 for</span>
    <span class="comment"># more details</span>
    <span class="identifier">bunch</span><span class="punctuation">.</span><span class="identifier">__dict__</span><span class="grouping">[</span><span class="string-literal">'key'] = 'set from __dict__'</span>
    <span class="identifier">bunch_from_pkl</span> <span class="arithmetic-assignment">=</span> <span class="identifier">loads</span><span class="grouping">(</span><span class="identifier">dumps</span><span class="grouping">(</span><span class="identifier">bunch</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="comment"># After loading from pickle the __dict__ should have been ignored</span>
    <span class="keyword">assert</span> <span class="identifier">bunch_from_pkl</span><span class="punctuation">.</span><span class="identifier">key</span> <span class="relational-operator">==</span> <span class="string-literal">'original'</span>
    <span class="keyword">assert</span> <span class="identifier">bunch_from_pkl</span><span class="grouping">[</span><span class="string-literal">'key'] == 'original'</span>
    <span class="comment"># Making sure that changing the attr does change the value</span>
    <span class="comment"># associated with __getitem__ as well</span>
    <span class="identifier">bunch_from_pkl</span><span class="punctuation">.</span><span class="identifier">key</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'changed'</span>
    <span class="keyword">assert</span> <span class="identifier">bunch_from_pkl</span><span class="punctuation">.</span><span class="identifier">key</span> <span class="relational-operator">==</span> <span class="string-literal">'changed'</span>
    <span class="keyword">assert</span> <span class="identifier">bunch_from_pkl</span><span class="grouping">[</span><span class="string-literal">'key'] == 'changed'</span>


<span class="keyword">def</span> <span class="identifier">test_bunch_dir</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># check that dir (important for autocomplete) shows attributes</span>
    <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">load_iris</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="string-literal">"data"</span> <span class="relational-operator">in</span> <span class="identifier">dir</span><span class="grouping">(</span><span class="identifier">data</span><span class="grouping">)</span>

    </pre>
  </body>
</html>