<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">#!/usr/bin/env python</span>
<span class="comment">"""
A comparison of multilabel target formats and metrics over them
"""</span>

<span class="keyword">from</span> <span class="identifier">timeit</span> <span class="keyword">import</span> <span class="identifier">timeit</span>
<span class="keyword">from</span> <span class="identifier">functools</span> <span class="keyword">import</span> <span class="identifier">partial</span>
<span class="keyword">import</span> <span class="identifier">itertools</span>
<span class="keyword">import</span> <span class="identifier">argparse</span>
<span class="keyword">import</span> <span class="identifier">sys</span>

<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
<span class="keyword">import</span> <span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">sparse</span> <span class="keyword">as</span> <span class="identifier">sp</span>
<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">make_multilabel_classification</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="grouping">(</span><span class="identifier">f1_score</span><span class="punctuation">,</span> <span class="identifier">accuracy_score</span><span class="punctuation">,</span> <span class="identifier">hamming_loss</span><span class="punctuation">,</span>
                             <span class="identifier">jaccard_similarity_score</span><span class="grouping">)</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="identifier">ignore_warnings</span>


<span class="identifier">METRICS</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span>
    <span class="string-literal">'f1': partial(f1_score, average='micro'</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="string-literal">'f1-by-sample': partial(f1_score, average='samples'</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="string-literal">'accuracy'</span><span class="punctuation">:</span> <span class="identifier">accuracy_score</span><span class="punctuation">,</span>
    <span class="string-literal">'hamming'</span><span class="punctuation">:</span> <span class="identifier">hamming_loss</span><span class="punctuation">,</span>
    <span class="string-literal">'jaccard'</span><span class="punctuation">:</span> <span class="identifier">jaccard_similarity_score</span><span class="punctuation">,</span>
<span class="grouping">}</span>

<span class="invalid">F</span><span class="invalid">O</span><span class="invalid">R</span><span class="invalid">M</span><span class="invalid">A</span><span class="invalid">T</span><span class="invalid">S</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span>
    <span class="string-literal">'sequences'</span><span class="punctuation">:</span> <span class="keyword">lambda</span> <span class="identifier">y</span><span class="punctuation">:</span> <span class="grouping">[</span><span class="identifier">list</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">flatnonzero</span><span class="grouping">(</span><span class="identifier">s</span><span class="grouping">)</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">s</span> <span class="relational-operator">in</span> <span class="identifier">y</span><span class="grouping">]</span><span class="punctuation">,</span>
    <span class="string-literal">'dense'</span><span class="punctuation">:</span> <span class="keyword">lambda</span> <span class="identifier">y</span><span class="punctuation">:</span> <span class="identifier">y</span><span class="punctuation">,</span>
    <span class="string-literal">'csr'</span><span class="punctuation">:</span> <span class="keyword">lambda</span> <span class="identifier">y</span><span class="punctuation">:</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">csr_matrix</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="string-literal">'csc'</span><span class="punctuation">:</span> <span class="keyword">lambda</span> <span class="identifier">y</span><span class="punctuation">:</span> <span class="identifier">sp</span><span class="punctuation">.</span><span class="identifier">csc_matrix</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">,</span>
<span class="grouping">}</span>


<span class="punctuation">@</span><span class="identifier">ignore_warnings</span>
<span class="keyword">def</span> <span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">metrics</span><span class="arithmetic-assignment">=</span><span class="identifier">tuple</span><span class="grouping">(</span><span class="identifier">v</span> <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span> <span class="relational-operator">in</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">METRICS</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
              <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="identifier">tuple</span><span class="grouping">(</span><span class="identifier">v</span> <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span> <span class="relational-operator">in</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="invalid">F</span><span class="invalid">O</span><span class="invalid">R</span><span class="invalid">M</span><span class="invalid">A</span><span class="invalid">T</span><span class="invalid">S</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
              <span class="identifier">samples</span><span class="arithmetic-assignment">=</span><span class="int-literal">1000</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="int-literal">4</span><span class="punctuation">,</span> <span class="identifier">density</span><span class="arithmetic-assignment">=</span><span class="float-literal">.2</span><span class="punctuation">,</span>
              <span class="identifier">n_times</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Times metric calculations for a number of inputs

    Parameters
    ----------
    metrics : array-like of callables (1d or 0d)
        The metric functions to time.

    formats : array-like of callables (1d or 0d)
        These may transform a dense indicator matrix into multilabel
        representation.

    samples : array-like of ints (1d or 0d)
        The number of samples to generate as input.

    classes : array-like of ints (1d or 0d)
        The number of classes in the input.

    density : array-like of ints (1d or 0d)
        The density of positive labels in the input.

    n_times : int
        Time calling the metric n_times times.

    Returns
    -------
    array of floats shaped like (metrics, formats, samples, classes, density)
        Time in seconds.
    """</span>
    <span class="identifier">metrics</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">atleast_1d</span><span class="grouping">(</span><span class="identifier">metrics</span><span class="grouping">)</span>
    <span class="identifier">samples</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">atleast_1d</span><span class="grouping">(</span><span class="identifier">samples</span><span class="grouping">)</span>
    <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">atleast_1d</span><span class="grouping">(</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">)</span>
    <span class="identifier">density</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">atleast_1d</span><span class="grouping">(</span><span class="identifier">density</span><span class="grouping">)</span>
    <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">atleast_1d</span><span class="grouping">(</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">)</span>
    <span class="identifier">out</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">metrics</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">len</span><span class="grouping">(</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">samples</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">len</span><span class="grouping">(</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">)</span><span class="punctuation">,</span>
                    <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">density</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">float</span><span class="grouping">)</span>
    <span class="identifier">it</span> <span class="arithmetic-assignment">=</span> <span class="identifier">itertools</span><span class="punctuation">.</span><span class="identifier">product</span><span class="grouping">(</span><span class="identifier">samples</span><span class="punctuation">,</span> <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">density</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">s</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="punctuation">,</span> <span class="identifier">d</span><span class="grouping">)</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">it</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">y_true</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_multilabel_classification</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="arithmetic-assignment">=</span><span class="identifier">s</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span>
                                                   <span class="identifier">n_classes</span><span class="arithmetic-assignment">=</span><span class="identifier">c</span><span class="punctuation">,</span> <span class="identifier">n_labels</span><span class="arithmetic-assignment">=</span><span class="identifier">d</span> <span class="arithmetic-operator">*</span> <span class="identifier">c</span><span class="punctuation">,</span>
                                                   <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span><span class="grouping">)</span>
        <span class="identifier">_</span><span class="punctuation">,</span> <span class="identifier">y_pred</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_multilabel_classification</span><span class="grouping">(</span><span class="identifier">n_samples</span><span class="arithmetic-assignment">=</span><span class="identifier">s</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span>
                                                   <span class="identifier">n_classes</span><span class="arithmetic-assignment">=</span><span class="identifier">c</span><span class="punctuation">,</span> <span class="identifier">n_labels</span><span class="arithmetic-assignment">=</span><span class="identifier">d</span> <span class="arithmetic-operator">*</span> <span class="identifier">c</span><span class="punctuation">,</span>
                                                   <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">84</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">j</span><span class="punctuation">,</span> <span class="identifier">f</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">f_true</span> <span class="arithmetic-assignment">=</span> <span class="identifier">f</span><span class="grouping">(</span><span class="identifier">y_true</span><span class="grouping">)</span>
            <span class="identifier">f_pred</span> <span class="arithmetic-assignment">=</span> <span class="identifier">f</span><span class="grouping">(</span><span class="identifier">y_pred</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">metric</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">metrics</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">t</span> <span class="arithmetic-assignment">=</span> <span class="identifier">timeit</span><span class="grouping">(</span><span class="identifier">partial</span><span class="grouping">(</span><span class="identifier">metric</span><span class="punctuation">,</span> <span class="identifier">f_true</span><span class="punctuation">,</span> <span class="identifier">f_pred</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">number</span><span class="arithmetic-assignment">=</span><span class="identifier">n_times</span><span class="grouping">)</span>

                <span class="identifier">out</span><span class="grouping">[</span><span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">j</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">flat</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">t</span>
    <span class="keyword">return</span> <span class="identifier">out</span>


<span class="keyword">def</span> <span class="identifier">_tabulate</span><span class="grouping">(</span><span class="identifier">results</span><span class="punctuation">,</span> <span class="identifier">metrics</span><span class="punctuation">,</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Prints results by metric and format

    Uses the last ([-1]) value of other fields
    """</span>
    <span class="identifier">column_width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">max</span><span class="grouping">(</span><span class="identifier">max</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">k</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">k</span> <span class="relational-operator">in</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="grouping">)</span>
    <span class="identifier">first_width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">max</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">k</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">k</span> <span class="relational-operator">in</span> <span class="identifier">metrics</span><span class="grouping">)</span>
    <span class="identifier">head_fmt</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">'{:&lt;{fw}s}' + '{:&gt;{cw}s}'</span> <span class="arithmetic-operator">*</span> <span class="identifier">len</span><span class="grouping">(</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">row_fmt</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">'{:&lt;{fw}s}' + '{:&gt;{cw}.3f}'</span> <span class="arithmetic-operator">*</span> <span class="identifier">len</span><span class="grouping">(</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="identifier">head_fmt</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="string-literal">'Metric'</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="punctuation">,</span>
                          <span class="identifier">cw</span><span class="arithmetic-assignment">=</span><span class="identifier">column_width</span><span class="punctuation">,</span> <span class="identifier">fw</span><span class="arithmetic-assignment">=</span><span class="identifier">first_width</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">metric</span><span class="punctuation">,</span> <span class="identifier">row</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">metrics</span><span class="punctuation">,</span> <span class="identifier">results</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="arithmetic-operator">-</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="identifier">row_fmt</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">metric</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="identifier">row</span><span class="punctuation">,</span>
                             <span class="identifier">cw</span><span class="arithmetic-assignment">=</span><span class="identifier">column_width</span><span class="punctuation">,</span> <span class="identifier">fw</span><span class="arithmetic-assignment">=</span><span class="identifier">first_width</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">_plot</span><span class="grouping">(</span><span class="identifier">results</span><span class="punctuation">,</span> <span class="identifier">metrics</span><span class="punctuation">,</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">title</span><span class="punctuation">,</span> <span class="identifier">x_ticks</span><span class="punctuation">,</span> <span class="identifier">x_label</span><span class="punctuation">,</span>
          <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">k</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="string-literal">'x', '|', 'o', '+'</span><span class="grouping">)</span><span class="punctuation">,</span>
          <span class="identifier">metric_colors</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="string-literal">'c', 'm', 'y', 'k', 'g', 'r', 'b'</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Plot the results by metric, format and some other variable given by
    x_label
    """</span>
    <span class="identifier">fig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="string-literal">'scikit-learn multilabel metrics benchmarks'</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="identifier">title</span><span class="grouping">)</span>
    <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">add_subplot</span><span class="grouping">(</span><span class="int-literal">111</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">metric</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">metrics</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">for</span> <span class="identifier">j</span><span class="punctuation">,</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">(</span><span class="identifier">x_ticks</span><span class="punctuation">,</span> <span class="identifier">results</span><span class="grouping">[</span><span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">j</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">flat</span><span class="punctuation">,</span>
                    <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'{}, {}'</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">metric</span><span class="punctuation">,</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">)</span><span class="punctuation">,</span>
                    <span class="identifier">marker</span><span class="arithmetic-assignment">=</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">k</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">s</span><span class="grouping">[</span><span class="identifier">j</span><span class="grouping">]</span><span class="punctuation">,</span>
                    <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="identifier">metric_colors</span><span class="grouping">[</span><span class="identifier">i</span> <span class="arithmetic-operator">%</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">metric_colors</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xlabel</span><span class="grouping">(</span><span class="identifier">x_label</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="string-literal">'Time (s)'</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="keyword">if</span> <span class="identifier">__name__</span> <span class="relational-operator">==</span> <span class="string-literal">"__main__"</span><span class="punctuation">:</span>
    <span class="identifier">ap</span> <span class="arithmetic-assignment">=</span> <span class="identifier">argparse</span><span class="punctuation">.</span><span class="identifier">ArgumentParser</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">ap</span><span class="punctuation">.</span><span class="identifier">add_argument</span><span class="grouping">(</span><span class="string-literal">'metrics', nargs='*'</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">METRICS</span><span class="grouping">)</span><span class="punctuation">,</span>
                    <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Specifies metrics to benchmark, defaults to all. '</span>
                         <span class="string-literal">'Choices are: {}'</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">METRICS</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">ap</span><span class="punctuation">.</span><span class="identifier">add_argument</span><span class="grouping">(</span><span class="string-literal">'--formats', nargs='+'</span><span class="punctuation">,</span> <span class="identifier">choices</span><span class="arithmetic-assignment">=</span><span class="identifier">sorted</span><span class="grouping">(</span><span class="invalid">F</span><span class="invalid">O</span><span class="invalid">R</span><span class="invalid">M</span><span class="invalid">A</span><span class="invalid">T</span><span class="invalid">S</span><span class="grouping">)</span><span class="punctuation">,</span>
                    <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Specifies multilabel formats to benchmark '</span>
                         <span class="string-literal">'(defaults to all).'</span><span class="grouping">)</span>
    <span class="identifier">ap</span><span class="punctuation">.</span><span class="identifier">add_argument</span><span class="grouping">(</span><span class="string-literal">'--samples'</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="int-literal">1000</span><span class="punctuation">,</span>
                    <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">'The number of samples to generate'</span><span class="grouping">)</span>
    <span class="identifier">ap</span><span class="punctuation">.</span><span class="identifier">add_argument</span><span class="grouping">(</span><span class="string-literal">'--classes'</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span>
                    <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">'The number of classes'</span><span class="grouping">)</span>
    <span class="identifier">ap</span><span class="punctuation">.</span><span class="identifier">add_argument</span><span class="grouping">(</span><span class="string-literal">'--density'</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">float</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="float-literal">.2</span><span class="punctuation">,</span>
                    <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">'The average density of labels per sample'</span><span class="grouping">)</span>
    <span class="identifier">ap</span><span class="punctuation">.</span><span class="identifier">add_argument</span><span class="grouping">(</span><span class="string-literal">'--plot', choices=['classes', 'density', 'samples'</span><span class="grouping">]</span><span class="punctuation">,</span>
                    <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span>
                    <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Plot time with respect to this parameter varying '</span>
                         <span class="string-literal">'up to the specified value'</span><span class="grouping">)</span>
    <span class="identifier">ap</span><span class="punctuation">.</span><span class="identifier">add_argument</span><span class="grouping">(</span><span class="string-literal">'--n-steps'</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="punctuation">,</span>
                    <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Plot this many points for each metric'</span><span class="grouping">)</span>
    <span class="identifier">ap</span><span class="punctuation">.</span><span class="identifier">add_argument</span><span class="grouping">(</span><span class="string-literal">'--n-times'</span><span class="punctuation">,</span>
                    <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="punctuation">,</span>
                    <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Time performance over n_times trials"</span><span class="grouping">)</span>
    <span class="identifier">args</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ap</span><span class="punctuation">.</span><span class="identifier">parse_args</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">plot</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">max_val</span> <span class="arithmetic-assignment">=</span> <span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">plot</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="string-literal">'classes', 'samples'</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">min_val</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">2</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">min_val</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
        <span class="identifier">steps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">linspace</span><span class="grouping">(</span><span class="identifier">min_val</span><span class="punctuation">,</span> <span class="identifier">max_val</span><span class="punctuation">,</span> <span class="identifier">num</span><span class="arithmetic-assignment">=</span><span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">n_steps</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="keyword">if</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">plot</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="string-literal">'classes', 'samples'</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">steps</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">unique</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">round</span><span class="grouping">(</span><span class="identifier">steps</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">setattr</span><span class="grouping">(</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="punctuation">,</span> <span class="identifier">steps</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">METRICS</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span> <span class="relational-operator">is</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">args</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="invalid">F</span><span class="invalid">O</span><span class="invalid">R</span><span class="invalid">M</span><span class="invalid">A</span><span class="invalid">T</span><span class="invalid">S</span><span class="grouping">)</span>

    <span class="identifier">results</span> <span class="arithmetic-assignment">=</span> <span class="identifier">benchmark</span><span class="grouping">(</span><span class="grouping">[</span><span class="identifier">METRICS</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">k</span> <span class="relational-operator">in</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">metrics</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="grouping">[</span><span class="invalid">F</span><span class="invalid">O</span><span class="invalid">R</span><span class="invalid">M</span><span class="invalid">A</span><span class="invalid">T</span><span class="invalid">S</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">k</span> <span class="relational-operator">in</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">]</span><span class="punctuation">,</span>
                        <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">samples</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">density</span><span class="punctuation">,</span>
                        <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">n_times</span><span class="grouping">)</span>

    <span class="identifier">_tabulate</span><span class="grouping">(</span><span class="identifier">results</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">metrics</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">plot</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'Displaying plot'</span><span class="punctuation">,</span> <span class="identifier">file</span><span class="arithmetic-assignment">=</span><span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">stderr</span><span class="grouping">)</span>
        <span class="identifier">title</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">'Multilabel metrics with %s'</span> <span class="arithmetic-operator">%</span>
                 <span class="string-literal">', '.join('{0}={1}'</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">field</span><span class="punctuation">,</span> <span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">args</span><span class="punctuation">,</span> <span class="identifier">field</span><span class="grouping">)</span><span class="grouping">)</span>
                           <span class="keyword">for</span> <span class="identifier">field</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">'samples', 'classes', 'density'</span><span class="grouping">]</span>
                           <span class="keyword">if</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">plot</span> <span class="relational-operator">!=</span> <span class="identifier">field</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">_plot</span><span class="grouping">(</span><span class="identifier">results</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">metrics</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">s</span><span class="punctuation">,</span> <span class="identifier">title</span><span class="punctuation">,</span> <span class="identifier">steps</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="punctuation">.</span><span class="identifier">plot</span><span class="grouping">)</span>

    </pre>
  </body>
</html>