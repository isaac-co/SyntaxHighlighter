<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
=====================================
SGDOneClassSVM benchmark
=====================================
This benchmark compares the :class:`SGDOneClassSVM` with :class:`OneClassSVM`.
The former is an online One-Class SVM implemented with a Stochastic Gradient
Descent (SGD). The latter is based on the LibSVM implementation. The
complexity of :class:`SGDOneClassSVM` is linear in the number of samples
whereas the one of :class:`OneClassSVM` is at best quadratic in the number of
samples. We here compare the performance in terms of AUC and training time on
classical anomaly detection datasets.

The :class:`OneClassSVM` is applied with a Gaussian kernel and we therefore
use a kernel approximation prior to the application of :class:`SGDOneClassSVM`.
"""</span>

<span class="keyword">from</span> <span class="identifier">time</span> <span class="keyword">import</span> <span class="identifier">time</span>
<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>

<span class="keyword">from</span> <span class="identifier">scipy</span><span class="punctuation">.</span><span class="identifier">interpolate</span> <span class="keyword">import</span> <span class="identifier">interp1d</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">metrics</span> <span class="keyword">import</span> <span class="identifier">roc_curve</span><span class="punctuation">,</span> <span class="identifier">auc</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">fetch_kddcup99</span><span class="punctuation">,</span> <span class="identifier">fetch_covtype</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">LabelBinarizer</span><span class="punctuation">,</span> <span class="identifier">StandardScaler</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">pipeline</span> <span class="keyword">import</span> <span class="identifier">make_pipeline</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span> <span class="keyword">import</span> <span class="identifier">shuffle</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">kernel_approximation</span> <span class="keyword">import</span> <span class="identifier">Nystroem</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">svm</span> <span class="keyword">import</span> <span class="identifier">OneClassSVM</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">SGDOneClassSVM</span>

<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span>

<span class="identifier">font</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="string-literal">'weight': 'normal'</span><span class="punctuation">,</span>
        <span class="string-literal">'size'</span><span class="punctuation">:</span> <span class="int-literal">15</span><span class="grouping">}</span>

<span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">rc</span><span class="grouping">(</span><span class="string-literal">'font'</span><span class="punctuation">,</span> <span class="arithmetic-operator">**</span><span class="identifier">font</span><span class="grouping">)</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">__doc__</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">print_outlier_ratio</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""
    Helper function to show the distinct value count of element in the target.
    Useful indicator for the datasets used in bench_isolation_forest.py.
    """</span>
    <span class="identifier">uniq</span><span class="punctuation">,</span> <span class="identifier">cnt</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">unique</span><span class="grouping">(</span><span class="identifier">y</span><span class="punctuation">,</span> <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">c</span><span class="invalid">o</span><span class="invalid">u</span><span class="invalid">n</span><span class="invalid">t</span><span class="invalid">s</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"----- Target count values: "</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">u</span><span class="punctuation">,</span> <span class="identifier">c</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">uniq</span><span class="punctuation">,</span> <span class="identifier">cnt</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"------ %s -&gt; %d occurrences"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">str</span><span class="grouping">(</span><span class="identifier">u</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"----- Outlier ratio: %.5f"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="identifier">cnt</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="comment"># for roc curve computation</span>
<span class="identifier">n_axis</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1000</span>
<span class="identifier">x_axis</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">linspace</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">n_axis</span><span class="grouping">)</span>

<span class="identifier">datasets</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="string-literal">'http', 'smtp', 'SA', 'SF', 'forestcover'</span><span class="grouping">]</span>

<span class="identifier">novelty_detection</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>  <span class="comment"># if False, training set polluted by outliers</span>

<span class="identifier">random_states</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">42</span><span class="grouping">]</span>
<span class="identifier">nu</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.05</span>

<span class="identifier">results_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">empty</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">datasets</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">n_axis</span> <span class="arithmetic-operator">+</span> <span class="int-literal">5</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">results_online</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">empty</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">datasets</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">n_axis</span> <span class="arithmetic-operator">+</span> <span class="int-literal">5</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="keyword">for</span> <span class="identifier">dat</span><span class="punctuation">,</span> <span class="identifier">dataset_name</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">datasets</span><span class="grouping">)</span><span class="punctuation">:</span>

    <span class="identifier">print</span><span class="grouping">(</span><span class="identifier">dataset_name</span><span class="grouping">)</span>

    <span class="comment"># Loading datasets</span>
    <span class="keyword">if</span> <span class="identifier">dataset_name</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">'http', 'smtp', 'SA', 'SF'</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">dataset</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fetch_kddcup99</span><span class="grouping">(</span><span class="identifier">subset</span><span class="arithmetic-assignment">=</span><span class="identifier">dataset_name</span><span class="punctuation">,</span> <span class="identifier">shuffle</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                                 <span class="identifier">percent10</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">88</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">data</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">target</span>

    <span class="keyword">if</span> <span class="identifier">dataset_name</span> <span class="relational-operator">==</span> <span class="string-literal">'forestcover'</span><span class="punctuation">:</span>
        <span class="identifier">dataset</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fetch_covtype</span><span class="grouping">(</span><span class="identifier">shuffle</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">data</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">target</span>
        <span class="comment"># normal data are those with attribute 2</span>
        <span class="comment"># abnormal those with attribute 4</span>
        <span class="identifier">s</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">y</span> <span class="relational-operator">==</span> <span class="int-literal">2</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="grouping">(</span><span class="identifier">y</span> <span class="relational-operator">==</span> <span class="int-literal">4</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="grouping">[</span><span class="identifier">s</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">y</span><span class="grouping">[</span><span class="identifier">s</span><span class="grouping">]</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">y</span> <span class="relational-operator">!=</span> <span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span>

    <span class="comment"># Vectorizing data</span>
    <span class="keyword">if</span> <span class="identifier">dataset_name</span> <span class="relational-operator">==</span> <span class="string-literal">'SF'</span><span class="punctuation">:</span>
        <span class="comment"># Casting type of X (object) as string is needed for string categorical</span>
        <span class="comment"># features to apply LabelBinarizer</span>
        <span class="identifier">lb</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LabelBinarizer</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">x1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">lb</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">c_</span><span class="grouping">[</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">x1</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="punctuation">:</span><span class="grouping">]</span><span class="grouping">]</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">y</span> <span class="relational-operator">!=</span> <span class="identifier">b</span><span class="string-literal">'normal.'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">dataset_name</span> <span class="relational-operator">==</span> <span class="string-literal">'SA'</span><span class="punctuation">:</span>
        <span class="identifier">lb</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LabelBinarizer</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="comment"># Casting type of X (object) as string is needed for string categorical</span>
        <span class="comment"># features to apply LabelBinarizer</span>
        <span class="identifier">x1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">lb</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">x2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">lb</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">x3</span> <span class="arithmetic-assignment">=</span> <span class="identifier">lb</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">str</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">c_</span><span class="grouping">[</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="punctuation">:</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">x1</span><span class="punctuation">,</span> <span class="identifier">x2</span><span class="punctuation">,</span> <span class="identifier">x3</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="punctuation">:</span><span class="grouping">]</span><span class="grouping">]</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">y</span> <span class="relational-operator">!=</span> <span class="identifier">b</span><span class="string-literal">'normal.'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">dataset_name</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">'http', 'smtp'</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">y</span> <span class="relational-operator">!=</span> <span class="identifier">b</span><span class="string-literal">'normal.'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">)</span>

    <span class="identifier">print_outlier_ratio</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span>

    <span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">n_features</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">dataset_name</span> <span class="relational-operator">==</span> <span class="string-literal">'SA'</span><span class="punctuation">:</span>  <span class="comment"># LibSVM too long with n_samples // 2</span>
        <span class="identifier">n_samples_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">n_samples</span> <span class="arithmetic-operator">//</span> <span class="int-literal">20</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="identifier">n_samples_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">n_samples</span> <span class="arithmetic-operator">//</span> <span class="int-literal">2</span>

    <span class="identifier">n_samples_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">n_samples</span> <span class="arithmetic-operator">-</span> <span class="identifier">n_samples_train</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'n_train: '</span><span class="punctuation">,</span> <span class="identifier">n_samples_train</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'n_features: '</span><span class="punctuation">,</span> <span class="identifier">n_features</span><span class="grouping">)</span>

    <span class="identifier">tpr_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">n_axis</span><span class="grouping">)</span>
    <span class="identifier">tpr_online</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="identifier">n_axis</span><span class="grouping">)</span>
    <span class="identifier">fit_time_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
    <span class="identifier">fit_time_online</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
    <span class="identifier">predict_time_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
    <span class="identifier">predict_time_online</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>

    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">t</span><span class="invalid">y</span><span class="invalid">p</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">float</span><span class="grouping">)</span>

    <span class="identifier">gamma</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span> <span class="arithmetic-operator">/</span> <span class="identifier">n_features</span>  <span class="comment"># OCSVM default parameter</span>

    <span class="keyword">for</span> <span class="identifier">random_state</span> <span class="relational-operator">in</span> <span class="identifier">random_states</span><span class="punctuation">:</span>

        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'random state: %s'</span> <span class="arithmetic-operator">%</span> <span class="identifier">random_state</span><span class="grouping">)</span>

        <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">shuffle</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="grouping">)</span>
        <span class="identifier">X_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">n_samples_train</span><span class="grouping">]</span>
        <span class="identifier">X_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="grouping">[</span><span class="identifier">n_samples_train</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="identifier">y_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">y</span><span class="grouping">[</span><span class="punctuation">:</span><span class="identifier">n_samples_train</span><span class="grouping">]</span>
        <span class="identifier">y_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">y</span><span class="grouping">[</span><span class="identifier">n_samples_train</span><span class="punctuation">:</span><span class="grouping">]</span>

        <span class="keyword">if</span> <span class="identifier">novelty_detection</span><span class="punctuation">:</span>
            <span class="identifier">X_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X_train</span><span class="grouping">[</span><span class="identifier">y_train</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="grouping">]</span>
            <span class="identifier">y_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">y_train</span><span class="grouping">[</span><span class="identifier">y_train</span> <span class="relational-operator">==</span> <span class="int-literal">0</span><span class="grouping">]</span>

        <span class="identifier">std</span> <span class="arithmetic-assignment">=</span> <span class="identifier">StandardScaler</span><span class="grouping">(</span><span class="grouping">)</span>

        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'----------- LibSVM OCSVM ------------'</span><span class="grouping">)</span>
        <span class="identifier">ocsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OneClassSVM</span><span class="grouping">(</span><span class="identifier">kernel</span><span class="arithmetic-assignment">=</span><span class="string-literal">'rbf'</span><span class="punctuation">,</span> <span class="identifier">gamma</span><span class="arithmetic-assignment">=</span><span class="identifier">gamma</span><span class="punctuation">,</span> <span class="identifier">nu</span><span class="arithmetic-assignment">=</span><span class="identifier">nu</span><span class="grouping">)</span>
        <span class="identifier">pipe_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span><span class="identifier">std</span><span class="punctuation">,</span> <span class="identifier">ocsvm</span><span class="grouping">)</span>

        <span class="identifier">tstart</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">pipe_libsvm</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_train</span><span class="grouping">)</span>
        <span class="identifier">fit_time_libsvm</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">tstart</span>

        <span class="identifier">tstart</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="comment"># scoring such that the lower, the more normal</span>
        <span class="identifier">scoring</span> <span class="arithmetic-assignment">=</span> <span class="arithmetic-operator">-</span><span class="identifier">pipe_libsvm</span><span class="punctuation">.</span><span class="identifier">decision_function</span><span class="grouping">(</span><span class="identifier">X_test</span><span class="grouping">)</span>
        <span class="identifier">predict_time_libsvm</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">tstart</span>
        <span class="identifier">fpr_libsvm_</span><span class="punctuation">,</span> <span class="identifier">tpr_libsvm_</span><span class="punctuation">,</span> <span class="identifier">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">roc_curve</span><span class="grouping">(</span><span class="identifier">y_test</span><span class="punctuation">,</span> <span class="identifier">scoring</span><span class="grouping">)</span>

        <span class="identifier">f_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">interp1d</span><span class="grouping">(</span><span class="identifier">fpr_libsvm_</span><span class="punctuation">,</span> <span class="identifier">tpr_libsvm_</span><span class="grouping">)</span>
        <span class="identifier">tpr_libsvm</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">f_libsvm</span><span class="grouping">(</span><span class="identifier">x_axis</span><span class="grouping">)</span>

        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'----------- Online OCSVM ------------'</span><span class="grouping">)</span>
        <span class="identifier">nystroem</span> <span class="arithmetic-assignment">=</span> <span class="identifier">Nystroem</span><span class="grouping">(</span><span class="identifier">gamma</span><span class="arithmetic-assignment">=</span><span class="identifier">gamma</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="grouping">)</span>
        <span class="identifier">online_ocsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">SGDOneClassSVM</span><span class="grouping">(</span><span class="identifier">nu</span><span class="arithmetic-assignment">=</span><span class="identifier">nu</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="identifier">random_state</span><span class="grouping">)</span>
        <span class="identifier">pipe_online</span> <span class="arithmetic-assignment">=</span> <span class="identifier">make_pipeline</span><span class="grouping">(</span><span class="identifier">std</span><span class="punctuation">,</span> <span class="identifier">nystroem</span><span class="punctuation">,</span> <span class="identifier">online_ocsvm</span><span class="grouping">)</span>

        <span class="identifier">tstart</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">pipe_online</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_train</span><span class="grouping">)</span>
        <span class="identifier">fit_time_online</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">tstart</span>

        <span class="identifier">tstart</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="comment"># scoring such that the lower, the more normal</span>
        <span class="identifier">scoring</span> <span class="arithmetic-assignment">=</span> <span class="arithmetic-operator">-</span><span class="identifier">pipe_online</span><span class="punctuation">.</span><span class="identifier">decision_function</span><span class="grouping">(</span><span class="identifier">X_test</span><span class="grouping">)</span>
        <span class="identifier">predict_time_online</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">tstart</span>
        <span class="identifier">fpr_online_</span><span class="punctuation">,</span> <span class="identifier">tpr_online_</span><span class="punctuation">,</span> <span class="identifier">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">roc_curve</span><span class="grouping">(</span><span class="identifier">y_test</span><span class="punctuation">,</span> <span class="identifier">scoring</span><span class="grouping">)</span>

        <span class="identifier">f_online</span> <span class="arithmetic-assignment">=</span> <span class="identifier">interp1d</span><span class="grouping">(</span><span class="identifier">fpr_online_</span><span class="punctuation">,</span> <span class="identifier">tpr_online_</span><span class="grouping">)</span>
        <span class="identifier">tpr_online</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">f_online</span><span class="grouping">(</span><span class="identifier">x_axis</span><span class="grouping">)</span>

    <span class="identifier">tpr_libsvm</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">random_states</span><span class="grouping">)</span>
    <span class="identifier">tpr_libsvm</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span><span class="punctuation">.</span>
    <span class="identifier">fit_time_libsvm</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">random_states</span><span class="grouping">)</span>
    <span class="identifier">predict_time_libsvm</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">random_states</span><span class="grouping">)</span>
    <span class="identifier">auc_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">auc</span><span class="grouping">(</span><span class="identifier">x_axis</span><span class="punctuation">,</span> <span class="identifier">tpr_libsvm</span><span class="grouping">)</span>

    <span class="identifier">results_libsvm</span><span class="grouping">[</span><span class="identifier">dat</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">[</span><span class="identifier">fit_time_libsvm</span><span class="punctuation">,</span> <span class="identifier">predict_time_libsvm</span><span class="punctuation">,</span>
                            <span class="identifier">auc_libsvm</span><span class="punctuation">,</span> <span class="identifier">n_samples_train</span><span class="punctuation">,</span>
                            <span class="identifier">n_features</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">tpr_libsvm</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="identifier">tpr_online</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">random_states</span><span class="grouping">)</span>
    <span class="identifier">tpr_online</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span><span class="punctuation">.</span>
    <span class="identifier">fit_time_online</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">random_states</span><span class="grouping">)</span>
    <span class="identifier">predict_time_online</span> <span class="arithmetic-assignment">/=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">random_states</span><span class="grouping">)</span>
    <span class="identifier">auc_online</span> <span class="arithmetic-assignment">=</span> <span class="identifier">auc</span><span class="grouping">(</span><span class="identifier">x_axis</span><span class="punctuation">,</span> <span class="identifier">tpr_online</span><span class="grouping">)</span>

    <span class="identifier">results_online</span><span class="grouping">[</span><span class="identifier">dat</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">[</span><span class="identifier">fit_time_online</span><span class="punctuation">,</span> <span class="identifier">predict_time_online</span><span class="punctuation">,</span>
                            <span class="identifier">auc_online</span><span class="punctuation">,</span> <span class="identifier">n_samples_train</span><span class="punctuation">,</span>
                            <span class="identifier">n_features</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="identifier">list</span><span class="grouping">(</span><span class="identifier">tpr_libsvm</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="comment"># -------- Plotting bar charts -------------</span>
<span class="identifier">fit_time_libsvm_all</span> <span class="arithmetic-assignment">=</span> <span class="identifier">results_libsvm</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span>
<span class="identifier">predict_time_libsvm_all</span> <span class="arithmetic-assignment">=</span> <span class="identifier">results_libsvm</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>
<span class="identifier">auc_libsvm_all</span> <span class="arithmetic-assignment">=</span> <span class="identifier">results_libsvm</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span>
<span class="identifier">n_train_all</span> <span class="arithmetic-assignment">=</span> <span class="identifier">results_libsvm</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">]</span>
<span class="identifier">n_features_all</span> <span class="arithmetic-assignment">=</span> <span class="identifier">results_libsvm</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">4</span><span class="grouping">]</span>

<span class="identifier">fit_time_online_all</span> <span class="arithmetic-assignment">=</span> <span class="identifier">results_online</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span>
<span class="identifier">predict_time_online_all</span> <span class="arithmetic-assignment">=</span> <span class="identifier">results_online</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>
<span class="identifier">auc_online_all</span> <span class="arithmetic-assignment">=</span> <span class="identifier">results_online</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">2</span><span class="grouping">]</span>


<span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.7</span>
<span class="identifier">ind</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">2</span> <span class="arithmetic-operator">*</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">datasets</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">x_tickslabels</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">(</span><span class="identifier">name</span> <span class="arithmetic-operator">+</span> <span class="string-literal">'\n' + r'$n={:,d}$' + '\n' + r'$d={:d}$'</span><span class="grouping">)</span>
                 <span class="punctuation">.</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">int</span><span class="grouping">(</span><span class="identifier">n</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">int</span><span class="grouping">(</span><span class="identifier">d</span><span class="grouping">)</span><span class="grouping">)</span>
                 <span class="keyword">for</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">n</span><span class="punctuation">,</span> <span class="identifier">d</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">datasets</span><span class="punctuation">,</span> <span class="identifier">n_train_all</span><span class="punctuation">,</span> <span class="identifier">n_features_all</span><span class="grouping">)</span><span class="grouping">]</span>


<span class="keyword">def</span> <span class="identifier">autolabel_auc</span><span class="grouping">(</span><span class="identifier">rects</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Attach a text label above each bar displaying its height."""</span>
    <span class="keyword">for</span> <span class="identifier">rect</span> <span class="relational-operator">in</span> <span class="identifier">rects</span><span class="punctuation">:</span>
        <span class="identifier">height</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rect</span><span class="punctuation">.</span><span class="identifier">get_height</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">text</span><span class="grouping">(</span><span class="identifier">rect</span><span class="punctuation">.</span><span class="identifier">get_x</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">rect</span><span class="punctuation">.</span><span class="identifier">get_width</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span><span class="punctuation">.</span><span class="punctuation">,</span> <span class="float-literal">1.05</span> <span class="arithmetic-operator">*</span> <span class="identifier">height</span><span class="punctuation">,</span>
                <span class="string-literal">'%.3f' % height, ha='center', va='bottom'</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">autolabel_time</span><span class="grouping">(</span><span class="identifier">rects</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Attach a text label above each bar displaying its height."""</span>
    <span class="keyword">for</span> <span class="identifier">rect</span> <span class="relational-operator">in</span> <span class="identifier">rects</span><span class="punctuation">:</span>
        <span class="identifier">height</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rect</span><span class="punctuation">.</span><span class="identifier">get_height</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">text</span><span class="grouping">(</span><span class="identifier">rect</span><span class="punctuation">.</span><span class="identifier">get_x</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">rect</span><span class="punctuation">.</span><span class="identifier">get_width</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span><span class="punctuation">.</span><span class="punctuation">,</span> <span class="float-literal">1.05</span> <span class="arithmetic-operator">*</span> <span class="identifier">height</span><span class="punctuation">,</span>
                <span class="string-literal">'%.1f' % height, ha='center', va='bottom'</span><span class="grouping">)</span>


<span class="identifier">fig</span><span class="punctuation">,</span> <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplots</span><span class="grouping">(</span><span class="identifier">figsize</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="string-literal">'AUC'</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_ylim</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="float-literal">1.3</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">rect_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span><span class="punctuation">,</span> <span class="identifier">auc_libsvm_all</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'r'</span><span class="grouping">)</span>
<span class="identifier">rect_online</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">auc_online_all</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'y'</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">rect_libsvm</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">rect_online</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="string-literal">'LibSVM', 'Online SVM'</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xticks</span><span class="grouping">(</span><span class="identifier">ind</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xticklabels</span><span class="grouping">(</span><span class="identifier">x_tickslabels</span><span class="grouping">)</span>
<span class="identifier">autolabel_auc</span><span class="grouping">(</span><span class="identifier">rect_libsvm</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="grouping">)</span>
<span class="identifier">autolabel_auc</span><span class="grouping">(</span><span class="identifier">rect_online</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="identifier">fig</span><span class="punctuation">,</span> <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplots</span><span class="grouping">(</span><span class="identifier">figsize</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="string-literal">'Training time (sec) - Log scale'</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_yscale</span><span class="grouping">(</span><span class="string-literal">'log'</span><span class="grouping">)</span>
<span class="identifier">rect_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span><span class="punctuation">,</span> <span class="identifier">fit_time_libsvm_all</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'r'</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="identifier">width</span><span class="grouping">)</span>
<span class="identifier">rect_online</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">fit_time_online_all</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'y'</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="identifier">width</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">rect_libsvm</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">rect_online</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="string-literal">'LibSVM', 'Online SVM'</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xticks</span><span class="grouping">(</span><span class="identifier">ind</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xticklabels</span><span class="grouping">(</span><span class="identifier">x_tickslabels</span><span class="grouping">)</span>
<span class="identifier">autolabel_time</span><span class="grouping">(</span><span class="identifier">rect_libsvm</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="grouping">)</span>
<span class="identifier">autolabel_time</span><span class="grouping">(</span><span class="identifier">rect_online</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="identifier">fig</span><span class="punctuation">,</span> <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplots</span><span class="grouping">(</span><span class="identifier">figsize</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">15</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="string-literal">'Testing time (sec) - Log scale'</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_yscale</span><span class="grouping">(</span><span class="string-literal">'log'</span><span class="grouping">)</span>
<span class="identifier">rect_libsvm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span><span class="punctuation">,</span> <span class="identifier">predict_time_libsvm_all</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'r'</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="identifier">width</span><span class="grouping">)</span>
<span class="identifier">rect_online</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">bar</span><span class="grouping">(</span><span class="identifier">ind</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">predict_time_online_all</span><span class="punctuation">,</span>
                     <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'y'</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="identifier">width</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">rect_libsvm</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">rect_online</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="string-literal">'LibSVM', 'Online SVM'</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xticks</span><span class="grouping">(</span><span class="identifier">ind</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span> <span class="arithmetic-operator">/</span> <span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xticklabels</span><span class="grouping">(</span><span class="identifier">x_tickslabels</span><span class="grouping">)</span>
<span class="identifier">autolabel_time</span><span class="grouping">(</span><span class="identifier">rect_libsvm</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="grouping">)</span>
<span class="identifier">autolabel_time</span><span class="grouping">(</span><span class="identifier">rect_online</span><span class="punctuation">,</span> <span class="identifier">ax</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>