<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
=============================================================================
Manifold learning on handwritten digits: Locally Linear Embedding, Isomap...
=============================================================================

An illustration of various embeddings on the digits dataset.

The RandomTreesEmbedding, from the :mod:`sklearn.ensemble` module, is not
technically a manifold embedding method, as it learn a high-dimensional
representation on which we apply a dimensionality reduction method.
However, it is often useful to cast a dataset into a representation in
which the classes are linearly-separable.

t-SNE will be initialized with the embedding that is generated by PCA in
this example, which is not the default setting. It ensures global stability
of the embedding, i.e., the embedding does not depend on random
initialization.

Linear Discriminant Analysis, from the :mod:`sklearn.discriminant_analysis`
module, and Neighborhood Components Analysis, from the :mod:`sklearn.neighbors`
module, are supervised dimensionality reduction method, i.e. they make use of
the provided labels, contrary to other methods.
"""</span>

<span class="comment"># Authors: Fabian Pedregosa &lt;fabian.pedregosa@inria.fr&gt;</span>
<span class="comment">#          Olivier Grisel &lt;olivier.grisel@ensta.org&gt;</span>
<span class="comment">#          Mathieu Blondel &lt;mathieu@mblondel.org&gt;</span>
<span class="comment">#          Gael Varoquaux</span>
<span class="comment"># License: BSD 3 clause (C) INRIA 2011</span>

<span class="keyword">from</span> <span class="identifier">time</span> <span class="keyword">import</span> <span class="identifier">time</span>
<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
<span class="keyword">from</span> <span class="identifier">matplotlib</span> <span class="keyword">import</span> <span class="identifier">offsetbox</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span> <span class="keyword">import</span> <span class="grouping">(</span><span class="identifier">manifold</span><span class="punctuation">,</span> <span class="identifier">datasets</span><span class="punctuation">,</span> <span class="identifier">decomposition</span><span class="punctuation">,</span> <span class="identifier">ensemble</span><span class="punctuation">,</span>
                     <span class="identifier">discriminant_analysis</span><span class="punctuation">,</span> <span class="identifier">random_projection</span><span class="punctuation">,</span> <span class="identifier">neighbors</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">__doc__</span><span class="grouping">)</span>

<span class="identifier">digits</span> <span class="arithmetic-assignment">=</span> <span class="identifier">datasets</span><span class="punctuation">.</span><span class="identifier">load_digits</span><span class="grouping">(</span><span class="identifier">n_class</span><span class="arithmetic-assignment">=</span><span class="int-literal">6</span><span class="grouping">)</span>
<span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">digits</span><span class="punctuation">.</span><span class="identifier">data</span>
<span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">digits</span><span class="punctuation">.</span><span class="identifier">target</span>
<span class="identifier">n_samples</span><span class="punctuation">,</span> <span class="identifier">n_features</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span>
<span class="identifier">n_neighbors</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">30</span>


<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Scale and visualize the embedding vectors</span>
<span class="keyword">def</span> <span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">title</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">x_min</span><span class="punctuation">,</span> <span class="identifier">x_max</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">)</span>
    <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">X</span> <span class="arithmetic-operator">-</span> <span class="identifier">x_min</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="grouping">(</span><span class="identifier">x_max</span> <span class="arithmetic-operator">-</span> <span class="identifier">x_min</span><span class="grouping">)</span>

    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">ax</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplot</span><span class="grouping">(</span><span class="int-literal">111</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">text</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="identifier">i</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">[</span><span class="identifier">i</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span>
                 <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">cm</span><span class="punctuation">.</span><span class="identifier">Set1</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-operator">/</span> <span class="int-literal">10</span><span class="punctuation">.</span><span class="grouping">)</span><span class="punctuation">,</span>
                 <span class="identifier">fontdict</span><span class="arithmetic-assignment">=</span><span class="grouping">{</span><span class="string-literal">'weight': 'bold', 'size'</span><span class="punctuation">:</span> <span class="int-literal">9</span><span class="grouping">}</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">offsetbox</span><span class="punctuation">,</span> <span class="string-literal">'AnnotationBbox'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># only print thumbnails with matplotlib &gt; 1.0</span>
        <span class="identifier">shown_images</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">.</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="punctuation">.</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">)</span>  <span class="comment"># just something big</span>
        <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">dist</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">sum</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="arithmetic-operator">-</span> <span class="identifier">shown_images</span><span class="grouping">)</span> <span class="arithmetic-operator">**</span> <span class="int-literal">2</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="identifier">dist</span><span class="grouping">)</span> <span class="relational-operator">&lt;</span> <span class="float-literal">4e-3</span><span class="punctuation">:</span>
                <span class="comment"># don't show points that are too close</span>
                <span class="keyword">continue</span>
            <span class="identifier">shown_images</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">r_</span><span class="grouping">[</span><span class="identifier">shown_images</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="identifier">X</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="grouping">]</span><span class="grouping">]</span>
            <span class="identifier">imagebox</span> <span class="arithmetic-assignment">=</span> <span class="identifier">offsetbox</span><span class="punctuation">.</span><span class="identifier">AnnotationBbox</span><span class="grouping">(</span>
                <span class="identifier">offsetbox</span><span class="punctuation">.</span><span class="identifier">OffsetImage</span><span class="grouping">(</span><span class="identifier">digits</span><span class="punctuation">.</span><span class="identifier">images</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">cmap</span><span class="arithmetic-assignment">=</span><span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">cm</span><span class="punctuation">.</span><span class="identifier">gray_r</span><span class="grouping">)</span><span class="punctuation">,</span>
                <span class="identifier">X</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="grouping">)</span>
            <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">add_artist</span><span class="grouping">(</span><span class="identifier">imagebox</span><span class="grouping">)</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">xticks</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">yticks</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">title</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
        <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="identifier">title</span><span class="grouping">)</span>


<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Plot images of the digits</span>
<span class="identifier">n_img_per_row</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">20</span>
<span class="identifier">img</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">zeros</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">10</span> <span class="arithmetic-operator">*</span> <span class="identifier">n_img_per_row</span><span class="punctuation">,</span> <span class="int-literal">10</span> <span class="arithmetic-operator">*</span> <span class="identifier">n_img_per_row</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">n_img_per_row</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">ix</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">10</span> <span class="arithmetic-operator">*</span> <span class="identifier">i</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span>
    <span class="keyword">for</span> <span class="identifier">j</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="identifier">n_img_per_row</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">iy</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">10</span> <span class="arithmetic-operator">*</span> <span class="identifier">j</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span>
        <span class="identifier">img</span><span class="grouping">[</span><span class="identifier">ix</span><span class="punctuation">:</span><span class="identifier">ix</span> <span class="arithmetic-operator">+</span> <span class="int-literal">8</span><span class="punctuation">,</span> <span class="identifier">iy</span><span class="punctuation">:</span><span class="identifier">iy</span> <span class="arithmetic-operator">+</span> <span class="int-literal">8</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="grouping">[</span><span class="identifier">i</span> <span class="arithmetic-operator">*</span> <span class="identifier">n_img_per_row</span> <span class="arithmetic-operator">+</span> <span class="identifier">j</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">reshape</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">8</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">imshow</span><span class="grouping">(</span><span class="identifier">img</span><span class="punctuation">,</span> <span class="identifier">cmap</span><span class="arithmetic-assignment">=</span><span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">cm</span><span class="punctuation">.</span><span class="identifier">binary</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">xticks</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">yticks</span><span class="grouping">(</span><span class="grouping">[</span><span class="grouping">]</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="string-literal">'A selection from the 64-dimensional digits dataset'</span><span class="grouping">)</span>


<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Random 2D projection using a random unitary matrix</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing random projection"</span><span class="grouping">)</span>
<span class="identifier">rp</span> <span class="arithmetic-assignment">=</span> <span class="identifier">random_projection</span><span class="punctuation">.</span><span class="identifier">SparseRandomProjection</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span><span class="grouping">)</span>
<span class="identifier">X_projected</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rp</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_projected</span><span class="punctuation">,</span> <span class="string-literal">"Random Projection of the digits"</span><span class="grouping">)</span>


<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Projection on to the first 2 principal components</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing PCA projection"</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_pca</span> <span class="arithmetic-assignment">=</span> <span class="identifier">decomposition</span><span class="punctuation">.</span><span class="identifier">TruncatedSVD</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_pca</span><span class="punctuation">,</span>
               <span class="string-literal">"Principal Components projection of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Projection on to the first 2 linear discriminant components</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing Linear Discriminant Analysis projection"</span><span class="grouping">)</span>
<span class="identifier">X2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">copy</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X2</span><span class="punctuation">.</span><span class="identifier">flat</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="identifier">X</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="grouping">]</span> <span class="arithmetic-assignment">+=</span> <span class="float-literal">0.01</span>  <span class="comment"># Make X invertible</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_lda</span> <span class="arithmetic-assignment">=</span> <span class="identifier">discriminant_analysis</span><span class="punctuation">.</span><span class="identifier">LinearDiscriminantAnalysis</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span>
                                                         <span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X2</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>
<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_lda</span><span class="punctuation">,</span>
               <span class="string-literal">"Linear Discriminant projection of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Isomap projection of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing Isomap projection"</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_iso</span> <span class="arithmetic-assignment">=</span> <span class="identifier">manifold</span><span class="punctuation">.</span><span class="identifier">Isomap</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="identifier">n_neighbors</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span>
                        <span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Done."</span><span class="grouping">)</span>
<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_iso</span><span class="punctuation">,</span>
               <span class="string-literal">"Isomap projection of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Locally linear embedding of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing LLE embedding"</span><span class="grouping">)</span>
<span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">manifold</span><span class="punctuation">.</span><span class="identifier">LocallyLinearEmbedding</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="identifier">n_neighbors</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                      <span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'standard'</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_lle</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Done. Reconstruction error: %g"</span> <span class="arithmetic-operator">%</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">reconstruction_error_</span><span class="grouping">)</span>
<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_lle</span><span class="punctuation">,</span>
               <span class="string-literal">"Locally Linear Embedding of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Modified Locally linear embedding of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing modified LLE embedding"</span><span class="grouping">)</span>
<span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">manifold</span><span class="punctuation">.</span><span class="identifier">LocallyLinearEmbedding</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="identifier">n_neighbors</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                      <span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'modified'</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_mlle</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Done. Reconstruction error: %g"</span> <span class="arithmetic-operator">%</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">reconstruction_error_</span><span class="grouping">)</span>
<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_mlle</span><span class="punctuation">,</span>
               <span class="string-literal">"Modified Locally Linear Embedding of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># HLLE embedding of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing Hessian LLE embedding"</span><span class="grouping">)</span>
<span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">manifold</span><span class="punctuation">.</span><span class="identifier">LocallyLinearEmbedding</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="identifier">n_neighbors</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                      <span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'hessian'</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_hlle</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Done. Reconstruction error: %g"</span> <span class="arithmetic-operator">%</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">reconstruction_error_</span><span class="grouping">)</span>
<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_hlle</span><span class="punctuation">,</span>
               <span class="string-literal">"Hessian Locally Linear Embedding of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># LTSA embedding of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing LTSA embedding"</span><span class="grouping">)</span>
<span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">manifold</span><span class="punctuation">.</span><span class="identifier">LocallyLinearEmbedding</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="identifier">n_neighbors</span><span class="punctuation">,</span> <span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span>
                                      <span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'ltsa'</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_ltsa</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Done. Reconstruction error: %g"</span> <span class="arithmetic-operator">%</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">reconstruction_error_</span><span class="grouping">)</span>
<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_ltsa</span><span class="punctuation">,</span>
               <span class="string-literal">"Local Tangent Space Alignment of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># MDS  embedding of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing MDS embedding"</span><span class="grouping">)</span>
<span class="identifier">clf</span> <span class="arithmetic-assignment">=</span> <span class="identifier">manifold</span><span class="punctuation">.</span><span class="identifier">MDS</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">n_init</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">max_iter</span><span class="arithmetic-assignment">=</span><span class="int-literal">100</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_mds</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Done. Stress: %f"</span> <span class="arithmetic-operator">%</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">stress_</span><span class="grouping">)</span>
<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_mds</span><span class="punctuation">,</span>
               <span class="string-literal">"MDS embedding of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Random Trees embedding of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing Totally Random Trees embedding"</span><span class="grouping">)</span>
<span class="identifier">hasher</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ensemble</span><span class="punctuation">.</span><span class="identifier">RandomTreesEmbedding</span><span class="grouping">(</span><span class="identifier">n_estimators</span><span class="arithmetic-assignment">=</span><span class="int-literal">200</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span>
                                       <span class="identifier">max_depth</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_transformed</span> <span class="arithmetic-assignment">=</span> <span class="identifier">hasher</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>
<span class="identifier">pca</span> <span class="arithmetic-assignment">=</span> <span class="identifier">decomposition</span><span class="punctuation">.</span><span class="identifier">TruncatedSVD</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="grouping">)</span>
<span class="identifier">X_reduced</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pca</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X_transformed</span><span class="grouping">)</span>

<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_reduced</span><span class="punctuation">,</span>
               <span class="string-literal">"Random forest embedding of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># Spectral embedding of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing Spectral embedding"</span><span class="grouping">)</span>
<span class="identifier">embedder</span> <span class="arithmetic-assignment">=</span> <span class="identifier">manifold</span><span class="punctuation">.</span><span class="identifier">SpectralEmbedding</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span>
                                      <span class="identifier">eigen_solver</span><span class="arithmetic-assignment">=</span><span class="string-literal">"arpack"</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_se</span> <span class="arithmetic-assignment">=</span> <span class="identifier">embedder</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>

<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_se</span><span class="punctuation">,</span>
               <span class="string-literal">"Spectral embedding of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># t-SNE embedding of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing t-SNE embedding"</span><span class="grouping">)</span>
<span class="identifier">tsne</span> <span class="arithmetic-assignment">=</span> <span class="identifier">manifold</span><span class="punctuation">.</span><span class="identifier">TSNE</span><span class="grouping">(</span><span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">init</span><span class="arithmetic-assignment">=</span><span class="string-literal">'pca'</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_tsne</span> <span class="arithmetic-assignment">=</span> <span class="identifier">tsne</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>

<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_tsne</span><span class="punctuation">,</span>
               <span class="string-literal">"t-SNE embedding of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># ----------------------------------------------------------------------</span>
<span class="comment"># NCA projection of the digits dataset</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Computing NCA projection"</span><span class="grouping">)</span>
<span class="identifier">nca</span> <span class="arithmetic-assignment">=</span> <span class="identifier">neighbors</span><span class="punctuation">.</span><span class="identifier">NeighborhoodComponentsAnalysis</span><span class="grouping">(</span><span class="identifier">init</span><span class="arithmetic-assignment">=</span><span class="string-literal">'random'</span><span class="punctuation">,</span>
                                               <span class="identifier">n_components</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_nca</span> <span class="arithmetic-assignment">=</span> <span class="identifier">nca</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

<span class="identifier">plot_embedding</span><span class="grouping">(</span><span class="identifier">X_nca</span><span class="punctuation">,</span>
               <span class="string-literal">"NCA embedding of the digits (time %.2fs)"</span> <span class="arithmetic-operator">%</span>
               <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>