<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">#!/usr/bin/env python</span>
<span class="comment"># -*- coding: utf-8 -*-</span>

<span class="comment">"""
=============================================================
Compare the effect of different scalers on data with outliers
=============================================================

Feature 0 (median income in a block) and feature 5 (number of households) of
the :ref:`california_housing_dataset` have very
different scales and contain some very large outliers. These two
characteristics lead to difficulties to visualize the data and, more
importantly, they can degrade the predictive performance of many machine
learning algorithms. Unscaled data can also slow down or even prevent the
convergence of many gradient-based estimators.

Indeed many estimators are designed with the assumption that each feature takes
values close to zero or more importantly that all features vary on comparable
scales. In particular, metric-based and gradient-based estimators often assume
approximately standardized data (centered features with unit variances). A
notable exception are decision tree-based estimators that are robust to
arbitrary scaling of the data.

This example uses different scalers, transformers, and normalizers to bring the
data within a pre-defined range.

Scalers are linear (or more precisely affine) transformers and differ from each
other in the way they estimate the parameters used to shift and scale each
feature.

:class:`~sklearn.preprocessing.QuantileTransformer` provides non-linear
transformations in which distances
between marginal outliers and inliers are shrunk.
:class:`~sklearn.preprocessing.PowerTransformer` provides
non-linear transformations in which data is mapped to a normal distribution to
stabilize variance and minimize skewness.

Unlike the previous transformations, normalization refers to a per sample
transformation instead of a per feature transformation.

The following code is a bit verbose, feel free to jump directly to the analysis
of the results_.

"""</span>

<span class="comment"># Author:  Raghav RV &lt;rvraghav93@gmail.com&gt;</span>
<span class="comment">#          Guillaume Lemaitre &lt;g.lemaitre58@gmail.com&gt;</span>
<span class="comment">#          Thomas Unterthiner</span>
<span class="comment"># License: BSD 3 clause</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>

<span class="keyword">import</span> <span class="identifier">matplotlib</span> <span class="keyword">as</span> <span class="identifier">mpl</span>
<span class="keyword">from</span> <span class="identifier">matplotlib</span> <span class="keyword">import</span> <span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>
<span class="keyword">from</span> <span class="identifier">matplotlib</span> <span class="keyword">import</span> <span class="identifier">cm</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">MinMaxScaler</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">minmax_scale</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">MaxAbsScaler</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">StandardScaler</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">RobustScaler</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">Normalizer</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">QuantileTransformer</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">preprocessing</span> <span class="keyword">import</span> <span class="identifier">PowerTransformer</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">fetch_california_housing</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">__doc__</span><span class="grouping">)</span>

<span class="identifier">dataset</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fetch_california_housing</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_full</span><span class="punctuation">,</span> <span class="identifier">y_full</span> <span class="arithmetic-assignment">=</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">dataset</span><span class="punctuation">.</span><span class="identifier">target</span>

<span class="comment"># Take only 2 features to make visualization easier</span>
<span class="comment"># Feature of 0 has a long tail distribution.</span>
<span class="comment"># Feature 5 has a few but very large outliers.</span>

<span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">X_full</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">]</span><span class="grouping">]</span>

<span class="identifier">distributions</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
    <span class="grouping">(</span><span class="string-literal">'Unscaled data'</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'Data after standard scaling'</span><span class="punctuation">,</span>
        <span class="identifier">StandardScaler</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'Data after min-max scaling'</span><span class="punctuation">,</span>
        <span class="identifier">MinMaxScaler</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'Data after max-abs scaling'</span><span class="punctuation">,</span>
        <span class="identifier">MaxAbsScaler</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'Data after robust scaling'</span><span class="punctuation">,</span>
        <span class="identifier">RobustScaler</span><span class="grouping">(</span><span class="identifier">quantile_range</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">25</span><span class="punctuation">,</span> <span class="int-literal">75</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'Data after power transformation (Yeo-Johnson)'</span><span class="punctuation">,</span>
     <span class="identifier">PowerTransformer</span><span class="grouping">(</span><span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'yeo-johnson'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'Data after power transformation (Box-Cox)'</span><span class="punctuation">,</span>
     <span class="identifier">PowerTransformer</span><span class="grouping">(</span><span class="identifier">method</span><span class="arithmetic-assignment">=</span><span class="string-literal">'box-cox'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'Data after quantile transformation (uniform pdf)'</span><span class="punctuation">,</span>
        <span class="identifier">QuantileTransformer</span><span class="grouping">(</span><span class="identifier">output_distribution</span><span class="arithmetic-assignment">=</span><span class="string-literal">'uniform'</span><span class="grouping">)</span>
        <span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'Data after quantile transformation (gaussian pdf)'</span><span class="punctuation">,</span>
        <span class="identifier">QuantileTransformer</span><span class="grouping">(</span><span class="identifier">output_distribution</span><span class="arithmetic-assignment">=</span><span class="string-literal">'normal'</span><span class="grouping">)</span>
        <span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">(</span><span class="string-literal">'Data after sample-wise L2 normalizing'</span><span class="punctuation">,</span>
        <span class="identifier">Normalizer</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
<span class="grouping">]</span>

<span class="comment"># scale the output between 0 and 1 for the colorbar</span>
<span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">minmax_scale</span><span class="grouping">(</span><span class="identifier">y_full</span><span class="grouping">)</span>

<span class="comment"># plasma does not exist in matplotlib &lt; 1.5</span>
<span class="identifier">cmap</span> <span class="arithmetic-assignment">=</span> <span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">cm</span><span class="punctuation">,</span> <span class="string-literal">'plasma_r'</span><span class="punctuation">,</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="identifier">hot_r</span><span class="grouping">)</span>

<span class="keyword">def</span> <span class="identifier">create_axes</span><span class="grouping">(</span><span class="identifier">title</span><span class="punctuation">,</span> <span class="identifier">figsize</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">16</span><span class="punctuation">,</span> <span class="int-literal">6</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">fig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="identifier">figsize</span><span class="arithmetic-assignment">=</span><span class="identifier">figsize</span><span class="grouping">)</span>
    <span class="identifier">fig</span><span class="punctuation">.</span><span class="identifier">suptitle</span><span class="grouping">(</span><span class="identifier">title</span><span class="grouping">)</span>

    <span class="comment"># define the axis for the first plot</span>
    <span class="identifier">left</span><span class="punctuation">,</span> <span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="float-literal">0.22</span>
    <span class="identifier">bottom</span><span class="punctuation">,</span> <span class="identifier">height</span> <span class="arithmetic-assignment">=</span> <span class="float-literal">0.1</span><span class="punctuation">,</span> <span class="float-literal">0.7</span>
    <span class="identifier">bottom_h</span> <span class="arithmetic-assignment">=</span> <span class="identifier">height</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.15</span>
    <span class="identifier">left_h</span> <span class="arithmetic-assignment">=</span> <span class="identifier">left</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.02</span>

    <span class="identifier">rect_scatter</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">left</span><span class="punctuation">,</span> <span class="identifier">bottom</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="grouping">]</span>
    <span class="identifier">rect_histx</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">left</span><span class="punctuation">,</span> <span class="identifier">bottom_h</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="float-literal">0.1</span><span class="grouping">]</span>
    <span class="identifier">rect_histy</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">left_h</span><span class="punctuation">,</span> <span class="identifier">bottom</span><span class="punctuation">,</span> <span class="float-literal">0.05</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="grouping">]</span>

    <span class="identifier">ax_scatter</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axes</span><span class="grouping">(</span><span class="identifier">rect_scatter</span><span class="grouping">)</span>
    <span class="identifier">ax_histx</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axes</span><span class="grouping">(</span><span class="identifier">rect_histx</span><span class="grouping">)</span>
    <span class="identifier">ax_histy</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axes</span><span class="grouping">(</span><span class="identifier">rect_histy</span><span class="grouping">)</span>

    <span class="comment"># define the axis for the zoomed-in plot</span>
    <span class="identifier">left</span> <span class="arithmetic-assignment">=</span> <span class="identifier">width</span> <span class="arithmetic-operator">+</span> <span class="identifier">left</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.2</span>
    <span class="identifier">left_h</span> <span class="arithmetic-assignment">=</span> <span class="identifier">left</span> <span class="arithmetic-operator">+</span> <span class="identifier">width</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.02</span>

    <span class="identifier">rect_scatter</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">left</span><span class="punctuation">,</span> <span class="identifier">bottom</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="grouping">]</span>
    <span class="identifier">rect_histx</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">left</span><span class="punctuation">,</span> <span class="identifier">bottom_h</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="float-literal">0.1</span><span class="grouping">]</span>
    <span class="identifier">rect_histy</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">left_h</span><span class="punctuation">,</span> <span class="identifier">bottom</span><span class="punctuation">,</span> <span class="float-literal">0.05</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="grouping">]</span>

    <span class="identifier">ax_scatter_zoom</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axes</span><span class="grouping">(</span><span class="identifier">rect_scatter</span><span class="grouping">)</span>
    <span class="identifier">ax_histx_zoom</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axes</span><span class="grouping">(</span><span class="identifier">rect_histx</span><span class="grouping">)</span>
    <span class="identifier">ax_histy_zoom</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axes</span><span class="grouping">(</span><span class="identifier">rect_histy</span><span class="grouping">)</span>

    <span class="comment"># define the axis for the colorbar</span>
    <span class="identifier">left</span><span class="punctuation">,</span> <span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">width</span> <span class="arithmetic-operator">+</span> <span class="identifier">left</span> <span class="arithmetic-operator">+</span> <span class="float-literal">0.13</span><span class="punctuation">,</span> <span class="float-literal">0.01</span>

    <span class="identifier">rect_colorbar</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">left</span><span class="punctuation">,</span> <span class="identifier">bottom</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">height</span><span class="grouping">]</span>
    <span class="identifier">ax_colorbar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">axes</span><span class="grouping">(</span><span class="identifier">rect_colorbar</span><span class="grouping">)</span>

    <span class="keyword">return</span> <span class="grouping">(</span><span class="grouping">(</span><span class="identifier">ax_scatter</span><span class="punctuation">,</span> <span class="identifier">ax_histy</span><span class="punctuation">,</span> <span class="identifier">ax_histx</span><span class="grouping">)</span><span class="punctuation">,</span>
            <span class="grouping">(</span><span class="identifier">ax_scatter_zoom</span><span class="punctuation">,</span> <span class="identifier">ax_histy_zoom</span><span class="punctuation">,</span> <span class="identifier">ax_histx_zoom</span><span class="grouping">)</span><span class="punctuation">,</span>
            <span class="identifier">ax_colorbar</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">plot_distribution</span><span class="grouping">(</span><span class="identifier">axes</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">hist_nbins</span><span class="arithmetic-assignment">=</span><span class="int-literal">50</span><span class="punctuation">,</span> <span class="identifier">title</span><span class="arithmetic-assignment">=</span><span class="string-literal">""</span><span class="punctuation">,</span>
                      <span class="identifier">x0_label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"", x1_label=""</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">ax</span><span class="punctuation">,</span> <span class="identifier">hist_X1</span><span class="punctuation">,</span> <span class="identifier">hist_X0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">axes</span>

    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_title</span><span class="grouping">(</span><span class="identifier">title</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_xlabel</span><span class="grouping">(</span><span class="identifier">x0_label</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">set_ylabel</span><span class="grouping">(</span><span class="identifier">x1_label</span><span class="grouping">)</span>

    <span class="comment"># The scatter plot</span>
    <span class="identifier">colors</span> <span class="arithmetic-assignment">=</span> <span class="identifier">cmap</span><span class="grouping">(</span><span class="identifier">y</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">scatter</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">alpha</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.5</span><span class="punctuation">,</span> <span class="identifier">marker</span><span class="arithmetic-assignment">=</span><span class="string-literal">'o'</span><span class="punctuation">,</span> <span class="identifier">s</span><span class="arithmetic-assignment">=</span><span class="int-literal">5</span><span class="punctuation">,</span> <span class="identifier">lw</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="arithmetic-assignment">=</span><span class="identifier">colors</span><span class="grouping">)</span>

    <span class="comment"># Removing the top and the right spine for aesthetics</span>
    <span class="comment"># make nice axis layout</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">spines</span><span class="grouping">[</span><span class="string-literal">'top'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">set_visible</span><span class="grouping">(</span><span class="bool-literal">False</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">spines</span><span class="grouping">[</span><span class="string-literal">'right'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">set_visible</span><span class="grouping">(</span><span class="bool-literal">False</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xaxis</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tick_bottom</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_yaxis</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tick_left</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">spines</span><span class="grouping">[</span><span class="string-literal">'left'].set_position(('outward'</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">spines</span><span class="grouping">[</span><span class="string-literal">'bottom'].set_position(('outward'</span><span class="punctuation">,</span> <span class="int-literal">10</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># Histogram for axis X1 (feature 5)</span>
    <span class="identifier">hist_X1</span><span class="punctuation">.</span><span class="identifier">set_ylim</span><span class="grouping">(</span><span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_ylim</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">hist_X1</span><span class="punctuation">.</span><span class="identifier">hist</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">bins</span><span class="arithmetic-assignment">=</span><span class="identifier">hist_nbins</span><span class="punctuation">,</span> <span class="identifier">orientation</span><span class="arithmetic-assignment">=</span><span class="string-literal">'horizontal'</span><span class="punctuation">,</span>
                 <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'grey', ec='grey'</span><span class="grouping">)</span>
    <span class="identifier">hist_X1</span><span class="punctuation">.</span><span class="identifier">axis</span><span class="grouping">(</span><span class="string-literal">'off'</span><span class="grouping">)</span>

    <span class="comment"># Histogram for axis X0 (feature 0)</span>
    <span class="identifier">hist_X0</span><span class="punctuation">.</span><span class="identifier">set_xlim</span><span class="grouping">(</span><span class="identifier">ax</span><span class="punctuation">.</span><span class="identifier">get_xlim</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">hist_X0</span><span class="punctuation">.</span><span class="identifier">hist</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">bins</span><span class="arithmetic-assignment">=</span><span class="identifier">hist_nbins</span><span class="punctuation">,</span> <span class="identifier">orientation</span><span class="arithmetic-assignment">=</span><span class="string-literal">'vertical'</span><span class="punctuation">,</span>
                 <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'grey', ec='grey'</span><span class="grouping">)</span>
    <span class="identifier">hist_X0</span><span class="punctuation">.</span><span class="identifier">axis</span><span class="grouping">(</span><span class="string-literal">'off'</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># Two plots will be shown for each scaler/normalizer/transformer. The left</span>
<span class="comment"># figure will show a scatter plot of the full data set while the right figure</span>
<span class="comment"># will exclude the extreme values considering only 99 % of the data set,</span>
<span class="comment"># excluding marginal outliers. In addition, the marginal distributions for each</span>
<span class="comment"># feature will be shown on the sides of the scatter plot.</span>


<span class="keyword">def</span> <span class="identifier">make_plot</span><span class="grouping">(</span><span class="identifier">item_idx</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">title</span><span class="punctuation">,</span> <span class="identifier">X</span> <span class="arithmetic-assignment">=</span> <span class="identifier">distributions</span><span class="grouping">[</span><span class="identifier">item_idx</span><span class="grouping">]</span>
    <span class="identifier">ax_zoom_out</span><span class="punctuation">,</span> <span class="identifier">ax_zoom_in</span><span class="punctuation">,</span> <span class="identifier">ax_colorbar</span> <span class="arithmetic-assignment">=</span> <span class="identifier">create_axes</span><span class="grouping">(</span><span class="identifier">title</span><span class="grouping">)</span>
    <span class="identifier">axarr</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="identifier">ax_zoom_out</span><span class="punctuation">,</span> <span class="identifier">ax_zoom_in</span><span class="grouping">)</span>
    <span class="identifier">plot_distribution</span><span class="grouping">(</span><span class="identifier">axarr</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">,</span> <span class="identifier">hist_nbins</span><span class="arithmetic-assignment">=</span><span class="int-literal">200</span><span class="punctuation">,</span>
                      <span class="identifier">x0_label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Median Income"</span><span class="punctuation">,</span>
                      <span class="identifier">x1_label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Number of households"</span><span class="punctuation">,</span>
                      <span class="identifier">title</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Full data"</span><span class="grouping">)</span>

    <span class="comment"># zoom-in</span>
    <span class="identifier">zoom_in_percentile_range</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">99</span><span class="grouping">)</span>
    <span class="identifier">cutoffs_X0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">percentile</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">zoom_in_percentile_range</span><span class="grouping">)</span>
    <span class="identifier">cutoffs_X1</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">percentile</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">[</span><span class="punctuation">:</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">zoom_in_percentile_range</span><span class="grouping">)</span>

    <span class="identifier">non_outliers_mask</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span>
        <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="identifier">X</span> <span class="relational-operator">&gt;</span> <span class="grouping">[</span><span class="identifier">cutoffs_X0</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">cutoffs_X1</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span> <span class="bitwise-operator">&</span>
        <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">all</span><span class="grouping">(</span><span class="identifier">X</span> <span class="relational-operator">&lt;</span> <span class="grouping">[</span><span class="identifier">cutoffs_X0</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">cutoffs_X1</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">axis</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">plot_distribution</span><span class="grouping">(</span><span class="identifier">axarr</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">[</span><span class="identifier">non_outliers_mask</span><span class="grouping">]</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">[</span><span class="identifier">non_outliers_mask</span><span class="grouping">]</span><span class="punctuation">,</span>
                      <span class="identifier">hist_nbins</span><span class="arithmetic-assignment">=</span><span class="int-literal">50</span><span class="punctuation">,</span>
                      <span class="identifier">x0_label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Median Income"</span><span class="punctuation">,</span>
                      <span class="identifier">x1_label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Number of households"</span><span class="punctuation">,</span>
                      <span class="identifier">title</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Zoom-in"</span><span class="grouping">)</span>

    <span class="identifier">norm</span> <span class="arithmetic-assignment">=</span> <span class="identifier">mpl</span><span class="punctuation">.</span><span class="identifier">colors</span><span class="punctuation">.</span><span class="identifier">Normalize</span><span class="grouping">(</span><span class="identifier">y_full</span><span class="punctuation">.</span><span class="identifier">min</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">y_full</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">mpl</span><span class="punctuation">.</span><span class="identifier">colorbar</span><span class="punctuation">.</span><span class="identifier">ColorbarBase</span><span class="grouping">(</span><span class="identifier">ax_colorbar</span><span class="punctuation">,</span> <span class="identifier">cmap</span><span class="arithmetic-assignment">=</span><span class="identifier">cmap</span><span class="punctuation">,</span>
                              <span class="identifier">norm</span><span class="arithmetic-assignment">=</span><span class="identifier">norm</span><span class="punctuation">,</span> <span class="identifier">orientation</span><span class="arithmetic-assignment">=</span><span class="string-literal">'vertical'</span><span class="punctuation">,</span>
                              <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Color mapping for values of y'</span><span class="grouping">)</span>


<span class="comment"># %%</span>
<span class="comment"># .. _results:</span>
<span class="comment">#</span>
<span class="comment"># Original data</span>
<span class="comment"># -------------</span>
<span class="comment">#</span>
<span class="comment"># Each transformation is plotted showing two transformed features, with the</span>
<span class="comment"># left plot showing the entire dataset, and the right zoomed-in to show the</span>
<span class="comment"># dataset without the marginal outliers. A large majority of the samples are</span>
<span class="comment"># compacted to a specific range, [0, 10] for the median income and [0, 6] for</span>
<span class="comment"># the number of households. Note that there are some marginal outliers (some</span>
<span class="comment"># blocks have more than 1200 households). Therefore, a specific pre-processing</span>
<span class="comment"># can be very beneficial depending of the application. In the following, we</span>
<span class="comment"># present some insights and behaviors of those pre-processing methods in the</span>
<span class="comment"># presence of marginal outliers.</span>

<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">0</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># StandardScaler</span>
<span class="comment"># --------------</span>
<span class="comment">#</span>
<span class="comment"># :class:`~sklearn.preprocessing.StandardScaler` removes the mean and scales</span>
<span class="comment"># the data to unit variance. The scaling shrinks the range of the feature</span>
<span class="comment"># values as shown in the left figure below.</span>
<span class="comment"># However, the outliers have an influence when computing the empirical mean and</span>
<span class="comment"># standard deviation. Note in particular that because the outliers on each</span>
<span class="comment"># feature have different magnitudes, the spread of the transformed data on</span>
<span class="comment"># each feature is very different: most of the data lie in the [-2, 4] range for</span>
<span class="comment"># the transformed median income feature while the same data is squeezed in the</span>
<span class="comment"># smaller [-0.2, 0.2] range for the transformed number of households.</span>
<span class="comment">#</span>
<span class="comment"># :class:`~sklearn.preprocessing.StandardScaler` therefore cannot guarantee</span>
<span class="comment"># balanced feature scales in the</span>
<span class="comment"># presence of outliers.</span>

<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">1</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># MinMaxScaler</span>
<span class="comment"># ------------</span>
<span class="comment">#</span>
<span class="comment"># :class:`~sklearn.preprocessing.MinMaxScaler` rescales the data set such that</span>
<span class="comment"># all feature values are in</span>
<span class="comment"># the range [0, 1] as shown in the right panel below. However, this scaling</span>
<span class="comment"># compresses all inliers into the narrow range [0, 0.005] for the transformed</span>
<span class="comment"># number of households.</span>
<span class="comment">#</span>
<span class="comment"># Both :class:`~sklearn.preprocessing.StandardScaler` and</span>
<span class="comment"># :class:`~sklearn.preprocessing.MinMaxScaler` are very sensitive to the</span>
<span class="comment"># presence of outliers.</span>

<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">2</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># MaxAbsScaler</span>
<span class="comment"># ------------</span>
<span class="comment">#</span>
<span class="comment"># :class:`~sklearn.preprocessing.MaxAbsScaler` is similar to</span>
<span class="comment"># :class:`~sklearn.preprocessing.MinMaxScaler` except that the</span>
<span class="comment"># values are mapped in the range [0, 1]. On positive only data, both scalers</span>
<span class="comment"># behave similarly.</span>
<span class="comment"># :class:`~sklearn.preprocessing.MaxAbsScaler` therefore also suffers from</span>
<span class="comment"># the presence of large outliers.</span>

<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">3</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># RobustScaler</span>
<span class="comment"># ------------</span>
<span class="comment">#</span>
<span class="comment"># Unlike the previous scalers, the centering and scaling statistics of</span>
<span class="comment"># :class:`~sklearn.preprocessing.RobustScaler`</span>
<span class="comment"># is based on percentiles and are therefore not influenced by a few</span>
<span class="comment"># number of very large marginal outliers. Consequently, the resulting range of</span>
<span class="comment"># the transformed feature values is larger than for the previous scalers and,</span>
<span class="comment"># more importantly, are approximately similar: for both features most of the</span>
<span class="comment"># transformed values lie in a [-2, 3] range as seen in the zoomed-in figure.</span>
<span class="comment"># Note that the outliers themselves are still present in the transformed data.</span>
<span class="comment"># If a separate outlier clipping is desirable, a non-linear transformation is</span>
<span class="comment"># required (see below).</span>

<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">4</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># PowerTransformer</span>
<span class="comment"># ----------------</span>
<span class="comment">#</span>
<span class="comment"># :class:`~sklearn.preprocessing.PowerTransformer` applies a power</span>
<span class="comment"># transformation to each feature to make the data more Gaussian-like in order</span>
<span class="comment"># to stabilize variance and minimize skewness. Currently the Yeo-Johnson</span>
<span class="comment"># and Box-Cox transforms are supported and the optimal</span>
<span class="comment"># scaling factor is determined via maximum likelihood estimation in both</span>
<span class="comment"># methods. By default, :class:`~sklearn.preprocessing.PowerTransformer` applies</span>
<span class="comment"># zero-mean, unit variance normalization. Note that</span>
<span class="comment"># Box-Cox can only be applied to strictly positive data. Income and number of</span>
<span class="comment"># households happen to be strictly positive, but if negative values are present</span>
<span class="comment"># the Yeo-Johnson transformed is preferred.</span>

<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">5</span><span class="grouping">)</span>
<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">6</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># QuantileTransformer (uniform output)</span>
<span class="comment"># ------------------------------------</span>
<span class="comment">#</span>
<span class="comment"># :class:`~sklearn.preprocessing.QuantileTransformer` applies a non-linear</span>
<span class="comment"># transformation such that the</span>
<span class="comment"># probability density function of each feature will be mapped to a uniform</span>
<span class="comment"># or Gaussian distribution. In this case, all the data, including outliers,</span>
<span class="comment"># will be mapped to a uniform distribution with the range [0, 1], making</span>
<span class="comment"># outliers indistinguishable from inliers.</span>
<span class="comment">#</span>
<span class="comment"># :class:`~sklearn.preprocessing.RobustScaler` and</span>
<span class="comment"># :class:`~sklearn.preprocessing.QuantileTransformer` are robust to outliers in</span>
<span class="comment"># the sense that adding or removing outliers in the training set will yield</span>
<span class="comment"># approximately the same transformation. But contrary to</span>
<span class="comment"># :class:`~sklearn.preprocessing.RobustScaler`,</span>
<span class="comment"># :class:`~sklearn.preprocessing.QuantileTransformer` will also automatically</span>
<span class="comment"># collapse any outlier by setting them to the a priori defined range boundaries</span>
<span class="comment"># (0 and 1). This can result in saturation artifacts for extreme values.</span>

<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">7</span><span class="grouping">)</span>

<span class="comment">##############################################################################</span>
<span class="comment"># QuantileTransformer (Gaussian output)</span>
<span class="comment"># -------------------------------------</span>
<span class="comment">#</span>
<span class="comment"># To map to a Gaussian distribution, set the parameter</span>
<span class="comment"># ``output_distribution='normal'``.</span>

<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">8</span><span class="grouping">)</span>

<span class="comment"># %%</span>
<span class="comment"># Normalizer</span>
<span class="comment"># ----------</span>
<span class="comment">#</span>
<span class="comment"># The :class:`~sklearn.preprocessing.Normalizer` rescales the vector for each</span>
<span class="comment"># sample to have unit norm,</span>
<span class="comment"># independently of the distribution of the samples. It can be seen on both</span>
<span class="comment"># figures below where all samples are mapped onto the unit circle. In our</span>
<span class="comment"># example the two selected features have only positive values; therefore the</span>
<span class="comment"># transformed data only lie in the positive quadrant. This would not be the</span>
<span class="comment"># case if some original features had a mix of positive and negative values.</span>

<span class="identifier">make_plot</span><span class="grouping">(</span><span class="int-literal">9</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>