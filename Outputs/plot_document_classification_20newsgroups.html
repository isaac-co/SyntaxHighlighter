<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""
======================================================
Classification of text documents using sparse features
======================================================

This is an example showing how scikit-learn can be used to classify documents
by topics using a bag-of-words approach. This example uses a scipy.sparse
matrix to store the features and demonstrates various classifiers that can
efficiently handle sparse matrices.

The dataset used in this example is the 20 newsgroups dataset. It will be
automatically downloaded, then cached.

"""</span>

<span class="comment"># Author: Peter Prettenhofer &lt;peter.prettenhofer@gmail.com&gt;</span>
<span class="comment">#         Olivier Grisel &lt;olivier.grisel@ensta.org&gt;</span>
<span class="comment">#         Mathieu Blondel &lt;mathieu@mblondel.org&gt;</span>
<span class="comment">#         Lars Buitinck</span>
<span class="comment"># License: BSD 3 clause</span>
<span class="keyword">import</span> <span class="identifier">logging</span>
<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>
<span class="keyword">from</span> <span class="identifier">optparse</span> <span class="keyword">import</span> <span class="identifier">OptionParser</span>
<span class="keyword">import</span> <span class="identifier">sys</span>
<span class="keyword">from</span> <span class="identifier">time</span> <span class="keyword">import</span> <span class="identifier">time</span>
<span class="keyword">import</span> <span class="identifier">matplotlib</span><span class="punctuation">.</span><span class="identifier">pyplot</span> <span class="keyword">as</span> <span class="identifier">plt</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">datasets</span> <span class="keyword">import</span> <span class="identifier">fetch_20newsgroups</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">feature_extraction</span><span class="punctuation">.</span><span class="identifier">text</span> <span class="keyword">import</span> <span class="identifier">TfidfVectorizer</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">feature_extraction</span><span class="punctuation">.</span><span class="identifier">text</span> <span class="keyword">import</span> <span class="identifier">HashingVectorizer</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">feature_selection</span> <span class="keyword">import</span> <span class="identifier">SelectFromModel</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">feature_selection</span> <span class="keyword">import</span> <span class="identifier">SelectKBest</span><span class="punctuation">,</span> <span class="identifier">chi2</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">RidgeClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">pipeline</span> <span class="keyword">import</span> <span class="identifier">Pipeline</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">svm</span> <span class="keyword">import</span> <span class="identifier">LinearSVC</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">SGDClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="identifier">Perceptron</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">linear_model</span> <span class="keyword">import</span> <span class="invalid">P</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">v</span><span class="invalid">e</span><span class="invalid">A</span><span class="invalid">g</span><span class="invalid">g</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">v</span><span class="invalid">e</span><span class="invalid">C</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">f</span><span class="invalid">i</span><span class="invalid">e</span><span class="invalid">r</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">naive_bayes</span> <span class="keyword">import</span> <span class="identifier">BernoulliNB</span><span class="punctuation">,</span> <span class="identifier">ComplementNB</span><span class="punctuation">,</span> <span class="identifier">MultinomialNB</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">neighbors</span> <span class="keyword">import</span> <span class="identifier">KNeighborsClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">neighbors</span> <span class="keyword">import</span> <span class="identifier">NearestCentroid</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">ensemble</span> <span class="keyword">import</span> <span class="identifier">RandomForestClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">extmath</span> <span class="keyword">import</span> <span class="identifier">density</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span> <span class="keyword">import</span> <span class="identifier">metrics</span>


<span class="comment"># Display progress logs on stdout</span>
<span class="identifier">logging</span><span class="punctuation">.</span><span class="identifier">basicConfig</span><span class="grouping">(</span><span class="identifier">level</span><span class="arithmetic-assignment">=</span><span class="identifier">logging</span><span class="punctuation">.</span><span class="identifier">INFO</span><span class="punctuation">,</span>
                    <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="string-literal">'%(asctime)s %(levelname)s %(message)s'</span><span class="grouping">)</span>

<span class="identifier">op</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OptionParser</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--report"</span><span class="punctuation">,</span>
              <span class="identifier">action</span><span class="arithmetic-assignment">=</span><span class="string-literal">"store_true", dest="print_report"</span><span class="punctuation">,</span>
              <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Print a detailed classification report."</span><span class="grouping">)</span>
<span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--chi2_select"</span><span class="punctuation">,</span>
              <span class="identifier">action</span><span class="arithmetic-assignment">=</span><span class="string-literal">"store", type="int", dest="select_chi2"</span><span class="punctuation">,</span>
              <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Select some number of features using a chi-squared test"</span><span class="grouping">)</span>
<span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--confusion_matrix"</span><span class="punctuation">,</span>
              <span class="identifier">action</span><span class="arithmetic-assignment">=</span><span class="string-literal">"store_true", dest="print_cm"</span><span class="punctuation">,</span>
              <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Print the confusion matrix."</span><span class="grouping">)</span>
<span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--top10"</span><span class="punctuation">,</span>
              <span class="identifier">action</span><span class="arithmetic-assignment">=</span><span class="string-literal">"store_true", dest="print_top10"</span><span class="punctuation">,</span>
              <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Print ten most discriminative terms per class"</span>
                   <span class="string-literal">" for every classifier."</span><span class="grouping">)</span>
<span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--all_categories"</span><span class="punctuation">,</span>
              <span class="identifier">action</span><span class="arithmetic-assignment">=</span><span class="string-literal">"store_true", dest="all_categories"</span><span class="punctuation">,</span>
              <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Whether to use all categories or not."</span><span class="grouping">)</span>
<span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--use_hashing"</span><span class="punctuation">,</span>
              <span class="identifier">action</span><span class="arithmetic-assignment">=</span><span class="string-literal">"store_true"</span><span class="punctuation">,</span>
              <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Use a hashing vectorizer."</span><span class="grouping">)</span>
<span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--n_features"</span><span class="punctuation">,</span>
              <span class="identifier">action</span><span class="arithmetic-assignment">=</span><span class="string-literal">"store"</span><span class="punctuation">,</span> <span class="identifier">type</span><span class="arithmetic-assignment">=</span><span class="identifier">int</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span><span class="arithmetic-assignment">=</span><span class="int-literal">2</span> <span class="arithmetic-operator">**</span> <span class="int-literal">16</span><span class="punctuation">,</span>
              <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"n_features when using the hashing vectorizer."</span><span class="grouping">)</span>
<span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">add_option</span><span class="grouping">(</span><span class="string-literal">"--filtered"</span><span class="punctuation">,</span>
              <span class="identifier">action</span><span class="arithmetic-assignment">=</span><span class="string-literal">"store_true"</span><span class="punctuation">,</span>
              <span class="identifier">help</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Remove newsgroup information that is easily overfit: "</span>
                   <span class="string-literal">"headers, signatures, and quoting."</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">is_interactive</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">return</span> <span class="logical-operator">not</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">modules</span><span class="grouping">[</span><span class="string-literal">'__main__'], '__file__'</span><span class="grouping">)</span>


<span class="comment"># work-around for Jupyter notebook and IPython console</span>
<span class="identifier">argv</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span> <span class="keyword">if</span> <span class="identifier">is_interactive</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">else</span> <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">argv</span><span class="grouping">[</span><span class="int-literal">1</span><span class="punctuation">:</span><span class="grouping">]</span>
<span class="grouping">(</span><span class="identifier">opts</span><span class="punctuation">,</span> <span class="identifier">args</span><span class="grouping">)</span> <span class="arithmetic-assignment">=</span> <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">parse_args</span><span class="grouping">(</span><span class="identifier">argv</span><span class="grouping">)</span>
<span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">args</span><span class="grouping">)</span> <span class="relational-operator">&gt;</span> <span class="int-literal">0</span><span class="punctuation">:</span>
    <span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">error</span><span class="grouping">(</span><span class="string-literal">"this script takes no arguments."</span><span class="grouping">)</span>
    <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">exit</span><span class="grouping">(</span><span class="int-literal">1</span><span class="grouping">)</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">__doc__</span><span class="grouping">)</span>
<span class="identifier">op</span><span class="punctuation">.</span><span class="identifier">print_help</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="comment"># %%</span>
<span class="comment"># Load data from the training set</span>
<span class="comment"># ------------------------------------</span>
<span class="comment"># Let's load data from the newsgroups dataset which comprises around 18000</span>
<span class="comment"># newsgroups posts on 20 topics split in two subsets: one for training (or</span>
<span class="comment"># development) and the other one for testing (or for performance evaluation).</span>
<span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">all_categories</span><span class="punctuation">:</span>
    <span class="identifier">categories</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
<span class="keyword">else</span><span class="punctuation">:</span>
    <span class="identifier">categories</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
        <span class="string-literal">'alt.atheism'</span><span class="punctuation">,</span>
        <span class="string-literal">'talk.religion.misc'</span><span class="punctuation">,</span>
        <span class="string-literal">'comp.graphics'</span><span class="punctuation">,</span>
        <span class="string-literal">'sci.space'</span><span class="punctuation">,</span>
    <span class="grouping">]</span>

<span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">filtered</span><span class="punctuation">:</span>
    <span class="identifier">remove</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="string-literal">'headers', 'footers', 'quotes'</span><span class="grouping">)</span>
<span class="keyword">else</span><span class="punctuation">:</span>
    <span class="identifier">remove</span> <span class="arithmetic-assignment">=</span> <span class="grouping">(</span><span class="grouping">)</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Loading 20 newsgroups dataset for categories:"</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="identifier">categories</span> <span class="keyword">if</span> <span class="identifier">categories</span> <span class="keyword">else</span> <span class="string-literal">"all"</span><span class="grouping">)</span>

<span class="identifier">data_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fetch_20newsgroups</span><span class="grouping">(</span><span class="identifier">subset</span><span class="arithmetic-assignment">=</span><span class="string-literal">'train'</span><span class="punctuation">,</span> <span class="identifier">categories</span><span class="arithmetic-assignment">=</span><span class="identifier">categories</span><span class="punctuation">,</span>
                                <span class="identifier">shuffle</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span><span class="punctuation">,</span>
                                <span class="identifier">remove</span><span class="arithmetic-assignment">=</span><span class="identifier">remove</span><span class="grouping">)</span>

<span class="identifier">data_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">fetch_20newsgroups</span><span class="grouping">(</span><span class="identifier">subset</span><span class="arithmetic-assignment">=</span><span class="string-literal">'test'</span><span class="punctuation">,</span> <span class="identifier">categories</span><span class="arithmetic-assignment">=</span><span class="identifier">categories</span><span class="punctuation">,</span>
                               <span class="identifier">shuffle</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">random_state</span><span class="arithmetic-assignment">=</span><span class="int-literal">42</span><span class="punctuation">,</span>
                               <span class="identifier">remove</span><span class="arithmetic-assignment">=</span><span class="identifier">remove</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'data loaded'</span><span class="grouping">)</span>

<span class="comment"># order of labels in `target_names` can be different from `categories`</span>
<span class="identifier">target_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data_train</span><span class="punctuation">.</span><span class="identifier">target_names</span>


<span class="keyword">def</span> <span class="identifier">size_mb</span><span class="grouping">(</span><span class="identifier">docs</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">return</span> <span class="identifier">sum</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">s</span><span class="punctuation">.</span><span class="identifier">encode</span><span class="grouping">(</span><span class="string-literal">'utf-8'</span><span class="grouping">)</span><span class="grouping">)</span> <span class="keyword">for</span> <span class="identifier">s</span> <span class="relational-operator">in</span> <span class="identifier">docs</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="float-literal">1e6</span>


<span class="identifier">data_train_size_mb</span> <span class="arithmetic-assignment">=</span> <span class="identifier">size_mb</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="punctuation">.</span><span class="identifier">data</span><span class="grouping">)</span>
<span class="identifier">data_test_size_mb</span> <span class="arithmetic-assignment">=</span> <span class="identifier">size_mb</span><span class="grouping">(</span><span class="identifier">data_test</span><span class="punctuation">.</span><span class="identifier">data</span><span class="grouping">)</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"%d documents - %0.3fMB (training set)"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span>
    <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="punctuation">.</span><span class="identifier">data</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">data_train_size_mb</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"%d documents - %0.3fMB (test set)"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span>
    <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">data_test</span><span class="punctuation">.</span><span class="identifier">data</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">data_test_size_mb</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"%d categories"</span> <span class="arithmetic-operator">%</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">target_names</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="comment"># split a training set and a test set</span>
<span class="identifier">y_train</span><span class="punctuation">,</span> <span class="identifier">y_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">data_train</span><span class="punctuation">.</span><span class="identifier">target</span><span class="punctuation">,</span> <span class="identifier">data_test</span><span class="punctuation">.</span><span class="identifier">target</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Extracting features from the training data using a sparse vectorizer"</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">use_hashing</span><span class="punctuation">:</span>
    <span class="identifier">vectorizer</span> <span class="arithmetic-assignment">=</span> <span class="identifier">HashingVectorizer</span><span class="grouping">(</span><span class="identifier">stop_words</span><span class="arithmetic-assignment">=</span><span class="string-literal">'english'</span><span class="punctuation">,</span> <span class="identifier">alternate_sign</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                                   <span class="identifier">n_features</span><span class="arithmetic-assignment">=</span><span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">n_features</span><span class="grouping">)</span>
    <span class="identifier">X_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">vectorizer</span><span class="punctuation">.</span><span class="identifier">transform</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="punctuation">.</span><span class="identifier">data</span><span class="grouping">)</span>
<span class="keyword">else</span><span class="punctuation">:</span>
    <span class="identifier">vectorizer</span> <span class="arithmetic-assignment">=</span> <span class="identifier">TfidfVectorizer</span><span class="grouping">(</span><span class="identifier">sublinear_tf</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span> <span class="identifier">max_df</span><span class="arithmetic-assignment">=</span><span class="float-literal">0.5</span><span class="punctuation">,</span>
                                 <span class="identifier">stop_words</span><span class="arithmetic-assignment">=</span><span class="string-literal">'english'</span><span class="grouping">)</span>
    <span class="identifier">X_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">vectorizer</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">data_train</span><span class="punctuation">.</span><span class="identifier">data</span><span class="grouping">)</span>
<span class="identifier">duration</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"done in %fs at %0.3fMB/s"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">duration</span><span class="punctuation">,</span> <span class="identifier">data_train_size_mb</span> <span class="arithmetic-operator">/</span> <span class="identifier">duration</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"n_samples: %d, n_features: %d"</span> <span class="arithmetic-operator">%</span> <span class="identifier">X_train</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Extracting features from the test data using the same vectorizer"</span><span class="grouping">)</span>
<span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
<span class="identifier">X_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">vectorizer</span><span class="punctuation">.</span><span class="identifier">transform</span><span class="grouping">(</span><span class="identifier">data_test</span><span class="punctuation">.</span><span class="identifier">data</span><span class="grouping">)</span>
<span class="identifier">duration</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"done in %fs at %0.3fMB/s"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">duration</span><span class="punctuation">,</span> <span class="identifier">data_test_size_mb</span> <span class="arithmetic-operator">/</span> <span class="identifier">duration</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"n_samples: %d, n_features: %d"</span> <span class="arithmetic-operator">%</span> <span class="identifier">X_test</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="comment"># mapping from integer feature name to original token string</span>
<span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">use_hashing</span><span class="punctuation">:</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="none-literal">None</span>
<span class="keyword">else</span><span class="punctuation">:</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">vectorizer</span><span class="punctuation">.</span><span class="identifier">get_feature_names</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">select_chi2</span><span class="punctuation">:</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Extracting %d best features by a chi-squared test"</span> <span class="arithmetic-operator">%</span>
          <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">select_chi2</span><span class="grouping">)</span>
    <span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">ch2</span> <span class="arithmetic-assignment">=</span> <span class="identifier">SelectKBest</span><span class="grouping">(</span><span class="identifier">chi2</span><span class="punctuation">,</span> <span class="identifier">k</span><span class="arithmetic-assignment">=</span><span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">select_chi2</span><span class="grouping">)</span>
    <span class="identifier">X_train</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ch2</span><span class="punctuation">.</span><span class="identifier">fit_transform</span><span class="grouping">(</span><span class="identifier">X_train</span><span class="punctuation">,</span> <span class="identifier">y_train</span><span class="grouping">)</span>
    <span class="identifier">X_test</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ch2</span><span class="punctuation">.</span><span class="identifier">transform</span><span class="grouping">(</span><span class="identifier">X_test</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">feature_names</span><span class="punctuation">:</span>
        <span class="comment"># keep selected feature names</span>
        <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">i</span>
                         <span class="relational-operator">in</span> <span class="identifier">ch2</span><span class="punctuation">.</span><span class="identifier">get_support</span><span class="grouping">(</span><span class="identifier">indices</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span><span class="grouping">]</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"done in %fs"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="grouping">)</span>

<span class="keyword">if</span> <span class="identifier">feature_names</span><span class="punctuation">:</span>
    <span class="identifier">feature_names</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="grouping">(</span><span class="identifier">feature_names</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">trim</span><span class="grouping">(</span><span class="identifier">s</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Trim string to fit on terminal (assuming 80-column display)"""</span>
    <span class="keyword">return</span> <span class="identifier">s</span> <span class="keyword">if</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">s</span><span class="grouping">)</span> <span class="relational-operator">&lt;=</span> <span class="int-literal">80</span> <span class="keyword">else</span> <span class="identifier">s</span><span class="grouping">[</span><span class="punctuation">:</span><span class="int-literal">77</span><span class="grouping">]</span> <span class="arithmetic-operator">+</span> <span class="string-literal">"..."</span>


<span class="comment"># %%</span>
<span class="comment"># Benchmark classifiers</span>
<span class="comment"># ------------------------------------</span>
<span class="comment"># We train and test the datasets with 15 different classification models</span>
<span class="comment"># and get performance results for each model.</span>
<span class="keyword">def</span> <span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">clf</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'_'</span> <span class="arithmetic-operator">*</span> <span class="int-literal">80</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Training: "</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="identifier">clf</span><span class="grouping">)</span>
    <span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">X_train</span><span class="punctuation">,</span> <span class="identifier">y_train</span><span class="grouping">)</span>
    <span class="identifier">train_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"train time: %0.3fs"</span> <span class="arithmetic-operator">%</span> <span class="identifier">train_time</span><span class="grouping">)</span>

    <span class="identifier">t0</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">pred</span> <span class="arithmetic-assignment">=</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">X_test</span><span class="grouping">)</span>
    <span class="identifier">test_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">time</span><span class="grouping">(</span><span class="grouping">)</span> <span class="arithmetic-operator">-</span> <span class="identifier">t0</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"test time:  %0.3fs"</span> <span class="arithmetic-operator">%</span> <span class="identifier">test_time</span><span class="grouping">)</span>

    <span class="identifier">score</span> <span class="arithmetic-assignment">=</span> <span class="identifier">metrics</span><span class="punctuation">.</span><span class="identifier">accuracy_score</span><span class="grouping">(</span><span class="identifier">y_test</span><span class="punctuation">,</span> <span class="identifier">pred</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"accuracy:   %0.3f"</span> <span class="arithmetic-operator">%</span> <span class="identifier">score</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">,</span> <span class="string-literal">'coef_'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"dimensionality: %d"</span> <span class="arithmetic-operator">%</span> <span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">coef_</span><span class="punctuation">.</span><span class="identifier">shape</span><span class="grouping">[</span><span class="int-literal">1</span><span class="grouping">]</span><span class="grouping">)</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"density: %f"</span> <span class="arithmetic-operator">%</span> <span class="identifier">density</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">coef_</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">print_top10</span> <span class="logical-operator">and</span> <span class="identifier">feature_names</span> <span class="relational-operator">is</span> <span class="logical-operator">not</span> <span class="none-literal">None</span><span class="punctuation">:</span>
            <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"top 10 keywords per class:"</span><span class="grouping">)</span>
            <span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">label</span> <span class="relational-operator">in</span> <span class="identifier">enumerate</span><span class="grouping">(</span><span class="identifier">target_names</span><span class="grouping">)</span><span class="punctuation">:</span>
                <span class="identifier">top10</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">argsort</span><span class="grouping">(</span><span class="identifier">clf</span><span class="punctuation">.</span><span class="identifier">coef_</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">[</span><span class="arithmetic-operator">-</span><span class="int-literal">10</span><span class="punctuation">:</span><span class="grouping">]</span>
                <span class="identifier">print</span><span class="grouping">(</span><span class="identifier">trim</span><span class="grouping">(</span><span class="string-literal">"%s: %s" % (label, " "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">feature_names</span><span class="grouping">[</span><span class="identifier">top10</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">print_report</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"classification report:"</span><span class="grouping">)</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="identifier">metrics</span><span class="punctuation">.</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">f</span><span class="invalid">i</span><span class="invalid">c</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">y_test</span><span class="punctuation">,</span> <span class="identifier">pred</span><span class="punctuation">,</span>
                                            <span class="identifier">target_names</span><span class="arithmetic-assignment">=</span><span class="identifier">target_names</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">opts</span><span class="punctuation">.</span><span class="identifier">print_cm</span><span class="punctuation">:</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"confusion matrix:"</span><span class="grouping">)</span>
        <span class="identifier">print</span><span class="grouping">(</span><span class="identifier">metrics</span><span class="punctuation">.</span><span class="identifier">confusion_matrix</span><span class="grouping">(</span><span class="identifier">y_test</span><span class="punctuation">,</span> <span class="identifier">pred</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="identifier">print</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">clf_descr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">str</span><span class="grouping">(</span><span class="identifier">clf</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">split</span><span class="grouping">(</span><span class="string-literal">'('</span><span class="grouping">)</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span>
    <span class="keyword">return</span> <span class="identifier">clf_descr</span><span class="punctuation">,</span> <span class="identifier">score</span><span class="punctuation">,</span> <span class="identifier">train_time</span><span class="punctuation">,</span> <span class="identifier">test_time</span>


<span class="identifier">results</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
<span class="keyword">for</span> <span class="identifier">clf</span><span class="punctuation">,</span> <span class="identifier">name</span> <span class="relational-operator">in</span> <span class="grouping">(</span>
        <span class="grouping">(</span><span class="identifier">RidgeClassifier</span><span class="grouping">(</span><span class="identifier">tol</span><span class="arithmetic-assignment">=</span><span class="float-literal">1e-2</span><span class="punctuation">,</span> <span class="identifier">solver</span><span class="arithmetic-assignment">=</span><span class="string-literal">"sag"), "Ridge Classifier"</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="identifier">Perceptron</span><span class="grouping">(</span><span class="identifier">max_iter</span><span class="arithmetic-assignment">=</span><span class="int-literal">50</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">"Perceptron"</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="invalid">P</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">v</span><span class="invalid">e</span><span class="invalid">A</span><span class="invalid">g</span><span class="invalid">g</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">v</span><span class="invalid">e</span><span class="invalid">C</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">i</span><span class="invalid">f</span><span class="invalid">i</span><span class="invalid">e</span><span class="invalid">r</span><span class="grouping">(</span><span class="identifier">max_iter</span><span class="arithmetic-assignment">=</span><span class="int-literal">50</span><span class="grouping">)</span><span class="punctuation">,</span>
         <span class="string-literal">"Passive-Aggressive"</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="identifier">KNeighborsClassifier</span><span class="grouping">(</span><span class="identifier">n_neighbors</span><span class="arithmetic-assignment">=</span><span class="int-literal">10</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">"kNN"</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="identifier">RandomForestClassifier</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="string-literal">"Random forest"</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'='</span> <span class="arithmetic-operator">*</span> <span class="int-literal">80</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="identifier">name</span><span class="grouping">)</span>
    <span class="identifier">results</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">clf</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="keyword">for</span> <span class="identifier">penalty</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="string-literal">"l2", "l1"</span><span class="grouping">]</span><span class="punctuation">:</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'='</span> <span class="arithmetic-operator">*</span> <span class="int-literal">80</span><span class="grouping">)</span>
    <span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"%s penalty"</span> <span class="arithmetic-operator">%</span> <span class="identifier">penalty</span><span class="punctuation">.</span><span class="identifier">upper</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="comment"># Train Liblinear model</span>
    <span class="identifier">results</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">LinearSVC</span><span class="grouping">(</span><span class="identifier">penalty</span><span class="arithmetic-assignment">=</span><span class="identifier">penalty</span><span class="punctuation">,</span> <span class="identifier">dual</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                                       <span class="identifier">tol</span><span class="arithmetic-assignment">=</span><span class="float-literal">1e-3</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># Train SGD model</span>
    <span class="identifier">results</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">SGDClassifier</span><span class="grouping">(</span><span class="identifier">alpha</span><span class="arithmetic-assignment">=</span><span class="float-literal">.0001</span><span class="punctuation">,</span> <span class="identifier">max_iter</span><span class="arithmetic-assignment">=</span><span class="int-literal">50</span><span class="punctuation">,</span>
                                           <span class="identifier">penalty</span><span class="arithmetic-assignment">=</span><span class="identifier">penalty</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># Train SGD with Elastic Net penalty</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'='</span> <span class="arithmetic-operator">*</span> <span class="int-literal">80</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Elastic-Net penalty"</span><span class="grouping">)</span>
<span class="identifier">results</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">SGDClassifier</span><span class="grouping">(</span><span class="identifier">alpha</span><span class="arithmetic-assignment">=</span><span class="float-literal">.0001</span><span class="punctuation">,</span> <span class="identifier">max_iter</span><span class="arithmetic-assignment">=</span><span class="int-literal">50</span><span class="punctuation">,</span>
                                       <span class="identifier">penalty</span><span class="arithmetic-assignment">=</span><span class="string-literal">"elasticnet"</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># Train NearestCentroid without threshold</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'='</span> <span class="arithmetic-operator">*</span> <span class="int-literal">80</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"NearestCentroid (aka Rocchio classifier)"</span><span class="grouping">)</span>
<span class="identifier">results</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">NearestCentroid</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="comment"># Train sparse Naive Bayes classifiers</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'='</span> <span class="arithmetic-operator">*</span> <span class="int-literal">80</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"Naive Bayes"</span><span class="grouping">)</span>
<span class="identifier">results</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">MultinomialNB</span><span class="grouping">(</span><span class="identifier">alpha</span><span class="arithmetic-assignment">=</span><span class="float-literal">.01</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">results</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">BernoulliNB</span><span class="grouping">(</span><span class="identifier">alpha</span><span class="arithmetic-assignment">=</span><span class="float-literal">.01</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">results</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">ComplementNB</span><span class="grouping">(</span><span class="identifier">alpha</span><span class="arithmetic-assignment">=</span><span class="float-literal">.1</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">'='</span> <span class="arithmetic-operator">*</span> <span class="int-literal">80</span><span class="grouping">)</span>
<span class="identifier">print</span><span class="grouping">(</span><span class="string-literal">"LinearSVC with L1-based feature selection"</span><span class="grouping">)</span>
<span class="comment"># The smaller C, the stronger the regularization.</span>
<span class="comment"># The more regularization, the more sparsity.</span>
<span class="identifier">results</span><span class="punctuation">.</span><span class="identifier">append</span><span class="grouping">(</span><span class="identifier">benchmark</span><span class="grouping">(</span><span class="identifier">Pipeline</span><span class="grouping">(</span><span class="grouping">[</span>
  <span class="grouping">(</span><span class="string-literal">'feature_selection'</span><span class="punctuation">,</span> <span class="identifier">SelectFromModel</span><span class="grouping">(</span><span class="identifier">LinearSVC</span><span class="grouping">(</span><span class="identifier">penalty</span><span class="arithmetic-assignment">=</span><span class="string-literal">"l1"</span><span class="punctuation">,</span> <span class="identifier">dual</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span>
                                                  <span class="identifier">tol</span><span class="arithmetic-assignment">=</span><span class="float-literal">1e-3</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span>
  <span class="grouping">(</span><span class="string-literal">'classification'</span><span class="punctuation">,</span> <span class="identifier">LinearSVC</span><span class="grouping">(</span><span class="identifier">penalty</span><span class="arithmetic-assignment">=</span><span class="string-literal">"l2"</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">]</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="comment"># %%</span>
<span class="comment"># Add plots</span>
<span class="comment"># ------------------------------------</span>
<span class="comment"># The bar plot indicates the accuracy, training time (normalized) and test time</span>
<span class="comment"># (normalized) of each classifier.</span>
<span class="identifier">indices</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="identifier">len</span><span class="grouping">(</span><span class="identifier">results</span><span class="grouping">)</span><span class="grouping">)</span>

<span class="identifier">results</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">[</span><span class="identifier">x</span><span class="grouping">[</span><span class="identifier">i</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">x</span> <span class="relational-operator">in</span> <span class="identifier">results</span><span class="grouping">]</span> <span class="keyword">for</span> <span class="identifier">i</span> <span class="relational-operator">in</span> <span class="identifier">range</span><span class="grouping">(</span><span class="int-literal">4</span><span class="grouping">)</span><span class="grouping">]</span>

<span class="identifier">clf_names</span><span class="punctuation">,</span> <span class="identifier">score</span><span class="punctuation">,</span> <span class="identifier">training_time</span><span class="punctuation">,</span> <span class="identifier">test_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">results</span>
<span class="identifier">training_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">training_time</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="identifier">training_time</span><span class="grouping">)</span>
<span class="identifier">test_time</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">array</span><span class="grouping">(</span><span class="identifier">test_time</span><span class="grouping">)</span> <span class="arithmetic-operator">/</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">max</span><span class="grouping">(</span><span class="identifier">test_time</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">figure</span><span class="grouping">(</span><span class="identifier">figsize</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="int-literal">12</span><span class="punctuation">,</span> <span class="int-literal">8</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">title</span><span class="grouping">(</span><span class="string-literal">"Score"</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">barh</span><span class="grouping">(</span><span class="identifier">indices</span><span class="punctuation">,</span> <span class="identifier">score</span><span class="punctuation">,</span> <span class="float-literal">.2</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"score"</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'navy'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">barh</span><span class="grouping">(</span><span class="identifier">indices</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.3</span><span class="punctuation">,</span> <span class="identifier">training_time</span><span class="punctuation">,</span> <span class="float-literal">.2</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"training time"</span><span class="punctuation">,</span>
         <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'c'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">barh</span><span class="grouping">(</span><span class="identifier">indices</span> <span class="arithmetic-operator">+</span> <span class="float-literal">.6</span><span class="punctuation">,</span> <span class="identifier">test_time</span><span class="punctuation">,</span> <span class="float-literal">.2</span><span class="punctuation">,</span> <span class="identifier">label</span><span class="arithmetic-assignment">=</span><span class="string-literal">"test time"</span><span class="punctuation">,</span> <span class="identifier">color</span><span class="arithmetic-assignment">=</span><span class="string-literal">'darkorange'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">yticks</span><span class="grouping">(</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">legend</span><span class="grouping">(</span><span class="identifier">loc</span><span class="arithmetic-assignment">=</span><span class="string-literal">'best'</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplots_adjust</span><span class="grouping">(</span><span class="identifier">left</span><span class="arithmetic-assignment">=</span><span class="float-literal">.25</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplots_adjust</span><span class="grouping">(</span><span class="identifier">top</span><span class="arithmetic-assignment">=</span><span class="float-literal">.95</span><span class="grouping">)</span>
<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">subplots_adjust</span><span class="grouping">(</span><span class="identifier">bottom</span><span class="arithmetic-assignment">=</span><span class="float-literal">.05</span><span class="grouping">)</span>

<span class="keyword">for</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">c</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">indices</span><span class="punctuation">,</span> <span class="identifier">clf_names</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">text</span><span class="grouping">(</span><span class="float-literal">-.3</span><span class="punctuation">,</span> <span class="identifier">i</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="grouping">)</span>

<span class="identifier">plt</span><span class="punctuation">.</span><span class="identifier">show</span><span class="grouping">(</span><span class="grouping">)</span>

    </pre>
  </body>
</html>