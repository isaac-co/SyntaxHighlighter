<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="comment">"""This module contains the _EstimatorPrettyPrinter class used in
BaseEstimator.__repr__ for pretty-printing estimators"""</span>

<span class="comment"># Copyright (c) 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,</span>
<span class="comment"># 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018 Python Software Foundation;</span>
<span class="comment"># All Rights Reserved</span>

<span class="comment"># Authors: Fred L. Drake, Jr. &lt;fdrake@acm.org&gt; (built-in CPython pprint module)</span>
<span class="comment">#          Nicolas Hug (scikit-learn specific changes)</span>

<span class="comment"># License: PSF License version 2 (see below)</span>

<span class="comment"># PYTHON SOFTWARE FOUNDATION LICENSE VERSION 2</span>
<span class="comment"># --------------------------------------------</span>

<span class="comment"># 1. This LICENSE AGREEMENT is between the Python Software Foundation ("PSF"),</span>
<span class="comment"># and the Individual or Organization ("Licensee") accessing and otherwise</span>
<span class="comment"># using this software ("Python") in source or binary form and its associated</span>
<span class="comment"># documentation.</span>

<span class="comment"># 2. Subject to the terms and conditions of this License Agreement, PSF hereby</span>
<span class="comment"># grants Licensee a nonexclusive, royalty-free, world-wide license to</span>
<span class="comment"># reproduce, analyze, test, perform and/or display publicly, prepare</span>
<span class="comment"># derivative works, distribute, and otherwise use Python alone or in any</span>
<span class="comment"># derivative version, provided, however, that PSF's License Agreement and</span>
<span class="comment"># PSF's notice of copyright, i.e., "Copyright (c) 2001, 2002, 2003, 2004,</span>
<span class="comment"># 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016,</span>
<span class="comment"># 2017, 2018 Python Software Foundation; All Rights Reserved" are retained in</span>
<span class="comment"># Python alone or in any derivative version prepared by Licensee.</span>

<span class="comment"># 3. In the event Licensee prepares a derivative work that is based on or</span>
<span class="comment"># incorporates Python or any part thereof, and wants to make the derivative</span>
<span class="comment"># work available to others as provided herein, then Licensee hereby agrees to</span>
<span class="comment"># include in any such work a brief summary of the changes made to Python.</span>

<span class="comment"># 4. PSF is making Python available to Licensee on an "AS IS" basis. PSF MAKES</span>
<span class="comment"># NO REPRESENTATIONS OR WARRANTIES, EXPRESS OR IMPLIED. BY WAY OF EXAMPLE, BUT</span>
<span class="comment"># NOT LIMITATION, PSF MAKES NO AND DISCLAIMS ANY REPRESENTATION OR WARRANTY OF</span>
<span class="comment"># MERCHANTABILITY OR FITNESS FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF</span>
<span class="comment"># PYTHON WILL NOT INFRINGE ANY THIRD PARTY RIGHTS.</span>

<span class="comment"># 5. PSF SHALL NOT BE LIABLE TO LICENSEE OR ANY OTHER USERS OF PYTHON FOR ANY</span>
<span class="comment"># INCIDENTAL, SPECIAL, OR CONSEQUENTIAL DAMAGES OR LOSS AS A RESULT OF</span>
<span class="comment"># MODIFYING, DISTRIBUTING, OR OTHERWISE USING PYTHON, OR ANY DERIVATIVE</span>
<span class="comment"># THEREOF, EVEN IF ADVISED OF THE POSSIBILITY THEREOF.</span>

<span class="comment"># 6. This License Agreement will automatically terminate upon a material</span>
<span class="comment"># breach of its terms and conditions.</span>

<span class="comment"># 7. Nothing in this License Agreement shall be deemed to create any</span>
<span class="comment"># relationship of agency, partnership, or joint venture between PSF and</span>
<span class="comment"># Licensee. This License Agreement does not grant permission to use PSF</span>
<span class="comment"># trademarks or trade name in a trademark sense to endorse or promote products</span>
<span class="comment"># or services of Licensee, or any third party.</span>

<span class="comment"># 8. By copying, installing or otherwise using Python, Licensee agrees to be</span>
<span class="comment"># bound by the terms and conditions of this License Agreement.</span>


<span class="comment"># Brief summary of changes to original code:</span>
<span class="comment"># - "compact" parameter is supported for dicts, not just lists or tuples</span>
<span class="comment"># - estimators have a custom handler, they're not just treated as objects</span>
<span class="comment"># - long sequences (lists, tuples, dict items) with more than N elements are</span>
<span class="comment">#   shortened using ellipsis (', ...') at the end.</span>

<span class="keyword">import</span> <span class="identifier">inspect</span>
<span class="keyword">import</span> <span class="identifier">pprint</span>
<span class="keyword">from</span> <span class="identifier">collections</span> <span class="keyword">import</span> <span class="identifier">OrderedDict</span>

<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">base</span> <span class="keyword">import</span> <span class="identifier">BaseEstimator</span>
<span class="keyword">from</span> <span class="punctuation">.</span><span class="punctuation">.</span><span class="identifier">_config</span> <span class="keyword">import</span> <span class="identifier">get_config</span>
<span class="keyword">from</span> <span class="punctuation">.</span> <span class="keyword">import</span> <span class="identifier">is_scalar_nan</span>


<span class="keyword">class</span> <span class="identifier">KeyValTuple</span><span class="grouping">(</span><span class="identifier">tuple</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Dummy class for correctly rendering key-value tuples from dicts."""</span>
    <span class="keyword">def</span> <span class="identifier">__repr__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># needed for _dispatch[tuple.__repr__] not to be overridden</span>
        <span class="keyword">return</span> <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__repr__</span><span class="grouping">(</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">KeyValTupleParam</span><span class="grouping">(</span><span class="identifier">KeyValTuple</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Dummy class for correctly rendering key-value tuples from parameters."""</span>
    <span class="keyword">pass</span>


<span class="keyword">def</span> <span class="identifier">_changed_params</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Return dict (param_name: value) of parameters that were given to
    estimator with non-default values."""</span>

    <span class="identifier">params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">get_params</span><span class="grouping">(</span><span class="identifier">deep</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
    <span class="identifier">init_func</span> <span class="arithmetic-assignment">=</span> <span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="punctuation">,</span> <span class="string-literal">'deprecated_original'</span><span class="punctuation">,</span>
                        <span class="identifier">estimator</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">)</span>
    <span class="identifier">init_params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">signature</span><span class="grouping">(</span><span class="identifier">init_func</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">parameters</span>
    <span class="identifier">init_params</span> <span class="arithmetic-assignment">=</span> <span class="grouping">{</span><span class="identifier">name</span><span class="punctuation">:</span> <span class="identifier">param</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">f</span><span class="invalid">a</span><span class="invalid">u</span><span class="invalid">l</span><span class="invalid">t</span> <span class="keyword">for</span> <span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">param</span> <span class="relational-operator">in</span> <span class="identifier">init_params</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">}</span>

    <span class="keyword">def</span> <span class="identifier">has_changed</span><span class="grouping">(</span><span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">k</span> <span class="logical-operator">not</span> <span class="relational-operator">in</span> <span class="identifier">init_params</span><span class="punctuation">:</span>  <span class="comment"># happens if k is part of a **kwargs</span>
            <span class="keyword">return</span> <span class="bool-literal">True</span>
        <span class="keyword">if</span> <span class="identifier">init_params</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="identifier">inspect</span><span class="punctuation">.</span><span class="identifier">_empty</span><span class="punctuation">:</span>  <span class="comment"># k has no default value</span>
            <span class="keyword">return</span> <span class="bool-literal">True</span>
        <span class="comment"># try to avoid calling repr on nested estimators</span>
        <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">v</span><span class="punctuation">,</span> <span class="identifier">BaseEstimator</span><span class="grouping">)</span> <span class="logical-operator">and</span>
           <span class="identifier">v</span><span class="punctuation">.</span><span class="identifier">__class__</span> <span class="relational-operator">!=</span> <span class="identifier">init_params</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="bool-literal">True</span>
        <span class="comment"># Use repr as a last resort. It may be expensive.</span>
        <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">repr</span><span class="grouping">(</span><span class="identifier">v</span><span class="grouping">)</span> <span class="relational-operator">!=</span> <span class="identifier">repr</span><span class="grouping">(</span><span class="identifier">init_params</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span><span class="grouping">)</span> <span class="logical-operator">and</span>
           <span class="logical-operator">not</span> <span class="grouping">(</span><span class="identifier">is_scalar_nan</span><span class="grouping">(</span><span class="identifier">init_params</span><span class="grouping">[</span><span class="identifier">k</span><span class="grouping">]</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="identifier">is_scalar_nan</span><span class="grouping">(</span><span class="identifier">v</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="bool-literal">True</span>
        <span class="keyword">return</span> <span class="bool-literal">False</span>

    <span class="keyword">return</span> <span class="grouping">{</span><span class="identifier">k</span><span class="punctuation">:</span> <span class="identifier">v</span> <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span> <span class="relational-operator">in</span> <span class="identifier">params</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span> <span class="keyword">if</span> <span class="identifier">has_changed</span><span class="grouping">(</span><span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span><span class="grouping">)</span><span class="grouping">}</span>


<span class="keyword">class</span> <span class="identifier">_EstimatorPrettyPrinter</span><span class="grouping">(</span><span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">PrettyPrinter</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Pretty Printer class for estimator objects.

    This extends the pprint.PrettyPrinter class, because:
    - we need estimators to be printed with their parameters, e.g.
      Estimator(param1=value1, ...) which is not supported by default.
    - the 'compact' parameter of PrettyPrinter is ignored for dicts, which
      may lead to very long representations that we want to avoid.

    Quick overview of pprint.PrettyPrinter (see also
    https://stackoverflow.com/questions/49565047/pprint-with-hex-numbers):

    - the entry point is the _format() method which calls format() (overridden
      here)
    - format() directly calls _safe_repr() for a first try at rendering the
      object
    - _safe_repr formats the whole object reccursively, only calling itself,
      not caring about line length or anything
    - back to _format(), if the output string is too long, _format() then calls
      the appropriate _pprint_TYPE() method (e.g. _pprint_list()) depending on
      the type of the object. This where the line length and the compact
      parameters are taken into account.
    - those _pprint_TYPE() methods will internally use the format() method for
      rendering the nested objects of an object (e.g. the elements of a list)

    In the end, everything has to be implemented twice: in _safe_repr and in
    the custom _pprint_TYPE methods. Unfortunately PrettyPrinter is really not
    straightforward to extend (especially when we want a compact output), so
    the code is a bit convoluted.

    This class overrides:
    - format() to support the changed_only parameter
    - _safe_repr to support printing of estimators (for when they fit on a
      single line)
    - _format_dict_items so that dict are correctly 'compacted'
    - _format_items so that ellipsis is used on long lists and tuples

    When estimators cannot be printed on a single line, the builtin _format()
    will call _pprint_estimator() because it was registered to do so (see
    _dispatch[BaseEstimator.__repr__] = _pprint_estimator).

    both _format_dict_items() and _pprint_estimator() use the
    _format_params_or_dict_items() method that will format parameters and
    key-value pairs respecting the compact parameter. This method needs another
    subroutine _pprint_key_val_tuple() used when a parameter or a key-value
    pair is too long to fit on a single line. This subroutine is called in
    _format() and is registered as well in the _dispatch dict (just like
    _pprint_estimator). We had to create the two classes KeyValTuple and
    KeyValTupleParam for this.
    """</span>

    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="arithmetic-assignment">=</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="arithmetic-assignment">=</span><span class="int-literal">80</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="punctuation">,</span> <span class="arithmetic-operator">*</span><span class="punctuation">,</span>
                 <span class="identifier">compact</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">indent_at_name</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="punctuation">,</span>
                 <span class="identifier">n_max_elements_to_show</span><span class="arithmetic-assignment">=</span><span class="none-literal">None</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">super</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">width</span><span class="punctuation">,</span> <span class="identifier">depth</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">compact</span><span class="arithmetic-assignment">=</span><span class="identifier">compact</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_indent_at_name</span> <span class="arithmetic-assignment">=</span> <span class="identifier">indent_at_name</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_indent_at_name</span><span class="punctuation">:</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_indent_per_level</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span>  <span class="comment"># ignore indent param</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_changed_only</span> <span class="arithmetic-assignment">=</span> <span class="identifier">get_config</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">[</span><span class="string-literal">'print_changed_only'</span><span class="grouping">]</span>
        <span class="comment"># Max number of elements in a list, dict, tuple until we start using</span>
        <span class="comment"># ellipsis. This also affects the number of arguments of an estimators</span>
        <span class="comment"># (they are treated as dicts)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_max_elements_to_show</span> <span class="arithmetic-assignment">=</span> <span class="identifier">n_max_elements_to_show</span>

    <span class="keyword">def</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">object</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">maxlevels</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">_safe_repr</span><span class="grouping">(</span><span class="identifier">object</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">maxlevels</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span>
                          <span class="identifier">changed_only</span><span class="arithmetic-assignment">=</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_changed_only</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_pprint_estimator</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">object</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">allowance</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span>
                          <span class="identifier">level</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">stream</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="identifier">object</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span> <span class="arithmetic-operator">+</span> <span class="string-literal">'('</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_indent_at_name</span><span class="punctuation">:</span>
            <span class="identifier">indent</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">object</span><span class="punctuation">.</span><span class="identifier">__class__</span><span class="punctuation">.</span><span class="identifier">__name__</span><span class="grouping">)</span>

        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_changed_only</span><span class="punctuation">:</span>
            <span class="identifier">params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_changed_params</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">object</span><span class="punctuation">.</span><span class="identifier">get_params</span><span class="grouping">(</span><span class="identifier">deep</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>

        <span class="identifier">params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">OrderedDict</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">val</span><span class="grouping">)</span>
                             <span class="keyword">for</span> <span class="grouping">(</span><span class="identifier">name</span><span class="punctuation">,</span> <span class="identifier">val</span><span class="grouping">)</span> <span class="relational-operator">in</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">params</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_format_params</span><span class="grouping">(</span><span class="identifier">params</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">allowance</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="punctuation">,</span>
                            <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span>
        <span class="identifier">stream</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">')'</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_format_dict_items</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">items</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">allowance</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span>
                           <span class="identifier">level</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_format_params_or_dict_items</span><span class="grouping">(</span>
            <span class="identifier">items</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">allowance</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span> <span class="identifier">is_dict</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_format_params</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">items</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">allowance</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_format_params_or_dict_items</span><span class="grouping">(</span>
            <span class="identifier">items</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">allowance</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span> <span class="identifier">is_dict</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_format_params_or_dict_items</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">object</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">allowance</span><span class="punctuation">,</span>
                                     <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span> <span class="identifier">is_dict</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Format dict items or parameters respecting the compact=True
        parameter. For some reason, the builtin rendering of dict items doesn't
        respect compact=True and will use one line per key-value if all cannot
        fit in a single line.
        Dict items will be rendered as &lt;'key': value&gt; while params will be
        rendered as &lt;key=value&gt;. The implementation is mostly copy/pasting from
        the builtin _format_items().
        This also adds ellipsis if the number of items is greater than
        self.n_max_elements_to_show.
        """</span>
        <span class="identifier">write</span> <span class="arithmetic-assignment">=</span> <span class="identifier">stream</span><span class="punctuation">.</span><span class="identifier">write</span>
        <span class="identifier">indent</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_indent_per_level</span>
        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">n</span><span class="invalid">l</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">',\n' + ' '</span> <span class="arithmetic-operator">*</span> <span class="identifier">indent</span>
        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">''</span>
        <span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">max_width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_width</span> <span class="arithmetic-operator">-</span> <span class="identifier">indent</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span>
        <span class="identifier">it</span> <span class="arithmetic-assignment">=</span> <span class="identifier">iter</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="identifier">next_ent</span> <span class="arithmetic-assignment">=</span> <span class="identifier">next</span><span class="grouping">(</span><span class="identifier">it</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">StopIteration</span><span class="punctuation">:</span>
            <span class="keyword">return</span>
        <span class="identifier">last</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="identifier">n_items</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
        <span class="keyword">while</span> <span class="logical-operator">not</span> <span class="identifier">last</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">n_items</span> <span class="relational-operator">==</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_max_elements_to_show</span><span class="punctuation">:</span>
                <span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">', ...'</span><span class="grouping">)</span>
                <span class="keyword">break</span>
            <span class="identifier">n_items</span> <span class="arithmetic-assignment">+=</span> <span class="int-literal">1</span>
            <span class="identifier">ent</span> <span class="arithmetic-assignment">=</span> <span class="identifier">next_ent</span>
            <span class="keyword">try</span><span class="punctuation">:</span>
                <span class="identifier">next_ent</span> <span class="arithmetic-assignment">=</span> <span class="identifier">next</span><span class="grouping">(</span><span class="identifier">it</span><span class="grouping">)</span>
            <span class="keyword">except</span> <span class="identifier">StopIteration</span><span class="punctuation">:</span>
                <span class="identifier">last</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
                <span class="identifier">max_width</span> <span class="arithmetic-assignment">-=</span> <span class="identifier">allowance</span>
                <span class="identifier">width</span> <span class="arithmetic-assignment">-=</span> <span class="identifier">allowance</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_compact</span><span class="punctuation">:</span>
                <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ent</span>
                <span class="identifier">krepr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_repr</span><span class="grouping">(</span><span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span>
                <span class="identifier">vrepr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_repr</span><span class="grouping">(</span><span class="identifier">v</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span>
                <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">is_dict</span><span class="punctuation">:</span>
                    <span class="identifier">krepr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">krepr</span><span class="punctuation">.</span><span class="identifier">strip</span><span class="grouping">(</span><span class="string-literal">"'"</span><span class="grouping">)</span>
                <span class="identifier">middle</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">': ' if is_dict else '='</span>
                <span class="identifier">rep</span> <span class="arithmetic-assignment">=</span> <span class="identifier">krepr</span> <span class="arithmetic-operator">+</span> <span class="identifier">middle</span> <span class="arithmetic-operator">+</span> <span class="identifier">vrepr</span>
                <span class="identifier">w</span> <span class="arithmetic-assignment">=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">rep</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="int-literal">2</span>
                <span class="keyword">if</span> <span class="identifier">width</span> <span class="relational-operator">&lt;</span> <span class="identifier">w</span><span class="punctuation">:</span>
                    <span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">max_width</span>
                    <span class="keyword">if</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="punctuation">:</span>
                        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span> <span class="arithmetic-assignment">=</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">n</span><span class="invalid">l</span>
                <span class="keyword">if</span> <span class="identifier">width</span> <span class="relational-operator">&gt;=</span> <span class="identifier">w</span><span class="punctuation">:</span>
                    <span class="identifier">width</span> <span class="arithmetic-assignment">-=</span> <span class="identifier">w</span>
                    <span class="identifier">write</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="grouping">)</span>
                    <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">', '</span>
                    <span class="identifier">write</span><span class="grouping">(</span><span class="identifier">rep</span><span class="grouping">)</span>
                    <span class="keyword">continue</span>
            <span class="identifier">write</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="grouping">)</span>
            <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span> <span class="arithmetic-assignment">=</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">n</span><span class="invalid">l</span>
            <span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span> <span class="arithmetic-assignment">=</span> <span class="identifier">KeyValTuple</span> <span class="keyword">if</span> <span class="identifier">is_dict</span> <span class="keyword">else</span> <span class="identifier">KeyValTupleParam</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_format</span><span class="grouping">(</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">_</span><span class="grouping">(</span><span class="identifier">ent</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span>
                         <span class="identifier">allowance</span> <span class="keyword">if</span> <span class="identifier">last</span> <span class="keyword">else</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_format_items</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">items</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">allowance</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Format the items of an iterable (list, tuple...). Same as the
        built-in _format_items, with support for ellipsis if the number of
        elements is greater than self.n_max_elements_to_show.
        """</span>
        <span class="identifier">write</span> <span class="arithmetic-assignment">=</span> <span class="identifier">stream</span><span class="punctuation">.</span><span class="identifier">write</span>
        <span class="identifier">indent</span> <span class="arithmetic-assignment">+=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_indent_per_level</span>
        <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_indent_per_level</span> <span class="relational-operator">&gt;</span> <span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="identifier">write</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_indent_per_level</span> <span class="arithmetic-operator">-</span> <span class="int-literal">1</span><span class="grouping">)</span> <span class="arithmetic-operator">*</span> <span class="string-literal">' '</span><span class="grouping">)</span>
        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">n</span><span class="invalid">l</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">',\n' + ' '</span> <span class="arithmetic-operator">*</span> <span class="identifier">indent</span>
        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">''</span>
        <span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">max_width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_width</span> <span class="arithmetic-operator">-</span> <span class="identifier">indent</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span>
        <span class="identifier">it</span> <span class="arithmetic-assignment">=</span> <span class="identifier">iter</span><span class="grouping">(</span><span class="identifier">items</span><span class="grouping">)</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="identifier">next_ent</span> <span class="arithmetic-assignment">=</span> <span class="identifier">next</span><span class="grouping">(</span><span class="identifier">it</span><span class="grouping">)</span>
        <span class="keyword">except</span> <span class="identifier">StopIteration</span><span class="punctuation">:</span>
            <span class="keyword">return</span>
        <span class="identifier">last</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="identifier">n_items</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>
        <span class="keyword">while</span> <span class="logical-operator">not</span> <span class="identifier">last</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="identifier">n_items</span> <span class="relational-operator">==</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">n_max_elements_to_show</span><span class="punctuation">:</span>
                <span class="identifier">write</span><span class="grouping">(</span><span class="string-literal">', ...'</span><span class="grouping">)</span>
                <span class="keyword">break</span>
            <span class="identifier">n_items</span> <span class="arithmetic-assignment">+=</span> <span class="int-literal">1</span>
            <span class="identifier">ent</span> <span class="arithmetic-assignment">=</span> <span class="identifier">next_ent</span>
            <span class="keyword">try</span><span class="punctuation">:</span>
                <span class="identifier">next_ent</span> <span class="arithmetic-assignment">=</span> <span class="identifier">next</span><span class="grouping">(</span><span class="identifier">it</span><span class="grouping">)</span>
            <span class="keyword">except</span> <span class="identifier">StopIteration</span><span class="punctuation">:</span>
                <span class="identifier">last</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
                <span class="identifier">max_width</span> <span class="arithmetic-assignment">-=</span> <span class="identifier">allowance</span>
                <span class="identifier">width</span> <span class="arithmetic-assignment">-=</span> <span class="identifier">allowance</span>
            <span class="keyword">if</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_compact</span><span class="punctuation">:</span>
                <span class="identifier">rep</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_repr</span><span class="grouping">(</span><span class="identifier">ent</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span>
                <span class="identifier">w</span> <span class="arithmetic-assignment">=</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">rep</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="int-literal">2</span>
                <span class="keyword">if</span> <span class="identifier">width</span> <span class="relational-operator">&lt;</span> <span class="identifier">w</span><span class="punctuation">:</span>
                    <span class="identifier">width</span> <span class="arithmetic-assignment">=</span> <span class="identifier">max_width</span>
                    <span class="keyword">if</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="punctuation">:</span>
                        <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span> <span class="arithmetic-assignment">=</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">n</span><span class="invalid">l</span>
                <span class="keyword">if</span> <span class="identifier">width</span> <span class="relational-operator">&gt;=</span> <span class="identifier">w</span><span class="punctuation">:</span>
                    <span class="identifier">width</span> <span class="arithmetic-assignment">-=</span> <span class="identifier">w</span>
                    <span class="identifier">write</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="grouping">)</span>
                    <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">', '</span>
                    <span class="identifier">write</span><span class="grouping">(</span><span class="identifier">rep</span><span class="grouping">)</span>
                    <span class="keyword">continue</span>
            <span class="identifier">write</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="grouping">)</span>
            <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span> <span class="arithmetic-assignment">=</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">n</span><span class="invalid">l</span>
            <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_format</span><span class="grouping">(</span><span class="identifier">ent</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span>
                         <span class="identifier">allowance</span> <span class="keyword">if</span> <span class="identifier">last</span> <span class="keyword">else</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_pprint_key_val_tuple</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">object</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span><span class="punctuation">,</span> <span class="identifier">allowance</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span>
                              <span class="identifier">level</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Pretty printing for key-value tuples from dict or parameters."""</span>
        <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span> <span class="arithmetic-assignment">=</span> <span class="identifier">object</span>
        <span class="identifier">rep</span> <span class="arithmetic-assignment">=</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_repr</span><span class="grouping">(</span><span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">object</span><span class="punctuation">,</span> <span class="identifier">KeyValTupleParam</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">rep</span> <span class="arithmetic-assignment">=</span> <span class="identifier">rep</span><span class="punctuation">.</span><span class="identifier">strip</span><span class="grouping">(</span><span class="string-literal">"'"</span><span class="grouping">)</span>
            <span class="identifier">middle</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'='</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">middle</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">': '</span>
        <span class="identifier">stream</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="identifier">rep</span><span class="grouping">)</span>
        <span class="identifier">stream</span><span class="punctuation">.</span><span class="identifier">write</span><span class="grouping">(</span><span class="identifier">middle</span><span class="grouping">)</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">_format</span><span class="grouping">(</span><span class="identifier">v</span><span class="punctuation">,</span> <span class="identifier">stream</span><span class="punctuation">,</span> <span class="identifier">indent</span> <span class="arithmetic-operator">+</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">rep</span><span class="grouping">)</span> <span class="arithmetic-operator">+</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">middle</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">allowance</span><span class="punctuation">,</span>
                     <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="grouping">)</span>

    <span class="comment"># Note: need to copy _dispatch to prevent instances of the builtin</span>
    <span class="comment"># PrettyPrinter class to call methods of _EstimatorPrettyPrinter (see issue</span>
    <span class="comment"># 12906)</span>
    <span class="comment"># mypy error: "Type[PrettyPrinter]" has no attribute "_dispatch"</span>
    <span class="identifier">_dispatch</span> <span class="arithmetic-assignment">=</span> <span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">PrettyPrinter</span><span class="punctuation">.</span><span class="identifier">_dispatch</span><span class="punctuation">.</span><span class="identifier">copy</span><span class="grouping">(</span><span class="grouping">)</span>  <span class="comment"># type: ignore</span>
    <span class="identifier">_dispatch</span><span class="grouping">[</span><span class="identifier">BaseEstimator</span><span class="punctuation">.</span><span class="identifier">__repr__</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_pprint_estimator</span>
    <span class="identifier">_dispatch</span><span class="grouping">[</span><span class="identifier">KeyValTuple</span><span class="punctuation">.</span><span class="identifier">__repr__</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_pprint_key_val_tuple</span>


<span class="keyword">def</span> <span class="identifier">_safe_repr</span><span class="grouping">(</span><span class="identifier">object</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">maxlevels</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span> <span class="identifier">changed_only</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Same as the builtin _safe_repr, with added support for Estimator
    objects."""</span>
    <span class="identifier">typ</span> <span class="arithmetic-assignment">=</span> <span class="identifier">type</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">typ</span> <span class="relational-operator">in</span> <span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">_builtin_scalars</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">repr</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="bool-literal">False</span>

    <span class="identifier">r</span> <span class="arithmetic-assignment">=</span> <span class="identifier">getattr</span><span class="grouping">(</span><span class="identifier">typ</span><span class="punctuation">,</span> <span class="string-literal">"__repr__"</span><span class="punctuation">,</span> <span class="none-literal">None</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">issubclass</span><span class="grouping">(</span><span class="identifier">typ</span><span class="punctuation">,</span> <span class="identifier">dict</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="identifier">r</span> <span class="relational-operator">is</span> <span class="identifier">dict</span><span class="punctuation">.</span><span class="identifier">__repr__</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">object</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="string-literal">"{}"</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="bool-literal">False</span>
        <span class="identifier">objid</span> <span class="arithmetic-assignment">=</span> <span class="identifier">id</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">maxlevels</span> <span class="logical-operator">and</span> <span class="identifier">level</span> <span class="relational-operator">&gt;=</span> <span class="identifier">maxlevels</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="string-literal">"{...}"</span><span class="punctuation">,</span> <span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">objid</span> <span class="relational-operator">in</span> <span class="identifier">context</span>
        <span class="keyword">if</span> <span class="identifier">objid</span> <span class="relational-operator">in</span> <span class="identifier">context</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">_recursion</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="bool-literal">False</span><span class="punctuation">,</span> <span class="bool-literal">True</span>
        <span class="identifier">context</span><span class="grouping">[</span><span class="identifier">objid</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span>
        <span class="identifier">readable</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="identifier">recursive</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="identifier">components</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="identifier">append</span> <span class="arithmetic-assignment">=</span> <span class="identifier">components</span><span class="punctuation">.</span><span class="identifier">append</span>
        <span class="identifier">level</span> <span class="arithmetic-assignment">+=</span> <span class="int-literal">1</span>
        <span class="identifier">saferepr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_safe_repr</span>
        <span class="identifier">items</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">object</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="arithmetic-assignment">=</span><span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">_safe_tuple</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span> <span class="relational-operator">in</span> <span class="identifier">items</span><span class="punctuation">:</span>
            <span class="identifier">krepr</span><span class="punctuation">,</span> <span class="identifier">kreadable</span><span class="punctuation">,</span> <span class="identifier">krecur</span> <span class="arithmetic-assignment">=</span> <span class="identifier">saferepr</span><span class="grouping">(</span>
                <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">maxlevels</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span> <span class="identifier">changed_only</span><span class="arithmetic-assignment">=</span><span class="identifier">changed_only</span><span class="grouping">)</span>
            <span class="identifier">vrepr</span><span class="punctuation">,</span> <span class="identifier">vreadable</span><span class="punctuation">,</span> <span class="identifier">vrecur</span> <span class="arithmetic-assignment">=</span> <span class="identifier">saferepr</span><span class="grouping">(</span>
                <span class="identifier">v</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">maxlevels</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span> <span class="identifier">changed_only</span><span class="arithmetic-assignment">=</span><span class="identifier">changed_only</span><span class="grouping">)</span>
            <span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">"%s: %s"</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">krepr</span><span class="punctuation">,</span> <span class="identifier">vrepr</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="identifier">readable</span> <span class="arithmetic-assignment">=</span> <span class="identifier">readable</span> <span class="logical-operator">and</span> <span class="identifier">kreadable</span> <span class="logical-operator">and</span> <span class="identifier">vreadable</span>
            <span class="keyword">if</span> <span class="identifier">krecur</span> <span class="logical-operator">or</span> <span class="identifier">vrecur</span><span class="punctuation">:</span>
                <span class="identifier">recursive</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="keyword">del</span> <span class="identifier">context</span><span class="grouping">[</span><span class="identifier">objid</span><span class="grouping">]</span>
        <span class="keyword">return</span> <span class="string-literal">"{%s}" % ", "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">components</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">readable</span><span class="punctuation">,</span> <span class="identifier">recursive</span>

    <span class="keyword">if</span> <span class="grouping">(</span><span class="identifier">issubclass</span><span class="grouping">(</span><span class="identifier">typ</span><span class="punctuation">,</span> <span class="identifier">list</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="identifier">r</span> <span class="relational-operator">is</span> <span class="identifier">list</span><span class="punctuation">.</span><span class="identifier">__repr__</span><span class="grouping">)</span> <span class="logical-operator">or</span> <span class="invalid">\</span>
       <span class="grouping">(</span><span class="identifier">issubclass</span><span class="grouping">(</span><span class="identifier">typ</span><span class="punctuation">,</span> <span class="identifier">tuple</span><span class="grouping">)</span> <span class="logical-operator">and</span> <span class="identifier">r</span> <span class="relational-operator">is</span> <span class="identifier">tuple</span><span class="punctuation">.</span><span class="identifier">__repr__</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">if</span> <span class="identifier">issubclass</span><span class="grouping">(</span><span class="identifier">typ</span><span class="punctuation">,</span> <span class="identifier">list</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">object</span><span class="punctuation">:</span>
                <span class="keyword">return</span> <span class="string-literal">"[]"</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="bool-literal">False</span>
            <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"[%s]"</span>
        <span class="keyword">elif</span> <span class="identifier">len</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span><span class="punctuation">:</span>
            <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"(%s,)"</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">object</span><span class="punctuation">:</span>
                <span class="keyword">return</span> <span class="string-literal">"()"</span><span class="punctuation">,</span> <span class="bool-literal">True</span><span class="punctuation">,</span> <span class="bool-literal">False</span>
            <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"(%s)"</span>
        <span class="identifier">objid</span> <span class="arithmetic-assignment">=</span> <span class="identifier">id</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">maxlevels</span> <span class="logical-operator">and</span> <span class="identifier">level</span> <span class="relational-operator">&gt;=</span> <span class="identifier">maxlevels</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span> <span class="arithmetic-operator">%</span> <span class="string-literal">"..."</span><span class="punctuation">,</span> <span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">objid</span> <span class="relational-operator">in</span> <span class="identifier">context</span>
        <span class="keyword">if</span> <span class="identifier">objid</span> <span class="relational-operator">in</span> <span class="identifier">context</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">_recursion</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="bool-literal">False</span><span class="punctuation">,</span> <span class="bool-literal">True</span>
        <span class="identifier">context</span><span class="grouping">[</span><span class="identifier">objid</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span>
        <span class="identifier">readable</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="identifier">recursive</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="identifier">components</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="identifier">append</span> <span class="arithmetic-assignment">=</span> <span class="identifier">components</span><span class="punctuation">.</span><span class="identifier">append</span>
        <span class="identifier">level</span> <span class="arithmetic-assignment">+=</span> <span class="int-literal">1</span>
        <span class="keyword">for</span> <span class="identifier">o</span> <span class="relational-operator">in</span> <span class="identifier">object</span><span class="punctuation">:</span>
            <span class="identifier">orepr</span><span class="punctuation">,</span> <span class="identifier">oreadable</span><span class="punctuation">,</span> <span class="identifier">orecur</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_safe_repr</span><span class="grouping">(</span>
                <span class="identifier">o</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">maxlevels</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span> <span class="identifier">changed_only</span><span class="arithmetic-assignment">=</span><span class="identifier">changed_only</span><span class="grouping">)</span>
            <span class="identifier">append</span><span class="grouping">(</span><span class="identifier">orepr</span><span class="grouping">)</span>
            <span class="keyword">if</span> <span class="logical-operator">not</span> <span class="identifier">oreadable</span><span class="punctuation">:</span>
                <span class="identifier">readable</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
            <span class="keyword">if</span> <span class="identifier">orecur</span><span class="punctuation">:</span>
                <span class="identifier">recursive</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="keyword">del</span> <span class="identifier">context</span><span class="grouping">[</span><span class="identifier">objid</span><span class="grouping">]</span>
        <span class="keyword">return</span> <span class="invalid">f</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span> <span class="arithmetic-operator">%</span> <span class="string-literal">", "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">components</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">readable</span><span class="punctuation">,</span> <span class="identifier">recursive</span>

    <span class="keyword">if</span> <span class="identifier">issubclass</span><span class="grouping">(</span><span class="identifier">typ</span><span class="punctuation">,</span> <span class="identifier">BaseEstimator</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">objid</span> <span class="arithmetic-assignment">=</span> <span class="identifier">id</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span>
        <span class="keyword">if</span> <span class="identifier">maxlevels</span> <span class="logical-operator">and</span> <span class="identifier">level</span> <span class="relational-operator">&gt;=</span> <span class="identifier">maxlevels</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="string-literal">"{...}"</span><span class="punctuation">,</span> <span class="bool-literal">False</span><span class="punctuation">,</span> <span class="identifier">objid</span> <span class="relational-operator">in</span> <span class="identifier">context</span>
        <span class="keyword">if</span> <span class="identifier">objid</span> <span class="relational-operator">in</span> <span class="identifier">context</span><span class="punctuation">:</span>
            <span class="keyword">return</span> <span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">_recursion</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="bool-literal">False</span><span class="punctuation">,</span> <span class="bool-literal">True</span>
        <span class="identifier">context</span><span class="grouping">[</span><span class="identifier">objid</span><span class="grouping">]</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">1</span>
        <span class="identifier">readable</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="identifier">recursive</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="keyword">if</span> <span class="identifier">changed_only</span><span class="punctuation">:</span>
            <span class="identifier">params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_changed_params</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="identifier">params</span> <span class="arithmetic-assignment">=</span> <span class="identifier">object</span><span class="punctuation">.</span><span class="identifier">get_params</span><span class="grouping">(</span><span class="identifier">deep</span><span class="arithmetic-assignment">=</span><span class="bool-literal">False</span><span class="grouping">)</span>
        <span class="identifier">components</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="grouping">]</span>
        <span class="identifier">append</span> <span class="arithmetic-assignment">=</span> <span class="identifier">components</span><span class="punctuation">.</span><span class="identifier">append</span>
        <span class="identifier">level</span> <span class="arithmetic-assignment">+=</span> <span class="int-literal">1</span>
        <span class="identifier">saferepr</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_safe_repr</span>
        <span class="identifier">items</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sorted</span><span class="grouping">(</span><span class="identifier">params</span><span class="punctuation">.</span><span class="identifier">items</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">key</span><span class="arithmetic-assignment">=</span><span class="identifier">pprint</span><span class="punctuation">.</span><span class="identifier">_safe_tuple</span><span class="grouping">)</span>
        <span class="keyword">for</span> <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">v</span> <span class="relational-operator">in</span> <span class="identifier">items</span><span class="punctuation">:</span>
            <span class="identifier">krepr</span><span class="punctuation">,</span> <span class="identifier">kreadable</span><span class="punctuation">,</span> <span class="identifier">krecur</span> <span class="arithmetic-assignment">=</span> <span class="identifier">saferepr</span><span class="grouping">(</span>
                <span class="identifier">k</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">maxlevels</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span> <span class="identifier">changed_only</span><span class="arithmetic-assignment">=</span><span class="identifier">changed_only</span><span class="grouping">)</span>
            <span class="identifier">vrepr</span><span class="punctuation">,</span> <span class="identifier">vreadable</span><span class="punctuation">,</span> <span class="identifier">vrecur</span> <span class="arithmetic-assignment">=</span> <span class="identifier">saferepr</span><span class="grouping">(</span>
                <span class="identifier">v</span><span class="punctuation">,</span> <span class="identifier">context</span><span class="punctuation">,</span> <span class="identifier">maxlevels</span><span class="punctuation">,</span> <span class="identifier">level</span><span class="punctuation">,</span> <span class="identifier">changed_only</span><span class="arithmetic-assignment">=</span><span class="identifier">changed_only</span><span class="grouping">)</span>
            <span class="identifier">append</span><span class="grouping">(</span><span class="string-literal">"%s=%s" % (krepr.strip("'"</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">vrepr</span><span class="grouping">)</span><span class="grouping">)</span>
            <span class="identifier">readable</span> <span class="arithmetic-assignment">=</span> <span class="identifier">readable</span> <span class="logical-operator">and</span> <span class="identifier">kreadable</span> <span class="logical-operator">and</span> <span class="identifier">vreadable</span>
            <span class="keyword">if</span> <span class="identifier">krecur</span> <span class="logical-operator">or</span> <span class="identifier">vrecur</span><span class="punctuation">:</span>
                <span class="identifier">recursive</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
        <span class="keyword">del</span> <span class="identifier">context</span><span class="grouping">[</span><span class="identifier">objid</span><span class="grouping">]</span>
        <span class="keyword">return</span> <span class="grouping">(</span><span class="string-literal">"%s(%s)" % (typ.__name__, ", "</span><span class="punctuation">.</span><span class="identifier">join</span><span class="grouping">(</span><span class="identifier">components</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">readable</span><span class="punctuation">,</span>
                <span class="identifier">recursive</span><span class="grouping">)</span>

    <span class="identifier">rep</span> <span class="arithmetic-assignment">=</span> <span class="identifier">repr</span><span class="grouping">(</span><span class="identifier">object</span><span class="grouping">)</span>
    <span class="keyword">return</span> <span class="identifier">rep</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">rep</span> <span class="logical-operator">and</span> <span class="logical-operator">not</span> <span class="identifier">rep</span><span class="punctuation">.</span><span class="identifier">startswith</span><span class="grouping">(</span><span class="string-literal">'&lt;'</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="bool-literal">False</span>

    </pre>
  </body>
</html>