<html>
  <head>
    <title>Python Lexical Highliter</title>
    <link rel="stylesheet" href="token_colors.css">
  </head>
  <body>
    <pre><span class="keyword">import</span> <span class="identifier">warnings</span>
<span class="keyword">import</span> <span class="identifier">unittest</span>
<span class="keyword">import</span> <span class="identifier">sys</span>
<span class="keyword">import</span> <span class="identifier">os</span>
<span class="keyword">import</span> <span class="identifier">atexit</span>

<span class="keyword">import</span> <span class="identifier">numpy</span> <span class="keyword">as</span> <span class="identifier">np</span>

<span class="keyword">from</span> <span class="identifier">scipy</span> <span class="keyword">import</span> <span class="identifier">sparse</span>

<span class="keyword">import</span> <span class="identifier">pytest</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">deprecation</span> <span class="keyword">import</span> <span class="identifier">deprecated</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">metaestimators</span> <span class="keyword">import</span> <span class="invalid">i</span><span class="invalid">f</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">h</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">o</span><span class="invalid">d</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">utils</span><span class="punctuation">.</span><span class="identifier">_testing</span> <span class="keyword">import</span> <span class="grouping">(</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="punctuation">,</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="punctuation">,</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="punctuation">,</span>
    <span class="identifier">set_random_state</span><span class="punctuation">,</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="punctuation">,</span>
    <span class="identifier">ignore_warnings</span><span class="punctuation">,</span>
    <span class="identifier">check_docstring_parameters</span><span class="punctuation">,</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">n</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">p</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">e</span><span class="punctuation">,</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">e</span><span class="invalid">x</span><span class="punctuation">,</span>
    <span class="identifier">TempMemmap</span><span class="punctuation">,</span>
    <span class="identifier">create_memmap_backed_data</span><span class="punctuation">,</span>
    <span class="identifier">_delete_folder</span><span class="punctuation">,</span>
    <span class="identifier">_convert_container</span><span class="punctuation">,</span>
    <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="punctuation">,</span>
<span class="grouping">)</span>

<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">tree</span> <span class="keyword">import</span> <span class="identifier">DecisionTreeClassifier</span>
<span class="keyword">from</span> <span class="identifier">sklearn</span><span class="punctuation">.</span><span class="identifier">discriminant_analysis</span> <span class="keyword">import</span> <span class="identifier">LinearDiscriminantAnalysis</span>


<span class="keyword">def</span> <span class="identifier">test_set_random_state</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">lda</span> <span class="arithmetic-assignment">=</span> <span class="identifier">LinearDiscriminantAnalysis</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">tree</span> <span class="arithmetic-assignment">=</span> <span class="identifier">DecisionTreeClassifier</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="comment"># Linear Discriminant Analysis doesn't have random state: smoke test</span>
    <span class="identifier">set_random_state</span><span class="grouping">(</span><span class="identifier">lda</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>
    <span class="identifier">set_random_state</span><span class="grouping">(</span><span class="identifier">tree</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">tree</span><span class="punctuation">.</span><span class="identifier">random_state</span> <span class="relational-operator">==</span> <span class="int-literal">3</span>


<span class="keyword">def</span> <span class="identifier">test_assert_allclose_dense_sparse</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">x</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">arange</span><span class="grouping">(</span><span class="int-literal">9</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">reshape</span><span class="grouping">(</span><span class="int-literal">3</span><span class="punctuation">,</span> <span class="int-literal">3</span><span class="grouping">)</span>
    <span class="identifier">msg</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"Not equal to tolerance "</span>
    <span class="identifier">y</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">csc_matrix</span><span class="grouping">(</span><span class="identifier">x</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">X</span> <span class="relational-operator">in</span> <span class="grouping">[</span><span class="identifier">x</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">]</span><span class="punctuation">:</span>
        <span class="comment"># basic compare</span>
        <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">msg</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">n</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">p</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="arithmetic-operator">*</span><span class="int-literal">2</span><span class="grouping">)</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">n</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">p</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Can only compare two sparse"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">n</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">p</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">x</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span>

    <span class="identifier">A</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">diags</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="int-literal">5</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">offsets</span><span class="arithmetic-assignment">=</span><span class="int-literal">0</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">tocsr</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">B</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">csr_matrix</span><span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="grouping">(</span><span class="int-literal">1</span><span class="punctuation">,</span> <span class="int-literal">5</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Arrays are not equal"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">l</span><span class="invalid">l</span><span class="invalid">c</span><span class="invalid">l</span><span class="invalid">o</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">n</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">s</span><span class="invalid">p</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">B</span><span class="punctuation">,</span> <span class="identifier">A</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_assert_raises_msg</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">with</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">e</span><span class="invalid">x</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="string-literal">'Hello world'</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">msg</span><span class="arithmetic-assignment">=</span><span class="string-literal">'Hello world'</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">pass</span>


<span class="keyword">def</span> <span class="identifier">test_assert_raise_message</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">_raise_ValueError</span><span class="grouping">(</span><span class="identifier">message</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="identifier">message</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_no_raise</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">pass</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="string-literal">"test"</span><span class="punctuation">,</span>
                         <span class="identifier">_raise_ValueError</span><span class="punctuation">,</span> <span class="string-literal">"test"</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span>
                  <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="punctuation">,</span> <span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="string-literal">"something else"</span><span class="punctuation">,</span>
                  <span class="identifier">_raise_ValueError</span><span class="punctuation">,</span> <span class="string-literal">"test"</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span>
                  <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="punctuation">,</span> <span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="string-literal">"something else"</span><span class="punctuation">,</span>
                  <span class="identifier">_raise_ValueError</span><span class="punctuation">,</span> <span class="string-literal">"test"</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span>
                  <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="punctuation">,</span> <span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="string-literal">"test"</span><span class="punctuation">,</span>
                  <span class="identifier">_no_raise</span><span class="grouping">)</span>

    <span class="comment"># multiple exceptions in a tuple</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span>
                  <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">a</span><span class="invalid">g</span><span class="invalid">e</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">AttributeError</span><span class="grouping">)</span><span class="punctuation">,</span>
                  <span class="string-literal">"test"</span><span class="punctuation">,</span> <span class="identifier">_no_raise</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_ignore_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># This check that ignore_warning decorateur and context manager are working</span>
    <span class="comment"># as expected</span>
    <span class="keyword">def</span> <span class="identifier">_warning_function</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span><span class="string-literal">"deprecation warning"</span><span class="punctuation">,</span> <span class="identifier">DeprecationWarning</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">_multiple_warning_function</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span><span class="string-literal">"deprecation warning"</span><span class="punctuation">,</span> <span class="identifier">DeprecationWarning</span><span class="grouping">)</span>
        <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span><span class="string-literal">"deprecation warning"</span><span class="grouping">)</span>

    <span class="comment"># Check the function directly</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">_warning_function</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">_warning_function</span><span class="punctuation">,</span>
                                       <span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">DeprecationWarning</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">DeprecationWarning</span><span class="punctuation">,</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">_warning_function</span><span class="punctuation">,</span>
                                                     <span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">UserWarning</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">UserWarning</span><span class="punctuation">,</span>
                 <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">_multiple_warning_function</span><span class="punctuation">,</span>
                                 <span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">FutureWarning</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">DeprecationWarning</span><span class="punctuation">,</span>
                 <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">_multiple_warning_function</span><span class="punctuation">,</span>
                                 <span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">UserWarning</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">_warning_function</span><span class="punctuation">,</span>
                                       <span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="identifier">DeprecationWarning</span><span class="punctuation">,</span>
                                                 <span class="identifier">UserWarning</span><span class="grouping">)</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="comment"># Check the decorator</span>
    <span class="punctuation">@</span><span class="identifier">ignore_warnings</span>
    <span class="keyword">def</span> <span class="identifier">decorator_no_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>
        <span class="identifier">_multiple_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="identifier">DeprecationWarning</span><span class="punctuation">,</span> <span class="identifier">UserWarning</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="identifier">decorator_no_warning_multiple</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">_multiple_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">DeprecationWarning</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="identifier">decorator_no_deprecation_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">UserWarning</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="identifier">decorator_no_user_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">DeprecationWarning</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="identifier">decorator_no_deprecation_multiple_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">_multiple_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">UserWarning</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="identifier">decorator_no_user_multiple_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">_multiple_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">decorator_no_warning</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">decorator_no_warning_multiple</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">decorator_no_deprecation_warning</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">DeprecationWarning</span><span class="punctuation">,</span> <span class="identifier">decorator_no_user_warning</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">UserWarning</span><span class="punctuation">,</span> <span class="identifier">decorator_no_deprecation_multiple_warning</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">DeprecationWarning</span><span class="punctuation">,</span> <span class="identifier">decorator_no_user_multiple_warning</span><span class="grouping">)</span>

    <span class="comment"># Check the context manager</span>
    <span class="keyword">def</span> <span class="identifier">context_manager_no_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">context_manager_no_warning_multiple</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="identifier">DeprecationWarning</span><span class="punctuation">,</span> <span class="identifier">UserWarning</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">_multiple_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">context_manager_no_deprecation_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">DeprecationWarning</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">context_manager_no_user_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">UserWarning</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">context_manager_no_deprecation_multiple_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">DeprecationWarning</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">_multiple_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">def</span> <span class="identifier">context_manager_no_user_multiple_warning</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">category</span><span class="arithmetic-assignment">=</span><span class="identifier">UserWarning</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">_multiple_warning_function</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">context_manager_no_warning</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">context_manager_no_warning_multiple</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">context_manager_no_deprecation_warning</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">DeprecationWarning</span><span class="punctuation">,</span> <span class="identifier">context_manager_no_user_warning</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">UserWarning</span><span class="punctuation">,</span> <span class="identifier">context_manager_no_deprecation_multiple_warning</span><span class="grouping">)</span>
    <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">DeprecationWarning</span><span class="punctuation">,</span> <span class="identifier">context_manager_no_user_multiple_warning</span><span class="grouping">)</span>

    <span class="comment"># Check that passing warning class as first positional argument</span>
    <span class="identifier">warning_class</span> <span class="arithmetic-assignment">=</span> <span class="identifier">UserWarning</span>
    <span class="identifier">match</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">"'obj' should be a callable.+you should use 'category=UserWarning'"</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">match</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">silence_warnings_func</span> <span class="arithmetic-assignment">=</span> <span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">warning_class</span><span class="grouping">)</span><span class="grouping">(</span>
            <span class="identifier">_warning_function</span><span class="grouping">)</span>
        <span class="identifier">silence_warnings_func</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="identifier">match</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="punctuation">@</span><span class="identifier">ignore_warnings</span><span class="grouping">(</span><span class="identifier">warning_class</span><span class="grouping">)</span>
        <span class="keyword">def</span> <span class="identifier">test</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">pass</span>


<span class="keyword">class</span> <span class="identifier">TestWarns</span><span class="grouping">(</span><span class="identifier">unittest</span><span class="punctuation">.</span><span class="identifier">TestCase</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">test_warn</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">def</span> <span class="identifier">f</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span><span class="string-literal">"yo"</span><span class="grouping">)</span>
            <span class="keyword">return</span> <span class="int-literal">3</span>

        <span class="keyword">with</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">catch_warnings</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">simplefilter</span><span class="grouping">(</span><span class="string-literal">"ignore"</span><span class="punctuation">,</span> <span class="identifier">UserWarning</span><span class="grouping">)</span>
            <span class="identifier">filters_orig</span> <span class="arithmetic-assignment">=</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">filters</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span>
            <span class="keyword">assert</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">UserWarning</span><span class="punctuation">,</span> <span class="identifier">f</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">3</span>
            <span class="comment"># test that assert_warns doesn't have side effects on warnings</span>
            <span class="comment"># filters</span>
            <span class="keyword">assert</span> <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">filters</span> <span class="relational-operator">==</span> <span class="identifier">filters_orig</span>
        <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">f</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">n</span><span class="invalid">o</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">i</span><span class="invalid">n</span><span class="invalid">g</span><span class="invalid">s</span><span class="grouping">(</span><span class="keyword">lambda</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="identifier">x</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">)</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>

    <span class="keyword">def</span> <span class="identifier">test_warn_wrong_warning</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">def</span> <span class="identifier">f</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="identifier">warnings</span><span class="punctuation">.</span><span class="identifier">warn</span><span class="grouping">(</span><span class="string-literal">"yo"</span><span class="punctuation">,</span> <span class="identifier">FutureWarning</span><span class="grouping">)</span>

        <span class="identifier">failed</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">False</span>
        <span class="identifier">filters</span> <span class="arithmetic-assignment">=</span> <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">modules</span><span class="grouping">[</span><span class="string-literal">'warnings'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">filters</span><span class="grouping">[</span><span class="punctuation">:</span><span class="grouping">]</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="keyword">try</span><span class="punctuation">:</span>
                <span class="comment"># Should raise an AssertionError</span>

                <span class="comment"># assert_warns has a special handling of "FutureWarning" that</span>
                <span class="comment"># pytest.warns does not have</span>
                <span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">w</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">UserWarning</span><span class="punctuation">,</span> <span class="identifier">f</span><span class="grouping">)</span>
                <span class="identifier">failed</span> <span class="arithmetic-assignment">=</span> <span class="bool-literal">True</span>
            <span class="keyword">except</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">:</span>
                <span class="keyword">pass</span>
        <span class="keyword">finally</span><span class="punctuation">:</span>
            <span class="identifier">sys</span><span class="punctuation">.</span><span class="identifier">modules</span><span class="grouping">[</span><span class="string-literal">'warnings'</span><span class="grouping">]</span><span class="punctuation">.</span><span class="identifier">filters</span> <span class="arithmetic-assignment">=</span> <span class="identifier">filters</span>

        <span class="keyword">if</span> <span class="identifier">failed</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">(</span><span class="string-literal">"wrong warning caught by assert_warn"</span><span class="grouping">)</span>


<span class="comment"># Tests for docstrings:</span>

<span class="keyword">def</span> <span class="identifier">f_ok</span><span class="grouping">(</span><span class="identifier">a</span><span class="punctuation">,</span> <span class="identifier">b</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Function f

    Parameters
    ----------
    a : int
        Parameter a
    b : float
        Parameter b

    Returns
    -------
    c : list
        Parameter c
    """</span>
    <span class="identifier">c</span> <span class="arithmetic-assignment">=</span> <span class="identifier">a</span> <span class="arithmetic-operator">+</span> <span class="identifier">b</span>
    <span class="keyword">return</span> <span class="identifier">c</span>


<span class="keyword">def</span> <span class="identifier">f_bad_sections</span><span class="grouping">(</span><span class="identifier">a</span><span class="punctuation">,</span> <span class="identifier">b</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Function f

    Parameters
    ----------
    a : int
        Parameter a
    b : float
        Parameter b

    Results
    -------
    c : list
        Parameter c
    """</span>
    <span class="identifier">c</span> <span class="arithmetic-assignment">=</span> <span class="identifier">a</span> <span class="arithmetic-operator">+</span> <span class="identifier">b</span>
    <span class="keyword">return</span> <span class="identifier">c</span>


<span class="keyword">def</span> <span class="identifier">f_bad_order</span><span class="grouping">(</span><span class="identifier">b</span><span class="punctuation">,</span> <span class="identifier">a</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Function f

    Parameters
    ----------
    a : int
        Parameter a
    b : float
        Parameter b

    Returns
    -------
    c : list
        Parameter c
    """</span>
    <span class="identifier">c</span> <span class="arithmetic-assignment">=</span> <span class="identifier">a</span> <span class="arithmetic-operator">+</span> <span class="identifier">b</span>
    <span class="keyword">return</span> <span class="identifier">c</span>


<span class="keyword">def</span> <span class="identifier">f_too_many_param_docstring</span><span class="grouping">(</span><span class="identifier">a</span><span class="punctuation">,</span> <span class="identifier">b</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Function f

    Parameters
    ----------
    a : int
        Parameter a
    b : int
        Parameter b
    c : int
        Parameter c

    Returns
    -------
    d : list
        Parameter c
    """</span>
    <span class="identifier">d</span> <span class="arithmetic-assignment">=</span> <span class="identifier">a</span> <span class="arithmetic-operator">+</span> <span class="identifier">b</span>
    <span class="keyword">return</span> <span class="identifier">d</span>


<span class="keyword">def</span> <span class="identifier">f_missing</span><span class="grouping">(</span><span class="identifier">a</span><span class="punctuation">,</span> <span class="identifier">b</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Function f

    Parameters
    ----------
    a : int
        Parameter a

    Returns
    -------
    c : list
        Parameter c
    """</span>
    <span class="identifier">c</span> <span class="arithmetic-assignment">=</span> <span class="identifier">a</span> <span class="arithmetic-operator">+</span> <span class="identifier">b</span>
    <span class="keyword">return</span> <span class="identifier">c</span>


<span class="keyword">def</span> <span class="identifier">f_check_param_definition</span><span class="grouping">(</span><span class="identifier">a</span><span class="punctuation">,</span> <span class="identifier">b</span><span class="punctuation">,</span> <span class="identifier">c</span><span class="punctuation">,</span> <span class="identifier">d</span><span class="punctuation">,</span> <span class="identifier">e</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Function f

    Parameters
    ----------
    a: int
        Parameter a
    b:
        Parameter b
    c :
        Parameter c
    d:int
        Parameter d
    e
        No typespec is allowed without colon
    """</span>
    <span class="keyword">return</span> <span class="identifier">a</span> <span class="arithmetic-operator">+</span> <span class="identifier">b</span> <span class="arithmetic-operator">+</span> <span class="identifier">c</span> <span class="arithmetic-operator">+</span> <span class="identifier">d</span>


<span class="keyword">class</span> <span class="identifier">Klass</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">f_missing</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">pass</span>

    <span class="keyword">def</span> <span class="identifier">f_bad_sections</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Function f

        Parameter
        ----------
        a : int
            Parameter a
        b : float
            Parameter b

        Results
        -------
        c : list
            Parameter c
        """</span>
        <span class="keyword">pass</span>


<span class="keyword">class</span> <span class="identifier">MockEst</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""MockEstimator"""</span>
    <span class="keyword">def</span> <span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">X</span>

    <span class="keyword">def</span> <span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">X</span>

    <span class="keyword">def</span> <span class="identifier">predict_proba</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="identifier">X</span>

    <span class="keyword">def</span> <span class="identifier">score</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="int-literal">1</span><span class="punctuation">.</span>


<span class="keyword">class</span> <span class="identifier">MockMetaEstimator</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""MetaEstimator to check if doctest on delegated methods work.

        Parameters
        ---------
        delegate : estimator
            Delegated estimator.
        """</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span> <span class="arithmetic-assignment">=</span> <span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span>

    <span class="punctuation">@</span><span class="invalid">i</span><span class="invalid">f</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">h</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">o</span><span class="invalid">d</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="string-literal">'delegate'</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""This is available only if delegate has predict.

        Parameters
        ----------
        y : ndarray
            Parameter y
        """</span>
        <span class="keyword">return</span> <span class="identifier">self</span><span class="punctuation">.</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="punctuation">.</span><span class="identifier">predict</span><span class="grouping">(</span><span class="identifier">X</span><span class="grouping">)</span>

    <span class="punctuation">@</span><span class="invalid">i</span><span class="invalid">f</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">h</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">o</span><span class="invalid">d</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="string-literal">'delegate'</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="punctuation">@</span><span class="identifier">deprecated</span><span class="grouping">(</span><span class="string-literal">"Testing a deprecated delegated method"</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="identifier">score</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""This is available only if delegate has score.

        Parameters
        ---------
        y : ndarray
            Parameter y
        """</span>

    <span class="punctuation">@</span><span class="invalid">i</span><span class="invalid">f</span><span class="invalid">_</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="invalid">_</span><span class="invalid">h</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">h</span><span class="invalid">o</span><span class="invalid">d</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="arithmetic-assignment">=</span><span class="grouping">(</span><span class="string-literal">'delegate'</span><span class="grouping">)</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="identifier">predict_proba</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""This is available only if delegate has predict_proba.

        Parameters
        ---------
        X : ndarray
            Parameter X
        """</span>
        <span class="keyword">return</span> <span class="identifier">X</span>

    <span class="punctuation">@</span><span class="identifier">deprecated</span><span class="grouping">(</span><span class="string-literal">'Testing deprecated function with wrong params'</span><span class="grouping">)</span>
    <span class="keyword">def</span> <span class="identifier">fit</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">X</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment">"""Incorrect docstring but should not be tested"""</span>


<span class="keyword">def</span> <span class="identifier">test_check_docstring_parameters</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">i</span><span class="invalid">m</span><span class="invalid">p</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">o</span><span class="invalid">r</span><span class="invalid">s</span><span class="invalid">k</span><span class="invalid">i</span><span class="invalid">p</span><span class="grouping">(</span><span class="string-literal">'numpydoc'</span><span class="punctuation">,</span>
                        <span class="identifier">reason</span><span class="arithmetic-assignment">=</span><span class="string-literal">"numpydoc is required to test the docstrings"</span><span class="grouping">)</span>

    <span class="identifier">incorrect</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span><span class="identifier">f_ok</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">incorrect</span> <span class="relational-operator">==</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="identifier">incorrect</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span><span class="identifier">f_ok</span><span class="punctuation">,</span> <span class="identifier">ignore</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'b'</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">incorrect</span> <span class="relational-operator">==</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="identifier">incorrect</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span><span class="identifier">f_missing</span><span class="punctuation">,</span> <span class="identifier">ignore</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">'b'</span><span class="grouping">]</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">incorrect</span> <span class="relational-operator">==</span> <span class="grouping">[</span><span class="grouping">]</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">RuntimeError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Unknown section Results"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span><span class="identifier">f_bad_sections</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">RuntimeError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Unknown section Parameter"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span><span class="identifier">Klass</span><span class="punctuation">.</span><span class="identifier">f_bad_sections</span><span class="grouping">)</span>

    <span class="identifier">incorrect</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span><span class="identifier">f_check_param_definition</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="grouping">(</span>
        <span class="identifier">incorrect</span> <span class="relational-operator">==</span> <span class="grouping">[</span>
            <span class="string-literal">"sklearn.utils.tests.test_testing.f_check_param_definition There "</span>
            <span class="string-literal">"was no space between the param name and colon ('a: int')"</span><span class="punctuation">,</span>

            <span class="string-literal">"sklearn.utils.tests.test_testing.f_check_param_definition There "</span>
            <span class="string-literal">"was no space between the param name and colon ('b:')"</span><span class="punctuation">,</span>

            <span class="string-literal">"sklearn.utils.tests.test_testing.f_check_param_definition "</span>
            <span class="string-literal">"Parameter 'c :' has an empty type spec. Remove the colon"</span><span class="punctuation">,</span>

            <span class="string-literal">"sklearn.utils.tests.test_testing.f_check_param_definition There "</span>
            <span class="string-literal">"was no space between the param name and colon ('d:int')"</span><span class="punctuation">,</span>
        <span class="grouping">]</span><span class="grouping">)</span>

    <span class="identifier">messages</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span>
            <span class="grouping">[</span><span class="string-literal">"In function: sklearn.utils.tests.test_testing.f_bad_order"</span><span class="punctuation">,</span>
             <span class="string-literal">"There's a parameter name mismatch in function docstring w.r.t."</span>
             <span class="string-literal">" function signature, at index 0 diff: 'b' != 'a'"</span><span class="punctuation">,</span>
             <span class="string-literal">"Full diff:"</span><span class="punctuation">,</span>
             <span class="string-literal">"- ['b', 'a']"</span><span class="punctuation">,</span>
             <span class="string-literal">"+ ['a', 'b']"</span><span class="grouping">]</span><span class="punctuation">,</span>

            <span class="grouping">[</span><span class="string-literal">"In function: "</span> <span class="arithmetic-operator">+</span>
                <span class="string-literal">"sklearn.utils.tests.test_testing.f_too_many_param_docstring"</span><span class="punctuation">,</span>
             <span class="string-literal">"Parameters in function docstring have more items w.r.t. function"</span>
             <span class="string-literal">" signature, first extra item: c"</span><span class="punctuation">,</span>
             <span class="string-literal">"Full diff:"</span><span class="punctuation">,</span>
             <span class="string-literal">"- ['a', 'b']"</span><span class="punctuation">,</span>
             <span class="string-literal">"+ ['a', 'b', 'c']"</span><span class="punctuation">,</span>
             <span class="string-literal">"?          +++++"</span><span class="grouping">]</span><span class="punctuation">,</span>

            <span class="grouping">[</span><span class="string-literal">"In function: sklearn.utils.tests.test_testing.f_missing"</span><span class="punctuation">,</span>
             <span class="string-literal">"Parameters in function docstring have less items w.r.t. function"</span>
             <span class="string-literal">" signature, first missing item: b"</span><span class="punctuation">,</span>
             <span class="string-literal">"Full diff:"</span><span class="punctuation">,</span>
             <span class="string-literal">"- ['a', 'b']"</span><span class="punctuation">,</span>
             <span class="string-literal">"+ ['a']"</span><span class="grouping">]</span><span class="punctuation">,</span>

            <span class="grouping">[</span><span class="string-literal">"In function: sklearn.utils.tests.test_testing.Klass.f_missing"</span><span class="punctuation">,</span>
             <span class="string-literal">"Parameters in function docstring have less items w.r.t. function"</span>
             <span class="string-literal">" signature, first missing item: X"</span><span class="punctuation">,</span>
             <span class="string-literal">"Full diff:"</span><span class="punctuation">,</span>
             <span class="string-literal">"- ['X', 'y']"</span><span class="punctuation">,</span>
             <span class="string-literal">"+ []"</span><span class="grouping">]</span><span class="punctuation">,</span>

            <span class="grouping">[</span><span class="string-literal">"In function: "</span> <span class="arithmetic-operator">+</span>
             <span class="string-literal">"sklearn.utils.tests.test_testing.MockMetaEstimator.predict"</span><span class="punctuation">,</span>
             <span class="string-literal">"There's a parameter name mismatch in function docstring w.r.t."</span>
             <span class="string-literal">" function signature, at index 0 diff: 'X' != 'y'"</span><span class="punctuation">,</span>
             <span class="string-literal">"Full diff:"</span><span class="punctuation">,</span>
             <span class="string-literal">"- ['X']"</span><span class="punctuation">,</span>
             <span class="string-literal">"?   ^"</span><span class="punctuation">,</span>
             <span class="string-literal">"+ ['y']"</span><span class="punctuation">,</span>
             <span class="string-literal">"?   ^"</span><span class="grouping">]</span><span class="punctuation">,</span>

            <span class="grouping">[</span><span class="string-literal">"In function: "</span> <span class="arithmetic-operator">+</span>
             <span class="string-literal">"sklearn.utils.tests.test_testing.MockMetaEstimator."</span>
             <span class="arithmetic-operator">+</span> <span class="string-literal">"predict_proba"</span><span class="punctuation">,</span>
             <span class="string-literal">"Parameters in function docstring have less items w.r.t. function"</span>
             <span class="string-literal">" signature, first missing item: X"</span><span class="punctuation">,</span>
             <span class="string-literal">"Full diff:"</span><span class="punctuation">,</span>
             <span class="string-literal">"- ['X']"</span><span class="punctuation">,</span>
             <span class="string-literal">"+ []"</span><span class="grouping">]</span><span class="punctuation">,</span>

            <span class="grouping">[</span><span class="string-literal">"In function: "</span> <span class="arithmetic-operator">+</span>
                <span class="string-literal">"sklearn.utils.tests.test_testing.MockMetaEstimator.score"</span><span class="punctuation">,</span>
             <span class="string-literal">"Parameters in function docstring have less items w.r.t. function"</span>
             <span class="string-literal">" signature, first missing item: X"</span><span class="punctuation">,</span>
             <span class="string-literal">"Full diff:"</span><span class="punctuation">,</span>
             <span class="string-literal">"- ['X']"</span><span class="punctuation">,</span>
             <span class="string-literal">"+ []"</span><span class="grouping">]</span><span class="punctuation">,</span>

            <span class="grouping">[</span><span class="string-literal">"In function: "</span> <span class="arithmetic-operator">+</span>
                <span class="string-literal">"sklearn.utils.tests.test_testing.MockMetaEstimator.fit"</span><span class="punctuation">,</span>
             <span class="string-literal">"Parameters in function docstring have less items w.r.t. function"</span>
             <span class="string-literal">" signature, first missing item: X"</span><span class="punctuation">,</span>
             <span class="string-literal">"Full diff:"</span><span class="punctuation">,</span>
             <span class="string-literal">"- ['X', 'y']"</span><span class="punctuation">,</span>
             <span class="string-literal">"+ []"</span><span class="grouping">]</span><span class="punctuation">,</span>

            <span class="grouping">]</span>

    <span class="identifier">mock_meta</span> <span class="arithmetic-assignment">=</span> <span class="identifier">MockMetaEstimator</span><span class="grouping">(</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">l</span><span class="invalid">e</span><span class="invalid">g</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">e</span><span class="arithmetic-assignment">=</span><span class="identifier">MockEst</span><span class="grouping">(</span><span class="grouping">)</span><span class="grouping">)</span>

    <span class="keyword">for</span> <span class="identifier">msg</span><span class="punctuation">,</span> <span class="identifier">f</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">messages</span><span class="punctuation">,</span>
                      <span class="grouping">[</span><span class="identifier">f_bad_order</span><span class="punctuation">,</span>
                       <span class="identifier">f_too_many_param_docstring</span><span class="punctuation">,</span>
                       <span class="identifier">f_missing</span><span class="punctuation">,</span>
                       <span class="identifier">Klass</span><span class="punctuation">.</span><span class="identifier">f_missing</span><span class="punctuation">,</span>
                       <span class="identifier">mock_meta</span><span class="punctuation">.</span><span class="identifier">predict</span><span class="punctuation">,</span>
                       <span class="identifier">mock_meta</span><span class="punctuation">.</span><span class="identifier">predict_proba</span><span class="punctuation">,</span>
                       <span class="identifier">mock_meta</span><span class="punctuation">.</span><span class="identifier">score</span><span class="punctuation">,</span>
                       <span class="identifier">mock_meta</span><span class="punctuation">.</span><span class="identifier">fit</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">incorrect</span> <span class="arithmetic-assignment">=</span> <span class="identifier">check_docstring_parameters</span><span class="grouping">(</span><span class="identifier">f</span><span class="grouping">)</span>
        <span class="keyword">assert</span> <span class="identifier">msg</span> <span class="relational-operator">==</span> <span class="identifier">incorrect</span><span class="punctuation">,</span> <span class="grouping">(</span><span class="string-literal">'\n"%s"\n not in \n"%s"'</span> <span class="arithmetic-operator">%</span> <span class="grouping">(</span><span class="identifier">msg</span><span class="punctuation">,</span> <span class="identifier">incorrect</span><span class="grouping">)</span><span class="grouping">)</span>


<span class="keyword">class</span> <span class="identifier">RegistrationCounter</span><span class="punctuation">:</span>
    <span class="keyword">def</span> <span class="identifier">__init__</span><span class="grouping">(</span><span class="identifier">self</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">nb_calls</span> <span class="arithmetic-assignment">=</span> <span class="int-literal">0</span>

    <span class="keyword">def</span> <span class="identifier">__call__</span><span class="grouping">(</span><span class="identifier">self</span><span class="punctuation">,</span> <span class="identifier">to_register_func</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">self</span><span class="punctuation">.</span><span class="identifier">nb_calls</span> <span class="arithmetic-assignment">+=</span> <span class="int-literal">1</span>
        <span class="keyword">assert</span> <span class="identifier">to_register_func</span><span class="punctuation">.</span><span class="identifier">func</span> <span class="relational-operator">is</span> <span class="identifier">_delete_folder</span>


<span class="keyword">def</span> <span class="identifier">check_memmap</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">mmap_data</span><span class="punctuation">,</span> <span class="identifier">mmap_mode</span><span class="arithmetic-assignment">=</span><span class="string-literal">'r'</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="keyword">assert</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">mmap_data</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">memmap</span><span class="grouping">)</span>
    <span class="identifier">writeable</span> <span class="arithmetic-assignment">=</span> <span class="identifier">mmap_mode</span> <span class="relational-operator">!=</span> <span class="string-literal">'r'</span>
    <span class="keyword">assert</span> <span class="identifier">mmap_data</span><span class="punctuation">.</span><span class="identifier">flags</span><span class="punctuation">.</span><span class="identifier">writeable</span> <span class="relational-operator">is</span> <span class="identifier">writeable</span>
    <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">testing</span><span class="punctuation">.</span><span class="invalid">a</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">y</span><span class="invalid">_</span><span class="invalid">e</span><span class="invalid">q</span><span class="invalid">u</span><span class="invalid">a</span><span class="invalid">l</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">mmap_data</span><span class="grouping">)</span>


<span class="keyword">def</span> <span class="identifier">test_tempmemmap</span><span class="grouping">(</span><span class="identifier">monkeypatch</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">registration_counter</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RegistrationCounter</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">monkeypatch</span><span class="punctuation">.</span><span class="identifier">setattr</span><span class="grouping">(</span><span class="identifier">atexit</span><span class="punctuation">,</span> <span class="string-literal">'register'</span><span class="punctuation">,</span> <span class="identifier">registration_counter</span><span class="grouping">)</span>

    <span class="identifier">input_array</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="int-literal">3</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">TempMemmap</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">data</span><span class="punctuation">:</span>
        <span class="identifier">check_memmap</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">)</span>
        <span class="identifier">temp_folder</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">filename</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="relational-operator">!=</span> <span class="string-literal">'nt'</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">temp_folder</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">registration_counter</span><span class="punctuation">.</span><span class="identifier">nb_calls</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>

    <span class="identifier">mmap_mode</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'r+'</span>
    <span class="keyword">with</span> <span class="identifier">TempMemmap</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">mmap_mode</span><span class="arithmetic-assignment">=</span><span class="identifier">mmap_mode</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">data</span><span class="punctuation">:</span>
        <span class="identifier">check_memmap</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">mmap_mode</span><span class="arithmetic-assignment">=</span><span class="identifier">mmap_mode</span><span class="grouping">)</span>
        <span class="identifier">temp_folder</span> <span class="arithmetic-assignment">=</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">filename</span><span class="grouping">)</span>
    <span class="keyword">if</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">name</span> <span class="relational-operator">!=</span> <span class="string-literal">'nt'</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">exists</span><span class="grouping">(</span><span class="identifier">temp_folder</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">registration_counter</span><span class="punctuation">.</span><span class="identifier">nb_calls</span> <span class="relational-operator">==</span> <span class="int-literal">2</span>


<span class="keyword">def</span> <span class="identifier">test_create_memmap_backed_data</span><span class="grouping">(</span><span class="identifier">monkeypatch</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="identifier">registration_counter</span> <span class="arithmetic-assignment">=</span> <span class="identifier">RegistrationCounter</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">monkeypatch</span><span class="punctuation">.</span><span class="identifier">setattr</span><span class="grouping">(</span><span class="identifier">atexit</span><span class="punctuation">,</span> <span class="string-literal">'register'</span><span class="punctuation">,</span> <span class="identifier">registration_counter</span><span class="grouping">)</span>

    <span class="identifier">input_array</span> <span class="arithmetic-assignment">=</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ones</span><span class="grouping">(</span><span class="int-literal">3</span><span class="grouping">)</span>
    <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">create_memmap_backed_data</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="grouping">)</span>
    <span class="identifier">check_memmap</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">registration_counter</span><span class="punctuation">.</span><span class="identifier">nb_calls</span> <span class="relational-operator">==</span> <span class="int-literal">1</span>

    <span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">folder</span> <span class="arithmetic-assignment">=</span> <span class="identifier">create_memmap_backed_data</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span>
                                             <span class="invalid">r</span><span class="invalid">e</span><span class="invalid">t</span><span class="invalid">u</span><span class="invalid">r</span><span class="invalid">n</span><span class="invalid">_</span><span class="invalid">f</span><span class="invalid">o</span><span class="invalid">l</span><span class="invalid">d</span><span class="invalid">e</span><span class="invalid">r</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span>
    <span class="identifier">check_memmap</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">folder</span> <span class="relational-operator">==</span> <span class="identifier">os</span><span class="punctuation">.</span><span class="identifier">path</span><span class="punctuation">.</span><span class="identifier">dirname</span><span class="grouping">(</span><span class="identifier">data</span><span class="punctuation">.</span><span class="identifier">filename</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">registration_counter</span><span class="punctuation">.</span><span class="identifier">nb_calls</span> <span class="relational-operator">==</span> <span class="int-literal">2</span>

    <span class="identifier">mmap_mode</span> <span class="arithmetic-assignment">=</span> <span class="string-literal">'r+'</span>
    <span class="identifier">data</span> <span class="arithmetic-assignment">=</span> <span class="identifier">create_memmap_backed_data</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">mmap_mode</span><span class="arithmetic-assignment">=</span><span class="identifier">mmap_mode</span><span class="grouping">)</span>
    <span class="identifier">check_memmap</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="punctuation">,</span> <span class="identifier">mmap_mode</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">registration_counter</span><span class="punctuation">.</span><span class="identifier">nb_calls</span> <span class="relational-operator">==</span> <span class="int-literal">3</span>

    <span class="identifier">input_list</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">input_array</span> <span class="arithmetic-operator">+</span> <span class="int-literal">1</span><span class="punctuation">,</span> <span class="identifier">input_array</span> <span class="arithmetic-operator">+</span> <span class="int-literal">2</span><span class="grouping">]</span>
    <span class="identifier">mmap_data_list</span> <span class="arithmetic-assignment">=</span> <span class="identifier">create_memmap_backed_data</span><span class="grouping">(</span><span class="identifier">input_list</span><span class="grouping">)</span>
    <span class="keyword">for</span> <span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">data</span> <span class="relational-operator">in</span> <span class="identifier">zip</span><span class="grouping">(</span><span class="identifier">input_list</span><span class="punctuation">,</span> <span class="identifier">mmap_data_list</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="identifier">check_memmap</span><span class="grouping">(</span><span class="identifier">input_array</span><span class="punctuation">,</span> <span class="identifier">data</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">registration_counter</span><span class="punctuation">.</span><span class="identifier">nb_calls</span> <span class="relational-operator">==</span> <span class="int-literal">4</span>


<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="string-literal">"constructor_name, container_type"</span><span class="punctuation">,</span>
    <span class="grouping">[</span>
        <span class="grouping">(</span><span class="string-literal">'list'</span><span class="punctuation">,</span> <span class="identifier">list</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">'tuple'</span><span class="punctuation">,</span> <span class="identifier">tuple</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">'array'</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">ndarray</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">'sparse'</span><span class="punctuation">,</span> <span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">csr_matrix</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">'sparse_csr'</span><span class="punctuation">,</span> <span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">csr_matrix</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">'sparse_csc'</span><span class="punctuation">,</span> <span class="identifier">sparse</span><span class="punctuation">.</span><span class="identifier">csc_matrix</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">'dataframe', lambda: pytest.importorskip('pandas'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">DataFrame</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">'series', lambda: pytest.importorskip('pandas'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">Series</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">'index', lambda: pytest.importorskip('pandas'</span><span class="grouping">)</span><span class="punctuation">.</span><span class="identifier">Index</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="string-literal">'slice'</span><span class="punctuation">,</span> <span class="identifier">slice</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">]</span>
<span class="grouping">)</span>
<span class="punctuation">@</span><span class="identifier">pytest</span><span class="punctuation">.</span><span class="identifier">mark</span><span class="punctuation">.</span><span class="identifier">parametrize</span><span class="grouping">(</span>
    <span class="string-literal">"dtype, superdtype"</span><span class="punctuation">,</span>
    <span class="grouping">[</span>
        <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">int32</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">integer</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">int64</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">integer</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float32</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">floating</span><span class="grouping">)</span><span class="punctuation">,</span>
        <span class="grouping">(</span><span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">float64</span><span class="punctuation">,</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">floating</span><span class="grouping">)</span><span class="punctuation">,</span>
    <span class="grouping">]</span>
<span class="grouping">)</span>
<span class="keyword">def</span> <span class="identifier">test_convert_container</span><span class="grouping">(</span>
    <span class="identifier">constructor_name</span><span class="punctuation">,</span> <span class="identifier">container_type</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="punctuation">,</span> <span class="identifier">superdtype</span><span class="punctuation">,</span>
<span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment">"""Check that we convert the container to the right type of array with the
    right data type."""</span>
    <span class="keyword">if</span> <span class="identifier">constructor_name</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="string-literal">"dataframe", "series", "index"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># delay the import of pandas within the function to only skip this test</span>
        <span class="comment"># instead of the whole file</span>
        <span class="identifier">container_type</span> <span class="arithmetic-assignment">=</span> <span class="identifier">container_type</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="identifier">container</span> <span class="arithmetic-assignment">=</span> <span class="grouping">[</span><span class="int-literal">0</span><span class="punctuation">,</span> <span class="int-literal">1</span><span class="grouping">]</span>
    <span class="identifier">container_converted</span> <span class="arithmetic-assignment">=</span> <span class="identifier">_convert_container</span><span class="grouping">(</span>
        <span class="identifier">container</span><span class="punctuation">,</span> <span class="identifier">constructor_name</span><span class="punctuation">,</span> <span class="identifier">dtype</span><span class="arithmetic-assignment">=</span><span class="identifier">dtype</span><span class="punctuation">,</span>
    <span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">isinstance</span><span class="grouping">(</span><span class="identifier">container_converted</span><span class="punctuation">,</span> <span class="identifier">container_type</span><span class="grouping">)</span>

    <span class="keyword">if</span> <span class="identifier">constructor_name</span> <span class="relational-operator">in</span> <span class="grouping">(</span><span class="string-literal">"list", "tuple", "index"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="comment"># list and tuple will use Python class dtype: int, float</span>
        <span class="comment"># pandas index will always use high precision: np.int64 and np.float64</span>
        <span class="keyword">assert</span> <span class="identifier">np</span><span class="punctuation">.</span><span class="identifier">issubdtype</span><span class="grouping">(</span><span class="identifier">type</span><span class="grouping">(</span><span class="identifier">container_converted</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span><span class="grouping">)</span><span class="punctuation">,</span> <span class="identifier">superdtype</span><span class="grouping">)</span>
    <span class="keyword">elif</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">container_converted</span><span class="punctuation">,</span> <span class="string-literal">"dtype"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="identifier">container_converted</span><span class="punctuation">.</span><span class="identifier">dtype</span> <span class="relational-operator">==</span> <span class="identifier">dtype</span>
    <span class="keyword">elif</span> <span class="identifier">hasattr</span><span class="grouping">(</span><span class="identifier">container_converted</span><span class="punctuation">,</span> <span class="string-literal">"dtypes"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">assert</span> <span class="identifier">container_converted</span><span class="punctuation">.</span><span class="identifier">dtypes</span><span class="grouping">[</span><span class="int-literal">0</span><span class="grouping">]</span> <span class="relational-operator">==</span> <span class="identifier">dtype</span>


<span class="keyword">def</span> <span class="identifier">test_raises</span><span class="grouping">(</span><span class="grouping">)</span><span class="punctuation">:</span>
    <span class="comment"># Tests for the raises context manager</span>

    <span class="comment"># Proper type, no match</span>
    <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">TypeError</span><span class="grouping">(</span><span class="grouping">)</span>

    <span class="comment"># Proper type, proper match</span>
    <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"how are you"</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">cm</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">TypeError</span><span class="grouping">(</span><span class="string-literal">"hello how are you"</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span>

    <span class="comment"># Proper type, proper match with multiple patterns</span>
    <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="grouping">[</span><span class="string-literal">"not this one", "how are you"</span><span class="grouping">]</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">cm</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">TypeError</span><span class="grouping">(</span><span class="string-literal">"hello how are you"</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span>

    <span class="comment"># bad type, no match</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"this will be raised"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">cm</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"this will be raised"</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span>

    <span class="comment"># Bad type, no match, with a err_msg</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"the failure message"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">err_msg</span><span class="arithmetic-assignment">=</span><span class="string-literal">"the failure message"</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">cm</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span>

    <span class="comment"># bad type, with match (is ignored anyway)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">ValueError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"this will be raised"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"this is ignored"</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">cm</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="string-literal">"this will be raised"</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span>

    <span class="comment"># proper type but bad match</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span>
        <span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"should contain one of the following patterns"</span>
    <span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"hello"</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">cm</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">TypeError</span><span class="grouping">(</span><span class="string-literal">"Bad message"</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span>

    <span class="comment"># proper type but bad match, with err_msg</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"the failure message"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span>
            <span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"hello", err_msg="the failure message"</span>
        <span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">cm</span><span class="punctuation">:</span>
            <span class="keyword">raise</span> <span class="identifier">TypeError</span><span class="grouping">(</span><span class="string-literal">"Bad message"</span><span class="grouping">)</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span>

    <span class="comment"># no raise with default may_pass=False</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"Did not raise"</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">cm</span><span class="punctuation">:</span>
            <span class="keyword">pass</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span>

    <span class="comment"># no raise with may_pass=True</span>
    <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">match</span><span class="arithmetic-assignment">=</span><span class="string-literal">"hello"</span><span class="punctuation">,</span> <span class="identifier">may_pass</span><span class="arithmetic-assignment">=</span><span class="bool-literal">True</span><span class="grouping">)</span> <span class="keyword">as</span> <span class="identifier">cm</span><span class="punctuation">:</span>
        <span class="keyword">pass</span>  <span class="comment"># still OK</span>
    <span class="keyword">assert</span> <span class="logical-operator">not</span> <span class="identifier">cm</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">a</span><span class="invalid">n</span><span class="invalid">d</span><span class="invalid">_</span><span class="invalid">m</span><span class="invalid">a</span><span class="invalid">t</span><span class="invalid">c</span><span class="invalid">h</span><span class="invalid">e</span><span class="invalid">d</span>

    <span class="comment"># Multiple exception types:</span>
    <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">ValueError</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">TypeError</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">ValueError</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="identifier">ValueError</span><span class="grouping">(</span><span class="grouping">)</span>
    <span class="keyword">with</span> <span class="identifier">pytest</span><span class="punctuation">.</span><span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="invalid">A</span><span class="invalid">s</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">r</span><span class="invalid">t</span><span class="invalid">i</span><span class="invalid">o</span><span class="invalid">n</span><span class="invalid">E</span><span class="invalid">r</span><span class="invalid">r</span><span class="invalid">o</span><span class="invalid">r</span><span class="grouping">)</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="invalid">r</span><span class="invalid">a</span><span class="invalid">i</span><span class="invalid">s</span><span class="invalid">e</span><span class="invalid">s</span><span class="grouping">(</span><span class="grouping">(</span><span class="identifier">TypeError</span><span class="punctuation">,</span> <span class="identifier">ValueError</span><span class="grouping">)</span><span class="grouping">)</span><span class="punctuation">:</span>
            <span class="keyword">pass</span>

    </pre>
  </body>
</html>